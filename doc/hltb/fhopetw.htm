<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script type="text/javascript">
//<![CDATA[
var version = {title: "TiddlyWiki", major: 2, minor: 2, revision: 5, date: new Date("Aug 24, 2007"), extensions: {}};
//]]>
</script>
<!--
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) UnaMesa Association 2004-2007

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
-->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml'/>
<!--}}}-->
<!--PRE-HEAD-END-->
<title> FhopeccTW - 20090713 </title>
<style type="text/css">
#saveTest {display:none;}
#messageArea {display:none;}
#copyright {display:none;}
#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#shadowArea {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}
</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.checkUnsavedChanges) checkUnsavedChanges(); if(window.scrubNodes) scrubNodes(document.body);">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston, Copyright &copy; 2007 UnaMesa Association
</div>
<noscript>
	<div id="javascriptWarning">This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.</div>
</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
	<div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="ColorPalette">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88</pre>
</div>
<div title="StyleSheetColors">
<pre>/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {background:[[ColorPalette::PrimaryMid]];}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected{color:[[ColorPalette::PrimaryDark]];
	background:[[ColorPalette::TertiaryPale]];
	border-left:1px solid [[ColorPalette::TertiaryLight]];
	border-top:1px solid [[ColorPalette::TertiaryLight]];
	border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}
.wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}
.wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}
.wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];
	border:1px solid [[ColorPalette::PrimaryMid]];}
.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
	border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
	border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}

#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}
#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}
.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}
.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}
.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button {border:none;}

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.sparkline {background:[[ColorPalette::PrimaryPale]]; border:0;}
.sparktick {background:[[ColorPalette::PrimaryDark]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}
.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}
.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}

.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:'alpha(opacity:60)';}
/*}}}*/</pre>
</div>
<div title="StyleSheetLayout">
<pre>/*{{{*/
* html .tiddler {height:1%;}

body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

a {text-decoration:none;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em;}

#contentWrapper .chkOptionInput {border:0;}

.externalLink {text-decoration:underline;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
	#mainMenu .tiddlyLinkNonExisting,
	#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}

.header {position:relative;}
.header a:hover {background:transparent;}
.headerShadow {position:relative; padding:4.5em 0em 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:4.5em 0em 1em 1em; left:0px; top:0px;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0em 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 .3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard {padding:0.1em 1em 0em 2em;}
.wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0em 0em 0em 0em; margin:0.4em 0em 0.2em 0em;}
.wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0em 0em 0em 0em; margin:0.4em 0em 0.2em 0em;}
.wizardStep {padding:1em 1em 1em 1em;}
.wizard .button {margin:0.5em 0em 0em 0em; font-size:1.2em;}
.wizardFooter {padding:0.8em 0.4em 0.8em 0em;}
.wizardFooter .status {padding:0em 0.4em 0em 0.4em; margin-left:1em;}
.wizard .button {padding:0.1em 0.2em 0.1em 0.2em;}

#messageArea {position:fixed; top:2em; right:0em; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}
.messageToolbar {display:block; text-align:right; padding:0.2em 0.2em 0.2em 0.2em;}
#messageArea a {text-decoration:underline;}

.tiddlerPopupButton {padding:0.2em 0.2em 0.2em 0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em 1em 1em 1em; margin:0;}

.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}
.popup .popupMessage {padding:0.4em;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0em;}
.popup li.disabled {padding:0.4em;}
.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tabset {padding:1em 0em 0em 0.5em;}
.tab {margin:0em 0em 0em 0.25em; padding:2px;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0em 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler {padding:1em 1em 0em 1em;}

.missing .viewer,.missing .title {font-style:italic;}

.title {font-size:1.6em; font-weight:bold;}

.missing .subtitle {display:none;}
.subtitle {font-size:1.1em;}

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation {padding:0.5em; margin:0.5em;}

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0em 0.25em; padding:0em 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}
.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
table.listView {font-size:0.85em; margin:0.8em 1.0em;}
table.listView th, table.listView td, table.listView tr {padding:0px 3px 0px 3px;}

.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}
.viewer code {font-size:1.2em; line-height:1.4em;}

.editor {font-size:1.1em;}
.editor input, .editor textarea {display:block; width:100%; font:inherit;}
.editorFooter {padding:0.25em 0em; font-size:.9em;}
.editorFooter .button {padding-top:0px; padding-bottom:0px;}

.fieldsetFix {border:0; padding:0; margin:1px 0px 1px 0px;}

.sparkline {line-height:1em;}
.sparktick {outline:0;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em 0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em 0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0em; right:0em;}
#backstageButton a {padding:0.1em 0.4em 0.1em 0.4em; margin:0.1em 0.1em 0.1em 0.1em;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel {display:none; z-index:100; position:absolute; margin:0em 3em 0em 3em; padding:1em 1em 1em 1em;}
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em 0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/</pre>
</div>
<div title="StyleSheetLocale">
<pre>/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which use a logographic writing system and need larger font sizes.
***/

/*{{{*/
body {font-size:0.8em;}

#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}

.subtitle {font-size:0.8em;}

.viewer table.listView {font-size:0.95em;}

.htmlarea .toolbarHA table {border:1px solid ButtonFace; margin:0em 0em;}
/*}}}*/</pre>
</div>
<div title="StyleSheetPrint">
<pre>/*{{{*/
@media print {
#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea {display: none ! important;}
#displayArea {margin: 1em 1em 0em 1em;}
/* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
noscript {display:none;}
}
/*}}}*/</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar closeTiddler closeOthers +editTiddler &gt; fields syncing permalink references jump'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar +saveTiddler -cancelTiddler deleteTiddler'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="GettingStarted">
<pre>To get started with this blank TiddlyWiki, you'll need to modify the following tiddlers:
* SiteTitle &amp; SiteSubtitle: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* MainMenu: The menu (usually on the left)
* DefaultTiddlers: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</pre>
</div>
<div title="OptionsPanel">
<pre>These InterfaceOptions for customising TiddlyWiki are saved in your browser

Your username for signing your edits. Write it as a WikiWord (eg JoeBloggs)

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; SaveBackups
&lt;&lt;option chkAutoSave&gt;&gt; AutoSave
&lt;&lt;option chkRegExpSearch&gt;&gt; RegExpSearch
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; CaseSensitiveSearch
&lt;&lt;option chkAnimate&gt;&gt; EnableAnimations

----
Also see AdvancedOptions</pre>
</div>
</div>
<!--POST-SHADOWAREA-->
<div id="storeArea">
<div title="10.2.14-17研考會資通安全防護" modifier="fhopecc" created="200809080719" tags="緊急事項 完成事項" changecount="1">
<pre></pre>
</div>
<div title="2007.4.14 版本 1.0" modifier="YourName" modified="200704270525" created="200704140901" tags="chkList version">
<pre>1st release.</pre>
</div>
<div title="2007.4.16 版本 1.0.1" modifier="YourName" modified="200704270525" created="200704160507" tags="chkList version">
<pre>fix the display problem in IE.</pre>
</div>
<div title="20071009" modifier="fhopecc" modified="200711120713" created="200710090545" tags="台中市稅捐處" changecount="3">
<pre>曾經問過大學同學志豪，他是喜歡北部還是中部，
他說他比較喜歡中部，
因為娛樂及休閒的地方很多，
自火車站下車後，搭統聯73號公車(27元、約40分車程)至稅捐處，
沿路看到餐館、簡餐站相當多，且每個商家都有很特殊的造型，
就連 star bukes 都建造的很有特色，
且道路，公共建築都相當有藝術感。
去了稅捐處前面的自助餐站吃午飯，
發現站主人服務態度還滿好的。
前陣子新閒吵說，
王文洋對中部發展
</pre>
</div>
<div title="2008.11.27網際網路研討會" modifier="fhopecc" created="200811200011" tags="緊急事項 完成事項" changecount="2">
<pre>網際網路研討會</pre>
</div>
<div title="2008.7.31" modifier="fhopecc" created="200807310530" tags="ok">
<pre></pre>
</div>
<div title="20080603" modifier="fhopecc" modified="200806030136" created="200806030033" changecount="3">
<pre>#繳信用卡
----
#機時發文
#資料庫檢核</pre>
</div>
<div title="20080610" modifier="fhopecc" created="200806100141" changecount="1">
<pre>!Todo
#程式館
#batchlog restore</pre>
</div>
<div title="20080611" modifier="fhopecc" modified="200806110630" created="200806110052" changecount="7">
<pre>!Plan
#資料庫檢核表
#程式館
#[[豐村法拍]]
!Done
#[[batchlog檢核表要加備份月]]</pre>
</div>
<div title="20080613" modifier="fhopecc" created="200806130215" changecount="1">
<pre>!todo
#程式館
#整理環境
!done
#6/28碩士課程請假
</pre>
</div>
<div title="20080627" modifier="fhopecc" modified="200806270534" created="200806270333" changecount="3">
<pre>#繳交信用卡
#印三本論文
#錄音筆
#看奶媽
#時間欄位的問題 
----
#聯絡教授 done</pre>
</div>
<div title="20080716" modifier="fhopecc" modified="200807160040" created="200807160032" changecount="2">
<pre>!Todo
#SQL Group 語法
#資訊專案
#論文將模組運算改成圖片
!Done</pre>
</div>
<div title="20080721" modifier="YourName" modified="200807210150" created="200807202213" changecount="6">
<pre>!Todo
#確認產假, 生產津貼申請所須證件,[[彌月蛋糕名單]], 影印身份證
#MISROC論文修改, 確認星期5 meeting
#整理桌面
!訂票
身分證字號:  S123020695    
電腦代碼:  965642
車次:         66          車種:   莒光
乘車時刻:   2008/07/27 17:45
起站:   台東         到站:   花蓮         張數:   01
取票或網路付款截止時間:   2008/07/23 22:00
----
身分證字號:  S123020695    
電腦代碼:  965673
車次:         93          車種:   莒光
乘車時刻:   2008/07/27 15:29
起站:   林邊         到站:   台東         張數:   01
取票或網路付款截止時間:   2008/07/23 22:00</pre>
</div>
<div title="20080722" modifier="fhopecc" modified="200807221347" created="200807211153" changecount="3">
<pre>!Todo
#家中門窗全部關上
#插頭要拔，由其是冷氣的和烘碗机
#最後家門確定關好
#枕頭被子收好
#照相機和電腦放在一起
!done
#奶瓶消毒鍋和頭髮乾洗劑
#照相機要把照片清光  
#身份証影印本
#汽車行駕放到辦公室
#換去程的車票</pre>
</div>
<div title="3月戶政連線陳報桃園" modifier="fhopecc" modified="200904170626" created="200804020731" changecount="20">
<pre>桃稅處鍾宜燕, mailto:inf212@tytax.gov.tw, 03-3326181#2533
自4/17通報不用再傳</pre>
</div>
<div title="5月YHQ和EGX連線記錄分發" modifier="fhopecc" modified="200905110705" created="200804020731" tags="例行事項" changecount="18">
<pre></pre>
</div>
<div title="5月地政資料更新" modifier="fhopecc" modified="200907130546" created="200811060317" tags="完成事項" changecount="11">
<pre>97tt040/民眾上網電腦
97tt027
96tt006
97tt024
97tt025
96tt003</pre>
</div>
<div title="701論文口試" modifier="fhopecc" modified="200903170128" created="200802210819" tags="碩士" changecount="22">
<pre>&lt;&lt;reminder year:2008 month:3 day:24 title:學位考試申請開始&gt;&gt;
#帶錄音筆、名產
#檢附系所規定資料(如論文摘要、初稿、投稿接受證明等，依各系所規定)
#96.03.24逕向系所經辦提出學位考試申請。
&lt;&lt;reminder year:2008 month:7 day:1 title:論文口試&gt;&gt;
----
 身分證字號:     S123020695
電腦代碼:     200505
車次:    1079              車種:    自強號
乘車時刻:    2008/06/30 12:25-14:39
起站:    花蓮              到站:    台東              張數:        1
取票或網路付款截止時間:    2008/06/20 22:00 
----
身分證字號:     S123020695
電腦代碼:     200539
車次:    94              車種:    莒光號
乘車時刻:    2008/06/30 14:55-16:52
起站:    台東              到站:    林邊              張數:        1
取票或網路付款截止時間:    2008/06/20 22:00 
----
 身分證字號:     S123020695
電腦代碼:     200566
車次:    81              車種:    莒光號
乘車時刻:    2008/07/02 11:22-13:12
起站:    林邊              到站:    台東              張數:        1
取票或網路付款截止時間:    2008/06/20 22:00 
----
 身分證字號:     S123020695
電腦代碼:     200572
車次:    1056              車種:    自強號
乘車時刻:    2008/07/02 13:20-15:32
起站:    台東              到站:    花蓮              張數:        1
取票或網路付款截止時間:
----
身分證字號:  S123020695    
電腦代碼:  954237
車次:         94          車種:   莒光
乘車時刻:   2008/06/30 14:55
起站:   台東         到站:   林邊         張數:   01
取票或網路付款截止時間:   2008/06/28 22:00
----
身分證字號:  S123020695    
電腦代碼:  954551
車次:         1079          車種:   自強
乘車時刻:   2008/06/30 12:25
起站:   花蓮         到站:   玉里         張數:   01
取票或網路付款截止時間:   2008/06/28 22:00
----
身分證字號:  S123020695    
電腦代碼:  954601
車次:         1079          車種:   自強
乘車時刻:   2008/06/30 13:39
起站:   玉里         到站:   台東         張數:   01
取票或網路付款截止時間:   2008/06/28 22:00</pre>
</div>
<div title="7月執行土地歸戶資料查詢管制工作" modifier="fhopecc" modified="200907130546" created="200708200939" tags="內部稽核 例行事項" changecount="88">
<pre>本月稽核人員：&lt;&lt;currentLNDAuditor&gt;&gt;,10/16
!排程
&lt;&lt;reminder day:6 title:&quot;執行土地歸戶資料查詢管制工作&quot; leadtime:5&gt;&gt;
!程序
#依[[資訊稽核小組名冊|file:///d:/fhopecc/twFhopecc/Audit/資訊稽核小組名冊.xls]]查詢本月稽核委員
#5日前詢問本月查核土地歸戶查詢作業之稽核委員欲查核之(上月)日期
#請地價系統列印查詢記錄日報表(~LND204P)、[[空白土地歸戶資料查詢管制工作底稿|file:///d:/fhopecc/twFhopecc/Audit/lnd/空白土地歸戶資料查詢管制工作底稿.doc]]及[[底稿封面|file:///d:/fhopecc/twFhopecc/Audit/lnd/土地歸戶資料.xls]]交稽核委員
#稽核委員稽核完送資管課
#資管課製作報告[[土地歸戶報告書|file:///d:/fhopecc/twFhopecc/資安稽核/土地歸戶報告書.odt]]
!檔案
#[[空白土地歸戶資料查詢管制工作底稿|file:///d:/fhopecc/twFhopecc/Audit/lnd/空白土地歸戶資料查詢管制工作底稿.doc]]
#[[資訊稽核小組名冊|file:///d:/fhopecc/twFhopecc/Audit/資訊稽核小組名冊.xls]]
#[[封面範本|file:///d:/fhopecc/twFhopecc/Audit/lnd/土地歸戶資料.xls]]</pre>
</div>
<div title="7月戶役政資料管制表" modifier="fhopecc" modified="200907130548" created="200808200602" tags="例行事項 YHQ" changecount="9">
<pre>&lt;&lt;reminder day:20 title:陳報7月戶役政資料管制表&gt;&gt;
!控管檔
#填寫[[97年度控管檔|file:///D:/fhopecc/twFhopecc/資安稽核/戶政稽核/戶政資料件數管制表.xls]]
#陳核
#寄給中心[[董惠蘭|mailto:hltung@fdc.gov.tw]]
</pre>
</div>
<div title="7月機時報表" modifier="fhopecc" modified="200907130547" created="200805020325" tags="例行事項" changecount="20">
<pre>機時報表
&lt;&lt;tiddler 執行機時統計報表&gt;&gt;</pre>
</div>
<div title="7月產出YPM異常報表" modifier="fhopecc" created="200806130650" tags="例行事項 完成事項" changecount="2">
<pre></pre>
</div>
<div title="96年度資訊專案稽核" modifier="fhopecc" modified="200803180228" created="200710010843" tags="資訊專案稽核" changecount="13">
<pre>!專案計畫
[[96賦更稽核|file://d:/fhopecc/twFhopecc/MISAuditProject/96賦更稽核.doc]]
!專案派員
李秀勤、蔡惠絨
!專案報告
[[96年度資訊專案稽核報告]]
&lt;&lt;tiddler  &quot;96年度資訊專案稽核報告&quot;&gt;&gt;
----
!範本
&lt;&lt;tiddler  資訊專案稽核&gt;&gt;
</pre>
</div>
<div title="96年度資訊專案稽核報告" modifier="fhopecc" modified="200710020325" created="200710010839" changecount="5">
<pre>!檔案
[[96年度資訊專案稽核報告|file:///d:/fhopecc/twFhopecc/MISAuditProject/96專案稽核報告書.doc]]
!排程
&lt;&lt;reminder year:2007 month:10 day:10 title:&quot;96年度資訊專案稽核報告&quot; leadtime:10&gt;&gt;</pre>
</div>
<div title="96年災變回復演練" modifier="YourName" modified="200710220106" created="200709280050" tags="災變回復" changecount="12">
<pre>!排程
&lt;&lt;reminder day:4 month:10 year:2007 title:&quot;96年災變回復演練&quot; &gt;&gt;
!報告
[[96年災變回復演練報告|file:///d:/fhopecc/twFhopecc/災變回復計劃/96年災變回復演練報告.odt]]</pre>
</div>
<div title="97年內部稽核" modifier="fhopecc" modified="200811110948" created="200809250037" tags="緊急事項 完成事項" changecount="4">
<pre>#會議記錄、前次資料寄給 bb 、上知識庫</pre>
</div>
<div title="97年專案稽核" modifier="fhopecc" modified="200809250035" created="200808040144" tags="緊急事項 完成事項" changecount="12">
<pre>#稽核委員給稽核結果
#印抽核報表
#陳核[[計畫|file:///d:/fhopecc/twFhopecc/資安稽核/專案稽核/97/計畫.doc]]、[[工作底稿|file:///d:/fhopecc/twFhopecc/資安稽核/專案稽核/97/工作底稿.doc]]、[[近5年稽核人員清冊|file:///d:/fhopecc/twFhopecc/資安稽核/專案稽核/97/近5年稽核人員清冊.doc]]</pre>
</div>
<div title="97年災變回復" modifier="fhopecc" created="200810060058" tags="緊急事項 完成事項" changecount="1">
<pre>#撰寫計劃</pre>
</div>
<div title="97年自行查核" modifier="fhopecc" created="200811040212" tags="緊急事項" changecount="1">
<pre></pre>
</div>
<div title="ActiveX" modifier="fhopecc" modified="200710101351" created="200710101330" tags="COM" changecount="5">
<pre>~ActiveX 就是 OLE Automation 物件，
這是一種''行程間溝通''的架構，
此架構有兩種物件，
第一個為 ~ActiveX Client(Automation Controller)，
第二個為 ~ActiveX Server(Automation Object)，
應用程式可利用 ~ActiveX Client 來控制另一行程的 ~ActiveX Server 物件。
一個應用程式可以匯出一個 ~ActiveX Server 物件，
來讓另一個應用程式來使用。
</pre>
</div>
<div title="Activity Diagram" modifier="fhopecc" modified="200807190215" created="200807190155" tags="UML" changecount="3">
<pre>!Initial node
The filled in circle is the starting point of the diagram.  An initial node isn急 required although it does make it significantly easier to read the diagram.

!Activity final node.
The filled circle with a border is the ending point.  An activity diagram can have zero or more activity final nodes.

!Activity
The rounded rectangles represent activities that occur. An activity may be physical, such as Inspect Forms, or electronic, such as Display Create Student Screen.

!Flow/edge
The arrows on the diagram.  Although there is a subtle difference between flows and edges I have never seen a practical purpose for the difference although I have no doubt one exists.  I?l use the term flow. 

!Fork
A black bar with one flow going into it and several leaving it.  This denotes the beginning of parallel activity.

!Join
A black bar with several flows entering it and one leaving it.  All flows going into the join must reach it before processing may continue.  This denotes the end of parallel processing.


!Condition
 Text such as [Incorrect Form] on a flow, defining a guard which must evaluate to true in order to traverse the node.


!Decision
A diamond with one flow entering and several leaving.  The flows leaving include conditions although some modelers will not indicate the conditions if it is obvious. 


!Merge
 A diamond with several flows entering and one leaving.  The implication is that one or more incoming flows must reach this point until processing continues, based on any guards on the outgoing flow.
!Partition
Figure 2 is organized into three partitions, also called swimlanes, indicating who/what is performing the activities (either the Applicant, Registrar, or System).
!Sub-activity indicator
 The rake in the bottom corner of an activity, such as in the Apply to University activity, indicates that the activity is described by a more finely detailed activity diagram.  In Figure 2 the Enroll In Seminar activity includes this symbol.
!Flow final
 The circle with the X through it.  This indicates that the process stops at this point. 

!Note
Figure 2 includes a standard UML note to indicate that the merges does not require all three flows to arrive before processing can continue.  An alternative way to model this would have been with an OR constraint between the no match and applicant not on match list flows.  I prefer notes because stakeholders find them easier to understand.

!Use case
 In Figure 1 I indicated that the Enroll in Seminar use case is invoked as one of the activities.  This is a visual cheat that I use to indicate that an included use case is being invoked.  To tell you the truth I? not sure if this is official allowed by the UML but clearly it should be.  Another way to depict this is shown in Figure 2 via the use of a normal activity although I don急 think this is as obvious as using a use case. </pre>
</div>
<div title="AdobeReader漏洞修補通知" modifier="fhopecc" modified="200712250700" created="200712250037" tags="資安漏洞 資通安全" changecount="3">
<pre>!發布編號
ICST-ANA-2007-0008
!發布時間
2007/11/01 00:00:00
!事件類型
漏洞預警
!發現時間
2007/11/01
!通告名稱
Adobe Reader / Acrobat漏洞修補通知
!內容說明
	技術服務中心發現駭客利用存在Adobe Reader 8.1與先前版本的安全性漏洞，透過電子郵件社交工程方式，嘗試入侵我政府機關(構)。待使用者開啟惡意PDF附件後，下載惡意程式至受害主機，進而達到竊取重要資訊的目的。
除具針對性質的駭客攻擊外，目前亦已有廣泛流傳的惡意程式攻擊PDF弱點。技術服務中心提醒，Adobe Reader與PDF為辦公室常用文書軟體與檔案格式，使用者除勿開啟來歷不明的電子郵件及附件外，若有使用Adobe產品，請儘早至Adobe官方網站更新至最新版本(8.1.1)。
!影響平台
Windows XP、Windows 2003搭配IE 7，並安裝Adobe Reader / Acrobat 8.1 及 7.0.9 (含)以前版本者
!影響等級
高
!建議措施
儘早至下列官方網站更新軟體
(本警訊撰寫時，Adobe尚未提供繁體中文版之單一安裝檔案，欲安裝繁體中文8.1.1版本者，請先安裝8.1版本，再安裝8.1.1更新程式，或利用8.1版之自動更新功能)
!參考資料
Adobe Reader更新網址
http://www.adobe.com/support/downloads/product.jsp?product=10&amp;platform=Windows
Adobe安全性公告與建議
http://www.adobe.com/support/security/bulletins/apsb07-18.html
http://www.adobe.com/support/security/advisories/apsa07-04.html </pre>
</div>
<div title="All Apologies " modifier="fhopecc" created="200710160149" changecount="1">
<pre>What else should I be
All apologies
What else could I say
Everyone is gay
What else could I write
I don't have the right
What else should I be
All apologies

In the sun
In the sun I feel as one
In the sun
In the sun
I'm married
Buried

I wish I was like you
Easily amused
Find my nest of salt
Everything is my fault
I'll take all the blame
Aqua seafoam shame
Sunburn with freezeburn
Choking on the ashes of her enemy

In the sun
In the sun I feel as one
In the sun
In the sun
Married, Maried, Maried!
Buried!
Yeah yeah yeah yeah

All in all is all we are [x20]</pre>
</div>
<div title="Aspirin" modifier="YourName" modified="200704270553" created="200703011653" tags="chkList chkPacking xAA">
<pre></pre>
</div>
<div title="B-樹初步" modifier="fhopecc" modified="200709030040" created="200708230501" tags="電腦科學" changecount="1">
<pre>B-樹初步
Glückauf老番癲以煤礦工們進出千公尺坑道時，相互的祝願語自我慶幸一番，並感謝台大胡主任給老番癲裝上人工水晶體，讓老番癲能夠繼續寫讀書隨筆，也可以更清楚的看一看SUSE Linux 10.2版 不但未採納ReiserFs 4.0，也放棄了10,1 版中的ReiserFs 3.6.而改用ext3的說詞。
首先當然需要對B-tree有一個粗淺瞭解，自1972 年R. Bayer先生創立了平衡B樹資料結構以來，B-tree已經有下列幾種變體：
l          B-tree
l          B+ -tree：採用的檔案系統NTFS（Windows），ReiserFS 3.6（Unix 及Linux），XFS（IRIX及 Linux），JFS2（AIX，OS/2 及Linux）
l          B* -tree：採用的檔案系統HFS及 ReiserFS 4
l          B++ tree
網路查到一位德國及另一位瑞士教授在其講授大綱中聲稱B+ -tree為英美用詞而B* -tree為德奧瑞用詞，二者完全相同，把老番癲搞得一頭霧水，不過老番癲最後還是採信英文版Wikipedia在B* -tree說明中提出的警告「勿將B* -tree與B+ -tree混淆」。
廿世紀中葉後資料庫及檔案的蓬勃發展，老番癲當年接觸到的Hollerith卡片系統早已不敷需求，龐大的資料又不可能全部放在快速的記憶體中（3-8 ns），而必須放在硬碟中。硬碟的轉速雖然增快，但由於讀取資料區塊的讀寫頭前進後退速度的限制，一般讀取時間約為10 ms，而記憶體通常傳遞整塊或整頁資料，因此能否載入目前所需資料，也即減少資料區塊數及其存取的次數，成為重要的指標。

H樹高
檔案及資料庫需先寫入硬碟後再讀取，其中包括了搜尋、插入、合併、刪除及瀏覽，因此需要一個有效率的結構來儲存這些資料，而無論Windows或Linux的檔案的目錄結構，均是採用一個倒立的階層式的樹狀結構，最上層為樹根，根下是樹幹（節點），接著從樹枝到樹葉，有的文獻則以族譜作比喻，由祖父經父執輩到子姪輩，循序而下找到子姪節結或樹葉，也即所要的資料儲存的地方。
 
根
父
子
階層 0
階層1 1111        1111 1
階層 2   2222222222222222222222222222222222222222   2222212222222
最底層稱為葉，由根到葉的距離便是樹高。
Bayer先生創立的B-tree，則更需要吻合下列條件。
l          從根到葉的路徑均等長 － B-樹在平衡狀態。
l          儲存在B-樹中的資料元素（Element）有唯一的鍵值，也在樹中只能呈現一個位置上。所有的元素均能在O(log n)時間內搜尋到或插入。
l          B-樹稱為n階次（order n）如果它的每個節結至少有n個最多2 n個鍵值。樹根至少要有一個元素，其他節結至少要有n個元素。
l          每個節結至少要50%充滿。也即節結中的位置不必占滿，如此可獲得較大的自由度，限制重結構的消耗。
l          除了樹根外，一個節結中的鍵值均按拉丁字母或數字增值次序排列。
l          n個鍵值的節結有n+ 1個子節結。
l          如果S1 ...... Sn是n+ 1個節結的鍵值，而V0, V1….. Vn是指向子樹指標，則
（a）V0指向鍵值小於S1子樹的指標
（b）Vi（I = 1, ....., n-1）指向鍵值在Si與Si+i間的子樹的指標
（c）Vn指向鍵值大於Sn子樹的指標
 
下面是典型B-樹的示意圖。
 

|F1 | X | X | X |
v0 s1 v1 s2 v2 s3 v3
| K1 |  K2 | K3 | X |
|B1|B2| X |X |
|A1|A2|A3| X |
|C1|C2| X | X| |
|D1|D2|D3|X| |
|G1|G2|G3| X |
|N1|N2|N3| X |
|M1|M2|M3|M4|
1.          搜尋
從樹根開始尋找，直到節結它的鍵值能含蓋欲搜尋的鍵值，也即它的第一此值與欲搜尋的鍵值大或相等。如二者相等便找到答案，否則依此元素前的指標到下一個的節結中尋找，如果到了樹葉，還沒有發現搜尋的鍵值，表示B-樹不含此資料。</pre>
</div>
<div title="Base64InOtherLanguage" modifier="fhopecc" modified="200712220254" created="200712180201" tags="Ruby" changecount="2">
<pre>在電子郵件應用普遍的今天，
幾乎所有主流的程式語言都提供了Base64的函式庫，
就我所知像是JavaScript、Perl、PHP及Java等都有完整的函式庫可用。
雖然函式庫的發展目標都是為了支援Email程式，
但是看完上述Base64在包裝二進位檔案的應用後，
妳有沒有不一樣的想法呢？
老實說我還看過很酷的應用，不是在Ruby而是在JavaScript。
網頁顯示一張JPEG的圖，
但是只有一個html檔，沒有額外的圖檔，
看完本文後，聰明的妳，應該猜得到圖放在那裡吧！</pre>
</div>
<div title="Base64模組" modifier="fhopecc" modified="200712210626" created="200712181221" tags="Ruby" changecount="7">
<pre>!在ruby中使用base64編碼
在ruby中要使用base64編碼，很簡單。
因為base64編碼在ruby中是核心套件，
所以不必在安裝其它的元件，
要使用時，首先要載入檔案：
{{{
require &quot;base64&quot;
}}}
而Base64相關的演算法是封裝在Ruby模組中，所以用法如下：
{{{
enc   = Base64.encode64('Send reinforcements') # -&gt; &quot;U2VuZCByZWluZm9yY2VtZW50cw==\n&quot;
plain = Base64.decode64(enc) # -&gt; &quot;Send reinforcements&quot;
}}}
也可以包含模組進來，省去打Base64的字元。
{{{
include Base64
enc   = encode64('Send reinforcements') # -&gt; &quot;U2VuZCByZWluZm9yY2VtZW50cw==\n&quot;
plain = decode64(enc) # -&gt; &quot;Send reinforcements&quot;
}}}
可以使用的函式主要就是{{{encode64}}}及{{{decode64}}}，
分別用來將二進位碼轉成Base64碼，
或將Base64碼轉成二進位碼，上例則是將字串
{{{'Send reinforcements'}}}的二進位表示，轉成Base64碼。</pre>
</div>
<div title="Big5Plugin" modifier="fhopecc" modified="200709290626" created="200702090116" tags="systemConfig 如何使用wiki" changecount="3">
<pre>//{{{
version.extensions.zh_TW = {major: 2, minor: 0, revision: 7, beta: 1,
 date: new Date(&quot;Mar 23, 2006&quot;),
 name: &quot;zh_TW&quot;,
 type: &quot;Plugin&quot;,
 author: &quot;BramChen&quot;,
 source: &quot;http://sourceforge.net/project/showfiles.php?group_id=150646&quot;
};
// // ''Messages''
var lingo = config.messages;
lingo.customConfigError = &quot;customConfig 錯誤 - '%1' - %0&quot;;
lingo.savedSnapshotError = &quot;此 TiddlyWiki 未正確存檔，詳見 http://www.tiddlywiki.com/#DownloadSoftware&quot;;
lingo.subtitleUnknown = &quot;(未知)&quot;;
lingo.undefinedTiddlerToolTip = &quot;'%0' 尚無內容&quot;;
lingo.shadowedTiddlerToolTip = &quot;'%0' 尚無內容, 但已定義隱藏的預設值&quot;;
lingo.tiddlerLinkTooltip = &quot;%0 - %1, %2&quot;;
lingo.externalLinkTooltip = &quot;外部連結至 %0&quot;;
lingo.noTags = &quot;未設定標籤的文章&quot;;
lingo.notFileUrlError = &quot;須先將此 TiddlyWiki 存至檔案，才可儲存變更&quot;;
lingo.cantSaveError = &quot;此瀏覽器無法儲存變更，建議使用FireFox；也可能是你的 TiddlyWiki 檔名包含不合法的字元所致。&quot;;
lingo.invalidFileError = &quot; '%0' 非有效之 TiddlyWiki&quot;;
lingo.backupSaved = &quot;已儲存備份&quot;;
lingo.backupFailed = &quot;無法儲存備份&quot;;
lingo.rssSaved = &quot;RSS feed 已儲存&quot;;
lingo.rssFailed = &quot;無法儲存 RSS feed &quot;;
lingo.emptySaved = &quot;已儲存範本&quot;;
lingo.emptyFailed = &quot;無法儲存範本&quot;;
lingo.mainSaved = &quot;主要的TiddlyWiki已儲存&quot;;
lingo.mainFailed = &quot;無法儲存主要 TiddlyWiki. 所作的改變未儲存&quot;;
lingo.macroError = &quot;巨集&lt;&lt;%0&gt;&gt;執行錯誤&quot;;
lingo.macroErrorDetails = &quot;執行巨集&lt;&lt;%0&gt;&gt;時，發生錯誤 :\n%1&quot;;
lingo.missingMacro = &quot;無此巨集&quot;;
lingo.overwriteWarning = &quot;'%0' 已存在，[確定]覆寫之&quot;;
lingo.unsavedChangesWarning = &quot;注意！ 尚未儲存變更\n\n[確定]存檔，或[取消]放棄存檔？&quot;;
lingo.confirmExit = &quot;--------------------------------\n\nTiddlyWiki 以更改內容尚未儲存，繼續的話將遺失這些更動\n\n--------------------------------&quot;;
lingo.saveInstructions = &quot;SaveChanges&quot;;
lingo.messageClose = {text: &quot;關閉&quot;, tooltip: &quot;關閉此訊息&quot;};
//lingo.dates.months = [&quot;一&quot;, &quot;二&quot;, &quot;三&quot;, &quot;四&quot;, &quot;五&quot;, &quot;六&quot;, &quot;七&quot;, &quot;八&quot;, &quot;九&quot;, &quot;十&quot;, &quot;十一&quot;, &quot;十二&quot;];
//lingo.dates.days = [&quot;日&quot;, &quot;一&quot;,&quot;二&quot;, &quot;三&quot;, &quot;四&quot;, &quot;五&quot;, &quot;六&quot;];
config.messages = lingo;

// // ''config.views''
lingo =config.views; 
lingo.wikified.tag = {labelNoTags: &quot;未設標籤&quot;, labelTags: &quot;標籤: &quot;, openTag: &quot;開啟標籤 '%0'&quot;, tooltip: &quot;顯示標籤為 '%0' 的文章&quot;, openAllText: &quot;開啟以下所有文章&quot;, openAllTooltip: &quot;開啟以下所有文章&quot;, popupNone: &quot;僅此文標籤為 '%0'&quot;};
lingo.wikified.defaultText = &quot;&quot;;
lingo.wikified.defaultModifier = &quot;(missing)&quot;;
lingo.wikified.shadowModifier = &quot;(shadow)&quot;;
lingo.editor.tagPrompt = &quot;設定標籤之間以空白區隔，[[標籤含空白時請使用雙中括弧]]，或點選現有之標籤加入&quot;;
lingo.editor.tagChooser = {text: &quot;標籤&quot;, tooltip: &quot;點選現有之標籤加至本文章&quot;, popupNone: &quot;未設定標籤&quot;, tagTooltip: &quot;加入標籤 '%0'&quot;};
lingo.editor.defaultText = &quot;&quot;;
config.views = lingo;

// // ''Macros
lingo =config.macros;
lingo.search.label = &quot; 尋找&quot;;
lingo.search.prompt = &quot;搜尋本 Wiki&quot;;
lingo.search.sizeTextbox = 15;
lingo.search.accessKey = &quot;F&quot;;
lingo.search.successMsg = &quot; %0 篇符合條件: %1&quot;;
lingo.search.failureMsg = &quot; 無符合條件: %0&quot;;
lingo.tagging.label = &quot;引用標籤:&quot;;
lingo.tagging.labelNotTag = &quot;無引用標籤&quot;;
lingo.tagging.tooltip = &quot;列出標籤為 '%0' 的文章&quot;;
lingo.timeline.dateFormat = &quot;YYYY0MM0DD&quot;;
lingo.allTags.tooltip = &quot;顯示文章- 標籤為'%0'&quot;;
lingo.allTags.noTags = &quot;沒有標籤的文章&quot;;
lingo.list.all.prompt = &quot;依字母排序&quot;;
lingo.list.missing.prompt = &quot;被引用且內容空白的文章&quot;;
lingo.list.orphans.prompt = &quot;未被引用的文章&quot;;
lingo.list.shadowed.prompt = &quot;這些隱藏的文章已定義預設內容&quot;;
lingo.closeAll.label = &quot;全部關閉&quot;;
lingo.closeAll.prompt = &quot;關閉所有開啟中的 tiddler (編輯中除外)&quot;;
lingo.permaview.label = &quot;引用連結&quot;;
lingo.permaview.prompt = &quot;可存取現有開啟之文章的連結位址&quot;;
lingo.saveChanges.label = &quot;儲存變更&quot;;
lingo.saveChanges.prompt = &quot;儲存所有文章，產生新的版本&quot;;
lingo.newTiddler.label = &quot;新增文章&quot;;
lingo.newTiddler.prompt = &quot;新增 tiddler&quot;;
lingo.newJournal.label = &quot;新增日誌&quot;;
lingo.newJournal.prompt = &quot;新增 jounal&quot;;
config.macros = lingo;

// // ''Toolbars (Commands)''
lingo = config.commands;
lingo.closeTiddler.text = &quot;關閉&quot;;
lingo.closeTiddler.tooltip = &quot;關閉本文&quot;;
lingo.closeOthers.text = &quot;關閉其他&quot;;
lingo.closeOthers.tooltip = &quot;關閉其他文章&quot;;
lingo.editTiddler.text = &quot;編輯&quot;;
lingo.editTiddler.tooltip = &quot;編輯本文&quot;;
lingo.editTiddler.readOnlyText = &quot;檢視&quot;;
lingo.editTiddler.readOnlyTooltip = &quot;檢視本文之原始內容&quot;;
lingo.saveTiddler.text = &quot;完成&quot;;
lingo.saveTiddler.tooltip = &quot;確定修改&quot;;
lingo.saveTiddler.readOnlyText = &quot;完成&quot;;
lingo.saveTiddler.readOnlyTooltip = &quot;正常顯示模式&quot;;
lingo.cancelTiddler.text = &quot;取消&quot;;
lingo.cancelTiddler.tooltip = &quot;取消修改&quot;;
lingo.deleteTiddler.text = &quot;刪除&quot;;
lingo.deleteTiddler.tooltip = &quot;刪除文章&quot;;
lingo.deleteTiddler.warning = &quot;確定刪除 '%0'?&quot;;
lingo.permalink.text = &quot;引用連結&quot;;
lingo.permalink.tooltip = &quot;本文引用連結&quot;;
lingo.references.text = &quot;引用&quot;;
lingo.references.tooltip = &quot;引用本文的文章&quot;;
lingo.references.popupNone = &quot;本文未被引用&quot;;
lingo.jump.text = &quot;捲頁&quot;;
lingo.jump.tooltip = &quot;捲頁至其他已開啟的文章&quot;;
config.commands = lingo;

// // ''ShadowTiddlers''
lingo = config.shadowTiddlers;
lingo.SideBarOptions = &quot;&lt;&lt;search&gt;&gt;&lt;&lt;closeAll&gt;&gt;&lt;&lt;permaview&gt;&gt;&lt;&lt;newTiddler&gt;&gt;&lt;&lt;newJournal YYYY0MM0DD&gt;&gt;&lt;&lt;saveChanges&gt;&gt;&lt;&lt;slider chkSliderOptionsPanel OptionsPanel 偏好設定 '變更 TiddlyWiki 選項'&gt;&gt;&quot;;
lingo.AdvancedOptions = &quot;&lt;&lt;option chkOpenInNewWindow&gt;&gt; 連結開啟於新視窗\n&lt;&lt;option chkSaveEmptyTemplate&gt;&gt; 儲存範本\n&lt;&lt;option chkToggleLinks&gt;&gt; 點擊文章使已開啟者關閉\n\n&lt;&lt;option chkHttpReadOnly&gt;&gt; 隱藏編輯功能 ({{{http:}}})\n&lt;&lt;option chkForceMinorUpdate&gt;&gt; 修改文章不變更日期時間\n(確認修改同時按 Shift 鍵，或只按 Ctrl-Shift-Enter)\n&lt;&lt;option chkConfirmDelete&gt;&gt; 刪除文章前確認\n\n編輯模式中顯示列數: &lt;&lt;option txtMaxEditRows&gt;&gt;\n存放備份檔案的資料夾: &lt;&lt;option txtBackupFolder&gt;&gt;&quot;;
lingo.OptionsPanel = &quot;這些設定將暫存於瀏覽器中，\n請簽名&lt;&lt;option txtUserName&gt;&gt;\n (範例：WikiWord)\n\n &lt;&lt;option chkSaveBackups&gt;&gt; [[儲存備份]]\n&lt;&lt;option chkAutoSave&gt;&gt; [[自動儲存]]\n&lt;&lt;option chkGenerateAnRssFeed&gt;&gt; [[產生 RssFeed]]\n&lt;&lt;option chkRegExpSearch&gt;&gt; [[正規式搜尋]]\n&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; [[區分大小寫搜尋]]\n&lt;&lt;option \nchkAnimate&gt;&gt; [[使用動畫顯示]]\n\n AdvancedOptions&quot;;
lingo.SideBarTabs = &quot;&lt;&lt;tabs txtMainTab 最近更新 '依更新日期排序' TabTimeline 全部 '所有文章' TabAll 分類 '依標籤分類' TabTags 更多 '其他' TabMore&gt;&gt;&quot;;
lingo.TabMore = &quot;&lt;&lt;tabs txtMoreTab 未完成 '內容空白的文章' TabMoreMissing 未引用 '未被引用的文章' TabMoreOrphans 預設文章 '預設的影子文章' TabMoreShadowed&gt;&gt;&quot;;
config.shadowTiddlers = lingo;
lingo = null;
// // ''Date formatString''
/*
Date.prototype.formatString = function(template){
 template = template.replace(/YYYY/g,this.getFullYear() + '年');
 template = template.replace(/YY/g,String.zeroPad(this.getFullYear()-1911,2) + '年');
 template = template.replace(/MMM/g,config.messages.dates.months[this.getMonth()] + '月');
 template = template.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2) + '月');
 template = template.replace(/MM/g,this.getMonth()+1 + '月');
 template = template.replace(/DDD/g,'星期'+config.messages.dates.days[this.getDay()]);
 template = template.replace(/DDth/g,this.getDate()+this.daySuffix());
 template = template.replace(/0DD/g,String.zeroPad(this.getDate(),2)+ '日');
 template = template.replace(/DD/g,this.getDate() + '日');
 template = template.replace(/0hh/g,String.zeroPad(this.getHours(),2));
 template = template.replace(/hh/g,this.getHours());
 template = template.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
 template = template.replace(/mm/g,this.getMinutes());
 template = template.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
 template = template.replace(/ss/g,this.getSeconds());
 return template;
};
*/
//}}}
</pre>
</div>
<div title="BrowserDetect" modifier="fhopecc" created="200802161029" tags="Javascript" changecount="1">
<pre>Browser detect
show page contents
TopExampleThe scriptBrowser detectionPropertiesExample: SafariExample: OperauserAgent and vendorDetection orderVersion numberversionSearchuserAgent and appVersionOperating systemnavigator
show site navigation

Loading site navigation; please wait...

See section 3D of the book.

The version detect doesn't work in Safari and OmniWeb because these browsers don't include comprehensible version information in their identity string.

A useful but often overrated JavaScript function is the browser detect. Sometimes you want to give specific instructions or load a new page in case the viewer uses, for instance, Safari.

If you're new to JavaScript, don't use this script. Please read the object detection page first.
Example

Let's detect your browser:

You're using Firefox 2 on Windows!
The script

Copy this script into your JavaScript files. It works immediately, and you can query three properties of the BrowserDetect object:

    * Browser name: BrowserDetect.browser
    * Browser version: BrowserDetect.version
    * OS name: BrowserDetect.OS

var BrowserDetect = {
	init: function () {
		this.browser = this.searchString(this.dataBrowser) || &quot;An unknown browser&quot;;
		this.version = this.searchVersion(navigator.userAgent)
			|| this.searchVersion(navigator.appVersion)
			|| &quot;an unknown version&quot;;
		this.OS = this.searchString(this.dataOS) || &quot;an unknown OS&quot;;
	},
	searchString: function (data) {
		for (var i=0;i&lt;data.length;i++)	{
			var dataString = data[i].string;
			var dataProp = data[i].prop;
			this.versionSearchString = data[i].versionSearch || data[i].identity;
			if (dataString) {
				if (dataString.indexOf(data[i].subString) != -1)
					return data[i].identity;
			}
			else if (dataProp)
				return data[i].identity;
		}
	},
	searchVersion: function (dataString) {
		var index = dataString.indexOf(this.versionSearchString);
		if (index == -1) return;
		return parseFloat(dataString.substring(index+this.versionSearchString.length+1));
	},
	dataBrowser: [
		{ 	string: navigator.userAgent,
			subString: &quot;OmniWeb&quot;,
			versionSearch: &quot;OmniWeb/&quot;,
			identity: &quot;OmniWeb&quot;
		},
		{
			string: navigator.vendor,
			subString: &quot;Apple&quot;,
			identity: &quot;Safari&quot;
		},
		{
			prop: window.opera,
			identity: &quot;Opera&quot;
		},
		{
			string: navigator.vendor,
			subString: &quot;iCab&quot;,
			identity: &quot;iCab&quot;
		},
		{
			string: navigator.vendor,
			subString: &quot;KDE&quot;,
			identity: &quot;Konqueror&quot;
		},
		{
			string: navigator.userAgent,
			subString: &quot;Firefox&quot;,
			identity: &quot;Firefox&quot;
		},
		{
			string: navigator.vendor,
			subString: &quot;Camino&quot;,
			identity: &quot;Camino&quot;
		},
		{		// for newer Netscapes (6+)
			string: navigator.userAgent,
			subString: &quot;Netscape&quot;,
			identity: &quot;Netscape&quot;
		},
		{
			string: navigator.userAgent,
			subString: &quot;MSIE&quot;,
			identity: &quot;Explorer&quot;,
			versionSearch: &quot;MSIE&quot;
		},
		{
			string: navigator.userAgent,
			subString: &quot;Gecko&quot;,
			identity: &quot;Mozilla&quot;,
			versionSearch: &quot;rv&quot;
		},
		{ 		// for older Netscapes (4-)
			string: navigator.userAgent,
			subString: &quot;Mozilla&quot;,
			identity: &quot;Netscape&quot;,
			versionSearch: &quot;Mozilla&quot;
		}
	],
	dataOS : [
		{
			string: navigator.platform,
			subString: &quot;Win&quot;,
			identity: &quot;Windows&quot;
		},
		{
			string: navigator.platform,
			subString: &quot;Mac&quot;,
			identity: &quot;Mac&quot;
		},
		{
			string: navigator.platform,
			subString: &quot;Linux&quot;,
			identity: &quot;Linux&quot;
		}
	]

};
BrowserDetect.init();

This script will only continue to work if you regularly check whether newer browsers still follow the rules set forth in the dataBrowser and dataOS arrays.
Browser detection

The dataBrowser array is filled with objects that contain the properties that help the script detect your users' browser. Note its general syntax:

dataBrowser: [
	{
		prop: window.opera,
		identity: &quot;Opera&quot; // note: no comma
	},
	{
		string: navigator.userAgent,
		subString: &quot;MSIE&quot;,
		identity: &quot;Explorer&quot;,
		versionSearch: &quot;MSIE&quot; // note: no comma
	} // note: no comma
];

The [] define an array literal, and all of its elements are object literals. Each object literal is enclosed in curly braces {} and contains a few properties (name: value,). Note that a comma between the objects and between the properties is required, but that the last comma is always forbidden.
Properties

Every object in the dataBrowser array can contain the following properties:

   1. string and subString properties. These say: &quot;search for subString in string&quot;. If the subString is found, the browser is identified.
   2. a prop property. It says &quot;see if prop is supported&quot;. If it is, the browser is identified.
   3. an identity string. This string becomes the value of BrowserDetect.browser.
   4. a versionSearch string. This is for searching for the version number (see below). If this property is absent, the identity string is used instead.

Every object must contain either 1 or 2 (never both!), must contain 3 and may contain 4.
Example: Safari

As an example, here's the Safari object:

{
	string: navigator.vendor,
	subString: &quot;Apple&quot;,
	identity: &quot;Safari&quot;
},

The script takes the value of navigator.vendor and sees if it contains the string &quot;Apple&quot;. If it does, BrowserDetect.browser is set to &quot;Safari&quot; and the browser detection quits. If it doesn't, the script moves on to the next object.
Example: Opera

The next object is Opera:

{
	prop: window.opera,
	identity: &quot;Opera&quot;
},

Here the script checks if the property window.opera exists. If it does, BrowserDetect.browser is set to &quot;Opera&quot; and the browser detection quits. If it doesn't, the script moves on to the next object.
userAgent and vendor

The trick of browser detection is knowing where to look for the information you need. Traditionally we use navigator.userAgent. However, precisely because this check is traditional many minor browsers change their navigator.userAgent string so that bad detects written by amateur web developers are fooled into identifying it as Explorer. Section 3D of the book discusses this problem, as well as some gory details of navigator.userAgent.

More recently, new browsers have started to support the navigator.vendor property, which contains information about the vendor. In general I prefer to use this string for my detection, since it's less contaminated by obfuscation.

Of course, as soon as amateurs start using my detection script to detect Safari, Opera, Konqueror or other browsers, the browser vendors will be forced to change the value of navigator.vendor and my detect will not work any more.
Detection order

The objects in dataBrowser are used in the order they appear; that's why dataBrowser is an array. As soon as a positive identification is made the script ends, and it doesn't check the remaining objects.

Detection order is very important. The general rule is that you check for the minor browsers first. The reason is that many minor browsers give their users the opportunity to change identity in order to work around browser detects.

For instance, the Opera navigator.userAgent may contain &quot;MSIE&quot;. If we'd check for Explorer first, we'd find the &quot;MSIE&quot; and would incorrectly conclude that the browser is Explorer. In order to avoid this false detection, we should check for Safari first. If the browser is Opera, the script never proceeds to the &quot;MSIE&quot; check.

Safari's navigator.userAgent also contains &quot;Gecko&quot;. This causes the same problem: a check for Mozilla would reveal &quot;Gecko&quot;, and Safari would be identified as Mozilla. Therefore the Mozilla check only takes place if the browser is not Safari.

If you add a new object to detect a new browser, always add it before the Explorer/Mozilla objects at the end of the array.
Version number

In general, the version number of a browser can be found directly after its name in navigator.userAgent. The script searches for this name and takes the number that appears after it. For instance, this is Konqueror's navigator.userAgent:

Mozilla/5.0 (compatible; Konqueror/3; Linux)

The script searches for the string &quot;Konqueror&quot;, skips the next character, and takes the number after that. This is the version number. The script uses parseFloat, so that decimal places in the version number also become part of BrowserDetect.version.

Unfortunately Safari's string never contains its official version; only its internal Apple version number (ie. not 1.3.2 but 312.6). Therefore the version number detect doesn't work in Safari. Since this is clearly Apple's fault (it doesn't follow established conventions), I don't care.
versionSearch

In general, the browser name as it appears in navigator.userAgent is the same as the identification string. If the browser is &quot;iCab&quot;, the script searches for &quot;iCab&quot;.

However, Explorer needs &quot;MSIE&quot;, Mozilla needs &quot;rv&quot;, and older Netscape versions need &quot;Mozilla&quot;. In order to accomodate these problems you may add a versionSearch property to the browser object. If it's there it's used for the version detect; if it's not there the identity string is used instead.

Take the Firefox and Explorer objects:

{
	string: navigator.userAgent,
	subString: &quot;Firefox&quot;,
	identity: &quot;Firefox&quot;
},
{
	string: navigator.userAgent,
	subString: &quot;MSIE&quot;,
	identity: &quot;Explorer&quot;,
	versionSearch: &quot;MSIE&quot;
},

If the browser is Firefox, the script should look for the &quot;Firefox&quot; string. Since this is also the browser identity string, a special versionSearch is not necessary.

Explorer, however, puts its version number after the string &quot;MSIE&quot;. Since I use &quot;Explorer&quot; as identity string, I have to define the versionSearch property as &quot;MSIE&quot;.
userAgent and appVersion

The version detect script searches for the browser name in both navigator.userAgent and navigator.appVersion. The reason is iCab: this browser's navigator.userAgent may not contain the string &quot;iCab&quot;, but navigator.appVersion always does.
Operating system

The OS detect works the same as the browser detect. Currently all my OS detects use navigator.platform, since this property appears to always contain the correct information.
navigator

Below you see the objects contained by the object navigator. These variables can be read out and give information about the browser and computer of your users. Use this information to add new objects to the browser detect.


navigator.userAgent = Mozilla/5.0 (Windows; U; Windows NT 6.0; zh-TW; rv:1.8.1.12) Gecko/20080201 Firefox/2.0.0.12
navigator.vendor = 
navigator.platform = Win32
navigator.appCodeName = Mozilla
navigator.appName = Netscape
navigator.appVersion = 5.0 (Windows; zh-TW)
navigator.language = zh-TW
navigator.mimeTypes = [object MimeTypeArray]
navigator.oscpu = Windows NT 6.0
navigator.vendorSub = 
navigator.product = Gecko
navigator.productSub = 20080201
navigator.plugins = [object PluginArray]
navigator.securityPolicy = 
navigator.cookieEnabled = true
navigator.onLine = true
navigator.javaEnabled = function javaEnabled() {
    [native code]
}
navigator.taintEnabled = function taintEnabled() {
    [native code]
}
navigator.buildID = 2008020121
navigator.preference = function preference() {
    [native code]
}
navigator.registerContentHandler = function registerContentHandler() {
    [native code]
}
navigator.registerProtocolHandler = function registerProtocolHandler() {
    [native code]
}</pre>
</div>
<div title="CSS" modifier="fhopecc" modified="200710200139" created="200708200532" tags="CSS" changecount="1">
<pre>CSS的語法很簡單，它使用一組英語詞來表示不同的樣式和特徵。

一個樣式表由一組規則組成。每個規則由一個''選擇器''和一個定義部分組成。每個定義部分包含一組由半形分號（;）分離的定義。這組定義放在一對大括弧（{ }）之間。每個定義由一個特性，一個半形冒號（:）和一個值組成。

''選擇器 Selector''
    通常為檔中的元素（element），如html中的&lt;body&gt;，&lt;p&gt;，&lt;strong&gt;等標籤，多個選擇器可以半形逗號（,）隔開。
''屬性 property''
~CSS1、~CSS2、~CSS3規定了許多的屬性，目的在控制選擇器的樣式。
''值 value''
    指屬性接受的設定值，可由各種關鍵字（keyword）組成，多個關鍵字時大都以空格隔開。
要針對沒有標籤定義範圍進行樣式設定時，可利用&lt;div&gt;與&lt;span&gt;標籤
</pre>
</div>
<div title="CSS 的 box model" modifier="fhopecc" created="200708220820">
<pre>元素(element)的盒子模型(box model)

CSS將所有的元素視為一個盒子(box)，由內容(content)、留白(padding)、外框(border)與邊界(margin)所組成，圖示說明如下：
邊界 (margin)
外框 (border)
留白 (padding)
內容 (content)

實際上我們來看一個段落元素(P)的 box model

內容 (content)：由width與high組成內容的長與寬

小細節

    * 若外框沒有指定顏色，預設的顏色會與元素的顏色(color)一模一樣。
    * 除了body標籤之外，元素的background屬性都不會作用在邊界margin上 。

邊界 (margin)
    與其它元素間的距離。
    意義 	範例 	備註
    簡潔表示
    	margin: 1em 2em; 	

    其值可設定為負數(重要的定位技巧)，特別注意的是垂直邊界是取2元素中margin最大的那一個而非像水平邊界為margin的加總

    簡潔表示法的順序為「上」、「右」、「下」、「左」
    上方
    	margin-top: 1em;
    右方
    	margin-right: 2em;
    下方
    	margin-bottom: 1em;
    左方
    	margin-left: 2em;
外框 (border)
    元素以框線包起來 ，可指定的屬性類別有寬度、樣式、顏色、簡稱等四大類。
    寬度(width) 意義 	範例 	備註
    簡潔表示
    	border-width: thin thick; 	

    其值不可為負數，除了使用數值定義寬度外可使用關鍵字「thin」、「medium」、「thick」

    簡潔表示法的順序為「上」、「右」、「下」、「左」
    上方
    	border-top-width: 2px;
    右方
    	border-right-width: thick;
    下方
    	border-bottom-width: 3px;
    左方
    	border-left-width: medium;
    顏色(color) 意義 	範例 	備註
    簡潔表示
    	border-color: silver; 	

    可用的顏色名稱(color-name)：aqua, black, blue, fuchsia, gray, green, lime, maroon, navy, olive, purple, red, silver, teal, white, yellow

    顏色值的設定(color-value)：紅綠藍( rgb)的16進位表示法： #336699, #369, rgb(51,102,153), rgb(30%,60%,100%)

    若沒有指定顏色，預設與元素的顏色(color)一樣
    上方
    	border-top-color: #336699;
    右方
    	border-right-color: rgb(51,102,153);
    下方
    	border-bottom-color: #369;
    左方
    	border-left-color: rgb(30%,60%,100%);
    樣式(style) 意義 	範例 	備註
    簡潔表示
    	border-style: solid dotted; 	

    可用的樣式關鍵字有：none, hidden, dotted, dashed, solid, double, groove, ridge, inset, outset

    並不是所有的瀏覽器都支援指定的樣式效果
    上方
    	border-top-style: solid;
    右方
    	border-right-style: dotted;
    下方
    	border-bottom-style: double;
    左方
    	border-left-style: outset;
    簡稱(shorthand) 意義 	範例 	備註
    簡潔表示
    	border: solid red; 	

    因為框線有width, color, style三種因素，所以在此的簡潔表示法不像 margin與padding可以分別指定四個邊，只能統一設定四個邊
    上方
    	border-top: solid red;
    右方
    	border-right: solid red;
    下方
    	border-bottom: solid red;
    左方
    	border-left: solid red;
留白 (padding)
    內容與框線之間的距離
    意義 	範例 	備註
    簡潔表示
    	padding: 2px 3px; 	

    其值不可為負數

    簡潔表示法的順序為「上」、「右」、「下」、「左」
    上方
    	padding-top: 2px;
    右方
    	padding-right: 3px;
    下方
    	padding-bottom: 2px;
    左方
    	padding-left: 3px;
內容 (content)
    若為行內(inline)元素，就是資料本身，若為區塊(block)元素還可由width與height屬性組成內容的長與寬
    意義 	範例 	備註
    寬度
    	width: 760px; 	

    其值不可為負數

    IE 5.5的實作錯誤，其width與height皆包含了content, padding與border
    長度
    	height: 1000px;</pre>
</div>
<div title="CSS 的列印控制" modifier="fhopecc" modified="200808021247" created="200709200010" tags="CSS" changecount="3">
<pre>Printing Web documents and CSS

This document describes some of the issues concerning the use of CSS to reformat Web documents for printing (using the media type &quot;print&quot;). We also discuss those aspects that CSS is not able to control or even influence. We assume a good knowledge of CSS and concentrate on practical issues, given the current deficiencies in browsers in implementing print-related CSS. For more basic tutorials and theory see &quot;Other Sources&quot; below. See also MediaStylesheets for practical media stylesheet strategies.

Two of the most common problems with printing occur when positioning other than static is used (e.g. position: absolute) or when there are floats. See the section below &quot;Suggested strategy for page breaks&quot;.
Print stylesheets

At present, few sites specify print stylesheets. Instead, it's become fashionable to provide an alternative HTML file with a link entitled &quot;Printer-friendly version&quot; or &quot;Print this document&quot;. The downside, of course, is in the extra maintenance required. However, some clients insist on such a solution, believing that users have come to expect such links. In his design for Devedge, EricMeyer simply invoked a small piece of Javascript which displays a pop-up box saying &quot;This page is already printer-friendly!&quot;. Another solution would be to link to the &quot;Site Help&quot; page (you do have one, don't you?), explaining that all of the site's pages will &quot;automatically&quot; print nicely, i.e. by design.

Here are some ideas for what to put in your print stylesheet:-

    * Removing navigation aids such as menus, breadcrumbs and search boxes
    * Suppressing background colours [colors] and background images
    * Changing font (e.g. to a serifed font)
    * Changing text line-height (leading)
    * Exposing link URLs through generated content (advanced browsers only, e.g. Opera, Firefox)
    * Removing link underscores (although one school of thought is that it's still useful to see, on paper, what the document links to).

A thread in css-d in September 2003 suggested that some users have come to expect the printed version of a page to look exactly the same as what they see on screen. So it's a good idea not to make the printed version unnecessarily different and perhaps to outline, on your Site Help page, what the differences are and the reasons for them.

Be warned though, that for most users, the printed page will not look like what they see on screen in respect of backgrounds and perhaps borders and text colour too - and there's nothing you, as author, can do about it. See below under &quot;Backgrounds&quot;.
Print headers/footers and print margins

When printing Web documents, margins are set in the browser's Page Setup (or Print Setup) dialog box. These margin settings, although set within the browser, are controlled at the operating system/printer driver level and are not controllable at the HTML/CSS/DOM level. (For CSS-controlled printed page headers and footers see PrintingHeaders.)

The settings must be big enough to encompass the printer's physical non-printing areas. Further, they must be big enough to encompass the header and footer that the browser is usually configured to print (typically the page title, page number, URL and date). Note that these headers and footers, although specified by the browser and usually configurable through user preferences, are not part of the Web page itself and therefore are not controllable by CSS. In CSS terms, they fall outside the Page Box [CSS2.1 Section 13.2].

The values you enter (in inches, cm or mm) are not an accurate reflection of the actual margins. The discrepancy varies between browsers and between printers, so set the values by trial and error. To calibrate your own browser/printer combination, use a test Web document with a visible border on &lt;body&gt; and a CSS margin of zero. Set these properties on &lt;html&gt; as well for good measure:-

html {
margin: 0;
border: 1px solid red;
}

body {
margin: 0;
border: 1px solid green;
}

I've created a calibration page on my public Web site, which also permits calibration of font size (yes, that dreaded subject). The following link is to an enhanced version of the public page and further demonstrates the issues discussed below under &quot;Backgrounds&quot;. Please remember that the public page was written for general Web users, not Web designers:-

http://www.syntacticweb.co.uk/calib2.htm

When subsequently printing pages, you may find that the top or bottom line of text is &quot;cut off&quot;, or find even worse page-break mangling (see &quot;Page Breaks&quot; below). If so, slightly increase the top or bottom margin respectively. Experiments with my own sites suggest that a generous bottom margin will reduce page-break problems (it forms a kind of overflow area). However, adjusting margins is under the control of browser users rather than developers and you can place no reliance on its having been done at all, let alone well.

In your site's screen stylesheet, you may have chosen to set margins and padding on the &lt;body&gt; element (browsers set their own default values). If you have a print stylesheet, you will probably want to set the values for margin and padding to zero since the user's &quot;print margins&quot;, as described above, must be assumed to be sufficient (and what the user wants).
Page breaks

Since the &quot;print margins&quot; are not under your control as Web author, you can't guarantee how much of a Web document will be printed on each page and hence where the page breaks will be. It will vary according to the user's browser, browser settings and printer. And the user's base font size and stationery size are also outside your control. You will want to use CSS to influence (not control) the position of page breaks. The [CSS2.1 Recommendation Chapter 13 Paged Media] is essential reading. Note that, in this Chapter, CSS2.1 drops some features in CSS2 that browsers have never implemented.

Support for the page-break properties (such as page-break-inside) is largely non-existent, even in the latest browsers, the major exception being Opera (Opera 5 onwards) whose support is good:-

http://www.westciv.com/style_master/academy/browser_support/printing.html

http://www.ncdesign.org/html/s060oth.htm#pagebreak

Worse, browsers are liable to break pages in clearly unacceptable places (see also next paragraph). For example, I have found cases where IE5.0 and Gecko-based browsers (Netscape 7.1=Mozilla 1.4 and Firefox 0.10=Gecko 1.7.3) will break an image across pages. This extreme bug appears to have been fixed in IE6 (and may have been first fixed in IE5.5). Testing on my various sites suggests that Opera's page-break handling, whilst not perfect, is distinctly more robust than that of Gecko-based browsers (Netscape/Moz/Firefox) or IE.

Eric's article (see below) mentions a bug in Gecko (Mozilla) -based browsers regarding the printing of floated elements. This, and related bugs that apparently have yet to be fixed [at February 2005] result in floated elements being chopped at the end of the printed page and sometimes in only one page of a document being printed [Note 2]. I've found a similar float-chopping problem with older versions of Opera (O7.11 and O7.21). A different bug has been reported in IE where, if the top of a floated element happens to coincide with a page break, the floated element doesn't print at all [acknowledgement: Rennan Rieke].

For printing long tables across pages see PrintingTables.
Suggested strategy for page breaks

The best policy (certainly, until browsers improve) is to give them a break (ha!) by allowing them as much discretion as you can in their choice of break points. They have particular problems with side-by-side elements, such as positioned &lt;div&gt;s; floats; and tables with two or more columns. Suitable strategies therefore include making positioned &lt;div&gt;s static; unfloating floats; and breaking up tables used for layout into a series of shorter tables [Note 1]. I have found the latter strategy particularly effective: for example, with a two-column table (menu and text), a new table can be started with each sub-heading. Even though the page-break properties are poorly supported, don't over-constrain the browsers: use the &quot;avoid&quot; value with as light a touch as you can.

Browsers really don't like floats when it comes to printing (see previous section). The workround is to unfloat floated elements (float: none and perhaps width: auto as well). If you do risk having a floated element when printing, it may print across a page break (the top of a floated element is anchored to the current line). Depending on the nature of the floated material, this may be acceptable behaviour. If not, only Opera will enable you to suppress such a split.

If you must have some content printed on only one page, e.g. a form, your best chance is to make it significantly less than one page long, so that you have a good margin (sic) of error. Regarding stationery size, you might choose to assume the international (ISO) standard A4 size (for an international audience) or US Letter size (for an exclusively US audience) although there's no guarantee of what size users are using. But ask yourself how you would respond if you had produced a one-page form using a word processor and a user who was vision-impaired asked for a large-print version. As always with Web design and CSS, life will be much simpler if you don't try to fight with the user by insisting on pixel perfection or guaranteed page breaks. Fluid design applies on paper as well as on screen.
Backgrounds

Most browsers default to having background colours and images switched off when printing. Nevertheless, you'll probably want to suppress the background for the body element in your print stylesheet. If the user's browser is set to print backgrounds, your action will save on ink cartridges and make printing faster, and your users will thank you for these things.

My testing shows that the following browsers not only suppress the body background by default but also the backgrounds of div, table, td and p elements (and presumably all other elements):- Opera (O7.54 thru O9.10); Gecko (NS7.1=Gecko 1.4 and Firefox 1.0=Gecko 1.7.5); IE (5.0 and 6). The suppression, as part of the document's rendering, is controlled by the browser (albeit as a user preference). However, it can't be overridden through an author stylesheet. Instead, it is equivalent to the following rule in a user stylesheet (see UserStylesheets):-

@media print {
  * {
  background-color: white !important;
  background-image: none !important;
  }
}

This drastic suppression doesn't take account of the design of an individual Web document and can play havoc with its readability and general presentation. Since most users will have this browser setting (probably without knowing) you may wish to take account of it in your Print Stylesheet and try to mitigate any damage.

Interestingly, Opera (up to Opera 7, I think) used also to suppress borders set on div, table, td and p elements (and presumably on all other elements).

I have also found that all the above browsers, in addition to suppressing backgrounds, may change text colours to black to try to ensure readability (for example, if a document has white text on a black background). Thus, your document may be printed very differently from how you intended.
The @page rule and forcing Landscape orientation

The @page rule has been cut down in scope from CSS2 to CSS2.1. The full CSS2 @page rule was reportedly implemented only in Opera (and buggily even then). My own testing shows that IE (IE6), Mozilla (Moz1.7.1) and Firefox (FF0.10=Gecko 1.7.3) don't support @page at all. According to the now-obsolescent [CSS2 spec section 13.2.2] it is possible to override the user's setting of orientation and (for example) force printing in Landscape but the relevant &quot;size&quot; property has been dropped from [CSS2.1], consistent with the fact that no current browser supports it. It has been reinstated in the [CSS3 Paged Media] module but note that this is only a Candidate Recommendation (as at February 2007).

Conclusion: forget about @page for the present. If you feel your document needs to be printed in Landscape orientation, ask yourself if you can instead make your design more fluid. If you really can't (perhaps because the document contains data tables with many columns, for example), you will need to advise the user to set the orientation to Landscape and perhaps outline how to do it in the most common browsers.

[Unidentified contributor] If landscape is vital to your presentation, you can always consider PDF. There are free PDF generators for Windows, and Mac OS X has PDF generation natively. If creating a static document won't work for you (dynamic, database generated pages, for example) take a look at server side PDF generation. PHP has functions for this and more information can be found at http://www.php.net/pdf
Printing Quirks

(Authored by Kevin Venkiteswaran) Part of browsers' poor support for printing includes butchering content that is laid out with anything but position: static. This includes &quot;simple&quot; positioning such as relative and absolute. For example, Win/IE5.0 and Win/IE5.5 would show only the top-most onscreen portion of a &lt;div&gt; that was positioned absolute and had overflow: auto (a CSS setup to emulate HTML frames). Similarly, Mozilla 1.6 had similar problems. The solution was to change all position properties from fixed, absolute, etc. back to static.
High-quality printing

If you've read this far, you'll see that current CSS and browser support in no way match the sophisticated results possible with PDF and the rest of the &quot;proper&quot; printing industry.

If you need to produce a high-quality printed version of a Web document, with sophisticated features like printed page headers and footers and with sensible page breaks, then you can't do it with current browsers. However, if your document is in XHTML, [Yeslogic] [Prince] is a batch formatter that can convert any well-formed XML 1.0 document (including XHTML) into PDF and Postscript.

Prince supplies a suitable stylesheet for XHTML documents and supports the CSS3 Paged Media module Candidate Recommendation for doing advanced stuff like printed page headers and footers.

You can get a free Personal Licence (a link to yeslogic.com is added to the corner of output pages).

I haven't tried Prince. If you have any experience of it, please let me Jim Wilkinson know.

[Unidentified contributor] An even better option might be the open source product [CSSToXSLFO], which is a utility which can convert an XML document, together with a CSS2 style sheet, into an XSLFO document, which can then be converted into PDF. It has special support for the XHTML vocabulary, because that is the most obvious language it would be used for. I have tried it, and it is fast, streaming (low footprint) and reliable.
Other sources

EricMeyer has written an excellent basic tutorial for A List Apart called [Going to Print], giving a working example of some of the things you might want to do.

Zeldman describes his own site's print stylesheet at http://www.zeldman.com/essentials/print/. I have the temerity to disagree with Zeldman's use of points for print, for the accessibility reasons given above.

Jens Meiert describes the fundamentals and mimimal requirements for a print stylesheet in his post: [Print style sheets: The basics]

On the Boxes and Arrows site James Kalbach, in his article [Printing the Web], argues the importance of designing for print from a usability perspective and lists the candidate features to include.</pre>
</div>
<div title="CSSSelector" modifier="Fhopecc" modified="200708271246" created="200708230226" tags="CSS 樹狀結構" changecount="2">
<pre>由於HTML DOM 是樹狀結構，
故 CSS 的 selector 設計來描述樹狀結構中某個特定元素或一組特定元素，
selector 基本上為一種可以互相串接的元素過濾器。
!標籤選擇子 tag selector
{{{
&lt;tag_selector&gt; := &lt;tag_value&gt;
}}}
'標籤選擇子會過濾出文件中所有標籤等同 tag_value 的元素。
{{{
b {color:read}
}}}
會把文件中所有 &lt;b&gt;&lt;/b&gt; 的元素，其 style 的顏色屬性值設為 red。
!脈絡選擇子 contextual selector
{{{
&lt;contextual_selector&gt; := &lt;contextual_selector&gt;' '&lt;tag_selector&gt;
}}}
由左而右以 ' ' 連接的 tag_selector，會先求出最左邊的 tag_selector 的元素，
再由前面的元素中，過濾出標籤等同接續 tag_selector 的元素。
{{{
h2 em {color:blue}
}}}
上例表示選取父元素 tag 為 h2 的 tag 為 em 元素，如以下的元素
{{{
&lt;h2&gt;一般&lt;em&gt; 藍色 &lt;/em&gt;文字&lt;/h2&gt;
}}}
----
''類別選擇子 class selector''
{{{
&lt;class_selector&gt; = &lt;tag_selector&gt;'.'&lt;class_value&gt;
}}}
若無指定 tag_selector ，
其會過濾出文件中所有 class 屬性等同 class_value 的元素。
若有指定 tag_selector ，
其會從 tag_selector 所過濾出的元素中，過濾出 class 屬性等同 class_value 的元素。
每一個網頁只能有一個唯一的 id 可以套用樣式, 多用於版面配置或搭配程式 。
{{{
 .blue {color:blue;}
}}}
上述的 selector 可能會選取下面的元素。
{{{
&lt;span class=blue&gt;.......&lt;/span&gt;
&lt;h2 class=red&gt;.........&lt;h2&gt;
}}}
---- 
''識別選擇子 id selector''
{{{
&lt;id_selector&gt; := (&lt;tag_selector&gt;)'#'&lt;id_value&gt;
}}}
若無指定 tag_selector ，
其會過濾出文件中所有 id 屬性等同 id_value 的元素。
若有指定 tag_selector ，
其會從 tag_selector 所過濾出的元素中，再過濾出 id 屬性等同 id_value 的元素。
每一個網頁只能有一個唯一的 id 可以套用樣式, 多用於版面配置或搭配程式 。
{{{
#blue {color:blue;}
}}}
上述的 selector 可能會選取下面的元素。
{{{
&lt;span id=blue&gt;.......&lt;/span&gt;
}}}
----
''attribute selectors''
於 CSS 2.1 才定義。
{{{
&lt;attribute_selectors&gt; := &lt;selector&gt;{[attr=value]|[attr~=value]|[attr!=value]}
}}}
 the full CSS 2.1 set of [attr], [attr=value], [attr~=value] and [attr|=value]. It also supports [attr!=value].  

----
''選擇子的聯集''
{{{
&lt;selectors&gt;     :=  &lt;selector&gt;','&lt;selectors&gt;'
}}}
用 ',' 隔開的多個選擇子所有個別選擇子的聯集。</pre>
</div>
<div title="CheckboxPlugin" modifier="fhopecc" modified="200808031040" created="200702281444" tags="chkList systemConfig" changecount="1">
<pre>/***
|Name|CheckboxPlugin|
|Source|http://www.TiddlyTools.com/#CheckboxPlugin|
|Version|2.1.3|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;&lt;br&gt;&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|plugin|
|Requires||
|Overrides||
|Description|Add checkboxes to your tiddler content|

Checkbox states can be preserved in the document by either automatically modifying the tiddler content or setting/removing tags on specified tiddlers, or they may be saved as local cookies by assigning an optional 'chkID' to the checkbox.  Add custom javascript for programmatic initialization and onClick handling for any checkbox.  Also provides access to checkbox DOM element data and tracks the checkbox state in TiddlyWiki's config.options[] internal data.

!!!!!Usage
&lt;&lt;&lt;
The checkbox syntax, including all optional parameters, is contained inside a matched set of [ and ] brackets.
{{{ [x=id(title|tag){init_script}{onclick_script}] }}}

An alternative syntax lets you place the optional parameters ''outside'' the [ and ] brackets, and is provided for backward-compatibility with existing content that may include checkbox definitions based on earlier releases of this plugin:
{{{ [x]=id(title|tag){init_script}{onclick_script} }}}

//{{{
[ ]or[_] and [x]or[X]
//}}}
Simple checkboxes.  The current unchecked/checked state is indicated by the character between the {{{[}}} and {{{]}}} brackets (&quot;_&quot; means unchecked, &quot;X&quot; means checked).  When you click on a checkbox, the current state is retained by directly modifying the tiddler content to place the corresponding &quot;_&quot; or &quot;X&quot; character in between the brackets
//{{{
[x=id]
//}}}
Assign an optional ID to the checkbox so you can use {{{document.getElementByID(&quot;id&quot;)}}} to manipulate the checkbox DOM element, as well as tracking the current checkbox state in {{{config.options[&quot;id&quot;]}}}.  If the ID starts with &quot;chk&quot; the checkbox state will also be saved in a cookie, so it can be automatically restored whenever the checkbox is re-rendered (overrides any default {{{[x]}}} or {{{[_]}}} value).  If a cookie value is kept, the &quot;_&quot; or &quot;X&quot; character in the tiddler content remains unchanged, and is only applied as the default when a cookie-based value is not currently defined.
//{{{
[x(title|tag)] or [x(title:tag)]
//}}}
Initializes and tracks the current checkbox state by setting or removing (&quot;TogglyTagging&quot;) a particular tag value from a specified tiddler.  If you omit the tiddler title (and the | or : separator), the specified tag is assigned to the current tiddler.  If you omit the tag value, as in {{{(title|)}}}, the default tag, {{{checked}}}, is assumed.  Omitting both the title and tag, {{{()}}}, tracks the checkbox state by setting the &quot;checked&quot; tag on the current tiddler.  When tag tracking is used, the &quot;_&quot; or &quot;X&quot; character in the tiddler content remains unchanged, and is not used to set or track the checkbox state.  If a tiddler title named in the tag does not exist, the checkbox state defaults to //unselected//.  When the checkbox is subsequently changed to //selected//, it will automatically (and silently) create the missing tiddler and then add the tag to it.  //''NOTE: beginning with version 2.1.2 of this plugin, the &quot;|&quot; separator is the preferred separator between the title and tag name, as it avoids syntactic ambiguity when &quot;:&quot; is used within tiddler titles or tag names.''//
//{{{
[x{javascript}{javascript}]
//}}}
You can define optional javascript code segments to add custom initialization and/or 'onClick' handling to a checkbox.  The current checkbox state (and it's other DOM attributes) can be set or read from within these code segments by reference to the default context-object, 'this'.

The first code segment will be executed when the checkbox is initially displayed, so that you can programmatically determine it's starting checked/unchecked state.  The second code segment (if present) is executed whenever the checkbox is clicked, so that you can perform programmed responses or intercept and override the checkbox state based on complex logic using the TW core API or custom functions defined in plugins (e.g. testing a particular tiddler title to see if certain tags are set or setting some tags when the checkbox is clicked).

Note: if you want to use the default checkbox initialization processing with a custom onclick function, use this syntax: {{{ [x=id{}{javascript}] }}} 
&lt;&lt;&lt;
!!!!!Configuration
&lt;&lt;&lt;
Normally, when a checkbox state is changed, the affected tiddlers are automatically re-rendered, so that any checkbox-dependent dynamic content can be updated.  There are three possible tiddlers to be re-rendered, depending upon where the checkbox is placed, and what kind of storage method it is using.
*''container'': the tiddler in which the checkbox is displayed. (e.g., this tiddler)
*''tagged'': the tiddler that is being tagged (e.g., &quot;~MyTask&quot; when tagging &quot;~MyTask:done&quot;)
*''tagging'': the &quot;tag tiddler&quot; (e.g., &quot;~done&quot; when tagging &quot;~MyTask:done&quot;)
You can set the default refresh handling for all checkboxes in your document by using the following javascript syntax either in a systemConfig plugin, or as an inline script.  (Substitute true/false values as desired):
{{{config.checkbox.refresh = { tagged:true, tagging:true, container:true };}}}

You can also override these defaults for any given checkbox by using an initialization function to set one or more of the refresh options.  For example:
{{{[_{this.refresh.container=false}]}}}
&lt;&lt;&lt;
!!!!!Examples
&lt;&lt;&lt;
//{{{
[X] label
[_] label
//}}}
&gt;checked and unchecked static default values
&gt;[X] label
&gt;[_] label
//{{{
[_=demo] label
//}}}
&gt;document-based value (id='demo', no cookie)
&gt;[_=demo] label
//{{{
[_=chkDemo] label
//}}}
&gt;cookie-based value  (id='chkDemo')
&gt;[_=chkDemo] label
//{{{
[_(CheckboxPlugin|demotag)]
[_(CheckboxPlugin|demotag){this.refresh.tagged=this.refresh.container=false}]
//}}}
&gt;tag-based value (TogglyTagging)
&gt;[_(CheckboxPlugin|demotag)] toggle 'demotag' (and refresh tiddler display)
&gt;[_(CheckboxPlugin|demotag){this.refresh.tagged=this.refresh.container=false}] toggle 'demotag' (no refresh)
&gt;current tags: &lt;script&gt;return store.getTiddler(story.findContainingTiddler(place).id.substr(7)).tags.toString();&lt;/script&gt;
&gt;&lt;script label=&quot;click to view current tags&quot;&gt;alert(store.getTiddler(story.findContainingTiddler(place).id.substr(7)).tags.toString());return false&lt;/script&gt;
//{{{
[X{this.checked=true}{alert(this.checked?&quot;on&quot;:&quot;off&quot;)}] message box with checkbox state
//}}}
&gt;custom init and onClick functions
&gt;[X{this.checked=true}{alert(this.checked?&quot;on&quot;:&quot;off&quot;)}] message box with checkbox state
Retrieving option values:
config.options['demo']=&lt;script&gt;return config.options['demo']?&quot;true&quot;:&quot;false&quot;;&lt;/script&gt;
config.options['chkDemo']=&lt;script&gt;return config.options['chkDemo']?&quot;true&quot;:&quot;false&quot;;&lt;/script&gt;

!!!!!Installation
import (or copy/paste) the following tiddlers into your document:
''CheckboxPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)
&lt;&lt;&lt;
!!!!!Revision History
&lt;&lt;&lt;
2006.05.04 - 2.1.3 fix use of findContainingTiddler() to check for a non-null return value, so that checkboxes won't crash when used outside of tiddler display context (such as in header, sidebar or mainmenu)
2006.03.11 - 2.1.2 added &quot;|&quot; as delimiter to tag-based storage syntax (e.g. &quot;tiddler|tag&quot;) to avoid parsing ambiguity when tiddler titles or tag names contain &quot;:&quot;.   Using &quot;:&quot; as a delimiter is still supported but is deprecated in favor of the new &quot;|&quot; usage.  Based on a problem reported by JeffMason.
2006.02.25 - 2.1.0 added configuration options to enable/disable forced refresh of tiddlers when toggling tags
2006.02.23 - 2.0.4 when toggling tags, force refresh of the tiddler containing the checkbox.
2006.02.23 - 2.0.3 when toggling tags, force refresh of the 'tagged tiddler' so that tag-related tiddler content (such as &quot;to-do&quot; lists) can be re-rendered.
2006.02.23 - 2.0.2 when using tag-based storage, allow use [[ and ]] to quote tiddler or tag names that contain spaces:
{{{[x([[Tiddler with spaces]]:[[tag with spaces]])]}}}
2006.01.10 - 2.0.1 when toggling tags, force refresh of the 'tagging tiddler'.  For example, if you toggle the &quot;systemConfig&quot; tag on a plugin, the corresponding &quot;systemConfig&quot; TIDDLER will be automatically refreshed (if currently displayed), so that the 'tagged' list in that tiddler will remain up-to-date.
2006.01.04 - 2.0.0 update for ~TW2.0
2005.12.27 - 1.1.2 Fix lookAhead regExp handling for {{{[x=id]}}}, which had been including the &quot;]&quot; in the extracted ID.  
Added check for &quot;chk&quot; prefix on ID before calling saveOptionCookie()
2005.12.26 - 1.1.2 Corrected use of toUpperCase() in tiddler re-write code when comparing {{{[X]}}} in tiddler content with checkbox state. Fixes a problem where simple checkboxes could be set, but never cleared.
2005.12.26 - 1.1.0 Revise syntax so all optional parameters are included INSIDE the [ and ] brackets.  Backward compatibility with older syntax is supported, so content changes are not required when upgrading to the current version of this plugin.   Based on a suggestion by GeoffSlocock
2005.12.25 - 1.0.0 added support for tracking checkbox state using tags (&quot;TogglyTagging&quot;)
Revised version number for official post-beta release.
2005.12.08 - 0.9.3 support separate 'init' and 'onclick' function definitions.
2005.12.08 - 0.9.2 clean up lookahead pattern
2005.12.07 - 0.9.1 only update tiddler source content if checkbox state is actually different.  Eliminates unnecessary tiddler changes (and 'unsaved changes' warnings)
2005.12.07 - 0.9.0 initial BETA release
&lt;&lt;&lt;
!!!!!Credits
&lt;&lt;&lt;
This feature was created by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]]
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.CheckboxPlugin = {major: 2, minor: 1, revision:3 , date: new Date(2006,5,4)};
//}}}

// // 1.2.x compatibility
//{{{
if (!window.story) window.story=window;
if (!store.getTiddler) store.getTiddler=function(title){return store.tiddlers[title]}
if (!store.addTiddler) store.addTiddler=function(tiddler){store.tiddlers[tiddler.title]=tiddler}
if (!store.deleteTiddler) store.deleteTiddler=function(title){delete store.tiddlers[title]}
//}}}

//{{{
config.checkbox = { refresh: { tagged:true, tagging:true, container:true } };
config.formatters.push( {
	name: &quot;checkbox&quot;,
	match: &quot;\\[[xX_ ][\\]\\=\\(\\{]&quot;,
	lookahead: &quot;\\[([xX_ ])(\\])?(=[^\\s\\(\\]{]+)?(\\([^\\)]*\\))?({[^}]*})?({[^}]*})?(\\])?&quot;,
	handler: function(w)
		{
			var lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source)
			if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart)
			{
				// get params
				var checked=lookaheadMatch[1];
				var id=lookaheadMatch[3];
				var tag=lookaheadMatch[4];
				var fn_init=lookaheadMatch[5];
				var fn_click=lookaheadMatch[6];
				// create checkbox element
				var c = document.createElement(&quot;input&quot;);
				c.setAttribute(&quot;type&quot;,&quot;checkbox&quot;);
				c.onclick=onClickCheckbox;
				c.srcpos=w.matchStart+1; // remember location of &quot;X&quot;
				c.container=story.findContainingTiddler(w.output); if (c.container) c.container=c.container.id.substr(7); // tiddler containing checkbox
				c.refresh = { };
				c.refresh.container=config.checkbox.refresh.container;
				c.refresh.tagged=config.checkbox.refresh.tagged;
				c.refresh.tagging=config.checkbox.refresh.tagging;
				w.output.appendChild(c);
				// set default state
				c.checked=(checked.toUpperCase()==&quot;X&quot;);
				// get/set state by ID
				if (id) {
					c.id=id.substr(1); // trim off leading &quot;=&quot;
					if (config.options[c.id]!=undefined)
						c.checked=config.options[c.id];
					else
						config.options[c.id]=c.checked;
				}
				// get/set state by tag
				if (tag) {
					c.tiddler=c.container;
					c.tag=tag.substr(1,tag.length-2).trim(); // trim off parentheses
					var pos=c.tag.indexOf(&quot;|&quot;); if (pos==-1) var pos=c.tag.indexOf(&quot;:&quot;);
					if (pos==0) { c.tag=tag.substr(1); }
					if (pos&gt;0) { c.tiddler=c.tag.substr(0,pos).replace(/\[\[/g,&quot;&quot;).replace(/\]\]/g,&quot;&quot;); c.tag=c.tag.substr(pos+1); }
					c.tag.replace(/\[\[/g,&quot;&quot;).replace(/\]\]/g,&quot;&quot;);
					if (!c.tag.length) c.tag=&quot;checked&quot;;
					var t=store.getTiddler(c.tiddler);
					c.checked = (t &amp;&amp; t.tags)?(t.tags.find(c.tag)!=null):false;
				}
				if (fn_init) c.fn_init=fn_init.trim().substr(1,fn_init.length-2); // trim off surrounding { and } delimiters
				if (fn_click) c.fn_click=fn_click.trim().substr(1,fn_click.length-2);
				c.init=true; c.onclick(); c.init=false; // compute initial state and save in tiddler/config/cookie
				w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			}
		}
	}
)
//}}}

//{{{
function onClickCheckbox()
{
	if (this.fn_init)
		// custom function hook to set initial state (run only once)
		{ try { eval(this.fn_init); this.fn_init=null; } catch(e) { displayMessage(&quot;Checkbox init error: &quot;+e.toString()); } }
	else if (this.fn_click)
		// custom function hook to override or react to changes in checkbox state
		{ try { eval(this.fn_click) } catch(e) { displayMessage(&quot;Checkbox click error: &quot;+e.toString()); } }
	if (this.id)
		// save state in config AND cookie (only when ID starts with 'chk')
		{ config.options[this.id]=this.checked; if (this.id.substr(0,3)==&quot;chk&quot;) saveOptionCookie(this.id); }
	if ((!this.id || this.id.substr(0,3)!=&quot;chk&quot;) &amp;&amp; !this.tag) {
		// save state in tiddler content only if not using cookie or tag tracking
		var t=story.findContainingTiddler(this); if (t) {
			var t=store.getTiddler(t.id.substr(7));
			if (this.checked!=(t.text.substr(this.srcpos,1).toUpperCase()==&quot;X&quot;)) { // if changed
				t.set(null,t.text.substr(0,this.srcpos)+(this.checked?&quot;X&quot;:&quot;_&quot;)+t.text.substr(this.srcpos+1),null,null,t.tags);
				store.setDirty(true);
			}
		}
	}
	if (this.tag) {
		var t=store.getTiddler(this.tiddler);
		if (!t) { t=(new Tiddler()); t.set(this.tiddler,&quot;&quot;,config.options.txtUserName,(new Date()),null); store.addTiddler(t); } 
		var tagged=(t.tags &amp;&amp; t.tags.find(this.tag)!=null);
		if (this.checked &amp;&amp; !tagged) { t.tags.push(this.tag); store.setDirty(true); }
		if (!this.checked &amp;&amp; tagged) { t.tags.splice(t.tags.find(this.tag),1); store.setDirty(true); }
		// if tag state has been changed, force a display update
		if (this.checked!=tagged) {
			if (this.refresh.tagged) story.refreshTiddler(this.tiddler,null,true); // the TAGGED tiddler
			if (this.refresh.tagging) story.refreshTiddler(this.tag,null,true); // the TAGGING tiddler
		}
	}
	// refresh containing tiddler (but not during initial rendering, or we get an infinite loop!)
	if (!this.init &amp;&amp; this.refresh.container &amp;&amp; this.container!=this.tiddler)
		story.refreshTiddler(this.container,null,true); // the tiddler CONTAINING the checkbox
	return true;
}
//}}}</pre>
</div>
<div title="Console" modifier="fhopecc" created="200712100852" tags="ROR" changecount="1">
<pre>程式碼有更新則利用下面的句子反應更新。
{{{
reload! 
}}}</pre>
</div>
<div title="Contract ID in XPCOM" modifier="fhopecc" modified="200801290234" created="200801290233" tags="XPCOM" changecount="2">
<pre>@&lt;internetdomain&gt;/module[/submodule[...]];&lt;version&gt;[?&lt;name&gt;=&lt;value&gt;[&amp;&lt;name&gt;=&lt;value&gt;[...]]]

ContractID 告訴元件管理員應該建立那個元件實例。
{{{
var file = components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance();
}}}</pre>
</div>
<div title="Credits &amp; License" modifier="oc" modified="200704270640" created="200704140005" tags="chkList">
<pre>This tool is a application of many beautiful scripts:
#The wonderful frame work TiddlyWiki by JeremyRuston
#The powerful ForEachTiddlerPlugin by UdoBorkowski
#The interesting CheckboxPlugin by Eric Shulman
#Inspired by [[TiddlyWikiTasks|http://tiddlywikitips.com/TiddlyWikiTasks.html]] by Jim Barr
Who did this? ~Ying-Ching Chen (aka. [[老貓|http://b-oo-k.net/blog/]]). You can download and use it freely. If you like, please write a review in your blog. I would be very appreciated. </pre>
</div>
<div title="Creep" modifier="fhopecc" created="200710160539" changecount="1">
<pre>When you were here before,
Couldn’t look you in the eye
You’re just like an angel,
Your skin makes me cry

You float like a feather
In a beautiful world
I wish I was special
You’re so VERY special

But I’m a creep, I’m a weirdo
What the hell am I doin’ here?
I don’t belong here

I don’t care if it hurts, I wanna have control
I want a perfect body,I want a perfect soul

I want you to notice
when I’m not around
You’re so VERY special
I wish I was special

But I’m a creep, I’m a weirdo
What the hell am I doin’ here?
I don’t belong here, ohhhh, ohhhh

She’s running out again
She’s running out
She run run run run…run…

Whatever makes you happy
Whatever you want
You’re VERY special, I wish I was special

But I’m a creep, I’m a weirdo
What the hell am I doin’ here?
I don’t belong here

I don’t belong here… </pre>
</div>
<div title="CurrentLNDAuditorPlugin" modifier="fhopecc" modified="200902040139" created="200804090756" tags="systemConfig" changecount="15">
<pre>//{{
auditors =[
'邱稅務員錦蓮',
'蘇稅務員麗華',
'陳股長怜秀',
'黃主任遠學',
'吳主任美鴦',
'呂課長玉枝',
'稅務員錦蓮',
'葉股長秀桃',
'王股長其文',
'蔡股長惠絨',
'李股長秀勤',
'石審核員起生' ]
startDate = new Date()
startDate.setFullYear(2009)
startDate.setMonth(2)

today = new Date()

function monthsBetween(olddate, newdate) {
  year = newdate.getFullYear() - olddate.getFullYear()
  month = newdate.getMonth() - olddate.getMonth() 
  return (year * 12 + month + 1) % auditors.length;
}


currentAuditor = monthsBetween(startDate, today)
//alert(startDate)
//alert(auditors[currentAuditor])

 config.macros.currentLNDAuditor = {
   handler: function (place, macroName, params, wikifier, paramString, tiddler)
   { 
      var timespan = createTiddlyElement(place,&quot;span&quot;,&quot;lnda&quot;,&quot;lnda&quot;,auditors[currentAuditor]); 
   }
 };

//}}
</pre>
</div>
<div title="DC Battery" modifier="YourName" modified="200704270549" created="200703021045" tags="chkList chkPacking xEE">
<pre></pre>
</div>
<div title="DC Charger" modifier="YourName" modified="200704270548" created="200703021045" tags="chkList chkPacking xEE">
<pre></pre>
</div>
<div title="DSL" modifier="Fhopecc" modified="200708260040" created="200708230047" tags="電腦科學">
<pre>人說 ruby 很適合製作出新的 DSL，
但是如同 rake 模擬 make，
在 make 這個 DSL 中，符號的初始意義是 task，
所以任何符號不用再加上額外的字，去宣稱此符號表示一個 task，
在 ruby 中，符號的初始意義並非一個 task，所以必須在前面加上 task 方法，
來把其後面的符號轉為 task 的功能。

ruby 中具有 regexp 的常字語法，
/regexp/ ，故能直接將 regexp  寫入 // 間，
而非如同其它語言 java 必須將 regexp 轉為字串，再傳入其中。</pre>
</div>
<div title="DatePlugin" modifier="fhopecc" modified="200709280037" created="200709270158" tags="systemConfig" changecount="5">
<pre>/***
|Name|DatePlugin|
|Source|http://www.TiddlyTools.com/#DatePlugin|
|Version|2.3.1|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;&lt;br&gt;&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|plugin|
|Requires||
|Overrides||
|Description|formatted dates plus popup menu with 'journal' link, changes and (optional) reminders|

There are quite a few calendar generators, reminders, to-do lists, 'dated tiddlers' journals, blog-makers and GTD-like schedule managers that have been built around TW.  While they all have different purposes, and vary in format, interaction, and style, in one way or another each of these plugins displays and/or uses date-based information to make finding, accessing and managing relevant tiddlers easier.  This plugin provides a general approach to embedding dates and date-based links/menus within tiddler content.

This plugin display formatted dates, for the specified year, month, day using number values or mathematical expressions such as (Y+1) or (D+30).  Optionally, you can create a link from the formatted output to a 'dated tiddler' for quick blogging or create a popup menu that includes the dated tiddler link plus links to changes made on that date as well as links to any pending reminders for the coming 31 days (if the RemindersPlugin is installed).  This plugin also provides a public API for easily incorporating formatted date output (with or without the links/popups) into other plugins, such as calendar generators, etc.
!!!!!Usage
&lt;&lt;&lt;
When installed, this plugin defines a macro: {{{&lt;&lt;date [mode] [date] [format] [linkformat]&gt;&gt;}}}.  All of the macro parameters are optional and, in it's simplest form, {{{&lt;&lt;date&gt;&gt;}}}, it is equivalent to the ~TiddlyWiki core macro, {{{&lt;&lt;today&gt;&gt;}}}.

However, where {{{&lt;&lt;today&gt;&gt;}}} simply inserts the current date/time in a predefined format (or custom format, using {{{&lt;&lt;today [format]&gt;&gt;}}}), the {{{&lt;&lt;date&gt;&gt;}}} macro's parameters take it much further than that:
* [mode] is either ''display'', ''link'' or ''popup''.  If omitted, it defaults to ''display''.  This param let's you select between simply displaying a formatted date, or creating a link to a specific 'date titled' tiddler or a popup menu containing a dated tiddler link, plus links to changes and reminders.
* [date] lets you enter ANY date (not just today) as ''year, month, and day values or simple mathematical expressions'' using pre-defined variables, Y, M, and D for the current year, month and day, repectively.  You can display the modification date of the current tiddler by using the keyword: ''tiddler'' in place of the year, month and day parameters.  Use ''tiddler://name-of-tiddler//'' to display the modification date of a specific tiddler.  You can also use keywords ''today'' or ''filedate'' to refer to these //dynamically changing// date/time values.  
* [format] and [linkformat] uses standard ~TiddlyWiki date formatting syntax.  The default is &quot;YYYY.0MM.0DD&quot;
&gt;^^''DDD'' - day of week in full (eg, &quot;Monday&quot;), ''DD'' - day of month, ''0DD'' - adds leading zero^^
&gt;^^''MMM'' - month in full (eg, &quot;July&quot;), ''MM'' - month number, ''0MM'' - adds leading zero^^
&gt;^^''YYYY'' - full year, ''YY'' - two digit year, ''hh'' - hours, ''mm'' - minutes, ''ss'' - seconds^^
&gt;^^//note: use of hh, mm or ss format codes is only supported with ''tiddler'', ''today'' or ''filedate'' values//^^
* [linkformat] - specify an alternative date format so that the title of a 'dated tiddler' link can have a format that differs from the date's displayed format

In addition to the macro syntax, DatePlugin also provides a public javascript API so that other plugins that work with dates (such as calendar generators, etc.) can quickly incorporate date formatted links or popups into their output:

''{{{showDate(place, date, mode, format, linkformat, autostyle, weekend)}}}'' 

Note that in addition to the parameters provided by the macro interface, the javascript API also supports two optional true/false parameters:
* [autostyle] - when true, the font/background styles of formatted dates are automatically adjusted to show the date's status:  'today' is boxed, 'changes' are bold, 'reminders' are underlined, while weekends and holidays (as well as changes and reminders) can each have a different background color to make them more visibly distinct from each other.
* [weekend] - true indicates a weekend, false indicates a weekday.  When this parameter is omitted, the plugin uses internal defaults to automatically determine when a given date falls on a weekend.
&lt;&lt;&lt;
!!!!!Examples
&lt;&lt;&lt;
The current date: &lt;&lt;date&gt;&gt;
The current time: &lt;&lt;date today &quot;0hh:0mm:0ss&quot;&gt;&gt;
Today's blog: &lt;&lt;date link today &quot;DDD, MMM DDth, YYYY&quot;&gt;&gt;
Recent blogs/changes/reminders: &lt;&lt;date popup Y M D-1 &quot;yesterday&quot;&gt;&gt; &lt;&lt;date popup today &quot;today&quot;&gt;&gt; &lt;&lt;date popup Y M D+1 &quot;tomorrow&quot;&gt;&gt;
The first day of next month will be a &lt;&lt;date Y M+1 1 &quot;DDD&quot;&gt;&gt;
This tiddler (DatePlugin) was last updated on: &lt;&lt;date tiddler &quot;DDD, MMM DDth, YYYY&quot;&gt;&gt;
The SiteUrl was last updated on: &lt;&lt;date tiddler:SiteUrl &quot;DDD, MMM DDth, YYYY&quot;&gt;&gt;
This document was last saved on &lt;&lt;date filedate &quot;DDD, MMM DDth, YYYY at 0hh:0mm:0ss&quot;&gt;&gt;
&lt;&lt;date 2006 07 24 &quot;MMM DDth, YYYY&quot;&gt;&gt; will be a &lt;&lt;date 2006 07 24 &quot;DDD&quot;&gt;&gt;
&lt;&lt;&lt;
!!!!!Installation
&lt;&lt;&lt;
import (or copy/paste) the following tiddlers into your document:
''DatePlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)
&lt;&lt;&lt;
!!!!!Revision History
&lt;&lt;&lt;
''2007.06.20 [2.3.1]'' in onClickDatePopup(), use Popup.show() instead of deprecated ScrollToTiddlerPopup().  Fixes fatal error that prevents popups from being properly displayed
''2007.05.31 [2.3.0]'' list &quot;created&quot; tiddlers in date popup.  Also, force re-cache of created/modified indices when displaying current date and store.isDirty(), so that popup is kept in sync with tiddler changes.
''2006.05.09 [2.2.1]'' added &quot;todaybg&quot; handling to set background color of current date.  Also, honor excludeLists tag when getting lists of tiddlers.  Based on suggestions by Mark Hulme.
''2006.05.05 [2.2.0]'' added &quot;linkedbg&quot; handling to set background color when a 'dated tiddler' exists.  Based on a suggestion by Mark Hulme.
''2006.03.08 [2.1.2]'' add 'override leadtime' flag param in call to findTiddlersWithReminders(), and add &quot;Enter a title&quot; default text to new reminder handler.  Thanks to Jeremy Sheeley for these additional tweaks.
''2006.03.06 [2.1.0]'' hasReminders() nows uses window.reminderCacheForCalendar[] when present.  If calendar cache is not present, indexReminders() now uses findTiddlersWithReminders() with a 90-day look ahead to check for reminders.  Also, switched default background colors for autostyled dates: reminders are now greenish (&quot;c0ffee&quot;) and holidays are now reddish (&quot;ffaace&quot;).
''2006.02.14 [2.0.5]'' when readOnly is set (by TW core), omit &quot;new reminders...&quot; popup menu item and, if a &quot;dated tiddler&quot; does not already exist, display the date as simple text instead of a link.
''2006.02.05 [2.0.4]'' added var to variables that were unintentionally global.  Avoids FireFox 1.5.0.1 crash bug when referencing global variables
''2006.01.18 [2.0.3]'' In 1.2.x the tiddler editor's text area control was given an element ID=(&quot;tiddlerBody&quot;+title), so that it was easy to locate this field and programmatically modify its content.  With the addition of configuration templates in 2.x, the textarea no longer has an ID assigned.  To find this control we now look through all the child nodes of the tiddler editor to locate a &quot;textarea&quot; control where attribute(&quot;edit&quot;) equals &quot;text&quot;, and then append the new reminder to the contents of that control.
''2006.01.11 [2.0.2]'' correct 'weekend' override detection logic in showDate()
''2006.01.10 [2.0.1]'' allow custom-defined weekend days (default defined in config.macros.date.weekend[] array)
added flag param to showDate() API to override internal weekend[] array
''2005.12.27 [2.0.0]'' Update for TW2.0
Added parameter handling for 'linkformat'
''2005.12.21 [1.2.2]'' FF's date.getYear() function returns 105 (for the current year, 2005).  When calculating a date value from Y M and D expressions, the plugin adds 1900 to the returned year value get the current year number.  But IE's date.getYear() already returns 2005.  As a result, plugin calculated date values on IE were incorrect (e.g., 3905 instead of 2005).  Adding +1900 is now conditional so the values will be correct on both browsers.
''2005.11.07 [1.2.1]'' added support for &quot;tiddler&quot; dynamic date parameter
''2005.11.06 [1.2.0]'' added support for &quot;tiddler:title&quot; dynamic date parameter
''2005.11.03 [1.1.2]'' when a reminder doesn't have a specified title parameter, use the title of the tiddler that contains the reminder as &quot;fallback&quot; text in the popup menu.  Based on a suggestion from BenjaminKudria.
''2005.11.03 [1.1.1]'' Temporarily bypass hasReminders() logic to avoid excessive overhead from generating the indexReminders() cache.  While reminders can still appear in the popup menu, they just won't be indicated by auto-styling the date number that is displayed.  This single change saves approx. 60% overhead (5 second delay reduced to under 2 seconds).
''2005.11.01 [1.1.0]'' corrected logic in hasModifieds() and hasReminders() so caching of indexed modifieds and reminders is done just once, as intended.  This should hopefully speed up calendar generators and other plugins that render multiple dates...
''2005.10.31 [1.0.1]'' documentation and code cleanup
''2005.10.31 [1.0.0]'' initial public release
''2005.10.30 [0.9.0]'' pre-release
&lt;&lt;&lt;
!!!!!Credits
&lt;&lt;&lt;
This feature was developed by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]].
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.date = {major: 2, minor: 3, revision: 1, date: new Date(2007,6,20)};
//}}}

//{{{
config.macros.date = {
	format: &quot;YYYY.0MM.0DD&quot;, // default date display format
	linkformat: &quot;YYYY.0MM.0DD&quot;, // 'dated tiddler' link format
	linkedbg: &quot;#babb1e&quot;, // &quot;babble&quot;
	todaybg: &quot;#ffab1e&quot;, // &quot;fable&quot;
	weekendbg: &quot;#c0c0c0&quot;, // &quot;cocoa&quot;
	holidaybg: &quot;#ffaace&quot;, // &quot;face&quot;
	createdbg: &quot;#bbeeff&quot;, // &quot;beef&quot;
	modifiedsbg: &quot;#bbeeff&quot;, // &quot;beef&quot;
	remindersbg: &quot;#c0ffee&quot;, // &quot;coffee&quot;
	holidays: [ &quot;01/01&quot;, &quot;07/04&quot;, &quot;07/24&quot;, &quot;11/24&quot; ], // NewYearsDay, IndependenceDay(US), Eric's Birthday (hooray!), Thanksgiving(US)
	weekend: [ 1,0,0,0,0,0,1 ] // [ day index values: sun=0, mon=1, tue=2, wed=3, thu=4, fri=5, sat=6 ]
};
//}}}

//{{{
config.macros.date.handler = function(place,macroName,params)
{
	// do we want to see a link, a popup, or just a formatted date?
	var mode=&quot;display&quot;;
	if (params[0]==&quot;display&quot;) { mode=params[0]; params.shift(); }
	if (params[0]==&quot;popup&quot;) { mode=params[0]; params.shift(); }
	if (params[0]==&quot;link&quot;) { mode=params[0]; params.shift(); }
	// get the date
	var now = new Date();
	var date = now;
	if (!params[0] || params[0]==&quot;today&quot;)
		{ params.shift(); }
	else if (params[0]==&quot;filedate&quot;)
		{ date=new Date(document.lastModified); params.shift(); }
	else if (params[0]==&quot;tiddler&quot;)
		{ date=store.getTiddler(story.findContainingTiddler(place).id.substr(7)).modified; params.shift(); }
	else if (params[0].substr(0,8)==&quot;tiddler:&quot;)
		{ var t; if ((t=store.getTiddler(params[0].substr(8)))) date=t.modified; params.shift(); }
	else {
		var y = eval(params.shift().replace(/Y/ig,(now.getYear()&lt;1900)?now.getYear()+1900:now.getYear()));
		var m = eval(params.shift().replace(/M/ig,now.getMonth()+1));
		var d = eval(params.shift().replace(/D/ig,now.getDate()+0));
		date = new Date(y,m-1,d);
	}
	// date format with optional custom override
	var format=this.format; if (params[0]) format=params.shift();
	var linkformat=this.linkformat; if (params[0]) linkformat=params.shift();
	showDate(place,date,mode,format,linkformat);
}
//}}}

//{{{
window.showDate=showDate;
function showDate(place,date,mode,format,linkformat,autostyle,weekend)
{
	if (!mode) mode=&quot;display&quot;;
	if (!format) format=config.macros.date.format;
	if (!linkformat) linkformat=config.macros.date.linkformat;
	if (!autostyle) autostyle=false;

	// format the date output
	var title = date.formatString(format);
	var linkto = date.formatString(linkformat);

	// just show the formatted output
	if (mode==&quot;display&quot;) { place.appendChild(document.createTextNode(title)); return; }

	// link to a 'dated tiddler'
	var link = createTiddlyLink(place, linkto, false);
	link.appendChild(document.createTextNode(title));
	link.title = linkto;
	link.date = date;
	link.format = format;
	link.linkformat = linkformat;

	// if using a popup menu, replace click handler for dated tiddler link
	// with handler for popup and make link text non-italic (i.e., an 'existing link' look)
	if (mode==&quot;popup&quot;) {
		link.onclick = onClickDatePopup;
		link.style.fontStyle=&quot;normal&quot;;
	}

	// format the popup link to show what kind of info it contains (for use with calendar generators)
	if (!autostyle) return;
	if (hasModifieds(date)||hasCreateds(date))
		{ link.style.fontStyle=&quot;normal&quot;; link.style.fontWeight=&quot;bold&quot;; }
	if (hasReminders(date))
		{ link.style.textDecoration=&quot;underline&quot;; }
	if(isToday(date))
		{ link.style.border=&quot;1px solid black&quot;; }

	if( (weekend!=undefined?weekend:isWeekend(date)) &amp;&amp; (config.macros.date.weekendbg!=&quot;&quot;) )
		{ place.style.background = config.macros.date.weekendbg; }
	if(isHoliday(date)&amp;&amp;(config.macros.date.holidaybg!=&quot;&quot;))
		{ place.style.background = config.macros.date.holidaybg; }
	if (hasCreateds(date)&amp;&amp;(config.macros.date.createdbg!=&quot;&quot;))
		{ place.style.background = config.macros.date.createdbg; }
	if (hasModifieds(date)&amp;&amp;(config.macros.date.modifiedsbg!=&quot;&quot;))
		{ place.style.background = config.macros.date.modifiedsbg; }
	if (store.tiddlerExists(linkto)&amp;&amp;(config.macros.date.linkedbg!=&quot;&quot;))
		{ place.style.background = config.macros.date.linkedbg; }
	if (hasReminders(date)&amp;&amp;(config.macros.date.remindersbg!=&quot;&quot;))
		{ place.style.background = config.macros.date.remindersbg; }
	if(isToday(date)&amp;&amp;(config.macros.date.todaybg!=&quot;&quot;))
		{ place.style.background = config.macros.date.todaybg; }
}
//}}}

//{{{
function isToday(date) // returns true if date is today
	{ var now=new Date(); return ((now-date&gt;=0) &amp;&amp; (now-date&lt;86400000)); }

function isWeekend(date) // returns true if date is a weekend
	{ return (config.macros.date.weekend[date.getDay()]); }

function isHoliday(date) // returns true if date is a holiday
{
	var longHoliday = date.formatString(&quot;0MM/0DD/YYYY&quot;);
	var shortHoliday = date.formatString(&quot;0MM/0DD&quot;);
	for(var i = 0; i &lt; config.macros.date.holidays.length; i++) {
		var holiday=config.macros.date.holidays[i];
		if (holiday==longHoliday||holiday==shortHoliday) return true;
	}
	return false;
}
//}}}

//{{{
// Event handler for clicking on a day popup
function onClickDatePopup(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var popup = Popup.create(this);
	if(popup) {
		// always show dated tiddler link (or just date, if readOnly) at the top...
		if (!readOnly || store.tiddlerExists(this.date.formatString(this.linkformat)))
			createTiddlyLink(popup,this.date.formatString(this.linkformat),true);
		else
			createTiddlyText(popup,this.date.formatString(this.linkformat));
		addCreatedsToPopup(popup,this.date,this.format);
		addModifiedsToPopup(popup,this.date,this.format);
		addRemindersToPopup(popup,this.date,this.linkformat);
	}
	Popup.show(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}
//}}}

//{{{
function indexCreateds() // build list of tiddlers, hash indexed by creation date
{
	var createds= { };
	var tiddlers = store.getTiddlers(&quot;title&quot;,&quot;excludeLists&quot;);
	for (var t = 0; t &lt; tiddlers.length; t++) {
		var date = tiddlers[t].created.formatString(&quot;YYYY0MM0DD&quot;)
		if (!createds[date])
			createds[date]=new Array();
		createds[date].push(tiddlers[t].title);
	}
	return createds;
}
function hasCreateds(date) // returns true if date has created tiddlers
{
	if (!config.macros.date.createds) config.macros.date.createds=indexCreateds();
	return (config.macros.date.createds[date.formatString(&quot;YYYY0MM0DD&quot;)]!=undefined);
}

function addCreatedsToPopup(popup,when,format)
{
	var force=(store.isDirty() &amp;&amp; when.formatString(&quot;YYYY0MM0DD&quot;)==new Date().formatString(&quot;YYYY0MM0DD&quot;));
	if (force || !config.macros.date.createds) config.macros.date.createds=indexCreateds();
	var indent=String.fromCharCode(160)+String.fromCharCode(160);
	var createds = config.macros.date.createds[when.formatString(&quot;YYYY0MM0DD&quot;)];
	if (createds) {
		createds.sort();
		var e=createTiddlyElement(popup,&quot;div&quot;,null,null,&quot;created:&quot;);
		for(var t=0; t&lt;createds.length; t++) {
			var link=createTiddlyLink(popup,createds[t],false);
			link.appendChild(document.createTextNode(indent+createds[t]));
			createTiddlyElement(popup,&quot;br&quot;,null,null,null);
		}
	}
}
//}}}

//{{{
function indexModifieds() // build list of tiddlers, hash indexed by modification date
{
	var modifieds= { };
	var tiddlers = store.getTiddlers(&quot;title&quot;,&quot;excludeLists&quot;);
	for (var t = 0; t &lt; tiddlers.length; t++) {
		var date = tiddlers[t].modified.formatString(&quot;YYYY0MM0DD&quot;)
		if (!modifieds[date])
			modifieds[date]=new Array();
		modifieds[date].push(tiddlers[t].title);
	}
	return modifieds;
}
function hasModifieds(date) // returns true if date has modified tiddlers
{
	if (!config.macros.date.modifieds) config.macros.date.modifieds = indexModifieds();
	return (config.macros.date.modifieds[date.formatString(&quot;YYYY0MM0DD&quot;)]!=undefined);
}

function addModifiedsToPopup(popup,when,format)
{
	var force=(store.isDirty() &amp;&amp; when.formatString(&quot;YYYY0MM0DD&quot;)==new Date().formatString(&quot;YYYY0MM0DD&quot;));
	if (force || !config.macros.date.modifieds) config.macros.date.modifieds=indexModifieds();
	var indent=String.fromCharCode(160)+String.fromCharCode(160);
	var mods = config.macros.date.modifieds[when.formatString(&quot;YYYY0MM0DD&quot;)];
	if (mods) {
		mods.sort();
		var e=createTiddlyElement(popup,&quot;div&quot;,null,null,&quot;changed:&quot;);
		for(var t=0; t&lt;mods.length; t++) {
			var link=createTiddlyLink(popup,mods[t],false);
			link.appendChild(document.createTextNode(indent+mods[t]));
			createTiddlyElement(popup,&quot;br&quot;,null,null,null);
		}
	}
}
//}}}

//{{{
function indexReminders(date,leadtime) // build list of tiddlers with reminders, hash indexed by reminder date
{
	var reminders = { };
	if(window.findTiddlersWithReminders!=undefined) { // reminder plugin is installed
		// DEBUG var starttime=new Date();
		var t = findTiddlersWithReminders(date, [0,leadtime], null, null, 1);
		for(var i=0; i&lt;t.length; i++) reminders[t[i].matchedDate]=true;
		// DEBUG var out=&quot;Found &quot;+t.length+&quot; reminders in &quot;+((new Date())-starttime+1)+&quot;ms\n&quot;;
		// DEBUG out+=&quot;startdate: &quot;+date.toLocaleDateString()+&quot;\n&quot;+&quot;leadtime: &quot;+leadtime+&quot; days\n\n&quot;;
		// DEBUG for(var i=0; i&lt;t.length; i++) { out+=t[i].matchedDate.toLocaleDateString()+&quot; &quot;+t[i].params.title+&quot;\n&quot;; }
		// DEBUG alert(out);
	}
	return reminders;
}

function hasReminders(date) // returns true if date has reminders
{
	if (window.reminderCacheForCalendar)
		return window.reminderCacheForCalendar[date]; // use calendar cache
	if (!config.macros.date.reminders)
		config.macros.date.reminders = indexReminders(date,90); // create a 90-day leadtime reminder cache
	return (config.macros.date.reminders[date]);
}

function addRemindersToPopup(popup,when,format)
{
	if(window.findTiddlersWithReminders==undefined) return; // reminder plugin not installed

	var indent = String.fromCharCode(160)+String.fromCharCode(160);
	var reminders=findTiddlersWithReminders(when, [0,31],null,null,1);
	var e=createTiddlyElement(popup,&quot;div&quot;,null,null,&quot;reminders:&quot;+(!reminders.length?&quot; none&quot;:&quot;&quot;));
	for(var t=0; t&lt;reminders.length; t++) {
		link = createTiddlyLink(popup,reminders[t].tiddler,false);
		var diff=reminders[t].diff;
		diff=(diff&lt;1)?&quot;Today&quot;:((diff==1)?&quot;Tomorrow&quot;:diff+&quot; days&quot;);
		var txt=(reminders[t].params[&quot;title&quot;])?reminders[t].params[&quot;title&quot;]:reminders[t].tiddler;
		link.appendChild(document.createTextNode(indent+diff+&quot; - &quot;+txt));
		createTiddlyElement(popup,&quot;br&quot;,null,null,null);
	}
	if (readOnly) return;	// omit &quot;new reminder...&quot; link
	var link = createTiddlyLink(popup,indent+&quot;new reminder...&quot;,true); createTiddlyElement(popup,&quot;br&quot;);
	var title = when.formatString(format);
	link.title=&quot;add a reminder to '&quot;+title+&quot;'&quot;;
	link.onclick = function() {
		// show tiddler editor
		story.displayTiddler(null, title, 2, null, null, false, false);
		// find body 'textarea'
		var c =document.getElementById(&quot;tiddler&quot; + title).getElementsByTagName(&quot;*&quot;);
		for (var i=0; i&lt;c.length; i++) if ((c[i].tagName.toLowerCase()==&quot;textarea&quot;) &amp;&amp; (c[i].getAttribute(&quot;edit&quot;)==&quot;text&quot;)) break;
		// append reminder macro to tiddler content
		if (i&lt;c.length) {
			if (store.tiddlerExists(title)) c[i].value+=&quot;\n&quot;; else c[i].value=&quot;&quot;;
			c[i].value += &quot;&lt;&lt;reminder&quot;;
			c[i].value += &quot; day:&quot;+when.getDate();
			c[i].value += &quot; month:&quot;+(when.getMonth()+1);
			c[i].value += &quot; year:&quot;+when.getFullYear();
			c[i].value += ' title:&quot;Enter a title&quot; &gt;&gt;';
		}
	};
}
//}}}</pre>
</div>
<div title="DefaultTiddlers" modifier="fhopecc" modified="200806030156" created="200708280142" changecount="6">
<pre>MyTagCloud</pre>
</div>
<div title="Dental Floss" modifier="YourName" modified="200704270541" created="200703011647" tags="chkList chkPacking xAA">
<pre></pre>
</div>
<div title="Digital Camera" modifier="YourName" modified="200704270548" created="200703021046" tags="chkList chkPacking xEE">
<pre></pre>
</div>
<div title="Don't Get Around Much Anymore" modifier="Fhopecc" created="200709220236" tags="歌詞" changecount="2">
<pre>&quot;Don't Get Around Much Anymore&quot;

Missed the Saturday dance
Heard they crowded the floor
Couldn't bear it without you
Don't get around much anymore

Thought I'd visit the club
Got as far as the door
They'd have asked me about you
Don't get around much anymore

Darling, I guess my mind's more at ease
But nevertheless, why stir up old memories

Been invited on dates
I might have gone but what for
It's awfully different without you
Don't get around much anymore

My darling, I guess my mind's more at ease
But nevertheless, why stir up old memories

Been invited on dates
I might have gone but what for
It's awfully different without you
Don't get around much anymore
Awfully different without you
Don't get around much anymore</pre>
</div>
<div title="DownLoad" modifier="oc" modified="200704272256" created="200704140115" tags="chkList">
<pre>&lt;&lt;tiddler SiteTitle&gt;&gt; is a adaptation of TiddlyWiki. You can get this tool by:
#DownLoad: Please right-click [[here|TiddlyPackingList.html]] and select 'save as'.
#Import: If you are using TiddlyWiki, please use v 2.1.3 or higher ImportTiddlers to import all of the tiddlers taged with &lt;&lt;tag chkList&gt;&gt;.
''NOTE'':
*&lt;&lt;tiddler SiteTitle&gt;&gt; should be used in your own PC, you can't save any change on this site.
*If you like this little tool, please give it a nice review in your blog. Thanks.</pre>
</div>
<div title="Dump or Slurp YAML Reference Data (and Fixtures) " modifier="fhopecc" modified="200712100915" created="200712100914" tags="ROR" changecount="2">
<pre>UPDATE Now packaged as a plugin! Makes fixtures also. And, is MySQL friendly! UPDATE

Sometimes you need to save data and use it again when you deploy a server or continue a project on a different machine.

I wrote a plugin for ActiveRecord that lets you do this easily.

It adds two class methods that let you dump_to_file and load_from_file. The contents are written to the ‘db’ directory with the table name as the filename. When you call Model.load_from_file, existing data in that table is deleted and reloaded, but primary key id’s are kept intact.

An additional Model.to_fixture method makes fixtures from existing data. It writes a file to ./test/fixtures/models.yml that can be loaded normally in your unit and functional tests.
Usage

Install with the new plugin script. (Included in Rails 1.0).
{{{
./script/plugin install http://topfunky.net/svn/plugins/ar_fixtures
}}}
Use it in code, or use the built-in ‘runner’ command.
{{{
# Dump user table to db/users.yml
./script/runner &quot;User.dump_to_file&quot; 
# Or
./script/runner &quot;User.to_fixture&quot; 

# Read it back into the database
./script/runner &quot;User.load_from_file&quot; 
}}}</pre>
</div>
<div title="Enumerable" modifier="fhopecc" created="200709260056" tags="Ruby" changecount="1">
<pre>包含許多關於處理集合的方法。包含列舉、排序、過濾、集合函數等幾類功能
!!過濾
!!!select
語法：
{{{enum.find_all{|obj| block} #=&gt; array}}}
{{{enum.select{|obj| block} #=&gt; array}}}
&gt; 列舉所有元素，並傳回作用於區塊內集合不為 false 元素的陣列。
{{{
   (1..10).find_all {|i|  i % 3 == 0 }   #=&gt; [3, 6, 9]
}}}
!!!reject
{{{enum.reject{|obj| block} #=&gt; array}}}
&gt; 列舉所有元素，並傳回作用於區塊內集合為 false 元素的陣列。
{{{
   (1..10).reject {|i|  i % 3 == 0 }   #=&gt; [1, 2, 4, 5, 7, 8, 10]
}}}</pre>
</div>
<div title="FlashbackQuery" modifier="fhopecc" created="200804160802" tags="Oracle" changecount="1">
<pre></pre>
</div>
<div title="FlyWeight模式" modifier="fhopecc" created="200802211219" tags="DesignPattern" changecount="1">
<pre>設計模式之Flyweight(享元) FlyWeight模式

板橋裡人 http://www.jdon.com 2002/05/02

Flyweight模式定義:
避免大量擁有相同內容的小類的開銷(如耗費內存),使大家共享一個類(元類).

為什麼使用?
面向對象語言的原則就是一切都是對象,但是如果真正使用起來,有時對象數可能顯得很龐大,比如,字處理軟件,如果以每個文字都作為一個對象,幾千個字,對象數就是幾千,無疑耗費內存,那麼我們還是要&quot;求同存異&quot;,找出這些對象群的共同點,設計一個元類,封裝可以被共享的類,另外,還有一些特性是取決於應用 (context),是不可共享的,這也Flyweight中兩個重要概念內部狀態intrinsic和外部狀態extrinsic之分.

說白點,就是先捏一個的原始模型,然後隨著不同場合和環境,再產生各具特徵的具體模型,很顯然,在這裡需要產生不同的新對象,所以Flyweight模式中常出現Factory模式.Flyweight的內部狀態是用來共享的,Flyweight factory負責維護一個Flyweight pool(模式池)來存放內部狀態的對象.

Flyweight模式是一個提高程序效率和性能的模式,會大大加快程序的運行速度.應用場合很多:比如你要從一個數據庫中讀取一系列字符串,這些字符串中有許多是重複的,那麼我們可以將這些字符串儲存在Flyweight池(pool)中.

如何使用?

我們先從Flyweight抽象接口開始:

public interface Flyweight
{
　　public void operation( ExtrinsicState state );
}

//用於本模式的抽象數據類型(自行設計)
public interface ExtrinsicState { }

下面是接口的具體實現(ConcreteFlyweight) ,並為內部狀態增加內存空間, ConcreteFlyweight必須是可共享的,它保存的任何狀態都必須是內部(intrinsic),也就是說, ConcreteFlyweight必須和它的應用環境場合無關.
public class ConcreteFlyweight implements Flyweight {
　　private IntrinsicState state;
　　
　　public void operation( ExtrinsicState state )
　　{
　　　　　　//具體操作
　　}

}

當然,並不是所有的Flyweight具體實現子類都需要被共享的,所以還有另外一種不共享的ConcreteFlyweight:

public class UnsharedConcreteFlyweight implements Flyweight {

　　public void operation( ExtrinsicState state ) { }

}

Flyweight factory負責維護一個Flyweight池(存放內部狀態),當客戶端請求一個共享Flyweight時,這個factory首先搜索池中是否已經有可適用的,如果有,factory只是簡單返回送出這個對象,否則,創建一個新的對象,加入到池中,再返回送出這個對象.池

public class FlyweightFactory {
　　//Flyweight pool
　　private Hashtable flyweights = new Hashtable();

　　public Flyweight getFlyweight( Object key ) {

　　　　Flyweight flyweight = (Flyweight) flyweights.get(key);

　　　　if( flyweight == null ) {
　　　　　　//產生新的ConcreteFlyweight
　　　　　　flyweight = new ConcreteFlyweight();
　　　　　　flyweights.put( key, flyweight );
　　　　}

　　　　return flyweight;
　　}
}

至此,Flyweight模式的基本框架已經就緒,我們看看如何調用:

FlyweightFactory factory = new FlyweightFactory();
Flyweight fly1 = factory.getFlyweight( &quot;Fred&quot; );
Flyweight fly2 = factory.getFlyweight( &quot;Wilma&quot; );
......

從調用上看,好像是個純粹的Factory使用,但奧妙就在於Factory的內部設計上.

Flyweight模式在XML等數據源中應用
我們上面已經提到,當大量從數據源中讀取字符串,其中肯定有重複的,那麼我們使用Flyweight模式可以提高效率,以唱片CD為例,在一個XML文件中,存放了多個CD的資料.

每個CD有三個字段:
1.出片日期(year)
2.歌唱者姓名等信息(artist)
3.唱片曲目 (title)

其中,歌唱者姓名有可能重複,也就是說,可能有同一個演唱者的多個不同時期 不同曲目的CD.我們將&quot;歌唱者姓名&quot;作為可共享的ConcreteFlyweight.其他兩個字段作為UnsharedConcreteFlyweight.

首先看看數據源XML文件的內容:


&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;collection&gt;

&lt;cd&gt;
&lt;title&gt;Another Green World&lt;/title&gt;
&lt;year&gt;1978&lt;/year&gt;
&lt;artist&gt;Eno, Brian&lt;/artist&gt;
&lt;/cd&gt;

&lt;cd&gt;
&lt;title&gt;Greatest Hits&lt;/title&gt;
&lt;year&gt;1950&lt;/year&gt;
&lt;artist&gt;Holiday, Billie&lt;/artist&gt;
&lt;/cd&gt;

&lt;cd&gt;
&lt;title&gt;Taking Tiger Mountain (by strategy)&lt;/title&gt;
&lt;year&gt;1977&lt;/year&gt;
&lt;artist&gt;Eno, Brian&lt;/artist&gt;
&lt;/cd&gt;

.......

&lt;/collection&gt;


雖然上面舉例CD只有3張,CD可看成是大量重複的小類,因為其中成分只有三個字段,而且有重複的(歌唱者姓名).

CD就是類似上面接口 Flyweight:


public class CD {

　　private String title;
　　private int year;
　　private Artist artist;

　　public String getTitle() {　　return title;　}
　　public int getYear() {　　　　return year;　　}
　　public Artist getArtist() {　　　　return artist;　　}

　　public void setTitle(String t){　　　　title = t;}
　　public void setYear(int y){year = y;}
　　public void setArtist(Artist a){artist = a;}

}

將&quot;歌唱者姓名&quot;作為可共享的ConcreteFlyweight:

public class Artist {

　　//內部狀態
　　private String name;

　　// note that Artist is immutable.
　　String getName(){return name;}

　　Artist(String n){
　　　　name = n;
　　}

}

再看看Flyweight factory,專門用來製造上面的可共享的ConcreteFlyweight:Artist

public class ArtistFactory {

　　Hashtable pool = new Hashtable();

　　Artist getArtist(String key){

　　　　Artist result;
　　　　result = (Artist)pool.get(key);
　　　　////產生新的Artist
　　　　if(result == null) {
　　　　　　result = new Artist(key);
　　　　　　pool.put(key,result);
　　　　　　
　　　　}
　　　 return result;
　 }

}

當你有幾千張甚至更多CD時,Flyweight模式將節省更多空間,共享的flyweight越多,空間節省也就越大.</pre>
</div>
<div title="ForEachTiddlerPlugin" modifier="YourName" created="200702141524" tags="chkList systemConfig">
<pre>/***
|''Name:''|ForEachTiddlerPlugin|
|''Version:''|1.0.6 (2006-09-16)|
|''Source:''|http://tiddlywiki.abego-software.de/#ForEachTiddlerPlugin|
|''Author:''|UdoBorkowski (ub [at] abego-software [dot] de)|
|''Licence:''|[[BSD open source license (abego Software)|http://www.abego-software.de/legal/apl-v10.html]]|
|''Copyright:''|&amp;copy; 2005-2006 [[abego Software|http://www.abego-software.de]]|
|''TiddlyWiki:''|1.2.38+, 2.0|
|''Browser:''|Firefox 1.0.4+; Firefox 1.5; InternetExplorer 6.0|
!Description

Create customizable lists, tables etc. for your selections of tiddlers. Specify the tiddlers to include and their order through a powerful language.

''Syntax:'' 
|&gt;|{{{&lt;&lt;}}}''forEachTiddler'' [''in'' //tiddlyWikiPath//] [''where'' //whereCondition//] [''sortBy'' //sortExpression// [''ascending'' //or// ''descending'']] [''script'' //scriptText//] [//action// [//actionParameters//]]{{{&gt;&gt;}}}|
|//tiddlyWikiPath//|The filepath to the TiddlyWiki the macro should work on. When missing the current TiddlyWiki is used.|
|//whereCondition//|(quoted) JavaScript boolean expression. May refer to the build-in variables {{{tiddler}}} and  {{{context}}}.|
|//sortExpression//|(quoted) JavaScript expression returning &quot;comparable&quot; objects (using '{{{&lt;}}}','{{{&gt;}}}','{{{==}}}'. May refer to the build-in variables {{{tiddler}}} and  {{{context}}}.|
|//scriptText//|(quoted) JavaScript text. Typically defines JavaScript functions that are called by the various JavaScript expressions (whereClause, sortClause, action arguments,...)|
|//action//|The action that should be performed on every selected tiddler, in the given order. By default the actions [[addToList|AddToListAction]] and [[write|WriteAction]] are supported. When no action is specified [[addToList|AddToListAction]]  is used.|
|//actionParameters//|(action specific) parameters the action may refer while processing the tiddlers (see action descriptions for details). &lt;&lt;tiddler [[JavaScript in actionParameters]]&gt;&gt;|
|&gt;|~~Syntax formatting: Keywords in ''bold'', optional parts in [...]. 'or' means that exactly one of the two alternatives must exist.~~|

See details see [[ForEachTiddlerMacro]] and [[ForEachTiddlerExamples]].

!Revision history
* v1.0.6 (2006-09-16)
** Context provides &quot;viewerTiddler&quot;, i.e. the tiddler used to view the macro. Most times this is equal to the &quot;inTiddler&quot;, but when using the &quot;tiddler&quot; macro both may be different.
** Support &quot;begin&quot;, &quot;end&quot; and &quot;none&quot; expressions in &quot;write&quot; action
* v1.0.5 (2006-02-05)
** Pass tiddler containing the macro with wikify, context object also holds reference to tiddler containing the macro (&quot;inTiddler&quot;). Thanks to SimonBaird.
** Support Firefox 1.5.0.1
** Internal
*** Make &quot;JSLint&quot; conform
*** &quot;Only install once&quot;
* v1.0.4 (2006-01-06)
** Support TiddlyWiki 2.0
* v1.0.3 (2005-12-22)
** Features: 
*** Write output to a file supports multi-byte environments (Thanks to Bram Chen) 
*** Provide API to access the forEachTiddler functionality directly through JavaScript (see getTiddlers and performMacro)
** Enhancements:
*** Improved error messages on InternetExplorer.
* v1.0.2 (2005-12-10)
** Features: 
*** context object also holds reference to store (TiddlyWiki)
** Fixed Bugs: 
*** ForEachTiddler 1.0.1 has broken support on win32 Opera 8.51 (Thanks to BrunoSabin for reporting)
* v1.0.1 (2005-12-08)
** Features: 
*** Access tiddlers stored in separated TiddlyWikis through the &quot;in&quot; option. I.e. you are no longer limited to only work on the &quot;current TiddlyWiki&quot;.
*** Write output to an external file using the &quot;toFile&quot; option of the &quot;write&quot; action. With this option you may write your customized tiddler exports.
*** Use the &quot;script&quot; section to define &quot;helper&quot; JavaScript functions etc. to be used in the various JavaScript expressions (whereClause, sortClause, action arguments,...).
*** Access and store context information for the current forEachTiddler invocation (through the build-in &quot;context&quot; object) .
*** Improved script evaluation (for where/sort clause and write scripts).
* v1.0.0 (2005-11-20)
** initial version

!Code
***/
//{{{

	
//============================================================================
//============================================================================
//		   ForEachTiddlerPlugin
//============================================================================
//============================================================================

// Only install once
if (!version.extensions.ForEachTiddlerPlugin) {

if (!window.abego) window.abego = {};

version.extensions.ForEachTiddlerPlugin = {
	major: 1, minor: 0, revision: 6, 
	date: new Date(2006,8,16), 
	source: &quot;http://tiddlywiki.abego-software.de/#ForEachTiddlerPlugin&quot;,
	licence: &quot;[[BSD open source license (abego Software)|http://www.abego-software.de/legal/apl-v10.html]]&quot;,
	copyright: &quot;Copyright (c) abego Software GmbH, 2005-2006 (www.abego-software.de)&quot;
};

// For backward compatibility with TW 1.2.x
//
if (!TiddlyWiki.prototype.forEachTiddler) {
	TiddlyWiki.prototype.forEachTiddler = function(callback) {
		for(var t in this.tiddlers) {
			callback.call(this,t,this.tiddlers[t]);
		}
	};
}

//============================================================================
// forEachTiddler Macro
//============================================================================

version.extensions.forEachTiddler = {
	major: 1, minor: 0, revision: 5, date: new Date(2006,2,5), provider: &quot;http://tiddlywiki.abego-software.de&quot;};

// ---------------------------------------------------------------------------
// Configurations and constants 
// ---------------------------------------------------------------------------

config.macros.forEachTiddler = {
	 // Standard Properties
	 label: &quot;forEachTiddler&quot;,
	 prompt: &quot;Perform actions on a (sorted) selection of tiddlers&quot;,

	 // actions
	 actions: {
		 addToList: {},
		 write: {}
	 }
};

// ---------------------------------------------------------------------------
//  The forEachTiddler Macro Handler 
// ---------------------------------------------------------------------------

config.macros.forEachTiddler.getContainingTiddler = function(e) {
	while(e &amp;&amp; !hasClass(e,&quot;tiddler&quot;))
		e = e.parentNode;
	var title = e ? e.getAttribute(&quot;tiddler&quot;) : null; 
	return title ? store.getTiddler(title) : null;
};

config.macros.forEachTiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler) {
	// config.macros.forEachTiddler.traceMacroCall(place,macroName,params,wikifier,paramString,tiddler);

	if (!tiddler) tiddler = config.macros.forEachTiddler.getContainingTiddler(place);
	// --- Parsing ------------------------------------------

	var i = 0; // index running over the params
	// Parse the &quot;in&quot; clause
	var tiddlyWikiPath = undefined;
	if ((i &lt; params.length) &amp;&amp; params[i] == &quot;in&quot;) {
		i++;
		if (i &gt;= params.length) {
			this.handleError(place, &quot;TiddlyWiki path expected behind 'in'.&quot;);
			return;
		}
		tiddlyWikiPath = this.paramEncode((i &lt; params.length) ? params[i] : &quot;&quot;);
		i++;
	}

	// Parse the where clause
	var whereClause =&quot;true&quot;;
	if ((i &lt; params.length) &amp;&amp; params[i] == &quot;where&quot;) {
		i++;
		whereClause = this.paramEncode((i &lt; params.length) ? params[i] : &quot;&quot;);
		i++;
	}

	// Parse the sort stuff
	var sortClause = null;
	var sortAscending = true; 
	if ((i &lt; params.length) &amp;&amp; params[i] == &quot;sortBy&quot;) {
		i++;
		if (i &gt;= params.length) {
			this.handleError(place, &quot;sortClause missing behind 'sortBy'.&quot;);
			return;
		}
		sortClause = this.paramEncode(params[i]);
		i++;

		if ((i &lt; params.length) &amp;&amp; (params[i] == &quot;ascending&quot; || params[i] == &quot;descending&quot;)) {
			 sortAscending = params[i] == &quot;ascending&quot;;
			 i++;
		}
	}

	// Parse the script
	var scriptText = null;
	if ((i &lt; params.length) &amp;&amp; params[i] == &quot;script&quot;) {
		i++;
		scriptText = this.paramEncode((i &lt; params.length) ? params[i] : &quot;&quot;);
		i++;
	}

	// Parse the action. 
	// When we are already at the end use the default action
	var actionName = &quot;addToList&quot;;
	if (i &lt; params.length) {
	   if (!config.macros.forEachTiddler.actions[params[i]]) {
			this.handleError(place, &quot;Unknown action '&quot;+params[i]+&quot;'.&quot;);
			return;
		} else {
			actionName = params[i]; 
			i++;
		}
	} 
	
	// Get the action parameter
	// (the parsing is done inside the individual action implementation.)
	var actionParameter = params.slice(i);


	// --- Processing ------------------------------------------
	try {
		this.performMacro({
				place: place, 
				inTiddler: tiddler,
				whereClause: whereClause, 
				sortClause: sortClause, 
				sortAscending: sortAscending, 
				actionName: actionName, 
				actionParameter: actionParameter, 
				scriptText: scriptText, 
				tiddlyWikiPath: tiddlyWikiPath});

	} catch (e) {
		this.handleError(place, e);
	}
};

// Returns an object with properties &quot;tiddlers&quot; and &quot;context&quot;.
// tiddlers holds the (sorted) tiddlers selected by the parameter,
// context the context of the execution of the macro.
//
// The action is not yet performed.
//
// @parameter see performMacro
//
config.macros.forEachTiddler.getTiddlersAndContext = function(parameter) {

	var context = config.macros.forEachTiddler.createContext(parameter.place, parameter.whereClause, parameter.sortClause, parameter.sortAscending, parameter.actionName, parameter.actionParameter, parameter.scriptText, parameter.tiddlyWikiPath, parameter.inTiddler);

	var tiddlyWiki = parameter.tiddlyWikiPath ? this.loadTiddlyWiki(parameter.tiddlyWikiPath) : store;
	context[&quot;tiddlyWiki&quot;] = tiddlyWiki;
	
	// Get the tiddlers, as defined by the whereClause
	var tiddlers = this.findTiddlers(parameter.whereClause, context, tiddlyWiki);
	context[&quot;tiddlers&quot;] = tiddlers;

	// Sort the tiddlers, when sorting is required.
	if (parameter.sortClause) {
		this.sortTiddlers(tiddlers, parameter.sortClause, parameter.sortAscending, context);
	}

	return {tiddlers: tiddlers, context: context};
};

// Returns the (sorted) tiddlers selected by the parameter.
//
// The action is not yet performed.
//
// @parameter see performMacro
//
config.macros.forEachTiddler.getTiddlers = function(parameter) {
	return this.getTiddlersAndContext(parameter).tiddlers;
};

// Performs the macros with the given parameter.
//
// @param parameter holds the parameter of the macro as separate properties.
//				  The following properties are supported:
//
//						place
//						whereClause
//						sortClause
//						sortAscending
//						actionName
//						actionParameter
//						scriptText
//						tiddlyWikiPath
//
//					All properties are optional. 
//					For most actions the place property must be defined.
//
config.macros.forEachTiddler.performMacro = function(parameter) {
	var tiddlersAndContext = this.getTiddlersAndContext(parameter);

	// Perform the action
	var actionName = parameter.actionName ? parameter.actionName : &quot;addToList&quot;;
	var action = config.macros.forEachTiddler.actions[actionName];
	if (!action) {
		this.handleError(parameter.place, &quot;Unknown action '&quot;+actionName+&quot;'.&quot;);
		return;
	}

	var actionHandler = action.handler;
	actionHandler(parameter.place, tiddlersAndContext.tiddlers, parameter.actionParameter, tiddlersAndContext.context);
};

// ---------------------------------------------------------------------------
//  The actions 
// ---------------------------------------------------------------------------

// Internal.
//
// --- The addToList Action -----------------------------------------------
//
config.macros.forEachTiddler.actions.addToList.handler = function(place, tiddlers, parameter, context) {
	// Parse the parameter
	var p = 0;

	// Check for extra parameters
	if (parameter.length &gt; p) {
		config.macros.forEachTiddler.createExtraParameterErrorElement(place, &quot;addToList&quot;, parameter, p);
		return;
	}

	// Perform the action.
	var list = document.createElement(&quot;ul&quot;);
	place.appendChild(list);
	for (var i = 0; i &lt; tiddlers.length; i++) {
		var tiddler = tiddlers[i];
		var listItem = document.createElement(&quot;li&quot;);
		list.appendChild(listItem);
		createTiddlyLink(listItem, tiddler.title, true);
	}
};

abego.parseNamedParameter = function(name, parameter, i) {
	var beginExpression = null;
	if ((i &lt; parameter.length) &amp;&amp; parameter[i] == name) {
		i++;
		if (i &gt;= parameter.length) {
			throw &quot;Missing text behind '%0'&quot;.format([name]);
		}
		
		return config.macros.forEachTiddler.paramEncode(parameter[i]);
	}
	return null;
}

// Internal.
//
// --- The write Action ---------------------------------------------------
//
config.macros.forEachTiddler.actions.write.handler = function(place, tiddlers, parameter, context) {
	// Parse the parameter
	var p = 0;
	if (p &gt;= parameter.length) {
		this.handleError(place, &quot;Missing expression behind 'write'.&quot;);
		return;
	}

	var textExpression = config.macros.forEachTiddler.paramEncode(parameter[p]);
	p++;

	// Parse the &quot;begin&quot; option
	var beginExpression = abego.parseNamedParameter(&quot;begin&quot;, parameter, p);
	if (beginExpression !== null) 
		p += 2;
	var endExpression = abego.parseNamedParameter(&quot;end&quot;, parameter, p);
	if (endExpression !== null) 
		p += 2;
	var noneExpression = abego.parseNamedParameter(&quot;none&quot;, parameter, p);
	if (noneExpression !== null) 
		p += 2;

	// Parse the &quot;toFile&quot; option
	var filename = null;
	var lineSeparator = undefined;
	if ((p &lt; parameter.length) &amp;&amp; parameter[p] == &quot;toFile&quot;) {
		p++;
		if (p &gt;= parameter.length) {
			this.handleError(place, &quot;Filename expected behind 'toFile' of 'write' action.&quot;);
			return;
		}
		
		filename = config.macros.forEachTiddler.getLocalPath(config.macros.forEachTiddler.paramEncode(parameter[p]));
		p++;
		if ((p &lt; parameter.length) &amp;&amp; parameter[p] == &quot;withLineSeparator&quot;) {
			p++;
			if (p &gt;= parameter.length) {
				this.handleError(place, &quot;Line separator text expected behind 'withLineSeparator' of 'write' action.&quot;);
				return;
			}
			lineSeparator = config.macros.forEachTiddler.paramEncode(parameter[p]);
			p++;
		}
	}
	
	// Check for extra parameters
	if (parameter.length &gt; p) {
		config.macros.forEachTiddler.createExtraParameterErrorElement(place, &quot;write&quot;, parameter, p);
		return;
	}

	// Perform the action.
	var func = config.macros.forEachTiddler.getEvalTiddlerFunction(textExpression, context);
	var count = tiddlers.length;
	var text = &quot;&quot;;
	if (count &gt; 0 &amp;&amp; beginExpression)
		text += config.macros.forEachTiddler.getEvalTiddlerFunction(beginExpression, context)(undefined, context, count, undefined);
	
	for (var i = 0; i &lt; count; i++) {
		var tiddler = tiddlers[i];
		text += func(tiddler, context, count, i);
	}
	
	if (count &gt; 0 &amp;&amp; endExpression)
		text += config.macros.forEachTiddler.getEvalTiddlerFunction(endExpression, context)(undefined, context, count, undefined);

	if (count == 0 &amp;&amp; noneExpression) 
		text += config.macros.forEachTiddler.getEvalTiddlerFunction(noneExpression, context)(undefined, context, count, undefined);
		

	if (filename) {
		if (lineSeparator !== undefined) {
			lineSeparator = lineSeparator.replace(/\\n/mg, &quot;\n&quot;).replace(/\\r/mg, &quot;\r&quot;);
			text = text.replace(/\n/mg,lineSeparator);
		}
		saveFile(filename, convertUnicodeToUTF8(text));
	} else {
		var wrapper = createTiddlyElement(place, &quot;span&quot;);
		wikify(text, wrapper, null/* highlightRegExp */, context.inTiddler);
	}
};


// ---------------------------------------------------------------------------
//  Helpers
// ---------------------------------------------------------------------------

// Internal.
//
config.macros.forEachTiddler.createContext = function(placeParam, whereClauseParam, sortClauseParam, sortAscendingParam, actionNameParam, actionParameterParam, scriptText, tiddlyWikiPathParam, inTiddlerParam) {
	return {
		place : placeParam, 
		whereClause : whereClauseParam, 
		sortClause : sortClauseParam, 
		sortAscending : sortAscendingParam, 
		script : scriptText,
		actionName : actionNameParam, 
		actionParameter : actionParameterParam,
		tiddlyWikiPath : tiddlyWikiPathParam,
		inTiddler : inTiddlerParam, // the tiddler containing the &lt;&lt;forEachTiddler ...&gt;&gt; macro call.
		viewerTiddler : config.macros.forEachTiddler.getContainingTiddler(placeParam) // the tiddler showing the forEachTiddler result
	};
};

// Internal.
//
// Returns a TiddlyWiki with the tiddlers loaded from the TiddlyWiki of 
// the given path.
//
config.macros.forEachTiddler.loadTiddlyWiki = function(path, idPrefix) {
	if (!idPrefix) {
		idPrefix = &quot;store&quot;;
	}
	var lenPrefix = idPrefix.length;
	
	// Read the content of the given file
	var content = loadFile(this.getLocalPath(path));
	if(content === null) {
		throw &quot;TiddlyWiki '&quot;+path+&quot;' not found.&quot;;
	}
	
	// Locate the storeArea div's
	var posOpeningDiv = content.indexOf(startSaveArea);
	var posClosingDiv = content.lastIndexOf(endSaveArea);
	if((posOpeningDiv == -1) || (posClosingDiv == -1)) {
		throw &quot;File '&quot;+path+&quot;' is not a TiddlyWiki.&quot;;
	}
	var storageText = content.substr(posOpeningDiv + startSaveArea.length, posClosingDiv);
	
	// Create a &quot;div&quot; element that contains the storage text
	var myStorageDiv = document.createElement(&quot;div&quot;);
	myStorageDiv.innerHTML = storageText;
	myStorageDiv.normalize();
	
	// Create all tiddlers in a new TiddlyWiki
	// (following code is modified copy of TiddlyWiki.prototype.loadFromDiv)
	var tiddlyWiki = new TiddlyWiki();
	var store = myStorageDiv.childNodes;
	for(var t = 0; t &lt; store.length; t++) {
		var e = store[t];
		var title = null;
		if(e.getAttribute)
			title = e.getAttribute(&quot;tiddler&quot;);
		if(!title &amp;&amp; e.id &amp;&amp; e.id.substr(0,lenPrefix) == idPrefix)
			title = e.id.substr(lenPrefix);
		if(title &amp;&amp; title !== &quot;&quot;) {
			var tiddler = tiddlyWiki.createTiddler(title);
			tiddler.loadFromDiv(e,title);
		}
	}
	tiddlyWiki.dirty = false;

	return tiddlyWiki;
};


	
// Internal.
//
// Returns a function that has a function body returning the given javaScriptExpression.
// The function has the parameters:
// 
//	 (tiddler, context, count, index)
//
config.macros.forEachTiddler.getEvalTiddlerFunction = function (javaScriptExpression, context) {
	var script = context[&quot;script&quot;];
	var functionText = &quot;var theFunction = function(tiddler, context, count, index) { return &quot;+javaScriptExpression+&quot;}&quot;;
	var fullText = (script ? script+&quot;;&quot; : &quot;&quot;)+functionText+&quot;;theFunction;&quot;;
	return eval(fullText);
};

// Internal.
//
config.macros.forEachTiddler.findTiddlers = function(whereClause, context, tiddlyWiki) {
	var result = [];
	var func = config.macros.forEachTiddler.getEvalTiddlerFunction(whereClause, context);
	tiddlyWiki.forEachTiddler(function(title,tiddler) {
		if (func(tiddler, context, undefined, undefined)) {
			result.push(tiddler);
		}
	});
	return result;
};

// Internal.
//
config.macros.forEachTiddler.createExtraParameterErrorElement = function(place, actionName, parameter, firstUnusedIndex) {
	var message = &quot;Extra parameter behind '&quot;+actionName+&quot;':&quot;;
	for (var i = firstUnusedIndex; i &lt; parameter.length; i++) {
		message += &quot; &quot;+parameter[i];
	}
	this.handleError(place, message);
};

// Internal.
//
config.macros.forEachTiddler.sortAscending = function(tiddlerA, tiddlerB) {
	var result = 
		(tiddlerA.forEachTiddlerSortValue == tiddlerB.forEachTiddlerSortValue) 
			? 0
			: (tiddlerA.forEachTiddlerSortValue &lt; tiddlerB.forEachTiddlerSortValue)
			   ? -1 
			   : +1; 
	return result;
};

// Internal.
//
config.macros.forEachTiddler.sortDescending = function(tiddlerA, tiddlerB) {
	var result = 
		(tiddlerA.forEachTiddlerSortValue == tiddlerB.forEachTiddlerSortValue) 
			? 0
			: (tiddlerA.forEachTiddlerSortValue &lt; tiddlerB.forEachTiddlerSortValue)
			   ? +1 
			   : -1; 
	return result;
};

// Internal.
//
config.macros.forEachTiddler.sortTiddlers = function(tiddlers, sortClause, ascending, context) {
	// To avoid evaluating the sortClause whenever two items are compared 
	// we pre-calculate the sortValue for every item in the array and store it in a 
	// temporary property (&quot;forEachTiddlerSortValue&quot;) of the tiddlers.
	var func = config.macros.forEachTiddler.getEvalTiddlerFunction(sortClause, context);
	var count = tiddlers.length;
	var i;
	for (i = 0; i &lt; count; i++) {
		var tiddler = tiddlers[i];
		tiddler.forEachTiddlerSortValue = func(tiddler,context, undefined, undefined);
	}

	// Do the sorting
	tiddlers.sort(ascending ? this.sortAscending : this.sortDescending);

	// Delete the temporary property that holds the sortValue.	
	for (i = 0; i &lt; tiddlers.length; i++) {
		delete tiddlers[i].forEachTiddlerSortValue;
	}
};


// Internal.
//
config.macros.forEachTiddler.trace = function(message) {
	displayMessage(message);
};

// Internal.
//
config.macros.forEachTiddler.traceMacroCall = function(place,macroName,params) {
	var message =&quot;&lt;&lt;&quot;+macroName;
	for (var i = 0; i &lt; params.length; i++) {
		message += &quot; &quot;+params[i];
	}
	message += &quot;&gt;&gt;&quot;;
	displayMessage(message);
};


// Internal.
//
// Creates an element that holds an error message
// 
config.macros.forEachTiddler.createErrorElement = function(place, exception) {
	var message = (exception.description) ? exception.description : exception.toString();
	return createTiddlyElement(place,&quot;span&quot;,null,&quot;forEachTiddlerError&quot;,&quot;&lt;&lt;forEachTiddler ...&gt;&gt;: &quot;+message);
};

// Internal.
//
// @param place [may be null]
//
config.macros.forEachTiddler.handleError = function(place, exception) {
	if (place) {
		this.createErrorElement(place, exception);
	} else {
		throw exception;
	}
};

// Internal.
//
// Encodes the given string.
//
// Replaces 
//	 &quot;$))&quot; to &quot;&gt;&gt;&quot;
//	 &quot;$)&quot; to &quot;&gt;&quot;
//
config.macros.forEachTiddler.paramEncode = function(s) {
	var reGTGT = new RegExp(&quot;\\$\\)\\)&quot;,&quot;mg&quot;);
	var reGT = new RegExp(&quot;\\$\\)&quot;,&quot;mg&quot;);
	return s.replace(reGTGT, &quot;&gt;&gt;&quot;).replace(reGT, &quot;&gt;&quot;);
};

// Internal.
//
// Returns the given original path (that is a file path, starting with &quot;file:&quot;)
// as a path to a local file, in the systems native file format.
//
// Location information in the originalPath (i.e. the &quot;#&quot; and stuff following)
// is stripped.
// 
config.macros.forEachTiddler.getLocalPath = function(originalPath) {
	// Remove any location part of the URL
	var hashPos = originalPath.indexOf(&quot;#&quot;);
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert to a native file format assuming
	// &quot;file:///x:/path/path/path...&quot; - pc local file --&gt; &quot;x:\path\path\path...&quot;
	// &quot;file://///server/share/path/path/path...&quot; - FireFox pc network file --&gt; &quot;\\server\share\path\path\path...&quot;
	// &quot;file:///path/path/path...&quot; - mac/unix local file --&gt; &quot;/path/path/path...&quot;
	// &quot;file://server/share/path/path/path...&quot; - pc network file --&gt; &quot;\\server\share\path\path\path...&quot;
	var localPath;
	if(originalPath.charAt(9) == &quot;:&quot;) // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\\&quot;);
	else if(originalPath.indexOf(&quot;file://///&quot;) === 0) // FireFox pc network file
		localPath = &quot;\\\\&quot; + unescape(originalPath.substr(10)).replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\\&quot;);
	else if(originalPath.indexOf(&quot;file:///&quot;) === 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf(&quot;file:/&quot;) === 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = &quot;\\\\&quot; + unescape(originalPath.substr(7)).replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\\&quot;);	
	return localPath;
};

// ---------------------------------------------------------------------------
// Stylesheet Extensions (may be overridden by local StyleSheet)
// ---------------------------------------------------------------------------
//
setStylesheet(
	&quot;.forEachTiddlerError{color: #ffffff;background-color: #880000;}&quot;,
	&quot;forEachTiddler&quot;);

//============================================================================
// End of forEachTiddler Macro
//============================================================================


//============================================================================
// String.startsWith Function
//============================================================================
//
// Returns true if the string starts with the given prefix, false otherwise.
//
version.extensions[&quot;String.startsWith&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};
//
String.prototype.startsWith = function(prefix) {
	var n =  prefix.length;
	return (this.length &gt;= n) &amp;&amp; (this.slice(0, n) == prefix);
};



//============================================================================
// String.endsWith Function
//============================================================================
//
// Returns true if the string ends with the given suffix, false otherwise.
//
version.extensions[&quot;String.endsWith&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};
//
String.prototype.endsWith = function(suffix) {
	var n = suffix.length;
	return (this.length &gt;= n) &amp;&amp; (this.right(n) == suffix);
};


//============================================================================
// String.contains Function
//============================================================================
//
// Returns true when the string contains the given substring, false otherwise.
//
version.extensions[&quot;String.contains&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};
//
String.prototype.contains = function(substring) {
	return this.indexOf(substring) &gt;= 0;
};

//============================================================================
// Array.indexOf Function
//============================================================================
//
// Returns the index of the first occurance of the given item in the array or 
// -1 when no such item exists.
//
// @param item [may be null]
//
version.extensions[&quot;Array.indexOf&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};
//
Array.prototype.indexOf = function(item) {
	for (var i = 0; i &lt; this.length; i++) {
		if (this[i] == item) {
			return i;
		}
	}
	return -1;
};

//============================================================================
// Array.contains Function
//============================================================================
//
// Returns true when the array contains the given item, otherwise false. 
//
// @param item [may be null]
//
version.extensions[&quot;Array.contains&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};
//
Array.prototype.contains = function(item) {
	return (this.indexOf(item) &gt;= 0);
};

//============================================================================
// Array.containsAny Function
//============================================================================
//
// Returns true when the array contains at least one of the elements 
// of the item. Otherwise (or when items contains no elements) false is returned.
//
version.extensions[&quot;Array.containsAny&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};
//
Array.prototype.containsAny = function(items) {
	for(var i = 0; i &lt; items.length; i++) {
		if (this.contains(items[i])) {
			return true;
		}
	}
	return false;
};


//============================================================================
// Array.containsAll Function
//============================================================================
//
// Returns true when the array contains all the items, otherwise false.
// 
// When items is null false is returned (even if the array contains a null).
//
// @param items [may be null] 
//
version.extensions[&quot;Array.containsAll&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};
//
Array.prototype.containsAll = function(items) {
	for(var i = 0; i &lt; items.length; i++) {
		if (!this.contains(items[i])) {
			return false;
		}
	}
	return true;
};


} // of &quot;install only once&quot;

// Used Globals (for JSLint) ==============
// ... DOM
/*global 	document */
// ... TiddlyWiki Core
/*global 	convertUnicodeToUTF8, createTiddlyElement, createTiddlyLink, 
			displayMessage, endSaveArea, hasClass, loadFile, saveFile, 
			startSaveArea, store, wikify */
//}}}


/***
!Licence and Copyright
Copyright (c) abego Software ~GmbH, 2005 ([[www.abego-software.de|http://www.abego-software.de]])

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of abego Software nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
***/</pre>
</div>
<div title="GRANT_ROLE" modifier="fhopecc" modified="200805270553" created="200802120622" tags="SQL Oracle" changecount="2">
<pre> GRANT ELTWEB_WXX_MODIFY_ROLE TO YSJ06660;</pre>
</div>
<div title="Glasses" modifier="YourName" modified="200704270553" created="200703011647" tags="chkList chkPacking xAA">
<pre>For Backup</pre>
</div>
<div title="HIS功能" modifier="YourName" modified="200711081243" created="200708271321" tags="HIS專案" changecount="35">
<pre>&lt;&lt;tiddler 系統功能&gt;&gt;
&lt;&lt;tiddler 報表格式&gt;&gt;
&lt;&lt;tiddler 異常值之顯示&gt;&gt;</pre>
</div>
<div title="HIS專案" modifier="fhopecc" modified="200809250038" created="200708210226" tags="專案 待辦事項" changecount="28">
<pre>暫停中，6萬餘款未收


上述是 bugs ，我會儘快處理，
希望下週就能給您。
!已處理
1.總結的表格是死的無法活用,因為有些檢查沒做,我們會將沒做檢查的項目刪除,是否可像防癌篩檢的項目一樣沒輸入文字就不會顯示.
11.總結=&gt;Framing字為細明體,應為標楷體
12.每個插圖無法使用.
3.臨床理學=&gt;網頁出現:TEMPLATE IS MISSING
2.醫療史=&gt;日常活動量屬於:輕度活動量,(輕度)無法顯示,活動量應為標楷體.
                醫囑用藥的標題重覆,第1行應改為服用藥物
4.B型肝炎=&gt;目前只測B肝表面抗原及B肝表面抗體,B肝核心抗體目前較少使用到,可做修改像,篩檢一樣嗎?
5.24小時心電圖=&gt;受檢者紀錄及總結應為標楷體,目前出現細明體,最慢及最快心跳少Bpm單位,列印時附註的文字沒看到.
6.運動心電圖=&gt;在最大心跳指數,多1個At.
10.建議頁面空白
7.心臟超音波=&gt;E/A ratio:參考值為&gt;1.0,杜卜勒血流未看到S/D表格.
13.腹部超音波=&gt;少了&quot;其他&quot;欄位.
!異常值功能
待完成功能：
#修正某些欄位的資料型態改為字串，以方便片語輸入
#片語輸入，option 中的文字的片語的摘要，而提示視窗顯示全文
#整體的 CSS 格式
#CSSSelector 補充 lang 及 attr selector
已完成功能：
#清空 Form 裡文字方格的 script。
#~HTMLInputElement 具有 form 屬性，指出元件所屬的 ~HTMLFormElement，由此屬性即可找到 input 所屬的 form
#為了可以選取所有 form 中的 text 及 ~TextArea 元件，使用 prototype frame work 中，Element.getElementBySelector 的方法。參閱[[選取 DOM 的元素]]
#列印報表時，中文自動套用標楷體，英文自動套用Times New Roman
#將{{{''content''}}} 轉換成 {{{&lt;em&gt;content&lt;/em&gt;}}}，[[剖析標籤語言]]
#用藥的表格有更改(如附件)</pre>
</div>
<div title="HIS專案問題" modifier="fhopecc" modified="200808040204" created="200808040202" tags="緊急事項 完成事項" changecount="3">
<pre>圖片</pre>
</div>
<div title="HIS的邏輯架構" modifier="fhopecc" modified="200711271455" created="200711271452" tags="HIS專案" changecount="3">
<pre>report &gt; section &gt; items

|!model|report|section|items|
|!view|report.rhtml|partial|helper|</pre>
</div>
<div title="HIS第二期新增項目" modifier="fhopecc" modified="200711250720" created="200711230057" tags="HIS專案" server.type="file" server.host="file://D:\sfhopecc\stwFhopecc\sfhopetw.htm.mine" server.page.revision="200711250720">
<pre>#防癌篩檢(Cancer screening tests)
#B、C肝炎(HBV, HCV screnning test
#梅毒愛滋Syphilis,AIDS test
#尿液urinalysis
#糞便檢查 stool_test
#核子醫學檢查Nuclear medicine tests
#腸胃鏡檢查Endoscopy
!第二期程式更正
#</pre>
</div>
<div title="HIS系統功能" modifier="fhopecc" created="200711050218" tags="HIS專案" changecount="1">
<pre>#支授不同的 browser, 目前只支援 firefox</pre>
</div>
<div title="HIS進度" modifier="fhopecc" modified="200711090813" created="200708200513" tags="HIS專案" changecount="42">
<pre>!問題
#列印除{{{血液檢查}}}都設為1頁內;not completed
#可列印成 PDF 檔;not completed
#blood 中 欄位 moncytes 須正名為 Monocytes
#將源文字 '/n' 取代為{{{&lt;br/&gt;&lt;br/&gt;}}}改為用{{{&lt;p&gt;&lt;/p&gt;}}}包起來
#支授不同的 browser, 目前只支援 firefox
!#列印除{{{血液檢查}}}都設為1頁內;not completed
!!佔兩頁的章節
#目錄 Catalog 頁數 Page, 調整到中間
#ok理學檢查，腫脹，脈搏觸診，勾選處少一格
#ok臨床理學檢查,英文註解調為一行
#運動心電圖,英文註解調為一行
#心臟超音波,英文註解調為一行
#心臟超音波一定要2頁
#腹部血管超音波,英文註解調為一行
#ok周邊血管功能檢查,英文註解調為一行
#總結,英文註解調為一行
#建議,英文註解調為一行
#:conclusions_pages, :integer, :default =&gt; 2
#:exercise_ecg_pages, :integer, :default =&gt; 2
#:ecocardiogram_pages, :integer, :default =&gt; 2
#:carotid_ultrasound_pages, :integer, :default =&gt; 2
#:abdominal_ultrasound_pages, :integer, :default =&gt; 2
#:peripheral_ultrasound_pages, :integer, :default =&gt; 2</pre>
</div>
<div title="Hello world, macro 1" modifier="fhopecc" modified="200710030101" created="200710030029" tags="如何使用wiki" changecount="11">
<pre>!!Hello world, part 1
To create your own custom macro, you are going to need to write a plugin. A plugin in ~TiddlyWiki is a tiddler that contains some ~JavaScript that will be executed when ~TiddlyWiki starts up. First let's create a very basic plugin and make sure it's running.
!!!Creating a plugin
*Create a new tiddler by clicking &quot;new tiddler&quot;
*Give it a title, e.g. &quot;~MyFirstPlugin&quot;
*Give it the tag &quot;systemConfig&quot; (without the quotes). Tags are case sensitive in TiddlyWiki, so you must have the lowercase 's' and upper case C correct.
*In the body of the tiddler, paste in the following:
{{{
 // this will run on startup
 alert(&quot;Hello world&quot;);
}}}
*Click &quot;done&quot; to finish editing the tiddler. Save your TiddlyWiki and reload.
*Hopefully, when you load your TiddlyWiki, an alert should appear with the message &quot;Hello world&quot;. If so, then your plugin is working! If not, check to make sure you tagged it properly.
Your plugin is not very useful so far, but it's a good first step.
!!!Fixing JavaScript errors
If you're using TiddlyWiki 2.1 or later, there is a PluginManager that handles problems with plugins gracefully. You can use it to diagnose problems.
* Edit your MyFirstPlugin tiddler.
* Make a deliberate typo by changing {{{alert}}} to {{{alerrt}}}.
* Click &quot;done&quot;, save your TiddlyWiki and reload.
* The PluginManager should display this message next to your tiddler's name: &quot;Error: ReferenceError: alerrt is not defined&quot;
* Fix your typo, save, and reload your ~TiddlyWiki.
!!!Making your code look better
To make your code more readable, you can use a special version of the preformatted text formatting syntax, {{{ { { { and } } } }}} . It's specifically for use in plugins.
Edit your plugin tiddler so it looks like this:
 //{{{
 
 // this will run on startup
 alert(&quot;Hello world&quot;);
 
 //}}}
The double forward slashes (//) ask JavaScript to interpret the lines as comments. When you finish editing your tiddler, it should look more like code. Also, TiddlyWiki won't try to interpret any of your code as formatting instructions.

</pre>
</div>
<div title="Hello world, macro 2" modifier="fhopecc" modified="200710030203" created="200710030030" tags="如何使用wiki" changecount="4">
<pre>!!Hello world, part 2
So now we know how to call a macro from within a tiddler and how to plug some code into TiddlyWiki itself. Let's put these two concepts together.
!!!Linking a macro to your code
When ~TiddlyWiki encounters a macro in a tiddler, it looks for an identically named 'macro' within the global object {{{config.macros}}} and then calls the {{{handler}}} function of that macro. Edit your plugin tiddler so it looks like this:
{{{
 //{ { {
 config.macros.helloWorld = {
   handler: function (place, macroName, params, wikifier, paramString, tiddler)
   { 
       // this will run when macro is called from a tiddler
       alert(&quot;Hello world&quot;);
   }
 };
 //} } }
}}}
Save your ~TiddlyWiki and reload. This time, you shouldn't get the alert immediately. That's because your macro needs to invoked by a tiddler to act. Do that by following these steps:
*Create a new tiddler by clicking &quot;new tiddler&quot;.
*Give it a title, e.g. &quot;MyFirstPluginTest&quot;.
*In the body of the tiddler, type in the following: &lt;&lt;helloWorld&gt;&gt;
*Click &quot;done&quot; to finish editing the tiddler. As soon as you do this, you should see the alert box again. This is because TiddlyWiki immediately re-displays the tiddler after you edit it.
If you get an error message after reloading your TiddlyWiki, check your punctuation. A stray semicolon can sometimes mess things up.
!Getting parameters
So our macro does something now when called. But we need to make it more flexible by using those parameters we discussed before. The argument {{{params}}} provides the macro with an array of strings that are passed in from the tiddler. 
Let's try it out. Replace:
{{{
 alert(&quot;Hello world&quot;);
}}}
with 
{{{
 var who = params[0] || &quot;world&quot;;
 alert(&quot;Hello &quot; + who);
}}}
Save, reload, and look at MyFirstPluginTest again. So far its the same old popup message... but if we edit it as well:
 &lt;&lt;helloWorld 'all you TiddlyWiki fans'&gt;&gt;
The message will change. In many cases, it's a good idea to have defaults for macro parameters, like we set up here. JavaScript's logical-or operator makes this straightforward. 
!!!The handler function
So what do the rest of those arguments to the handler function do? Here's a quick summary:
|place|the DOM object that provides the document location where the macro is being rendered in the tiddler|
|macroName|the name of the macro being called. It's possible to have several different invocations call the same macro; in that case, you'd use this to determine how your macro is being called.|
| params|An array corresponding to the parameters passed into this macro.|
|wikifier|The Wikifier object displaying the current tiddler. By modifying this, you can alter how the rest of a tiddler is rendered.|
|paramString||
|tiddler|a TiddlyWiki object representing the tiddler from which the macro was called|
Finally, let's combine these parameters with a TiddlyWiki global function named [[wikify]] to finish our macro. Instead of popping open an alert box, it'll display its message right in the tiddler itself.
{{{
 //{{
 config.macros.helloWorld = {
   handler: function (place, macroName, params, wikifier, paramString, tiddler)
   { 
       // this will run when macro is called from a tiddler
       var who = params[0] || 'world';
       wikify('Hello //' + who + '// from the &quot;' + macroName + '&quot; macro in tiddler [[' + tiddler.title + ']].', place);
   } 
 };
 //}}
}}}
==Hello world, part 3==
===Adding plugin documentation=== 
This is under construction

===The complete Hello World plugin===
The complete plugin for the HelloWorld macro is available for inporting or viewing here:
[http://mptw2.tiddlyspot.com/#HelloWorldMacro HelloWorldMacro]</pre>
</div>
<div title="HelloWorld1" modifier="fhopecc" modified="200710030103" created="200710030102" tags="如何使用wiki" changecount="2">
<pre>alert(&quot;hello world!&quot;)</pre>
</div>
<div title="HelloWorld2" modifier="fhopecc" modified="200710030434" created="200710030210" tags="如何使用wiki" changecount="5">
<pre>//{{{
 config.macros.helloWorld = {
   handler: function (place, macroName, params, wikifier, paramString, tiddler)
   { 
       // this will run when macro is called from a tiddler
       alert(&quot;Hello world&quot;);
   }
 };
//}}}</pre>
</div>
<div title="ID Card" modifier="YourName" modified="200704270546" created="200703021041" tags="chkList chkPacking xDD">
<pre></pre>
</div>
<div title="Interface Discovery IN XPCOM" modifier="fhopecc" modified="200801300234" created="200801290226" tags="XPCOM" changecount="4">
<pre>{{{
interface nsISupports
{
    void QueryInterface(in nsIIDRef uuid, out nsQIResult result);
    nsrefcnt AddRef();
    nsrefcnt Release();
};
}}}

{{{
// first, we create an instance of something...
var file = components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance();
// second, we specify which interface we actually want to use.
file = file.QueryInterface(Components.interfaces.nsIFile);
// do something generic with the nsIFile interface here.
file.create(NORMAL_FILE_TYPE, 0377);
var size = file.fileSize;
// later on, we check to see if an extended interface is supported.
var local = file.QueryInterface(Components.interfaces.nsILocalFile);
if (local)
{
   // do something specific to the nsILocalFile interface...
   local.initWithPath('/usr/tmp/scratch.txt');

   // suppose we're now in some scope where the file variable is no longer
   // visible to use but we want to call some function that absolutely
   // insists on only accepting an nsIFile and not an nsILocalFile.
   // no problem, just QI over to the other interface like so ...

   var insists = local.QueryInterface(Components.interfaces.nsIFile);
   if (insists)
   {
      // at this point we can call our hypothetical function
      // to do some generic file processing...
      hypothetical(insists);
   }
}
}}}</pre>
</div>
<div title="ItemHelper" modifier="fhopecc" modified="200806180236" created="200806180205" tags="HIS專案" changecount="10">
<pre>!功能
ItemHelper 依照目前使用者的動作，決定如何顯示傳入的 item。
#若動作屬編輯類，便顯示可編輯傳入項目的欄位。
#若動作屬顯示類，便依類型來顯示項目。
!支授項目顯示
!!item_field item
傳回顯示此項目的html片段。
!支援空值欄位不顯示模組
!!empty_item? item
若傳入的 item 為空值，且動作是顯示則傳回真。
使用者可利用此方法來決定是否要顯示此欄位。
!目前動作類別
!!edit_action? 
傳回是否為編輯類動作。
!!show_action? 
傳回是否為顯示類動作。</pre>
</div>
<div title="JBD" modifier="fhopecc" created="200712100613" tags="地方稅系統" changecount="1">
<pre>|JBD|
|蔡坤達|</pre>
</div>
<div title="Javascript 控制列印視窗" modifier="fhopecc" modified="200802150933" created="200802150932" tags="Javascript" changecount="3">
<pre>{{{
&lt;script language=&quot;javascript&quot;&gt;
// 列印
function fnPrint() {
	try	{
		// 儲存原本頁首頁尾的設定，然後設定空白
		var ret = saveAndClearSetting();
		// 列印
		window.print();
		// 回存原本頁首頁尾的設定
		if ( ret ) restoreSetting();
	} catch (e) { alert(&quot;err=&quot;+e.description); }
}
var hkey_path = &quot;HKEY_CURRENT_USER\\Software\\Microsoft\\Internet Explorer\\PageSetup\\&quot;;
var hkey_key_header = hkey_path+&quot;header&quot;; // 頁首
var hkey_key_footer = hkey_path+&quot;footer&quot;; // 頁尾
var hkey_key_margin_bottom = hkey_path+&quot;margin_bottom&quot;; // 邊界（下）
var hkey_key_margin_left = hkey_path+&quot;margin_left&quot;; // 邊界（左）
var hkey_key_margin_right = hkey_path+&quot;margin_right&quot;; // 邊界（右）
var hkey_key_margin_top = hkey_path+&quot;margin_top&quot;; // 邊界（上）
var old_header = &quot;&amp;w&amp;b第 &amp;p 頁，共 &amp;P 頁&quot;;
var old_footer = &quot;&amp;u&amp;b&amp;d&quot;;
// 儲存原本頁首頁尾的設定，然後設定空白
function saveAndClearSetting() {
  try {
	var RegWsh = new ActiveXObject(&quot;Wscript.Shell&quot;);
	old_header = RegWsh.RegRead(hkey_key_header);
	old_footer = RegWsh.RegRead(hkey_key_footer);
	RegWsh.RegWrite(hkey_key_header,&quot;&quot;);
	RegWsh.RegWrite(hkey_key_footer,&quot;&quot;);
	return true;
  } catch (e) { 
	if ( e.description.indexOf(&quot;伺服程式無法產生物件&quot;) != -1 ) {
		alert(&quot;請調整IE瀏覽器的安全性\n網際網路選項＼安全性＼自訂層級\n「起始不標示為安全的ActiveX控制項」設定為啟用或提示。&quot;); 
	} // if
	else {
		alert(&quot;ERR=&quot;+e.description); 
	} // else
  } // catch
	return false;
}
// 回存原本頁首頁尾的設定
function restoreSetting() {
  try {
	var RegWsh = new ActiveXObject(&quot;WScript.Shell&quot;);
	RegWsh.RegWrite(hkey_key_header,old_header);
	RegWsh.RegWrite(hkey_key_footer,old_footer);
  } catch (e) {
	if ( e.description.indexOf(&quot;伺服程式無法產生物件&quot;) != -1 ) {
		alert(&quot;請調整IE瀏覽器的安全性\n網際網路選項＼安全性＼自訂層級\n「起始不標示為安全的ActiveX控制項」設定為啟用或提示。&quot;); 
	} // if
	else {
		alert(&quot;ERR=&quot;+e.description); 
	} // else
  } // catch
}
&lt;/script&gt;
}}}</pre>
</div>
<div title="Jeans" modifier="YourName" modified="200704270538" created="200703011650" tags="chkList chkPacking xBB">
<pre></pre>
</div>
<div title="LRParser工程" modifier="fhopecc" modified="200805260700" created="200805260659" tags="重要事項 完成事項" changecount="2">
<pre>#LRParser
##Test
#CFG -&gt; LRParser
##CFG -&gt; Action table
##CFG -&gt; Goto table
</pre>
</div>
<div title="Loading data in migrations" modifier="fhopecc" created="200712110826" tags="ROR" changecount="1">
<pre>Posted by Roman Mackovcak 196 days ago

I found migrations to be very useful tool to maintain data structures in a rails project. It is clean, easy to understand and fast when it comes to recreate a database.

During develoment, I faced several times the same problem: “How to import static data into the database?” Of course, one can create fixture and load it. But sometimes one needs more powerful tool.

So, I tried to import the data in the migrations themselves. Since the data to import was huge (tens of MBs), I did try several methods and approaches. Here is the result.
Fixtures in Migrations

This is method that I found on the web in an article of Adam Christensen Loading Fixtures in a Migration. It shows how to load the fixtures file into database.

require 'active_record/fixtures'

class CreateCategories &lt; ActiveRecord::Migration
  def self.up
    create_table :categories do |t|
      t.column :name, :string
    end

    Fixtures.create_fixtures('test/fixtures', File.basename(&quot;categories.yml&quot;, '.*'))
  end

  def self.down
    drop_table :categories
  end
end

Active record way

If your ActiveRecord object already exists, you can use the following code. It is obviously not the way to import thousands of records, but for ten objects it is good enough.

class CreateAuthors &lt; ActiveRecord::Migration
    def self.up
      create_table :authors do |t|
          t.column :name, :string, :length=&gt;20, :null=&gt;false
          t.column :surname, :string, :length=&gt;50, :null=&gt;false
          t.column :blog, :string, :length=&gt;100, :default=&gt;'http://blog.zmok.net' 
      end
      
      Author.create( :name=&gt;'Roman', :surname=&gt;'Mackovcak')
    end

    def self.down
      drop_table :authors
    end
end

External CSV

If the data came in the CSV format then a fastercsv library could be used.

First of all, the library needs to be installed.

sudo gem install fastercsv

then create the migration

require 'fastercsv'

class LoadAuthors &lt; ActiveRecord::Migration

  def self.up
    FasterCSV.foreach('db/data/authors.csv') do |row|
      Author.create(:name=&gt;row[0], :surname=&gt;row[1], :blog=&gt;row[2])
    end
  end
  
  def self.down
    Author.delete_all
  end
end

And place the CSV file (example below) into db/data folder.

&quot;Miro&quot;,&quot;Skultety&quot;,&quot;http://blog.zmok.net&quot;
&quot;Abhishek&quot;,&quot;Balaria&quot;,&quot;http://blog.zmok.net&quot;

Embedded CSV

Sometimes it is useful to bundle the data directly with the migration. In this example, the data are provided to the load_articles method from articles_data.

require 'csv'

class CreateArticles &lt; ActiveRecord::Migration
  def self.up
    create_table :articles do |t|
      t.column :title, :string, :length=&gt;20, :null=&gt;false
      t.column :url, :string, :length=&gt;100, :null=&gt;false
      t.column :author_id, :integer, :null=&gt;false
      t.column :abstract, :string, :length=&gt;255
    end

    load_articles
  end

  def self.down
    drop_table :articles
  end

  def self.load_articles
    cnx = ActiveRecord::Base.connection
    ActiveRecord::Base.silence do
      reader = CSV::Reader.create(articles_data) 
      reader.each do |row|
        values = row.collect {|v| cnx.quote(v).gsub('\\n', &quot;\n&quot;).gsub('\\r', &quot;\r&quot;) }.join(', ')
        sql = &quot;INSERT INTO articles(id, title, url, author_id, abstract) VALUES (#{values})&quot;
        cnx.insert(sql) 
      end
    end
  end

  def self.articles_data
    &lt;&lt;'END_OF_DATA'
1,&quot;Integration is the killer app (even in Web 2.0)&quot;,&quot;http://blog.zmok.net/articles/2006/08/20/integration-is-the-killer-app-even-in-web-2-0&quot;,3,&quot;Integration is the key to success&quot;
2,&quot;Visualize your Rails schema&quot;,&quot;http://blog.zmok.net/articles/2006/11/13/visualize-your-rails-schema&quot;,2,&quot;Exporting rails schema to UML&quot;
END_OF_DATA
  end

end

ActiveRecord - native commands

Last, but not least is the method that uses native functions of MySQL database. This could work only if the rails application sits on the same machine as the MySQL.

require 'tempfile' 

class CreateReaders &lt; ActiveRecord::Migration
    def self.up
      create_table :readers do |t|
          t.column :nickname, :string, :length=&gt;20, :null=&gt;false
          t.column :email, :string, :length=&gt;50, :null=&gt;false
      end
      load_from_file
    end

    def self.down
      drop_table :readers
    end
    
    def self.load_from_file
      file = 'db/data/readers.csv'
      tp = Tempfile.new(File.basename(file)).path
      File.copy(file, tp)
      File.chmod(0666, tp)
      ActiveRecord::Base.connection.execute(&quot;load data infile \'#{tp}\' into table readers fields terminated by \',\' enclosed by \'\&quot;\' lines terminated by \'\\n\'&quot;)
    end

end

and the corresponding CSV file

1,&quot;bob&quot;,&quot;bob@really-cool-office.org&quot;
2,&quot;sergey&quot;,&quot;sergey@hermitage-magazin.ru&quot;

That's it! Enjoy it.

Share the joy: del.icio.us |  Digg |  Yahoo! My Web 2.0 |  Reddit |  Blinklist |  Fark |  Tamtami |  dzone

Posted in Ruby on Rails | Tags csv, fixture, load, migration | no trackbacks
Comments

   1.
      nukeedit
      nick_jcn@yahoo.com said 7 days later:
      I'm looking for a RoR specialist to help us with a project. If you are interested to talk about it, or have any advise, or know somebody who could help us out or join our team - please let me know. Nick Borisenko nick_jcn@yahoo.com
   2.
      nukeedit
      Gustavo said 8 days later:
      Thank you so much for this information. I had to add require 'tempfile' to your &quot;ActiveRecord - native commands&quot; example for it to work. I added it to the end of my config/environment.rb file.
   3.
      nukeedit
      Roman Mackovcak said 8 days later:
      2 Gustavo
      Thanks, fixed.
   4.
      nukeedit
      jan said 9 days later:
      So which one did you choose and why? You don't mention it. But thanks for this overview, I was a bit procrastinating researching this, so now I don't have to;)
   5.
      nukeedit
      Roman Mackovcak said 10 days later:
      2 Jan
      Every method has got its own pros and cons. I had a big CSV file, so External CSV and Native commands were my options.

Trackbacks

Use the following link to trackback from your own site:
http://blog.zmok.net/articles/trackback/631

RSS feed for this post trackback uri

Comments are disabled</pre>
</div>
<div title="MLOG專案" modifier="fhopecc" created="200808110153" tags="重要事項 mlog 完成事項" changecount="1">
<pre>#完成月結帳
#於 blogger 建置功能說明
</pre>
</div>
<div title="MainMenu" modifier="fhopecc" modified="200808020116" created="200702090117" changecount="58">
<pre>&lt;&lt;digiclock&gt;&gt;
[[待辦事項|TodoCheckList]]
[[中期目標]]
&lt;&lt;tag 稅捐處業務&gt;&gt;
&lt;&lt;tag 每月例行工作&gt;&gt;
&lt;&lt;tag 網路連線&gt;&gt;
&lt;&lt;tag 資通安全&gt;&gt;
[[Ruby投稿]]
&lt;&lt;tag 財務&gt;&gt;
----
&lt;&lt;calendar thismonth&gt;&gt;
[[編輯主選單|MainMenu]]
----
&lt;&lt;tiddler 常用通訊錄&gt;&gt;</pre>
</div>
<div title="Migration 的 Integration" modifier="fhopecc" modified="200712100741" created="200709101230" tags="ROR" changecount="8">
<pre>每次作個小改變，就產生一個 migration，
最後會發現怎麼 migration 這麼多版本，
當我專案完成時，先把目前的 dev 資料庫 dump 成 ruby 的 shcema 檔，
再作一個 migration 再把此 schema 包進去，
就能整合很多 migration 了。
!從目前的資料庫匯出至 ruby 的 schema檔
{{{
rake db_schema_dump
}}}
!從ruby的schema檔匯入 目前的資料庫
{{{
rake db_schema_import
}}}
ps.會把舊資料庫的檔案全部清空，只能用在新資料庫
!砍掉重練
砍掉重練，把全部 table drop掉，重新跑一遍 rake db:migrate。
讓我印象深刻的是這招最後一節又提到一次。問題是說隨著 migrations 的累進，每個 schema 定義可能會散佈在各個 migration 檔案中，我們要如何一眼看懂每張 table 最後到底有哪些欄位?
!!方法一
看 db/schema.rb 檔，有全部的定義(Ruby form)
!!方法二
保持每張 table 只有唯一的 migration 檔案，有任何修改不要新增再 migration檔案了，而是用編輯的方式，每次有修改就砍掉重練即可。話說此招雖然跟 Migrations 版本累進的概念不同，但也是可以work。
!!方法三
裝 annotate_models plugin，每次有變動你只要跑 rake annotate_models，他就會在你的 model 自動加上 table column 註解，一目瞭然。用法跟結果可以參考這篇。</pre>
</div>
<div title="MyTagCloud" modifier="fhopecc" modified="200902230858" created="200709280123" changecount="69">
<pre>吾生也有涯，而知也無涯。以有涯隨無涯，殆已！已而為知者，殆而已矣！為善無近名，為惡無近刑，緣督以為經，可以保身，可以全生，可以養親，可以盡年。
感恩的心使生活常感喜樂
不患人之不已知，患已不知人也。
色難。有事，弟子服其勞；有酒食，先生饌，曾是以為孝乎？
道可道，非常道。
&lt;&lt;tiddler TodoCheckList&gt;&gt;
&lt;&lt;tagCloud&gt;&gt;</pre>
</div>
<div title="NTPDATE" modifier="fhopecc" modified="200805270554" created="200803200635" tags="unix AIX Network NTP" changecount="5">
<pre>!syntax:
ntpdate ip
ip 指的是要向那台主機對時。
!example:
向 10.66.251.1 對時，
只要下 
{{{ntpdate 10.66.251.1}}}
</pre>
</div>
<div title="NVLInRuby" modifier="fhopecc" created="200802171133" tags="Ruby" changecount="1">
<pre>word = nvl word, default

word ||= default</pre>
</div>
<div title="Never know" modifier="Fhopecc" created="200709080254" tags="歌詞" changecount="2">
<pre> lyrics by Jack Johnson.
I heard this old story before
Where the people keep on killing for their metaphors
But don't leave much up to the imagination
So I want to give this imagery back
But I know it just ain't so easy like that
So I turn the page and read the story again and again and again
It sure seems the same with a different name

We're breaking and rebuilding and we're growing, always guessing

Never knowing
We're shocking but we're nothing
We're just moments, we're clever but we're clueless
We're just human, amusing but confusing
We're trying, but where is this all leading?
We'll never know

It all happened so much faster than you can say disaster
Want to take a time-lapse and look at it backwards
Find the last word and maybe that's just the answer that we're after
But after all we're just a bubble in a boiling pot
Just one breath in a chain of thought
We're moments just combusting
We feel certain but we'll never, never know
It sure seems the same, give it a different name

We're begging and we're needing, and we're trying, and we're breathing

Never knowing
We're shocking but we're nothing
We're just moments, we're clever but we're clueless
We're just human, amusing but confusing
We're helping, rebuilding and we're growing
Never know

Knock, knock, coming door to door
To tell you that their metaphor is better than yours
And you can either sink or swim and things are looking pretty grim
If you don't believe in what they're spoon-feeding
It's got no feeling so I read it again and again and again

It sure seems the same, so many different names

Our hearts are strong, our heads are weak, we'll always be competing

Never knowing
We're shocking but we're nothing
We're just moments, we're clever but we're clueless
We're just human, amusing, confusing
But the truth is all we got are questions
We'll never know</pre>
</div>
<div title="NoteBook Computer" modifier="YourName" modified="200704270549" created="200703020155" tags="chkList chkPacking xEE">
<pre></pre>
</div>
<div title="NoteBook Power" modifier="YourName" modified="200704270552" created="200703021044" tags="chkList chkPacking xEE">
<pre></pre>
</div>
<div title="OA系統" modifier="fhopecc" created="200808040631" changecount="1">
<pre>黃懷民</pre>
</div>
<div title="Passport" modifier="YourName" modified="200704270545" created="200703020154" tags="chkList chkPacking xDD">
<pre></pre>
</div>
<div title="ROR on oracle" modifier="fhopecc" modified="200709170727" created="200709140824" tags="ROR" changecount="5">
<pre>!必要的函式庫
Now that you have Ruby, RubyGems, and Rails installed you can install a specialized code library that will allow your Rails applications to talk to your Oracle database server. To download and install Oracle Rails library, go to http://rubyforge.org/projects/ruby-oci8, download ruby-oci8-0.1.13-mswin.r to your C drive, and then using your command window, execute the following command.
{{{
C:\&gt;ruby ruby-oci8-0.1.16-mswin32.rb
Copy OCI8.rb to c:/ruby/lib/ruby/site_ruby/1.8/DBD/OCI8
Copy oci8.rb to c:/ruby/lib/ruby/site_ruby/1.8
Copy oci8lib.so to c:/ruby/lib/ruby/site_ruby/1.8/i386-msvcrt
OK?
Enter Yes/No: yes                                                   # 記得輸入 yes
Copying OCI8.rb to c:/ruby/lib/ruby/site_ruby/1.8/DBD/OCI8 ... done
Copying oci8.rb to c:/ruby/lib/ruby/site_ruby/1.8 ... done
Copying oci8lib.so to c:/ruby/lib/ruby/site_ruby/1.8/i386-msvcrt ... done
OK
}}}
!範例
{{{
development:
  adapter: oci
  username: ruby
  password: ruby
  host: RAILS 
}}}</pre>
</div>
<div title="Rails2.0新書" modifier="fhopecc" modified="200808120125" created="200808110149" tags="重要事項" changecount="8">
<pre>#告訴妹妹要寫2.0
#安裝、Hello World(妹妹)
#HTTP協定(稜剛)
#MVC架構(稜剛)
#連接資料庫的範例(妹妹)
#ActiveController
#ActiveRecord
#ActivePack
#上傳檔案
#Migration介紹</pre>
</div>
<div title="RailsLogger" modifier="fhopecc" modified="200806272347" created="200806210136" tags="RoR" changecount="4">
<pre>!預設的logger物件變數
|-|Model|View|Controller|Console|
|@logger|-|X|-|-|
|logger|X|-|X|-|
|RAILS_DEFAULT_LOGGER|X|X|X|X|
</pre>
</div>
<div title="Range" modifier="fhopecc" modified="200709040928" created="200709040920" tags="Ruby" changecount="5">
<pre>Range 物件用來表示一個有限區間內的值，
它包含一個起始值及終點值，其成員為大於起始值，但小於終點值的所有值。
!Range#include?(val)
此運算是計算值是否在 Range 定義的區間裡面。
{{{
(1..10).include?(5) =&gt; true
(1..10).include?(11) =&gt; false
}}}
</pre>
</div>
<div title="Razors" modifier="YourName" modified="200704270544" created="200703011646" tags="chkList chkPacking xAA">
<pre></pre>
</div>
<div title="Regular" modifier="fhopecc" modified="200806130649" created="200806130648" changecount="2">
<pre>![[例行事項|Regular]]
&lt;&lt;listTags 例行事項&gt;&gt;</pre>
</div>
<div title="ReminderPlugin" modifier="fhopecc" created="200709280105" tags="systemConfig" changecount="1">
<pre>/***
|''Name:''|ReminderPlugin|
|''Version:''|2.3.10 (Jun 28, 2007)|
|''Source:''|http://remindermacros.tiddlyspot.com|
|''Author:''|Jeremy Sheeley(pop1280 [at] excite [dot] com)&lt;&lt;br&gt;&gt;Maintainer: simon.baird@gmail.com|
|''Licence:''|[[BSD open source license]]|
|''Macros:''|reminder, showreminders, displayTiddlersWithReminders, newReminder|
|''TiddlyWiki:''|2.0+|
|''Browser:''|Firefox 1.0.4+; InternetExplorer 6.0|

!Description
This plugin provides macros for tagging a date with a reminder.  Use the {{{reminder}}} macro to do this.  The {{{showReminders}}} and {{{displayTiddlersWithReminder}}} macros automatically search through all available tiddlers looking for upcoming reminders.

!Installation
* Create a new tiddler in your tiddlywiki titled ReminderPlugin and give it the {{{systemConfig}}} tag.  The tag is important because it tells TW that this is executable code.
* Double click this tiddler, and copy all the text from the tiddler's body.
* Paste the text into the body of the new tiddler in your TW.
* Save and reload your TW.
* You can copy some examples into your TW as well.  See [[Simple examples]], [[Holidays]], [[showReminders]] and [[Personal Reminders]]

!Syntax:
|&gt;|See [[ReminderSyntax]] and [[showRemindersSyntax]]|

!Revision history
* v2.3.10 (Jun 28, 2007)
** Removed window.story = window backwards compatibility hacks since they were breaking TW 2.2
* v2.3.9 (Apr 26, 2007)
** allow bracketed list format in tags param lets you use tags with spaces
* v2.3.8 (Mar 9, 2006)
**Bug fix: A global variable had snuck in, which was killing FF 1.5.0.1
**Feature: You can now use TIDDLER and TIDDLERNAME in a regular reminder format
* v2.3.6 (Mar 1, 2006)
**Bug fix: Reminders for today weren't being matched sometimes.
**Feature:  Solidified integration with DatePlugin and CalendarPlugin
**Feature:  Recurring reminders will now return multiple hits in showReminders and the calendar.
**Feature:  Added TIDDLERNAME to the replacements for showReminders format, for plugins that need the title without brackets.
* v2.3.5 (Feb 8, 2006)
**Bug fix: Sped up reminders lots.  Added a caching mechanism for reminders that have already been matched.
* v2.3.4 (Feb 7, 2006)
**Bug fix: Cleaned up code to hopefully prevent the Firefox 1.5.0.1 crash that was causing lots of plugins 
to crash Firefox.  Thanks to http://www.jslint.com
* v2.3.3 (Feb 2, 2006)
**Feature: newReminder now has drop down lists instead of text boxes.
**Bug fix:  A trailing space in a title would trigger an infinite loop.
**Bug fix:  using tag:&quot;birthday !reminder&quot; would filter differently than tag:&quot;!reminder birthday&quot;
* v2.3.2 (Jan 21, 2006)
**Feature: newReminder macro, which will let you easily add a reminder to a tiddler. Thanks to Eric Shulman (http://www.elsdesign.com) for the code to do this.
** Bug fix: offsetday was not working sometimes
** Bug fix: when upgrading to 2.0, I included a bit to exclude tiddlers tagged with excludeSearch.  I've reverted back to searching through all tiddlers
* v2.3.1 (Jan 7, 2006)
**Feature: 2.0 compatibility
**Feature AlanH sent some code to make sure that showReminders prints a message if no reminders are found.
* v2.3.0 (Jan 3, 2006)
** Bug Fix:  Using &quot;Last Sunday (-0)&quot; as a offsetdayofweek wasn't working.
** Bug Fix:  Daylight Savings time broke offset based reminders (for example year:2005 month:8 day:23 recurdays:7 would match Monday instead of Tuesday during DST.

!Code
***/
//{{{

//============================================================================
//============================================================================
//           ReminderPlugin
//============================================================================
//============================================================================

version.extensions.ReminderPlugin = {major: 2, minor: 3, revision: 8, date: new Date(2006,3,9), source: &quot;http://remindermacros.tiddlyspot.com/&quot;};

//============================================================================
// Configuration
// Modify this section to change the defaults for 
// leadtime and display strings
//============================================================================

config.macros.reminders = {};
config.macros[&quot;reminder&quot;] = {};
config.macros[&quot;newReminder&quot;] = {};
config.macros[&quot;showReminders&quot;] = {};
config.macros[&quot;displayTiddlersWithReminders&quot;] = {};

config.macros.reminders[&quot;defaultLeadTime&quot;] = [0,6000];
config.macros.reminders[&quot;defaultReminderMessage&quot;] = &quot;DIFF: TITLE on DATE ANNIVERSARY&quot;;
config.macros.reminders[&quot;defaultShowReminderMessage&quot;] = &quot;DIFF: TITLE on DATE ANNIVERSARY -- TIDDLER&quot;;
config.macros.reminders[&quot;defaultAnniversaryMessage&quot;] = &quot;(DIFF)&quot;;
config.macros.reminders[&quot;untitledReminder&quot;] = &quot;Untitled Reminder&quot;;
config.macros.reminders[&quot;noReminderFound&quot;] = &quot;Couldn't find a match for TITLE in the next LEADTIMEUPPER days.&quot;
config.macros.reminders[&quot;todayString&quot;] = &quot;Today&quot;;
config.macros.reminders[&quot;tomorrowString&quot;] = &quot;Tomorrow&quot;;
config.macros.reminders[&quot;ndaysString&quot;] = &quot;DIFF days&quot;;
config.macros.reminders[&quot;emtpyShowRemindersString&quot;] = &quot;There are no upcoming events&quot;;


//============================================================================
//  Code
// You should not need to edit anything 
// below this.  Make sure to edit this tiddler and copy 
// the code from the text box, to make sure that 
// tiddler rendering doesn't interfere with the copy 
// and paste.
//============================================================================

//this object will hold the cache of reminders, so that we don't
//recompute the same reminder over again.
var reminderCache = {};

config.macros.showReminders.handler = function showReminders(place,macroName,params)
{
   var now = new Date().getMidnight();
   var paramHash = {};
   var leadtime = [0,14];
   paramHash = getParamsForReminder(params);
   var bProvidedDate = (paramHash[&quot;year&quot;] != null) || 
			(paramHash[&quot;month&quot;] != null) || 
			(paramHash[&quot;day&quot;] != null) || 
			(paramHash[&quot;dayofweek&quot;] != null);
   if (paramHash[&quot;leadtime&quot;] != null)
   {
      leadtime = paramHash[&quot;leadtime&quot;];
      if (bProvidedDate)
      {
         //If they've entered a day, we need to make 
         //sure to find it.  We'll reset the 
         //leadtime a few lines down.
         paramHash[&quot;leadtime&quot;] = [-10000, 10000];
      }
   }
   var matchedDate = now;
   if (bProvidedDate)
   {
      var leadTimeLowerBound = new Date().getMidnight().addDays(paramHash[&quot;leadtime&quot;][0]);
      var leadTimeUpperBound = new Date().getMidnight().addDays(paramHash[&quot;leadtime&quot;][1]);
      matchedDate = findDateForReminder(paramHash, new Date().getMidnight(), leadTimeLowerBound, leadTimeUpperBound); 
   }

   var arr = findTiddlersWithReminders(matchedDate, leadtime, paramHash[&quot;tag&quot;], paramHash[&quot;limit&quot;]);
   var elem = createTiddlyElement(place,&quot;span&quot;,null,null, null);
   var mess = &quot;&quot;;
   if (arr.length == 0)
   {
      mess += config.macros.reminders.emtpyShowRemindersString; 
   }
   for (var j = 0; j &lt; arr.length; j++)
   {
      if (paramHash[&quot;format&quot;] != null)
      {
         arr[j][&quot;params&quot;][&quot;format&quot;] = paramHash[&quot;format&quot;];
      }
      else
      {
         arr[j][&quot;params&quot;][&quot;format&quot;] = config.macros.reminders[&quot;defaultShowReminderMessage&quot;];
      }
      mess += getReminderMessageForDisplay(arr[j][&quot;diff&quot;], arr[j][&quot;params&quot;], arr[j][&quot;matchedDate&quot;], arr[j][&quot;tiddler&quot;]);
      mess += &quot;\n&quot;;
   }
   wikify(mess, elem, null, null);
};


config.macros.displayTiddlersWithReminders.handler = function displayTiddlersWithReminders(place,macroName,params)
{
   var now = new Date().getMidnight();
   var paramHash = {};
   var leadtime = [0,14];
   paramHash = getParamsForReminder(params);
   var bProvidedDate = (paramHash[&quot;year&quot;] != null) || 
			(paramHash[&quot;month&quot;] != null) || 
			(paramHash[&quot;day&quot;] != null) || 
			(paramHash[&quot;dayofweek&quot;] != null);
   if (paramHash[&quot;leadtime&quot;] != null)
   {
      leadtime = paramHash[&quot;leadtime&quot;];
      if (bProvidedDate)
      {
         //If they've entered a day, we need to make 
         //sure to find it.  We'll reset the leadtime 
         //a few lines down.
         paramHash[&quot;leadtime&quot;] = [-10000,10000];
      }
   }
   var matchedDate = now;
   if (bProvidedDate)
   {
      var leadTimeLowerBound = new Date().getMidnight().addDays(paramHash[&quot;leadtime&quot;][0]);
      var leadTimeUpperBound = new Date().getMidnight().addDays(paramHash[&quot;leadtime&quot;][1]);
      matchedDate = findDateForReminder(paramHash, new Date().getMidnight(), leadTimeLowerBound, leadTimeUpperBound); 
   }
   var arr = findTiddlersWithReminders(matchedDate, leadtime, paramHash[&quot;tag&quot;], paramHash[&quot;limit&quot;]);
   for (var j = 0; j &lt; arr.length; j++)
   {
      displayTiddler(null, arr[j][&quot;tiddler&quot;], 0, null, false, false, false);
   }
};

config.macros.reminder.handler = function reminder(place,macroName,params)
{
   var dateHash = getParamsForReminder(params);
   if (dateHash[&quot;hidden&quot;] != null)
   {
      return;
   }
   var leadTime = dateHash[&quot;leadtime&quot;];
   if (leadTime == null)
   {
      leadTime = config.macros.reminders[&quot;defaultLeadTime&quot;]; 
   }
   var leadTimeLowerBound = new Date().getMidnight().addDays(leadTime[0]);
   var leadTimeUpperBound = new Date().getMidnight().addDays(leadTime[1]);
   var matchedDate = findDateForReminder(dateHash, new Date().getMidnight(), leadTimeLowerBound, leadTimeUpperBound);
   if (!store.getTiddler) 
   {
      store.getTiddler=function(title) {return this.tiddlers[title];};
   }
   var title = window.story.findContainingTiddler(place).id.substr(7);
   if (matchedDate != null)
   {
      var diff = matchedDate.getDifferenceInDays(new Date().getMidnight());
      var elem = createTiddlyElement(place,&quot;span&quot;,null,null, null);
      var mess = getReminderMessageForDisplay(diff, dateHash, matchedDate, title);
      wikify(mess, elem, null, null);
   }
   else
   {
      createTiddlyElement(place,&quot;span&quot;,null,null, config.macros.reminders[&quot;noReminderFound&quot;].replace(&quot;TITLE&quot;, dateHash[&quot;title&quot;]).replace(&quot;LEADTIMEUPPER&quot;, leadTime[1]).replace(&quot;LEADTIMELOWER&quot;, leadTime[0]).replace(&quot;TIDDLERNAME&quot;, title).replace(&quot;TIDDLER&quot;, &quot;[[&quot; + title + &quot;]]&quot;) );
   }
};

config.macros.newReminder.handler = function newReminder(place,macroName,params)
{
  var today=new Date().getMidnight();
  var formstring = '&lt;html&gt;&lt;form&gt;Year: &lt;select name=&quot;year&quot;&gt;&lt;option value=&quot;&quot;&gt;Every year&lt;/option&gt;';
  for (var i = 0; i &lt; 5; i++)
  {
    formstring += '&lt;option' + ((i == 0) ? ' selected' : '') + ' value=&quot;' + (today.getFullYear() +i) + '&quot;&gt;' + (today.getFullYear() + i) + '&lt;/option&gt;';
  }
  formstring += '&lt;/select&gt;&amp;nbsp;&amp;nbsp;Month:&lt;select name=&quot;month&quot;&gt;&lt;option value=&quot;&quot;&gt;Every month&lt;/option&gt;';
  for (i = 0; i &lt; 12; i++)
  {
    formstring += '&lt;option' + ((i == today.getMonth()) ? ' selected' : '') + ' value=&quot;' + (i+1) + '&quot;&gt;' + config.messages.dates.months[i] + '&lt;/option&gt;';
  }
  formstring += '&lt;/select&gt;&amp;nbsp;&amp;nbsp;Day:&lt;select name=&quot;day&quot;&gt;&lt;option value=&quot;&quot;&gt;Every day&lt;/option&gt;';
  for (i = 1; i &lt; 32; i++)
  {
    formstring += '&lt;option' + ((i == (today.getDate() )) ? ' selected' : '') + ' value=&quot;' + i + '&quot;&gt;' + i + '&lt;/option&gt;';
  }

formstring += '&lt;/select&gt;&amp;nbsp;&amp;nbsp;Reminder Title:&lt;input type=&quot;text&quot; size=&quot;40&quot; name=&quot;title&quot; value=&quot;please enter a title&quot; onfocus=&quot;this.select();&quot;&gt;&lt;input type=&quot;button&quot; value=&quot;ok&quot; onclick=&quot;addReminderToTiddler(this.form)&quot;&gt;&lt;/form&gt;&lt;/html&gt;';

  var panel = config.macros.slider.createSlider(place,null,&quot;New Reminder&quot;,&quot;Open a form to add a new reminder to this tiddler&quot;);
  wikify(formstring ,panel,null,store.getTiddler(params[1]));
};

// onclick: process input and insert reminder at 'marker'
window.addReminderToTiddler = function(form) {
   if (!store.getTiddler) 
   {
      store.getTiddler=function(title) {return this.tiddlers[title];};
   }
   var title = window.story.findContainingTiddler(form).id.substr(7);
   var tiddler=store.getTiddler(title);
  var txt='\n&lt;&lt;reminder ';
  if (form.year.value != &quot;&quot;)
    txt += 'year:'+form.year.value + ' ';
  if (form.month.value != &quot;&quot;)
    txt += 'month:'+form.month.value + ' ';
  if (form.day.value != &quot;&quot;)
    txt += 'day:'+form.day.value + ' ';
  txt += 'title:&quot;'+form.title.value+'&quot; ';
  txt +='&gt;&gt;';
   tiddler.set(null,tiddler.text + txt);
   window.story.refreshTiddler(title,1,true);
   store.setDirty(true);
};

function hasTag(tiddlerTags, tagFilters)
{
  //Make sure we respond well to empty tiddlerTaglists or tagFilterlists
  if (tagFilters.length==0 || tiddlerTags.length==0)
  {
    return true;
  }

  var bHasTag = false;
  
  /*bNoPos says: &quot;'till now there has been no check using a positive filter&quot;
     Imagine a filterlist consisting of 1 negative filter:
         If the filter isn't matched, we want hasTag to be true.
         Yet bHasTag is still false ('cause only positive filters cause bHasTag to change)
         
     If no positive filters are present bNoPos is true, and no negative filters are matched so we have not returned false
         Thus: hasTag returns true.
      
      If at any time a positive filter is encountered, we want at least one of the tags to match it, so we turn bNoPos to false, which
      means bHasTag must be true for hasTag to return true*/
  var bNoPos=true;
  
for (var t3 = 0; t3 &lt; tagFilters.length; t3++)
  {
      for(var t2=0; t2&lt;tiddlerTags.length; t2++)
      {
           if (tagFilters[t3].length &gt; 1 &amp;&amp; tagFilters[t3].charAt(0) == '!') 
           {
              if (tiddlerTags[t2] == tagFilters[t3].substring(1))
              {
                 //If at any time a negative filter is matched, we return false
                  return false;
              }
           }
           else 
           {
              if (bNoPos)
              {
                 //We encountered the first positive filter
                 bNoPos=false;
              }
              if (tiddlerTags[t2] == tagFilters[t3])
              {
                  //A positive filter is matched. As long as no negative filter is matched, hasTag will return true
                  bHasTag=true;
              }
           }
        }
    }
    return (bNoPos || bHasTag);
};

//This function searches all tiddlers for the reminder  //macro.  It is intended that other plugins (like //calendar) will use this function to query for 
//upcoming reminders.
//The arguments to this function filter out reminders //based on when they will fire.
//
//ARGUMENTS:
//baseDate is the date that is used as &quot;now&quot;.  
//leadtime is a two element int array, with leadtime[0] 
//         as the lower bound and leadtime[1] as the
//         upper bound.  A reasonable default is [0,14]
//tags is a space-separated list of tags to use to filter 
//         tiddlers.  If a tag name begins with an !, then 
//         only tiddlers which do not have that tag will 
//         be considered.  For example &quot;examples holidays&quot;  
//         will search for reminders in any tiddlers that  
//         are tagged with examples or holidays and 
//         &quot;!examples !holidays&quot; will search for reminders 
//         in any tiddlers that are not tagged with 
//         examples or holidays.  Pass in null to search 
//         all tiddlers.
//limit.  If limit is null, individual reminders can 
//        override the leadtime specified earlier.  
//        Pass in 1 in order to override that behavior.

window.findTiddlersWithReminders = function findTiddlersWithReminders(baseDate, leadtime, tags, limit)
{
//function(searchRegExp,sortField,excludeTag)
//   var macroPattern = &quot;&lt;&lt;([^&gt;\\]+)(?:\\*)([^&gt;]*)&gt;&gt;&quot;;
   var macroPattern = &quot;&lt;&lt;(reminder)(.*)&gt;&gt;&quot;;
   var macroRegExp = new RegExp(macroPattern,&quot;mg&quot;);
   var matches = store.search(macroRegExp,&quot;title&quot;,&quot;&quot;);
   var arr = [];
   var tagsArray = null;
   if (tags != null)
   {
      // tagsArray = tags.split(&quot; &quot;);
      tagsArray = tags.readBracketedList(); // allows tags with spaces. thanks Robin Summerhill, 4-Oct-06.
   }
   for(var t=matches.length-1; t&gt;=0; t--)
   {
      if (tagsArray != null)
      {
         //If they specified tags to filter on, and this tiddler doesn't 
	 //match, skip it entirely.
         if ( ! hasTag(matches[t].tags, tagsArray))
         {
            continue;
         }
      }

      var targetText = matches[t].text;
      do {
         // Get the next formatting match
         var formatMatch = macroRegExp.exec(targetText);
         if(formatMatch &amp;&amp; formatMatch[1] != null &amp;&amp; formatMatch[1].toLowerCase() == &quot;reminder&quot;)
         {
            //Find the matching date.
            
            var params = formatMatch[2] != null ? formatMatch[2].readMacroParams() : {};
            var dateHash = getParamsForReminder(params);
            if (limit != null || dateHash[&quot;leadtime&quot;] == null)
            {
               if (leadtime == null)
                   dateHash[&quot;leadtime&quot;] = leadtime;
               else
               {
                  dateHash[&quot;leadtime&quot;] = [];
                  dateHash[&quot;leadtime&quot;][0] = leadtime[0];
                  dateHash[&quot;leadtime&quot;][1] = leadtime[1];
               }
            }
	    if (dateHash[&quot;leadtime&quot;] == null)
               dateHash[&quot;leadtime&quot;] = config.macros.reminders[&quot;defaultLeadTime&quot;]; 
            var leadTimeLowerBound = baseDate.addDays(dateHash[&quot;leadtime&quot;][0]);
            var leadTimeUpperBound = baseDate.addDays(dateHash[&quot;leadtime&quot;][1]);
            var matchedDate = findDateForReminder(dateHash, baseDate, leadTimeLowerBound, leadTimeUpperBound);
            while (matchedDate != null)
            {
               var hash = {};
               hash[&quot;diff&quot;] = matchedDate.getDifferenceInDays(baseDate);
               hash[&quot;matchedDate&quot;] = new Date(matchedDate.getFullYear(), matchedDate.getMonth(), matchedDate.getDate(), 0, 0);
               hash[&quot;params&quot;] = cloneParams(dateHash);
               hash[&quot;tiddler&quot;] = matches[t].title;
               hash[&quot;tags&quot;] = matches[t].tags;
               arr.pushUnique(hash);
	       if (dateHash[&quot;recurdays&quot;] != null || (dateHash[&quot;year&quot;] == null))
	       {
	         leadTimeLowerBound = leadTimeLowerBound.addDays(matchedDate.getDifferenceInDays(leadTimeLowerBound)+ 1);
                 matchedDate = findDateForReminder(dateHash, baseDate, leadTimeLowerBound, leadTimeUpperBound);
	       }
	       else matchedDate = null;
            }
         }
      }while(formatMatch);
   }
   if(arr.length &gt; 1)  //Sort the array by number of days remaining.
   {
      arr.sort(function (a,b) {if(a[&quot;diff&quot;] == b[&quot;diff&quot;]) {return(0);} else {return (a[&quot;diff&quot;] &lt; b[&quot;diff&quot;]) ? -1 : +1; } });
   }
   return arr;
};

//This function takes the reminder macro parameters and
//generates the string that is used for display.
//This function is not intended to be called by 
//other plugins.
 window.getReminderMessageForDisplay= function getReminderMessageForDisplay(diff, params, matchedDate, tiddlerTitle)
{
   var anniversaryString = &quot;&quot;;
   var reminderTitle = params[&quot;title&quot;];
   if (reminderTitle == null)
   {
      reminderTitle = config.macros.reminders[&quot;untitledReminder&quot;];
   }
   if (params[&quot;firstyear&quot;] != null)
   {
      anniversaryString = config.macros.reminders[&quot;defaultAnniversaryMessage&quot;].replace(&quot;DIFF&quot;, (matchedDate.getFullYear() - params[&quot;firstyear&quot;]));
   }
   var mess = &quot;&quot;;
   var diffString = &quot;&quot;;
   if (diff == 0)
   {
      diffString = config.macros.reminders[&quot;todayString&quot;];
   }
   else if (diff == 1)
   {
      diffString = config.macros.reminders[&quot;tomorrowString&quot;];
   }
   else
   {
      diffString = config.macros.reminders[&quot;ndaysString&quot;].replace(&quot;DIFF&quot;, diff);
   }
   var format = config.macros.reminders[&quot;defaultReminderMessage&quot;];
   if (params[&quot;format&quot;] != null)
   {
      format = params[&quot;format&quot;];
   }
   mess = format;
//HACK!  -- Avoid replacing DD in TIDDLER with the date
   mess = mess.replace(/TIDDLER/g, &quot;TIDELER&quot;);
   mess = matchedDate.formatStringDateOnly(mess);
   mess = mess.replace(/TIDELER/g, &quot;TIDDLER&quot;);
   if (tiddlerTitle != null)
   {
      mess = mess.replace(/TIDDLERNAME/g, tiddlerTitle);
      mess = mess.replace(/TIDDLER/g, &quot;[[&quot; + tiddlerTitle + &quot;]]&quot;);
   }
   
   mess = mess.replace(&quot;DIFF&quot;, diffString).replace(&quot;TITLE&quot;, reminderTitle).replace(&quot;DATE&quot;, matchedDate.formatString(&quot;DDD MMM DD, YYYY&quot;)).replace(&quot;ANNIVERSARY&quot;, anniversaryString);
   return mess;
};

// Parse out the macro parameters into a hashtable.  This
// handles the arguments for reminder, showReminders and 
// displayTiddlersWithReminders.
window.getParamsForReminder = function getParamsForReminder(params)
{
   var dateHash = {};
   var type = &quot;&quot;;
   var num = 0;
   var title = &quot;&quot;;
   for(var t=0; t&lt;params.length; t++)
   {
      var split = params[t].split(&quot;:&quot;);
      type = split[0].toLowerCase();
      var value = split[1];
      for (var i=2; i &lt; split.length; i++)
      {
         value += &quot;:&quot; + split[i];
      }
      if (type == &quot;nolinks&quot; || type == &quot;limit&quot; || type == &quot;hidden&quot;)
      {
         num = 1;
      }
      else if (type == &quot;leadtime&quot;)
      {
         var leads = value.split(&quot;...&quot;);
         if (leads.length == 1)
         {
            leads[1]= leads[0];
            leads[0] = 0;
         }
         leads[0] = parseInt(leads[0], 10);
         leads[1] = parseInt(leads[1], 10);
         num = leads;
      }
      else if (type == &quot;offsetdayofweek&quot;)
      {
          if (value.substr(0,1) == &quot;-&quot;)
          {
             dateHash[&quot;negativeOffsetDayOfWeek&quot;] = 1;
	     value = value.substr(1);
          }
          num = parseInt(value, 10);
      }
      else if (type != &quot;title&quot; &amp;&amp; type != &quot;tag&quot; &amp;&amp; type != &quot;format&quot;)
      {
         num = parseInt(value, 10);
      }
      else
      {
         title = value;
         t++;
         while (title.substr(0,1) == '&quot;' &amp;&amp; title.substr(title.length - 1,1) != '&quot;' &amp;&amp; params[t] != undefined)
         {
            title += &quot; &quot; + params[t++];
         }
         //Trim off the leading and trailing quotes
         if (title.substr(0,1) == &quot;\&quot;&quot; &amp;&amp; title.substr(title.length - 1,1)== &quot;\&quot;&quot;)
         {
            title = title.substr(1, title.length - 2);
            t--;
         }
         num = title;
      }
      dateHash[type] = num;
   }
   //date is synonymous with day
   if (dateHash[&quot;day&quot;] == null)
   {
      dateHash[&quot;day&quot;] = dateHash[&quot;date&quot;];
   }
   return dateHash;
};

//This function finds the date specified in the reminder 
//parameters.  It will return null if no match can be
//found.  This function is not intended to be used by
//other plugins.
window.findDateForReminder= function findDateForReminder( dateHash, baseDate, leadTimeLowerBound, leadTimeUpperBound)
{
   if (baseDate == null)
   {
     baseDate = new Date().getMidnight();
   }
   var hashKey = baseDate.convertToYYYYMMDDHHMM();
   for (var k in dateHash)
   {
      hashKey += &quot;,&quot; + k + &quot;|&quot; + dateHash[k];
   }
   hashKey += &quot;,&quot; + leadTimeLowerBound.convertToYYYYMMDDHHMM();
   hashKey += &quot;,&quot; + leadTimeUpperBound.convertToYYYYMMDDHHMM();
   if (reminderCache[hashKey] == null)
   {
      //If we don't find a match in this run, then we will
      //cache that the reminder can't be matched.
      reminderCache[hashKey] = false;
   }
   else if (reminderCache[hashKey] == false)
   {
      //We've already tried this date and failed
      return null;
   }
   else
   {
      return reminderCache[hashKey];
   }
   
   var bOffsetSpecified = dateHash[&quot;offsetyear&quot;] != null || 
				dateHash[&quot;offsetmonth&quot;] != null || 
				dateHash[&quot;offsetday&quot;] != null || 
				dateHash[&quot;offsetdayofweek&quot;] != null || 
				dateHash[&quot;recurdays&quot;] != null;
   
   // If we are matching the base date for a dayofweek offset, look for the base date a 
   //little further back.
   var tmp1leadTimeLowerBound = leadTimeLowerBound;  
   if ( dateHash[&quot;offsetdayofweek&quot;] != null)
   {
      tmp1leadTimeLowerBound = leadTimeLowerBound.addDays(-6);  
   }
   var matchedDate = baseDate.findMatch(dateHash, tmp1leadTimeLowerBound, leadTimeUpperBound);
   if (matchedDate != null)
   {
      var newMatchedDate = matchedDate;
      if (dateHash[&quot;recurdays&quot;] != null)
      {
         while (newMatchedDate.getTime() &lt; leadTimeLowerBound.getTime())
         {
            newMatchedDate = newMatchedDate.addDays(dateHash[&quot;recurdays&quot;]);
         }
      }
      else if (dateHash[&quot;offsetyear&quot;] != null || 
		dateHash[&quot;offsetmonth&quot;] != null || 
		dateHash[&quot;offsetday&quot;] != null || 
		dateHash[&quot;offsetdayofweek&quot;] != null)
      {
         var tmpdateHash = cloneParams(dateHash);
         tmpdateHash[&quot;year&quot;] = dateHash[&quot;offsetyear&quot;];
         tmpdateHash[&quot;month&quot;] = dateHash[&quot;offsetmonth&quot;];
         tmpdateHash[&quot;day&quot;] = dateHash[&quot;offsetday&quot;];
         tmpdateHash[&quot;dayofweek&quot;] = dateHash[&quot;offsetdayofweek&quot;];
	 var tmpleadTimeLowerBound = leadTimeLowerBound;
	 var tmpleadTimeUpperBound = leadTimeUpperBound;
	 if (tmpdateHash[&quot;offsetdayofweek&quot;] != null)
	 {
	 	if (tmpdateHash[&quot;negativeOffsetDayOfWeek&quot;] == 1)
		{
		   tmpleadTimeLowerBound = matchedDate.addDays(-6);
		   tmpleadTimeUpperBound = matchedDate;

		}
		else
		{
		   tmpleadTimeLowerBound = matchedDate;
		   tmpleadTimeUpperBound = matchedDate.addDays(6);
		}

	 }
	 newMatchedDate = matchedDate.findMatch(tmpdateHash, tmpleadTimeLowerBound, tmpleadTimeUpperBound);
         //The offset couldn't be matched.  return null.
         if (newMatchedDate == null)
         {
            return null;
         }
      }
      if (newMatchedDate.isBetween(leadTimeLowerBound, leadTimeUpperBound))
      {
         reminderCache[hashKey] = newMatchedDate;
         return newMatchedDate;
      }
   }
   return null;
};

//This does much the same job as findDateForReminder, but
//this one doesn't deal with offsets or recurring 
//reminders.
Date.prototype.findMatch = function findMatch(dateHash, leadTimeLowerBound, leadTimeUpperBound)
{

   var bSpecifiedYear =     (dateHash[&quot;year&quot;] != null);
   var bSpecifiedMonth =     (dateHash[&quot;month&quot;] != null);
   var bSpecifiedDay =     (dateHash[&quot;day&quot;] != null);
   var bSpecifiedDayOfWeek =     (dateHash[&quot;dayofweek&quot;] != null);
   if (bSpecifiedYear &amp;&amp; bSpecifiedMonth &amp;&amp; bSpecifiedDay)
   {
      return new Date(dateHash[&quot;year&quot;], dateHash[&quot;month&quot;]-1, dateHash[&quot;day&quot;], 0, 0);
   }
   var bMatchedYear = !bSpecifiedYear;
   var bMatchedMonth = !bSpecifiedMonth;
   var bMatchedDay = !bSpecifiedDay;
   var bMatchedDayOfWeek = !bSpecifiedDayOfWeek;
   if (bSpecifiedDay &amp;&amp; bSpecifiedMonth &amp;&amp; !bSpecifiedYear &amp;&amp; !bSpecifiedDayOfWeek)
   {

      //Shortcut -- First try this year.  If it's too small, try next year.
      var tmpMidnight = this.getMidnight();
      var tmpDate = new Date(this.getFullYear(), dateHash[&quot;month&quot;]-1, dateHash[&quot;day&quot;], 0,0);
      if (tmpDate.getTime() &lt; leadTimeLowerBound.getTime())
      {
         tmpDate = new Date((this.getFullYear() + 1), dateHash[&quot;month&quot;]-1, dateHash[&quot;day&quot;], 0,0);
      }
      if ( tmpDate.isBetween(leadTimeLowerBound, leadTimeUpperBound))
      {
         return tmpDate;
      }
      else
      {
         return null;
      }
   }

   var newDate = leadTimeLowerBound; 
   while (newDate.isBetween(leadTimeLowerBound, leadTimeUpperBound))
   {
      var tmp = testDate(newDate, dateHash, bSpecifiedYear, bSpecifiedMonth, bSpecifiedDay, bSpecifiedDayOfWeek);
      if (tmp != null)
        return tmp;
      newDate = newDate.addDays(1);
   }
};

function testDate(testMe, dateHash, bSpecifiedYear, bSpecifiedMonth, bSpecifiedDay, bSpecifiedDayOfWeek)
{
   var bMatchedYear = !bSpecifiedYear;
   var bMatchedMonth = !bSpecifiedMonth;
   var bMatchedDay = !bSpecifiedDay;
   var bMatchedDayOfWeek = !bSpecifiedDayOfWeek;
   if (bSpecifiedYear)
   {
      bMatchedYear = (dateHash[&quot;year&quot;] == testMe.getFullYear());
   }
   if (bSpecifiedMonth)
   {
      bMatchedMonth = ((dateHash[&quot;month&quot;] - 1)  == testMe.getMonth() );
   }
   if (bSpecifiedDay)
   {
      bMatchedDay = (dateHash[&quot;day&quot;] == testMe.getDate());
   }
   if (bSpecifiedDayOfWeek)
   {
      bMatchedDayOfWeek = (dateHash[&quot;dayofweek&quot;] == testMe.getDay());
   }

   if (bMatchedYear &amp;&amp; bMatchedMonth &amp;&amp; bMatchedDay &amp;&amp; bMatchedDayOfWeek)
   {
      return testMe;
   }
};

//Returns true if the date is in between two given dates
Date.prototype.isBetween = function isBetween(lowerBound, upperBound)
{
  return (this.getTime() &gt;= lowerBound.getTime() &amp;&amp; this.getTime() &lt;= upperBound.getTime());
}
//Return a new date, with the time set to midnight (0000)
Date.prototype.getMidnight = function getMidnight()
{
   return new Date(this.getFullYear(), this.getMonth(), this.getDate(), 0, 0);
};
// Add the specified number of days to a date.
Date.prototype.addDays = function addDays(numberOfDays)
{
   return new Date(this.getFullYear(), this.getMonth(), this.getDate() + numberOfDays, 0, 0);
};
//Return the number of days between two dates.
Date.prototype.getDifferenceInDays = function getDifferenceInDays(otherDate)
{
//I have to do it this way, because this way ignores daylight savings
   var tmpDate = this.addDays(0);
   if (this.getTime() &gt; otherDate.getTime())
   {
      var i = 0;
      for (i = 0; tmpDate.getTime() &gt; otherDate.getTime(); i++)
      {
         tmpDate = tmpDate.addDays(-1);
      }
      return i;
   }
   else
   {
      var i = 0;
      for (i = 0; tmpDate.getTime() &lt; otherDate.getTime(); i++)
      {
         tmpDate = tmpDate.addDays(1);
      }
      return i * -1;
   }
   return 0;
};
function cloneParams(what) {
    var tmp = {};
    for (var i in what) {
        tmp[i] = what[i];
    }
    return tmp;
}
// Substitute date components into a string
Date.prototype.formatStringDateOnly = function formatStringDateOnly(template)
{
	template = template.replace(&quot;YYYY&quot;,this.getFullYear());
	template = template.replace(&quot;YY&quot;,String.zeroPad(this.getFullYear()-2000,2));
	template = template.replace(&quot;MMM&quot;,config.messages.dates.months[this.getMonth()]);
	template = template.replace(&quot;0MM&quot;,String.zeroPad(this.getMonth()+1,2));
	template = template.replace(&quot;MM&quot;,this.getMonth()+1);
	template = template.replace(&quot;DDD&quot;,config.messages.dates.days[this.getDay()]);
	template = template.replace(&quot;0DD&quot;,String.zeroPad(this.getDate(),2));
	template = template.replace(&quot;DD&quot;,this.getDate());
	return template;
};

//}}}</pre>
</div>
<div title="Route" modifier="Fhopecc" modified="200709080135" created="200709071522" tags="ROR" changecount="10">
<pre>!函數與 route
在函數定義中，形式參數列依序列出形式參數的名稱，
當呼叫函數並傳入實際參數，編輯器會自動依實際參數列的位置，
將實際參數複製給對應的形式參數。

Route 就是把 URL 中使用者的參數依照其傳入的模式翻譯成 ruby 的 params 表，
指定 route 的規則，有點像是在程式語言中定義函數，
其中 :controller 與 :action 並非在 params 表中，
而是用來選擇使用的 controller 及 action。
</pre>
</div>
<div title="Ruby 操作 Word " modifier="fhopecc" modified="200807150750" created="200807150650" tags="Ruby" changecount="5">
<pre>用Ruby的OLE 自動化把文字檔案內容插入到Word中收藏
博文要我寫一本有關Ruby的書，其中對文字檔案（代碼，配置檔）的格式是有特殊要求，檔路徑用Arial Narrow 小四、斜體，正文用Courier New 五號。下面的這個Ruby程式使用OLE Automation來做這個工作。 
{{{
#insert_file_to_word.rb
require &quot;win32ole&quot; 
begin 
      word = WIN32OLE.connect(&quot;word.application&quot;) 
rescue 
      #如果沒有打開的Word程式，創建一個 
      word = WIN32OLE.new(&quot;word.application&quot;) 
      word.documents.add 
end 
word.visible = true 
doc = word.ActiveDocument() 
#保存原有的文本字體 
old_font_name = word.selection.font.name 
old_font_size = word.selection.font.size 
old_font_italic = word.selection.font.italic 
#創建檔路徑字體 
word.selection.font.name = &quot;Arial Narrow&quot; 
word.selection.font.size = 12 
word.selection.font.italic = true 
#輸入檔路徑 
word.selection.typeText(&quot;#{ARGV[0]}\n&quot;) 
#創建檔文本字體 
word.selection.font.name = &quot;Courier New&quot; 
word.selection.font.size = 10.5 
word.selection.font.italic = false 
#一行行寫入，換行符用\11，這樣可以作為一個整體來 
#處理檔，而不用分段。 
ARGF.each do |line| 
      word.selection.typeText(&quot;#{line.chomp}\x0b&quot;) 
end 
word.selection.typeText(&quot;\n&quot;) 
#恢復原有字體 
word.selection.font.name = old_font_name 
word.selection.font.size = old_font_size 
word.selection.font.italic = old_font_italic 
}}}
可以在命令行中輸入 ruby insert_file_to_word.rb &lt;FILE_TO_BE_INSERTED&gt;，我用的是UltraEdit 
的自定義工具功能，新建一個叫做&quot;Insert to word&quot;的功能表項，功能表的命令行部分使用ruby 
d:\work\ruby_works\ruby_book\win32\insert_file_to_word.rb %F 
，這樣一來，只要打開這個檔，然後按一個快捷鍵，檔文本就會出現到Word文檔中。 
</pre>
</div>
<div title="Ruby導論" modifier="fhopecc" created="200805260657" tags="待辦事項 完成事項" changecount="1">
<pre>#安裝Ruby
#字串的使用
#正規表示式</pre>
</div>
<div title="Ruby慣寫法" modifier="fhopecc" created="200802111313" tags="Ruby" changecount="1">
<pre>Ruby慣寫法
選項
目前本群組有太多主題設為優先顯示。 要優先顯示這個主題，請將其他主題的這個選項取消。
在處理您的要求時發生錯誤。 請再試一次。
標準檢視   樹狀檢視
比例文字   固定字型
[點擊信封以接收電子郵件的最新消息] 	將最新消息以電子郵件寄給我取消以電子郵件通知我最新消息
	
		
[按一下星號觀看此主題] 	
[點擊信封以接收電子郵件的最新消息]
	
標幟
	  	1 則留言 - 全部摺疊 	
您要留言的群組是 Usenet 群組。在此群組留言，網際網路上的任何使用者將可以看到您的電郵地址。
您的回覆郵件尚未寄出。
您已成功留言
	
		
CFC   	
檢視個人資料
	(1 位使用者)  更多選項 2006年12月30日, 上午11時30分
寄件者： &quot;CFC&quot; &lt;zuso...@gmail.com&gt;
日期： Sat, 30 Dec 2006 03:30:21 -0000
當地時間： 2006年12月30日(星期六) 上午11時30分
主旨： Ruby慣寫法
回覆作者 | 轉寄 | 列印 | 個別訊息 | 顯示原始檔 | 回報此訊息 | 尋找此作者的訊息
RailsCN上的Cookoo前輩建議了幾個他常用的寫法，有：Iterators、賦值、平行賦值..
etc.
轉貼至：http://railscn.com/viewtopic.php?t=2092

Ruby有不少慣用法，這裡略作一些介紹，也方便閱讀他人代碼：

迭代
一般寫法:
代碼:

for i in (1..10)
   puts i
end

習慣寫法:
代碼:

(1..10).each{|i| puts i}
或
1.upto(10){|i| puts i} # from njmzhang

||=賦值
一般寫法：
代碼:

number = 1 if number.nil?
number = 1 unless number

習慣寫法：
代碼:

number ||= 1

程序入口
代碼:

if __FILE__ == $0
或
if $PROGRAM_NAME == __FILE__

這個相當於main(),
邏輯判斷的意思當程序名($0或另一個）和當前文件名(__FILE__)一致時，也就是當前文件是被單獨執行的而不是被別的文件調用。這個方法還有個用法是作為unit
test使用。

預設變量
類似$0的Perl風格預設常量還有很多，參見Programming Ruby
p319
其中比較常用的如$:代表庫搜索路徑，修改方法常見有：
代碼:

$:.unshift('buildscript')  # from gigix
或
$: &lt;&lt; File.join(File.dirname(__FILE__), 'CurrentClass')

後一種方法使用了相對路徑，因為Ruby的module不要求namespace和文件目錄結構要對應一致，很多時候統統放一個目錄裡

inject
一般寫法：
代碼:

result = []
(1..10).each{|item| result &lt;&lt; item}

習慣寫法：
代碼:

(1..10).inject([]){|array, item| array &lt;&lt; item}

inject有點難理解，相當於python的reduce和一些FP裡的fold。inject的塊變量有兩個（這裡是array和item)，第二個變量(item)用來枚舉被inject的集合（這裡是(1..10)這個range),
而第一個變量(array)由inject的參數初始化(這裡是[]，可選)，並在block被反覆執行時保持持久（相當於靜態變量），而item則在每次枚舉時被更新為下一個值。我們再看一下inject的另一種通常用法就會更明白了：求和
代碼:

(1..10).inject{|sum, item| sum += item}
這個等於
(1..10).inject(0){|sum, item| sum += item}

也就是塊變量sum被初始化成0然後反覆迭代執行塊的內容，最後返回sum

並行賦值
這個很多人都知道了，比如：
代碼:

a,b = 0, 1
a,b = b, a # 交換a,b

當然可以延伸出一些很詭異的變化，不提倡使用阿

還有一個用法是讓函數返回「多個結果」（不是多個對象），如：
代碼:

def test
  1,2
end
x, y = test # x = 1, y = 2

這個njmzhang說的很對，其實函數返回的是一個array,然後再並行匹配到變量上去。（所以我對多個結果特別加了引號）
這顯然是個syntax
sugar，你隨便用逗號分割幾個變量是不會自動組成array的。

注意這種並行匹配當兩遍不平衡時會造成的問題：
代碼:

a,b = [1,2,3] # a = 1, b = 2, 3被丟棄
a,b,c = [1,2] # a = 1, b = 2, c = nil 被初始化成nil

*的匹配
一般來說*用於把一個array展開：
代碼:

a, *b = [1,2,3]  #a = 1, b = [2,3]

類似FP裡的xMads(haskell), x:Mads(ocaml), [a | b] (erlang from
布娃娃）

rescue簡單用法
代碼:

begin
 1/0
rescue
  puts 'wrong'
end

可以簡化為
代碼:
1/0 rescue puts 'wrong'

命名參數的默認值
ruby有默認參數，但其實沒有所謂keyword
argument，而是提供一個syntax
sugar用hash模擬。但是怎麼像Rails的方法那樣同時利用命名參數和默認參數值呢？
代碼:

def image(opt={})
    default_opt = {:height =&gt; 25, :width =&gt; 10}
    default_opt.merge! opt
#opt中同樣key的內容會覆蓋default_opt中key的value
end

精細duck typing控制
duck typing的精神就是行為決定類型，而不是相反
代碼:

a = []
#不用
if a.kind_of? Array then a &lt;&lt; 1
if a.instance_of? Array then a &lt;&lt; 1
#而用
if a.respond_to? :&lt;&lt; then a &lt;&lt; 1

獲取metaclass
這也比較常見了，各種動態伎倆的開始
代碼:

sing = class &lt;&lt; self; self; end

符號轉換到Proc
一般寫法：
代碼:

(1..10).map{|item| item.succ}

習慣寫法：
代碼:

(1..10).map(&amp;:succ)

map(fun(x))般的FP風格

注意這是Rails特有的，通過ActiveSupport對Symbol插入to_proc方法。
不用Rails怎麼辦呢？一種辦法是借助Ruby Facets庫（gem
install facets）：
代碼:
require 'facet/symbol/to_proc'

Facets庫包括大量對Ruby核心類的擴展，是個有趣而又危險的大雜燴，也許我以後會另外再專門介紹一下。

    回覆作者    轉寄       評等此留言： Text for clearing space
		
		
		
您必須先登入才能張貼訊息。
若要張貼訊息，您必須先加入此群組。
請在留言之前更新您訂閱設定網頁上的暱稱。
您沒有留言所需的權限。
主題尾端 	
« 返回討論主題 	« 較新的主題 	    	較舊的主題 »

	
建立群組 - Google 網上論壇 - Google 首頁 - 服務條款 - 隱私權政策
©2008 Google
</pre>
</div>
<div title="Ruby投稿" modifier="fhopecc" modified="200805270603" created="200803171238" tags="Ruby" changecount="8">
<pre>!未完成
#Ruby 的檔案處理
#block
#alias 要催妹妹
#flyweight辨析
#RubyDebug(UnitTest)(Logging)
#其它語言的老東西
!已完成
#Base64
#flyweight </pre>
</div>
<div title="Ruby簡介" modifier="fhopecc" modified="200712220238" created="200712131244" tags="Ruby" changecount="28">
<pre>作為程式師的你，是否有相同的感覺？
人的欲望無窮、老闆要求績效無上限、
以及使用者普遍地很怕麻煩，
造成目前系統演變的越來越複雜。

回憶起剛工作的前一二年除夕整夜都待在醫院資訊室除虫的日子，
望著醫院大樓資訊室窗外的天空慶賀新年的煙火，內心孤獨的感覺，
至今仍印象深刻。
在全面資訊化的醫院，不能容忍程式一絲一毫的中斷，
尤其在很多人吃壞肚子的除夕。

當然程式設計師也有欲望，也要求績效，更怕麻煩。
在台灣硬體大廠的努力下，
寫程式以從以往的關心機器要怎麼跑最快，
到現在則是關心我，一個平凡的程式師怎麼寫最快，最不麻煩。

而Ruby語言就是我目前(人是多變的)心中的聖杯，
它以動態性，物件高度的自省性聞名。
把Meta Programming的技巧，怕麻煩程式師的尚方寶劍，
從只聞此曲LISP有，人間那得幾回聞，
用Ruby自然便利的語法帶到我們的面前。

而我與Ruby語言一見鐘情於其在Web開發的殺手級框架，Rails。

Rails框架發揮了Ruby的動態以及高度自省的能力，
成功簡化了企業級Web應用系統開發的複雜性，
Ruby能自然的為某個問題建立起一組
DSL(Domain Specific Language)來解決此領域的問題，
這就是前面我所說的怕麻煩程式師的尚方寶劍，Meta Programming，
Rails框架的建立者，很怕麻煩的程式師 DHH(David Heinemeier Hansson )，更以 DRY (Dont Repeat Yourself)「不要重覆自已」原則加上COC(Convention over Configuration)「慣例優於設定檔」原則，建立了Rails。

像是Rails中ActionPack套件，
便是一組為MVC及Web應用開發專門設計的DSL，
而不約束於程式語言本身的語法中，
諸如傳統式如C++或Java語言，想要達到同樣的效果，
必須憑藉像是XML及程式碼產生器等一層又一層的與原本程式相差很遠的技術，老實說我用過，而且真的很麻煩。

而ActiveRecord又是Rails為持久性框架及SQL所設計的DSL，
它利用Ruby物件高度的自省性及動態性簡化了整合持久性框架及SQL所需要的複雜性。

Ruby的爸爸Matz把Ruby比作人體，
外表很簡單內在卻很複雜，有點像是愛因斯坦所說的：
「把事情儘可能變得更簡單，但不是簡化」，
這使Rails框架成功的吸引許多使用者願意採用它作為他們的解決方案。
但我要強調的是，Rails框架的強大，得力於Ruby語言本身的特性。
在我接觸Ruby以來，除了有名的Rails套件，
更在其它套件一次又一次發現Ruby設計的美感。

我希望能把這一路來的觀察，
寫成一系列文章，系列名稱暫定為「琢磨妳的紅寶石」，
我的目的有三：
首要為了賺些稿費養老婆小孩，
其次也希望藉由寫作來讓自已更為透澈的了解Ruby。
並將我學到的特別設計巧思，分享給與我一樣怕麻煩的程式師，
最後為了感謝Matz、DHH及所有把這個工具帶給我們的天才們。</pre>
</div>
<div title="SCO" modifier="fhopecc" modified="200808200611" created="200708300627" tags="網路連線 YHQ" changecount="37">
<pre>|主機 IP|10.66.7.10|
|作業系統|SCO ~OpenServer R5|
|負責人|劉盈志|1069,1053|0933906073|
|mailto:yc3916@gmail.com|
|負責人|廖春豪|0920722767|
|mailto:chliau@mitac.com.tw|
|電話|(02)276318331#1069|
|Telnet|a/p:xum/xum123|
|xum:xum123@Telnet|[[C-ISAM]]|
|[[xum:a@xumweb|http://10.66.7.10:8888/xum]]|[[WEB網路介面管理系統]]|
|xum8|[[國地稅查調服務]]|
|xum9|[[戶政資訊交流作業管理]]|
*''注意事項''
** 主機每天 7:00 開機, 10:00 關機
** 連線問題發生時，所有服務手動重啟
** 傳加密檔發生問題時，把檔於離峰或傳不加密檔</pre>
</div>
<div title="SNTP in Windows" modifier="fhopecc" modified="200803200637" created="200709030536" tags="Windows NTP" changecount="3">
<pre>|Simple Network Time Protocol|(SNTP)|
|port|123|

透過網際網路用來同步時間的通訊協定。SNTP 可讓用戶端電腦的時鐘與網際網路的伺服器時鐘同步，其服務的 

h3. Windows

net time同步處理電腦時鐘與其他電腦或網域的時鐘。

*顯示指定 SNTP 的時間*
例如：
&lt;pre&gt;
C:\&gt;net time
\\PMNM 現在的時間是 2007/8/15 下午 02:28

命令執行成功。
&lt;/pre&gt; 

*設定本機時間與指定的 SNTP 伺服器的時間同步*
&lt;pre&gt;
C:\&gt;net time /setsntp:PMNM
命令執行成功。
&lt;/pre&gt;

*顯示本機所指定要作同步的 SNTP 伺服器*
&lt;pre&gt;
C:\&gt;net time /querysntp
目前的 SNTP 值是: pmnm

命令執行成功。
&lt;/pre&gt;

*測試 SNTP 服務是否成功*
&lt;pre&gt;
C:\&gt;w32tm /resync
傳送 resync 命令到 local computer...
命令成功完成。
&lt;/pre&gt;</pre>
</div>
<div title="SQL教學大網" modifier="fhopecc" modified="200807030637" created="200807030636" tags="教學" changecount="4">
<pre>!SQL教學
#ELT系統表格的命名規則？
#如何選擇妳要的欄位？
#如何限定條件？
#如何串接不同的表格？
#使用 GROUP 及 HAVING 作分組篩選？
</pre>
</div>
<div title="SendTo move file" modifier="fhopecc" modified="200712270231" created="200712261229" tags="WinXPTips" changecount="4">
<pre>讓 SendTo 搬檔案，
只要用滑鼠選取要傳送檔案的圖示，並按住shift鍵，再按右鍵選取”傳送到”項目，
選取目的磁碟，即可。
If you click the icon once, hold shift then right click. Send to will
now move instead of copy :)</pre>
</div>
<div title="SessionConcept" modifier="Fhopecc" modified="200709211411" created="200709211410" changecount="2">
<pre>!Session 的概念
一個網站利用 session 來記得它跟某個使用者的互動。 例如，阿福登入 Gmail， Gamil 就會建立一個它跟阿福之間的 session。 每當阿福按他的收信籃或垃圾桶連結時，session 就會告訴 Gmail 阿福要什麼樣的資訊，然後 Gamil 就會把此資訊傳回給阿福。 如阿福登出 Gmail 或關閉瀏覽器，session 就會消失，Gmail 將不知道阿福是誰，也不會把阿福的資訊傳出去。 Session 只有在需要知道使用者是誰時才會建立。 如果阿福只要用 Google 的收尋功能，不用 Gmail， Google 就不需要知道他是誰，所以也不用建 session。

在 Rails 裡，session 是怎麼建立的呢？ 答案就是 cookie：當你登入一個網站時，網站的伺服器就即時產生一個 id 給你，當作 cookie 放在你的瀏覽器裡。 這 id 其實只是一個長度 32 位數的英文字母字串。每次你要新的資訊時，你的瀏覽器會把那串字給伺服器，這樣伺服器就知道你是誰了。

在我們的示範裡頭，有時會把一些變數存在 session 裡，方便紀錄一些有的沒有的。 這又是怎麼辦到的呢？ 每個人登入網站之後，Rails 會利用剛剛說的 32 位數的字串建一個文字檔，存放在你程式目錄下的 tmp\sessions 檔案夾。 你如果有執行過用到 session 的程式，去看看那個檔案夾你就會看到一堆檔案命名類似 ruby_sess.bb97ac9253f7ce87。 打開其中一個，就會看到一些資料。這些資料就是當初那個使用者的 session 物件被伺服器處理後存放的資料。 一個使用者會產生一個 session，一個 session就會產生一個 session 檔案。跟伺服器溝通時，伺服器會用你給它的字串找出你的 session 檔案，然後把這檔案裡的值灌回你的 session。 Session 裡的值依照你的需求被更改後，又會被存回 tmp\sessions 檔案夾。在 tmp\sessions 檔案夾裡看到的就是不同的使用者產生的 session 檔案，如果沒定時把這些檔案清掉的話，檔案夾會爆掉。清除的方法等一下再談。

在程式裡要把變數存入 session 很簡單，直接用 session 陣列就可以：

session[:current_phone] = user.phone

要取回存入的值的話也是一樣：

The phone number currently on file is &lt;%= session[:current_phone]%&gt;</pre>
</div>
<div title="SiteSubtitle" modifier="fhopecc" modified="200710040450" created="200709280035" changecount="17">
<pre>&lt;&lt;date popup &quot;today&quot; &quot;YYYY0MM0DD&quot; &quot;YYYY0MM0DD&quot;&gt;&gt;</pre>
</div>
<div title="SiteTitle" modifier="fhopecc" modified="200709290027" created="200702090114" changecount="4">
<pre>FhopeccTW</pre>
</div>
<div title="Socks" modifier="YourName" modified="200704270537" created="200703011649" tags="chkList chkPacking xBB">
<pre>5</pre>
</div>
<div title="Sub-word regex pattern matching with \B" modifier="Fhopecc" created="200709090427" tags="Ruby" changecount="1">
<pre>The \B regex option can be used to match \w characters ([a-zA-Z_0-9]) inside words.

Some examples for matching a numberstring that contains 332:

string = &quot;12332231 3321705&quot;

string.scan(/\B332\B/) { |x| puts x }

string.scan(/\w+?\B332\B\w+/) { |x| puts x }   # \d for \w is also possible here

a = string.gsub(/(\w+?)\B332\B(\w+)/) { $1 &lt;&lt; &quot;9999999&quot; &lt;&lt; $2 }   # replaces 332 by 9999999
puts a


to ruby regex string by ntk on Fri Feb 03 20:38:21 EST 2006 </pre>
</div>
<div title="Só danço samba," modifier="fhopecc" created="200711251127" tags="歌詞" server.type="file" server.host="file://D:\sfhopecc\stwFhopecc\sfhopetw.htm.mine" server.page.revision="200711251127">
<pre>Só danço samba,
Só danço samba,
Vai, vai, vai, vai, vai
Só danço samba,
Só danço samba,
Vai
Só danço samba,
Só danço samba,
Vai, vai, vai, vai, vai
Só danço samba,
Só danço samba,
Vai
Já dancei o twist até demais,
Mas não sei, me cansei,
Do calipso, ao chá chá chá
Só danço samba,
Só danço samba,
Vai, vai, vai, vai, vai
Só danço samba,
Só danço samba,
Vai
Só danço samba,
Só danço samba,
Vai, vai, vai, vai, vai
Só danço samba,
Só danço samba,
Vai </pre>
</div>
<div title="TabEditPlugin" modifier="YourName" created="200702101702" tags="chkList systemConfig">
<pre>/***
|Name|TabEditPlugin|
|Created by|SaqImtiaz|
|Location|http://tw.lewcid.org/#TabEditPlugin|
|Version|0.32|
|Requires|~TW2.x|

!Description
Makes editing of tabs easier.

!Usage
*Double click a tab to edit the source tiddler
*Double click outside the tabset to edit the containing tiddler. 

!Demo
TestTabs

!History
*28-04-06, v0.32 - fixed previous bug fix!
*27-04-06, v0.31 - fixed conflicts with tabs created using PartTiddler.
*26-04-06, v0.30 - first public release

***/

//{{{

//tab on double click event handler
Story.prototype.onTabDblClick = function(e){
        if (!e) var e = window.event;
        var theTarget = resolveTarget(e);
        var title= this.getAttribute(&quot;source&quot;);
        if ((version.extensions.PartTiddlerPlugin)&amp;&amp;(title.indexOf(&quot;/&quot;)!=-1))
                 {if (!oldFetchTiddler.call(this, [title]))
                              {return false;}}   
        story.displayTiddler(theTarget,title,2,false,null)
        e.cancelBubble = true;
        if (e.stopPropagation) e.stopPropagation();
        return false;
        }

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute(&quot;cookie&quot;);
	var theTab = null
	var nodes = tabset.childNodes;
	for(var t=0; t&lt;nodes.length; t++)
		if(nodes[t].getAttribute &amp;&amp; nodes[t].getAttribute(&quot;tab&quot;) == tab)
			{
			theTab = nodes[t];
			theTab.className = &quot;tab tabSelected&quot;;
			}
		else
			nodes[t].className = &quot;tab tabUnselected&quot;
	if(theTab)
		{
		if(tabset.nextSibling &amp;&amp; tabset.nextSibling.className == &quot;tabContents&quot;)
			tabset.parentNode.removeChild(tabset.nextSibling);
		var tabContent = createTiddlyElement(null,&quot;div&quot;,null,&quot;tabContents&quot;,null);
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute(&quot;content&quot;);

                //set source attribute equal to title of tiddler displayed in tab
		tabContent.setAttribute(&quot;source&quot;,contentTitle);
		//add dbl click event
		tabContent.ondblclick = story.onTabDblClick;

		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie)
			{
			config.options[cookie] = tab;
			saveOptionCookie(cookie);
			}
		}
}

//}}}</pre>
</div>
<div title="Tables In YPM" modifier="fhopecc" modified="200801310135" created="200801300730" tags="YPM" changecount="2">
<pre>|YPMT050|系統資料|
|YPMT060|現有程式資料|
|YPMT070|歷史程式資料|</pre>
</div>
<div title="TaskParametersInRake" modifier="fhopecc" created="200801220732" changecount="1">
<pre>Task Parameters in Rake 0.8.0

Looks like I’m not the only one that’s tired of munging ENV when I pass parameters to rake tasks. Along with a handful of other fixes, Rake 0.8.0 added the ability to pass parameters to your tasks without mucking with environment variables.

What used to be:

# rake invoke COMMAND=foo
task :invoke do
  puts &quot;Invoking #{ENV['COMMAND']}
end

Can become:

# rake invoke[foo]
task :invoke, :command do |task, args|
  puts &quot;Invoking #{args[:command]}&quot;
end

If your task has prerequisites, they come after the parameter names in the declaration:

task :invoke, :command =&gt; :prerequisite do |task, args|
  # ...
end

Looks like the args are comma-separated and purely positional, no named or default arguments. It’s possible that there’s a better way to access argument values than this, too: I haven’t run across any documentation yet.</pre>
</div>
<div title="Tea" modifier="YourName" modified="200704270533" created="200703020053" tags="chkList chkPacking xCC">
<pre></pre>
</div>
<div title="Tea Pod" modifier="YourName" modified="200704270532" created="200703020059" tags="chkList chkPacking xCC">
<pre></pre>
</div>
<div title="The Man Who Sold The World " modifier="fhopecc" modified="200709260436" created="200709250305" tags="歌詞" changecount="3">
<pre>We passed upon the stair, we spoke in was and when
Although I wasn't there, he said I was his friend
Which came as a surprise, I spoke into his eyes
I thought you died alone, a long long time ago

Oh no, not me
We never lost control
You're face to face
With The Man Who Sold The World

I laughed and shook his hand, and made my way back home
I searched a foreign land, for years and years I roamed
I gazed a gazeless stare, we walked a million hills
I must have died alone, a long long time ago

Who knows? Not me
I never lost control
You're face to face
With the Man who Sold the World

Who knows? not me
We never lost control
You're face to face
With the Man who Sold the World
</pre>
</div>
<div title="ThunderbirdMboxFile" modifier="fhopecc" modified="200802130711" created="200802130710" tags="thunderbird email" changecount="2">
<pre>Mbox files

There are four main versions of the Mbox format. Thunderbird, Netscape , Mozilla Suite and SeaMonkey use a slightly modified version of the ''mboxrd'' variant of this format. Eudora uses a slightly modified version of the mboxo variant. Most Windows email clients that use Mbox files will use an mboxo or mboxrd version, and you should have little trouble importing them. Under Linux you're more likely to run into an mboxcl or mboxcl2 version, which is incompatible. Both Kmail and Evolution use a compatible version. You might try migrating your messages to Kmail as an intermediate step since it supports importing numerous formats.

See the following links for more technical information about this format:

    * Wikipedia artcile about Mbox
    * Qmail documentationl
    * &quot;mbox&quot; is a family of several mutually incompatible mailbox formats
    * Configuring Netscape Mail On Unix: Why the Content-Length Format is Bad.
    * Mail Summary Files writeup explaining Mozilla mbox and .msf file design choices. 

[edit]
Manually importing and exporting

Unless you are an advanced user its generally preferable to use an application to import or export a folder since that typically sanitizes the file to minimize any incompatibilities. If you use IMAP's optional offline mode to create a local copy of remote folders, think ahead about how you will deal with any potential synchronization issues. To manually import/export Mbox formatted files:

   1. Create the e-mail account you want to use for the imported mail (unless you will use an existing account).
   2. Exit Thunderbird or Mozilla Suite.
   3. Back up your profile or Mail directory, especially if you plan to overwrite existing mbox files.
   4. Find the Mbox files in your account directory: In your Profile folder, you will see a &quot;Mail&quot; directory and in there you'll see one account directory named for each account.
   5. Copy the Mbox files you are importing, for example, copy &quot;Inbox&quot; (not inbox.msf) to the Mail account directory where you want to see the mail. Note: If you want to keep the existing Mbox file of the same name in the new location, rename the file you wish to import before copying it over. For example, rename &quot;Inbox&quot; to &quot;InboxOld&quot; and &quot;Sent&quot; to &quot;SentOld&quot;.
   6. Open Thunderbird or Mozilla Suite. A folder for each file you copied should be displayed.
   7. Open each folder and verify that it contains the correct number of e-mails, that they are readable, and that you can open attachments. Sometimes, differences between Mbox formats cause multiple emails to be combined into one larger e-mail or can make some e-mails unreadable. 

Troubleshooting is beyond the scope of this article, but if you examine the Mbox technical links and the links to importing specific programs, you may find helpful information. </pre>
</div>
<div title="Ticket" modifier="YourName" modified="200704270545" created="200703021042" tags="chkList chkPacking xDD">
<pre></pre>
</div>
<div title="TiddlyCheckList Version" modifier="YourName" modified="200704270524" created="200704140901" tags="chkList">
<pre>&lt;&lt;forEachTiddler
      where 'tiddler.tags.contains(&quot;version&quot;) &amp;&amp;
      tiddler.tags.contains(&quot;chkList&quot;) '
      sortBy 'tiddler.title' descending
 script 
 ' function getFirstLine(s) { var m = s.match(/\s*(.*)/); return m != null &amp;&amp; m.length &gt;= 1 ? m[1] : &quot;&quot;;  } '
 write '&quot;#[[&quot;+tiddler.title+&quot;]] &quot;+getFirstLine(tiddler.text)+&quot;\n&quot;'
&gt;&gt;&lt;&lt;newJournal 'YYYY.MM.DD 版本' label:&quot;Add New Version&quot; focus:title tag:chkList version&gt;&gt;</pre>
</div>
<div title="TiddlyPackingList HowTos" modifier="oc" modified="200704271026" created="200704131015" tags="chkList">
<pre>Do you see the checkbox in front of every item? Check any one of them. It disappeared, right? Where is it going?

Please click the ''&quot;Done&quot;'' tab. See! The item is there. You can uncheck it to get the item back to the original place.

What you're playing is TiddlyPackingList, a smart check list for travelers. While packing your package, you can use this check list to help not forgot anything. Till all the box had been checked, then you've definitely done the packing. It's easy and useful, and actually fun.
*General Functions
##''Adding Items'': Just click the ''Adding'' bottoms in each tab;
##''Deleting Items'': Click the Item title → Click ''edit'' → Click ''delete'';
##''Save'': Whatever you do please click on &lt;&lt;saveChanges&gt;&gt;;
##If you want to ''add or delete one tab'': It's a little bit diffcult. You have to know the [[TiddlyWiki tabs syntax]] first;
*''DownLoad''
*''[[Credits &amp; License]]''
*[[Version|TiddlyCheckList Version]]</pre>
</div>
<div title="TiddlyWiki" modifier="fhopecc" created="200708200514">
<pre></pre>
</div>
<div title="ToDo1" modifier="fhopecc" modified="200806130648" created="200803171202" changecount="5">
<pre>![[緊急事項|ToDo1]]
&lt;&lt;listTags 緊急事項&gt;&gt;</pre>
</div>
<div title="ToDo2" modifier="fhopecc" created="200803171203" changecount="1">
<pre>![[重要事項|ToDo2]]
&lt;&lt;listTags 重要事項&gt;&gt;</pre>
</div>
<div title="ToDo3" modifier="fhopecc" modified="200803171204" created="200803171201" changecount="3">
<pre>![[待辦事項|ToDo3]]
&lt;&lt;listTags 待辦事項&gt;&gt;</pre>
</div>
<div title="ToDo4" modifier="fhopecc" modified="200803171205" created="200803171158" changecount="3">
<pre>![[完成事項|ToDo4]]
&lt;&lt;listTags 完成事項&gt;&gt;</pre>
</div>
<div title="ToDoList" modifier="fhopecc" modified="200808020114" created="200803171156" changecount="29">
<pre>&lt;&lt;tabs txtFavourite
緊急事項 &quot;Priority 1&quot; ToDo1
例行事項 &quot;Priority 0&quot; Regular
重要事項 &quot;Priority 2&quot; ToDo2
待辦事項 &quot;Priority 3&quot; ToDo3
完成事項 &quot;Priority 4&quot; ToDo4
&gt;&gt;</pre>
</div>
<div title="TodoA" modifier="YourName" created="200704132326" tags="chkTodo chkList">
<pre>&lt;&lt;newJournal 'YYYY.MM.DD' label:&quot;新增公務Todo&quot; focus:title tag:chkTodo xAA&gt;&gt;&lt;&lt;forEachTiddler
      where 'tiddler.tags.contains(&quot;xAA&quot;) &amp;&amp;
      tiddler.tags.contains(&quot;chkTodo&quot;) &amp;&amp;
      ! tiddler.tags.contains(&quot;ok&quot;)'
      sortBy 'tiddler.title'
 script 
 ' function getFirstLine(s) { var m = s.match(/\s*(.*)/);
 return m != null &amp;&amp; m.length &gt;= 1 ? m[1] : &quot;&quot;;  } '
 write '&quot;|[X(&quot;+tiddler.title+&quot;:ok)] |[[&quot;+tiddler.title+&quot;]]|&quot;+getFirstLine(tiddler.text)+&quot;|\n&quot;'
&gt;&gt;</pre>
</div>
<div title="TodoB" modifier="YourName" modified="200704132330" created="200704132329" tags="chkTodo chkList">
<pre>&lt;&lt;newJournal 'YYYY.MM.DD' label:&quot;新增生活事務&quot; focus:title tag:chkTodo xBB&gt;&gt;&lt;&lt;forEachTiddler
      where 'tiddler.tags.contains(&quot;xBB&quot;) &amp;&amp;
      tiddler.tags.contains(&quot;chkTodo&quot;) &amp;&amp;
      ! tiddler.tags.contains(&quot;ok&quot;)'
      sortBy 'tiddler.title'
 script 
 ' function getFirstLine(s) { var m = s.match(/\s*(.*)/); return m != null &amp;&amp; m.length &gt;= 1 ? m[1] : &quot;&quot;;  } '
 write '&quot;|[X(&quot;+tiddler.title+&quot;:ok)] |[[&quot;+tiddler.title+&quot;]]|&quot;+getFirstLine(tiddler.text)+&quot;|\n&quot;'
&gt;&gt;</pre>
</div>
<div title="TodoCheckList" modifier="fhopecc" modified="200808060714" created="200703011702" tags="chkList" changecount="21">
<pre>&lt;&lt;tabs chktravelThings
緊急事項 緊急事項 &quot;緊急事項&quot;
例行事項 例行事項 &quot;例行事項&quot;
重要事項 重要事項 &quot;重要事項&quot;
待辦事項 待辦事項 &quot;待辦事項&quot;
完成事項 完成事項 &quot;完成事項&quot;
&gt;&gt;</pre>
</div>
<div title="TravelC" modifier="YourName" modified="200704270539" created="200703020050" tags="chkPacking chkList">
<pre>&lt;&lt;newJournal 'YYYY.MM.DD' label:&quot;Adding Tea&quot; focus:title tag:chkPacking xCC&gt;&gt;&lt;&lt;forEachTiddler
      where 'tiddler.tags.contains(&quot;xCC&quot;) &amp;&amp;
      tiddler.tags.contains(&quot;chkPacking&quot;) &amp;&amp;
      ! tiddler.tags.contains(&quot;ok&quot;)'
      sortBy 'tiddler.title'
 script 
 ' function getFirstLine(s) { var m = s.match(/\s*(.*)/);
 return m != null &amp;&amp; m.length &gt;= 1 ? m[1] : &quot;&quot;;  } '
 write '&quot;|[X(&quot;+tiddler.title+&quot;:ok)] |[[&quot;+tiddler.title+&quot;]]|&quot;+getFirstLine(tiddler.text)+&quot;|\n&quot;'
&gt;&gt;</pre>
</div>
<div title="TravelD" modifier="fhopecc" modified="200808020205" created="200703020140" tags="chkPacking chkList" changecount="1">
<pre>&lt;&lt;newJournal 'YYYY.MM.DD' label:&quot;Adding IDs&quot; focus:title tag:chkPacking xDD&gt;&gt;&lt;&lt;forEachTiddler
      where 'tiddler.tags.contains(&quot;xDD&quot;) &amp;&amp;
      tiddler.tags.contains(&quot;chkPacking&quot;) &amp;&amp;
      ! tiddler.tags.contains(&quot;ok&quot;)'
      sortBy 'tiddler.title'
 script 
 ' function getFirstLine(s) { var m = s.match(/\s*(.*)/);
 return m != null &amp;&amp; m.length &gt;= 1 ? m[1] : &quot;&quot;;  } '
 write '&quot;|[X(&quot;+tiddler.title+&quot;:ok)] |[[&quot;+tiddler.title+&quot;]]|&quot;+getFirstLine(tiddler.text)+&quot;|\n&quot;'
&gt;&gt;</pre>
</div>
<div title="TravelE" modifier="YourName" modified="200704270547" created="200703020140" tags="chkPacking chkList">
<pre>&lt;&lt;newJournal 'YYYY.MM.DD' label:&quot;Adding Digitals&quot; focus:title tag:chkPacking xEE&gt;&gt;&lt;&lt;forEachTiddler
      where 'tiddler.tags.contains(&quot;xEE&quot;) &amp;&amp;
      tiddler.tags.contains(&quot;chkPacking&quot;) &amp;&amp;
      ! tiddler.tags.contains(&quot;ok&quot;)'
      sortBy 'tiddler.title'
 script 
 ' function getFirstLine(s) { var m = s.match(/\s*(.*)/);
 return m != null &amp;&amp; m.length &gt;= 1 ? m[1] : &quot;&quot;;  } '
 write '&quot;|[X(&quot;+tiddler.title+&quot;:ok)] |[[&quot;+tiddler.title+&quot;]]|&quot;+getFirstLine(tiddler.text)+&quot;|\n&quot;'
&gt;&gt;</pre>
</div>
<div title="UTF8" modifier="Fhopecc" modified="200709090734" created="200709090423" tags="ROR" changecount="3">
<pre>字符編碼方案是從一個或多個編碼字符集到一個或多個固定寬度代碼單元序列的映射。 最常用的代码单元是字节，但是 16 位或 32 位整数也可用于内部处理。最常用的代碼單元是字節，但是16位或32位整數也可用於內部處理。 UTF-32、UTF-16 和 UTF-8 是 Unicode 标准的编码字符集的字符编码方案。 UTF-32、UTF-16和UTF-8是Unicode標準的編碼字符集的字符編碼方案。

UTF-32 即将每一个 Unicode 代码点表示为相同值的 32 位整数。 UTF-32即將每一個Unicode代碼點表示為相同值的32位整數。 很明显，它是内部处理最方便的表达方式，但是，如果作为一般字符串表达方式，则要消耗更多的内存。很明顯，它是內部處理最方便的表達方式，但是，如果作為一般字符串表達方式，則要消耗更多的內存。

UTF-16 使用一个或两个未分配的 16 位代码单元的序列对 Unicode 代码点进行编码。 UTF-16使用一個或兩個未分配的16位代碼單元的序列對Unicode代碼點進行編碼。 值 U+0000 至 U+FFFF 编码为一个相同值的 16 位单元。值U+0000至U+FFFF編碼為一個相同值的16位單元。 增补字符编码为两个代码单元，第一个单元来自于高代理范围（U+D800 至 U+DBFF），第二个单元来自于低代理范围（U+DC00 至 U+DFFF）。增補字符編碼為兩個代碼單元，第一個單元來自於高代理範圍（U+D800至U+DBFF），第二個單元來自於低代理範圍（U+DC00至U+DFFF）。 这在概念上可能看起来类似于多字节编码，但是其中有一个重要区别：值 U+D800 至 U+DFFF 保留用于 UTF-16；没有这些值分配字符作为代码点。這在概念上可能看起來類似於多字節編碼，但是其中有一個重要區別：值U+D800至U+DFFF保留用於UTF-16；沒有這些值分配字符作為代碼點。 这意味着，对于一个字符串中的每个单独的代码单元，软件可以识别是否该代码单元表示某个单单元字符，或者是否该代码单元是某个双单元字符的第一个或第二单元。這意味著，對於一個字符串中的每個單獨的代碼單元，軟件可以識別是否該代碼單元表示某個單單元字符，或者是否該代碼單元是某個雙單元字符的第一個或第二單元。 这相当于某些传统的多字节字符编码来说是一个显著的改进，在传统的多字节字符编码中，字节值 0x41 既可能表示字母“A”，也可能是一个双字节字符的第二个字节。這相當於某些傳統的多字節字符編碼來說是一個顯著的改進，在傳統的多字節字符編碼中，字節值0x41既可能表示字母“A”，也可能是一個雙字節字符的第二個字節。

UTF-8 使用一至四个字节的序列对编码 Unicode 代码点进行编码。 UTF-8使用一至四個字節的序列對編碼Unicode代碼點進行編碼。 U+0000 至 U+007F 使用一个字节编码，U+0080 至 U+07FF 使用两个字节，U+0800 至 U+FFFF 使用三个字节，而 U+10000 至 U+10FFFF 使用四个字节。 U+0000至U+007F使用一個字節編碼，U+0080至U+07FF使用兩個字節，U+0800至U+FFFF使用三個字節，而U+10000至U+10FFFF使用四個字節。 UTF-8 设计原理为：字节值 0x00 至 0x7F 始终表示代码点 U+0000 至 U+007F（Basic Latin 字符子集，它对应 ASCII 字符集）。 UTF-8設計原理為：字節值0x00至0x7F始終表示代碼點U+0000至U+007F（Basic Latin字符子集，它對應ASCII字符集）。 这些字节值永远不会表示其他代码点，这一特性使 UTF-8 可以很方便地在软件中将特殊的含义赋予某些 ASCII 字符。這些字節值永遠不會表示其他代碼點，這一特性使UTF-8可以很方便地在軟件中將特殊的含義賦予某些ASCII字符。 

!!Parsing UTF-8 encoded strings in Ruby (See related posts)
Scala is The Next Thing. Where is Big Blue?
Instead of using $KCODE = 'UTF8' together with require 'jcode' you can use the /u regex parameter
to parse UTF-8 strings containing multibyte characters.

A Latin1 &lt;-&gt; UTF-8 conversion hack btw can be found here:
http://rubyforge.org/pipermail/fxruby-users/2005-September/000480.html

For comparison just drop the u option!
{{{
string = &quot;abc\303\244&quot;  #  \303\244 stands for ä

puts string.scan(/./u).size

puts string.split(//u).reverse.join

puts string.gsub(/.$/u, '')

regex = Regexp.new(/..../u)
md = regex.match(string)
puts md[0].inspect
}}}</pre>
</div>
<div title="Underwear" modifier="YourName" modified="200704270536" created="200703011649" tags="chkList chkPacking xBB">
<pre>5</pre>
</div>
<div title="WEB網路介面管理系統" modifier="fhopecc" modified="200708270239" created="200708270231">
<pre>''啟動 WEB Server''
# 請 op 開 2 個服務
# /usr/xum/java/startrpc.sh
# /usr/xum/www/resin/bin/httpd.sh start</pre>
</div>
<div title="WIN32OLE" modifier="fhopecc" modified="200710101352" created="200710101346" tags="Ruby" changecount="4">
<pre>~WIN32OLE 物件用來表示 ~ActiveX 物件。</pre>
</div>
<div title="Wallet" modifier="YourName" modified="200704270546" created="200703021042" tags="chkList chkPacking xDD">
<pre></pre>
</div>
<div title="Webmail 使用的理由" modifier="fhopecc" created="200807090644" changecount="1">
<pre>有鑑於本處因垃圾郵件中毒事件頻繁，且 Outlook Express 郵件資料夾具有 2GB 的容量限制，
使得郵件管理成本日益升高，
而Gmail 具有穩定的超大容量(7G)、市埸最強的垃圾信辨識及病毒掃描，
最重要的是完全免費，
可有效降低本處電郵使用成本，
故擬教育宣導使用 Gmail 讓同仁可以逐漸轉換至 Gmail 平台</pre>
</div>
<div title="Webmail 教學大綱" modifier="fhopecc" modified="200807030637" created="200807030629" tags="我的教學" changecount="3">
<pre>!Webmail 教學
#為何要使用 Webmail?
#收信
#寄信
#組織你的信件
#通訊錄
#過濾你的信件
</pre>
</div>
<div title="Wiki文字使用語法" modifier="fhopecc" modified="200710030042" created="200702090118" tags="如何使用wiki" changecount="3">
<pre>TiddlyWiki 支援各種的文字格式處理：
*在文字前後加上兩個單引號可以產生''粗體字''效果如下：
{{{
''粗體字''
}}}
*在文字前後加上兩個等號可以產生==刪除線==效果如下：
{{{
==加上刪除線==
}}}
*在文字前後加上兩個底線符號可以產生__底線文字__的效果如下：
{{{
__底線文字__
}}}
*在文字前後加上兩個斜線可以產生//斜體字//效果如下：
{{{
//斜體字//
}}}
*在文字前後加上兩個指數符號可以產生^^上標字^^效果如下：
{{{
^^上標字效果^^
}}}
*在文字前後加上兩個蝌蚪符號可以產生~~下標字~~效果如下：
{{{
~~下標字效果~~
}}}
*在文字前後加上兩個 at 符號，並使用 color(顏色代碼): ，可以替@@color(green):文字改變顏色@@，效果如下：
{{{
@@color(顏色代碼):文字@@
}}}
*同樣地，在文字前後加上兩個 at 符號，並使用 bgcolor(顏色代碼): ，可以替@@bgcolor(red):文字改變背景色@@，效果如下：
{{{
@@bgcolor(顏色代碼):文字@@
}}}
{{{
!Inline Formatting /% DEBUG: buggy (-&gt; monospaced) %/
|!Option|!Syntax|!Output|
|bold font|{{{''bold''}}}|''bold''|
|italic type|{{{//italic//}}}|//italic//|
|underlined text|{{{__underlined__}}}|__underlined__|
|strikethrough text|{{{--strikethrough--}}}|--strikethrough--|
|superscript text|{{{^^super^^script}}}|^^super^^script|
|subscript text|{{{~~sub~~script}}}|~~sub~~script|
|highlighted text|{{{@@highlighted@@}}}|@@highlighted@@|
|monospaced text|{{{{{{monospaced}}}}}}|{{{monospaced}}}|
!Block Elements
!!Headings
{{{
!Heading 1
!!Heading 2
!!!Heading 3
!!!!Heading 4
!!!!!Heading 5
}}}
&lt;&lt;&lt;
!Heading 1
!!Heading 2
!!!Heading 3
!!!!Heading 4
!!!!!Heading 5
&lt;&lt;&lt;
!!Lists
{{{
* unordered list, level 1
** unordered list, level 2
*** unordered list, level 3

# ordered list, level 1
## ordered list, level 2
### unordered list, level 3

; definition list, term
: definition list, description
}}}
&lt;&lt;&lt;
* unordered list, level 1
** unordered list, level 2
*** unordered list, level 3

# ordered list, level 1
## ordered list, level 2
### unordered list, level 3

; definition list, term
: definition list, description
&lt;&lt;&lt;
!!Blockquotes /% DEBUG: hack %/
{{{
&gt; blockquote, level 1
&gt;&gt; blockquote, level 2
&gt;&gt;&gt; blockquote, level 3

&lt;&lt;&lt;
blockquote
&lt;&lt;&lt;
}}}
&lt;&lt;&lt;
&gt; blockquote, level 1
&gt;&gt; blockquote, level 2
&gt;&gt;&gt; blockquote, level 3

&gt; blockquote
&lt;&lt;&lt;
!!Preformatted Text /% DEBUG: hack %/
{{{
 {{{
 preformatted (e.g. code)
 }}}
}}}
&lt;&lt;&lt;
{{{
preformatted (e.g. code)
}}}
&lt;&lt;&lt;
!!Tables
{{{
|CssClass|k
|!heading column 1|!heading column 2|
|row 1, column 1|row 1, column 2|
|row 2, column 1|row 2, column 2|
|&gt;|COLSPAN|
|ROWSPAN| … |
|~| … |
|CssProperty:value;…| … |
|caption|c
}}}
''Annotation:''
* The {{{&gt;}}} marker creates a &quot;colspan&quot;, causing the current cell to merge with the one to the right.
* The {{{~}}} marker creates a &quot;rowspan&quot;, causing the current cell to merge with the one above.
&lt;&lt;&lt;
|CssClass|k
|!heading column 1|!heading column 2|
|row 1, column 1|row 1, column 2|
|row 2, column 1|row 2, column 2|
|&gt;|COLSPAN|
|ROWSPAN| … |
|~| … |
|CssProperty:value;…| … |
|caption|c
&lt;&lt;&lt;
!!Images /% DEBUG: to do %/
cf. [[TiddlyWiki.com|http://www.tiddlywiki.com/#EmbeddedImages]]
!Hyperlinks
* [[WikiWords|WikiWord]] are automatically transformed to hyperlinks to the respective tiddler
** the automatic transformation can be suppressed by preceding the respective WikiWord with a tilde ({{{~}}}): {{{~WikiWord}}}
* [[PrettyLinks]] are enclosed in square brackets and contain the desired tiddler name: {{{[[tiddler name]]}}}
** optionally, a custom title or description can be added, separated by a pipe character ({{{|}}}): {{{[[title|target]]}}}&lt;br&gt;'''N.B.:''' In this case, the target can also be any website (i.e. URL).
!Custom Styling
* {{{@@CssProperty:value;CssProperty:value;…@@}}}&lt;br&gt;''N.B.:'' CSS color definitions should use lowercase letters to prevent the inadvertent creation of WikiWords.
* {{{{{customCssClass{…}}}}}} /% DEBUG: buggy %/
* raw HTML can be inserted by enclosing the respective code in HTML tags: {{{&lt;html&gt; … &lt;/html&gt;}}}
!Special Markers
* {{{&lt;br&gt;}}} forces a manual line break
* {{{----}}} creates a horizontal ruler
* [http://www.tiddlywiki.com/#HtmlEntities HTML entities]
* {{{&lt;&lt;macroName&gt;&gt;}}} calls the respective [[macro|Macros]]
* To hide text within a tiddler so that it is not displayed, it can be wrapped in {{{/%}}} and {{{%/}}}.&lt;br/&gt;This can be a useful trick for hiding drafts or annotating complex markup.
* To prevent wiki markup from taking effect for a particular section, that section can be enclosed in three double quotes: e.g. {{{&quot;&quot;&quot;WikiWord&quot;&quot;&quot;}}}.
}}}</pre>
</div>
<div title="Wiki文字格式語法" modifier="fhopecc" modified="200711251043" created="200702090118" tags="如何使用wiki" server.type="file" server.host="file://D:\sfhopecc\stwFhopecc\sfhopetw.htm.mine" server.page.revision="200711251043">
<pre>TiddlyWiki 支援各種的文字格式處理：
*在文字前後加上兩個單引號可以產生''粗體字''效果如下：
{{{
''粗體字''
}}}
*在文字前後加上兩個等號可以產生==刪除線==效果如下：
{{{
==加上刪除線==
}}}
*在文字前後加上兩個底線符號可以產生__底線文字__的效果如下：
{{{
__底線文字__
}}}
*在文字前後加上兩個斜線可以產生//斜體字//效果如下：
{{{
//斜體字//
}}}
*在文字前後加上兩個指數符號可以產生^^上標字^^效果如下：
{{{
^^上標字效果^^
}}}
*在文字前後加上兩個蝌蚪符號可以產生~~下標字~~效果如下：
{{{
~~下標字效果~~
}}}
*在文字前後加上兩個 at 符號，並使用 color(顏色代碼): ，可以替@@color(green):文字改變顏色@@，效果如下：
{{{
@@color(顏色代碼):文字@@
}}}
*同樣地，在文字前後加上兩個 at 符號，並使用 bgcolor(顏色代碼): ，可以替@@bgcolor(red):文字改變背景色@@，效果如下：
{{{
@@bgcolor(顏色代碼):文字@@
}}}
{{{
!Inline Formatting /% DEBUG: buggy (-&gt; monospaced) %/
|!Option|!Syntax|!Output|
|bold font|{{{''bold''}}}|''bold''|
|italic type|{{{//italic//}}}|//italic//|
|underlined text|{{{__underlined__}}}|__underlined__|
|strikethrough text|{{{--strikethrough--}}}|--strikethrough--|
|superscript text|{{{^^super^^script}}}|^^super^^script|
|subscript text|{{{~~sub~~script}}}|~~sub~~script|
|highlighted text|{{{@@highlighted@@}}}|@@highlighted@@|
|monospaced text|{{{{{{monospaced}}}}}}|{{{monospaced}}}|
!Block Elements
!!Headings
{{{
!Heading 1
!!Heading 2
!!!Heading 3
!!!!Heading 4
!!!!!Heading 5
}}}
&lt;&lt;&lt;
!Heading 1
!!Heading 2
!!!Heading 3
!!!!Heading 4
!!!!!Heading 5
&lt;&lt;&lt;
!!Lists
{{{
* unordered list, level 1
** unordered list, level 2
*** unordered list, level 3

# ordered list, level 1
## ordered list, level 2
### unordered list, level 3

; definition list, term
: definition list, description
}}}
&lt;&lt;&lt;
* unordered list, level 1
** unordered list, level 2
*** unordered list, level 3

# ordered list, level 1
## ordered list, level 2
### unordered list, level 3

; definition list, term
: definition list, description
&lt;&lt;&lt;
!!Blockquotes /% DEBUG: hack %/
{{{
&gt; blockquote, level 1
&gt;&gt; blockquote, level 2
&gt;&gt;&gt; blockquote, level 3

&lt;&lt;&lt;
blockquote
&lt;&lt;&lt;
}}}
&lt;&lt;&lt;
&gt; blockquote, level 1
&gt;&gt; blockquote, level 2
&gt;&gt;&gt; blockquote, level 3

&gt; blockquote
&lt;&lt;&lt;
!!Preformatted Text /% DEBUG: hack %/
{{{
 {{{
 preformatted (e.g. code)
 }}}
}}}
&lt;&lt;&lt;
{{{
preformatted (e.g. code)
}}}
&lt;&lt;&lt;
!!Tables
{{{
|CssClass|k
|!heading column 1|!heading column 2|
|row 1, column 1|row 1, column 2|
|row 2, column 1|row 2, column 2|
|&gt;|COLSPAN|
|ROWSPAN| … |
|~| … |
|CssProperty:value;…| … |
|caption|c
}}}
''Annotation:''
* The {{{&gt;}}} marker creates a &quot;colspan&quot;, causing the current cell to merge with the one to the right.
* The {{{~}}} marker creates a &quot;rowspan&quot;, causing the current cell to merge with the one above.
&lt;&lt;&lt;
|CssClass|k
|!heading column 1|!heading column 2|
|row 1, column 1|row 1, column 2|
|row 2, column 1|row 2, column 2|
|&gt;|COLSPAN|
|ROWSPAN| … |
|~| … |
|CssProperty:value;…| … |
|caption|c
&lt;&lt;&lt;
!!Images /% DEBUG: to do %/
cf. [[TiddlyWiki.com|http://www.tiddlywiki.com/#EmbeddedImages]]
!Hyperlinks
* [[WikiWords|WikiWord]] are automatically transformed to hyperlinks to the respective tiddler
** the automatic transformation can be suppressed by preceding the respective WikiWord with a tilde ({{{~}}}): {{{~WikiWord}}}
* [[PrettyLinks]] are enclosed in square brackets and contain the desired tiddler name: {{{[[tiddler name]]}}}
** optionally, a custom title or description can be added, separated by a pipe character ({{{|}}}): {{{[[title|target]]}}}&lt;br&gt;'''N.B.:''' In this case, the target can also be any website (i.e. URL).
!Custom Styling
* {{{@@CssProperty:value;CssProperty:value;…@@}}}&lt;br&gt;''N.B.:'' CSS color definitions should use lowercase letters to prevent the inadvertent creation of WikiWords.
* {{{{{customCssClass{…}}}}}} /% DEBUG: buggy %/
* raw HTML can be inserted by enclosing the respective code in HTML tags: {{{&lt;html&gt; … &lt;/html&gt;}}}
!Special Markers
* {{{&lt;br&gt;}}} forces a manual line break
* {{{----}}} creates a horizontal ruler
* [http://www.tiddlywiki.com/#HtmlEntities HTML entities]
* {{{&lt;&lt;macroName&gt;&gt;}}} calls the respective [[macro|Macros]]
* To hide text within a tiddler so that it is not displayed, it can be wrapped in {{{/%}}} and {{{%/}}}.&lt;br/&gt;This can be a useful trick for hiding drafts or annotating complex markup.
* To prevent wiki markup from taking effect for a particular section, that section can be enclosed in three double quotes: e.g. {{{&quot;&quot;&quot;WikiWord&quot;&quot;&quot;}}}.
}}}</pre>
</div>
<div title="XPCOM" modifier="fhopecc" created="200801290211" tags="XPCOM" changecount="1">
<pre>XPCOM 旨在提供一個''平台及語言中立''的元件環境</pre>
</div>
<div title="XUL URL Format" modifier="fhopecc" modified="200801300158" created="200801290711" tags="XUL Mozilla" changecount="6">
<pre>{{{chrome://&lt;package name&gt;/&lt;part&gt;/&lt;file.xul&gt;}}}</pre>
</div>
<div title="XULOverlay" modifier="fhopecc" created="200802010229" tags="XUL" changecount="1">
<pre>XUL Overlay 是用來把Extension 的元件，掛到即有的架構上的技術。</pre>
</div>
<div title="Xbox" modifier="fhopecc" created="200810020212" tags="公文系統" changecount="1">
<pre>shutdown/GBCShutdowN!</pre>
</div>
<div title="YCM服務" modifier="fhopecc" modified="200710020255" created="200710020234" tags="批次作業管理系統" changecount="6">
<pre>!啟動服務
在批次作業主機(本處是AP1)，需要啟動YCM服務。
以 apsvr 登入執行下面的 script。
{{{
bash-3.00$ /elt/eltapp/bin/ycm/ycmjd_startup.sh
}}}
!檢查服務啟動
以下述指令看 YCMJobDaemon 是否存在，且其執行身份要為 apsvr
{{{
bash-3.00$ ps -ef | grep YCM
ccl00695  471062 1056780   0 10:38:04  pts/0  0:00 grep YCM
   apsvr  979170       1   0 10:10:06      -  0:04 java -Xmx512m -Dlog4j.configuration=file:/elt/eltapp/conf/log4j.conf com.acer.batch.YCMJobDaemon
bash-3.00$
}}}
!停止服務
kill YCMJobDaemon
上例為
{{{
kill 979170
}}}</pre>
</div>
<div title="YHQ 程式館測試報告" modifier="fhopecc" created="200808040216" tags="重要事項 YHQ" changecount="1">
<pre></pre>
</div>
<div title="YRM" modifier="fhopecc" created="200711220027" tags="地方稅系統" changecount="2">
<pre>|YRM|機時系統|
|馬穗英|#4310|
|宏碁|林志偉| #1071#1072 |
|游惟任|#2335|
</pre>
</div>
<div title="YRM佔資源過多問題" modifier="fhopecc" modified="200805150104" created="200804170632" tags="YRM 待辦事項 完成事項" changecount="3">
<pre>YRM所佔資源過多，須於開會時報告。</pre>
</div>
<div title="_form.rhtml" modifier="fhopecc" created="200806210203" tags="HIS專案" changecount="1">
<pre>!負責功能
#指定此節包含的欄位及繪出的順序</pre>
</div>
<div title="assignment" modifier="Fhopecc" created="200709220213" tags="Ruby" changecount="1">
<pre>= 可以串接起來。
{{{
a = b = c = 0  » 0  
}}}</pre>
</div>
<div title="association in activerecord" modifier="fhopecc" modified="200709190151" created="200709190134" tags="ROR" changecount="8">
<pre>利用外鍵串連兩個表格。
&lt;&lt;tiddler 'belongs_to association'&gt;&gt;</pre>
</div>
<div title="batchlog回復功能" modifier="fhopecc" modified="200806110046" created="200806090346" tags="完成事項" changecount="2">
<pre></pre>
</div>
<div title="batchlog檢核表要加備份月" modifier="fhopecc" modified="200806110246" created="200806090345" tags="完成事項" changecount="3">
<pre></pre>
</div>
<div title="belongs_to association" modifier="fhopecc" created="200709190149" tags="ROR" changecount="1">
<pre>!belongs_to
{{{
  class User &lt; ActiveRecord::Base
    # I reference an account.
    belongs_to :account
  end

  class Account &lt; ActiveRecord::Base
    # One user references me.
    has_one :user
  end
}}}</pre>
</div>
<div title="calendarPlugin" modifier="fhopecc" modified="200709280121" created="200709170035" tags="systemConfig" changecount="3">
<pre>/***
|Name|CalendarPlugin|
|Source|http://www.TiddlyTools.com/#CalendarPlugin|
|Version|0.0.0|
|Author|SteveRumsby|
|License|unknown|
|~CoreVersion|2.1|
|Type|plugin|
|Requires||
|Overrides||
|Description|monthly and yearly calendars|

// // updated by Jeremy Sheeley to add cacheing for reminders
// // see http://www.geocities.com/allredfaq/reminderMacros.html
// // ''Changes by ELS 2006.08.23:''
// // added handling for weeknumbers (code supplied by Martin Budden.  see &quot;wn**&quot; comment marks)
// // ''Changes by ELS 2005.10.30:''
// // config.macros.calendar.handler()
// // ^^use &quot;tbody&quot; element for IE compatibility^^
// // ^^IE returns 2005 for current year, FF returns 105... fix year adjustment accordingly^^
// // createCalendarDays()
// // ^^use showDate() function (if defined) to render autostyled date with linked popup^^
// // calendar stylesheet definition
// // ^^use .calendar class-specific selectors, add text centering and margin settings^^


!!!!!Configuration:
&lt;&lt;option chkDisplayWeekNumbers&gt;&gt; Display week numbers //(note: Monday will be used as the start of the week)//
|''First day of week:''|&lt;&lt;option txtCalFirstDay&gt;&gt;|(Monday = 0, Sunday = 6)|
|''First day of weekend:''|&lt;&lt;option txtCalStartOfWeekend&gt;&gt;|(Monday = 0, Sunday = 6)|

!!!!!Syntax:
|{{{&lt;&lt;calendar&gt;&gt;}}}|Produce a full-year calendar for the current year|
|{{{&lt;&lt;calendar year&gt;&gt;}}}|Produce a full-year calendar for the given year|
|{{{&lt;&lt;calendar year month&gt;&gt;}}}|Produce a one-month calendar for the given month and year|
|{{{&lt;&lt;calendar thismonth&gt;&gt;}}}|Produce a one-month calendar for the current month|
|{{{&lt;&lt;calendar lastmonth&gt;&gt;}}}|Produce a one-month calendar for last month|
|{{{&lt;&lt;calendar nextmonth&gt;&gt;}}}|Produce a one-month calendar for next month|

***/
// //Modify this section to change the text displayed for the month and day names, to a different language for example. You can also change the format of the tiddler names linked to from each date, and the colours used.

//{{{
config.macros.calendar = {};

config.macros.calendar.monthnames = [&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;];
config.macros.calendar.daynames = [&quot;M&quot;, &quot;T&quot;, &quot;W&quot;, &quot;T&quot;, &quot;F&quot;, &quot;S&quot;, &quot;S&quot;];

config.macros.calendar.weekendbg = &quot;#c0c0c0&quot;;
config.macros.calendar.monthbg = &quot;#e0e0e0&quot;;
config.macros.calendar.holidaybg = &quot;#ffc0c0&quot;;

//}}}
// //''Code section:''
// (you should not need to alter anything below here)//
//{{{
if(config.options.txtCalFirstDay == undefined)
  config.options.txtCalFirstDay = 0;
if(config.options.txtCalStartOfWeekend == undefined)
  config.options.txtCalStartOfWeekend = 5;
if(config.options.chkDisplayWeekNumbers == undefined)//wn**
  config.options.chkDisplayWeekNumbers = false;
if(config.options.chkDisplayWeekNumbers)
  config.options.txtCalFirstDay = 0;

config.macros.calendar.tiddlerformat = &quot;0DD/0MM/YYYY&quot;;  // This used to be changeable - for now, it isn't// &lt;&lt;smiley :-(&gt;&gt; 

version.extensions.calendar = { major: 0, minor: 6, revision: 0, date: new Date(2006, 1, 22)};
config.macros.calendar.monthdays = [ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

config.macros.calendar.holidays = [ ]; // Not sure this is required anymore - use reminders instead
//}}}

// //Is the given date a holiday?
//{{{
function calendarIsHoliday(date)
{
 var longHoliday = date.formatString(&quot;0DD/0MM/YYYY&quot;);
 var shortHoliday = date.formatString(&quot;0DD/0MM&quot;);

 for(var i = 0; i &lt; config.macros.calendar.holidays.length; i++) {
   if(config.macros.calendar.holidays[i] == longHoliday || config.macros.calendar.holidays[i] == shortHoliday) {
     return true;
   }
 }
 return false;
}
//}}}

// //The main entry point - the macro handler.
// //Decide what sort of calendar we are creating (month or year, and which month or year)
// // Create the main calendar container and pass that to sub-ordinate functions to create the structure.
// ELS 2005.10.30: added creation and use of &quot;tbody&quot; for IE compatibility and fixup for year &gt;1900//
// ELS 2005.10.30: fix year calculation for IE's getYear() function (which returns '2005' instead of '105')//
// ELS 2006.05.29: add journalDateFmt handling//
//{{{
config.macros.calendar.handler = function(place,macroName,params)
{
   var calendar = createTiddlyElement(place, &quot;table&quot;, null, &quot;calendar&quot;, null);
   var tbody = createTiddlyElement(calendar, &quot;tbody&quot;, null, null, null);
   var today = new Date();
   var year = today.getYear();
   if (year&lt;1900) year+=1900;
 
   // get format for journal link by reading from SideBarOptions (ELS 5/29/06 - based on suggestion by Martin Budden)
   var text = store.getTiddlerText(&quot;SideBarOptions&quot;);
   this.journalDateFmt = &quot;DD-MMM-YYYY&quot;;
   var re = new RegExp(&quot;&lt;&lt;(?:newJournal)([^&gt;]*)&gt;&gt;&quot;,&quot;mg&quot;); var fm = re.exec(text);
   if (fm &amp;&amp; fm[1]!=null) { var pa=fm[1].readMacroParams(); if (pa[0]) this.journalDateFmt = pa[0]; }

   if (params[0] == &quot;thismonth&quot;)
  {
      cacheReminders(new Date(year, today.getMonth(), 1, 0, 0), 31);
      createCalendarOneMonth(tbody, year, today.getMonth());
  } 
  else if (params[0] == &quot;lastmonth&quot;) {
      var month = today.getMonth()-1; if (month==-1) { month=11; year--; }
      cacheReminders(new Date(year, month, 1, 0, 0), 31);
      createCalendarOneMonth(tbody, year, month);
   }
   else if (params[0] == &quot;nextmonth&quot;) {
      var month = today.getMonth()+1; if (month&gt;11) { month=0; year++; }
      cacheReminders(new Date(year, month, 1, 0, 0), 31);
      createCalendarOneMonth(tbody, year, month);
   }
   else {
      if (params[0]) year = params[0];
      if(params[1])
      {
         cacheReminders(new Date(year, params[1]-1, 1, 0, 0), 31);
         createCalendarOneMonth(tbody, year, params[1]-1);
      }
      else
      {
         cacheReminders(new Date(year, 0, 1, 0, 0), 366);
         createCalendarYear(tbody, year);
      }
   }
  window.reminderCacheForCalendar = null;
}
//}}}
//{{{
//This global variable is used to store reminders that have been cached
//while the calendar is being rendered.  It will be renulled after the calendar is fully rendered.
window.reminderCacheForCalendar = null;
//}}}
//{{{
function cacheReminders(date, leadtime)
{
  if (window.findTiddlersWithReminders == null)
    return;
  window.reminderCacheForCalendar = {};
  var leadtimeHash = [];
  leadtimeHash [0] = 0;
  leadtimeHash [1] = leadtime;
  var t = findTiddlersWithReminders(date, leadtimeHash, null, 1);
  for(var i = 0; i &lt; t.length; i++) {
    //just tag it in the cache, so that when we're drawing days, we can bold this one.
     window.reminderCacheForCalendar[t[i][&quot;matchedDate&quot;]] = &quot;reminder:&quot; + t[i][&quot;params&quot;][&quot;title&quot;]; 
  }
}
//}}}
//{{{
function createCalendarOneMonth(calendar, year, mon)
{
  var row = createTiddlyElement(calendar, &quot;tr&quot;, null, null, null);
  createCalendarMonthHeader(calendar, row, config.macros.calendar.monthnames[mon] + &quot; &quot; + year, true, year, mon);
  row = createTiddlyElement(calendar, &quot;tr&quot;, null, null, null);
  createCalendarDayHeader(row, 1);
  createCalendarDayRowsSingle(calendar, year, mon);
}
//}}}

//{{{
function createCalendarMonth(calendar, year, mon)
{
  var row = createTiddlyElement(calendar, &quot;tr&quot;, null, null, null);
  createCalendarMonthHeader(calendar, row, config.macros.calendar.monthnames[mon] + &quot; &quot; + year, false, year, mon);
  row = createTiddlyElement(calendar, &quot;tr&quot;, null, null, null);
  createCalendarDayHeader(row, 1);
  createCalendarDayRowsSingle(calendar, year, mon);
}
//}}}

//{{{
function createCalendarYear(calendar, year)
{
  var row;
  row = createTiddlyElement(calendar, &quot;tr&quot;, null, null, null);
  var back = createTiddlyElement(row, &quot;td&quot;, null, null, null);
  var backHandler = function() {
      removeChildren(calendar);
      createCalendarYear(calendar, year-1);
    };
  createTiddlyButton(back, &quot;&lt;&quot;, &quot;Previous year&quot;, backHandler);
  back.align = &quot;center&quot;;

  var yearHeader = createTiddlyElement(row, &quot;td&quot;, null, &quot;calendarYear&quot;, year);
  yearHeader.align = &quot;center&quot;;
  //yearHeader.setAttribute(&quot;colSpan&quot;, 19);
  yearHeader.setAttribute(&quot;colSpan&quot;,config.options.chkDisplayWeekNumbers?22:19);//wn**

  var fwd = createTiddlyElement(row, &quot;td&quot;, null, null, null);
  var fwdHandler = function() {
    removeChildren(calendar);
    createCalendarYear(calendar, year+1);
  };
  createTiddlyButton(fwd, &quot;&gt;&quot;, &quot;Next year&quot;, fwdHandler);
  fwd.align = &quot;center&quot;;

  createCalendarMonthRow(calendar, year, 0);
  createCalendarMonthRow(calendar, year, 3);
  createCalendarMonthRow(calendar, year, 6);
  createCalendarMonthRow(calendar, year, 9);
}
//}}}

//{{{
function createCalendarMonthRow(cal, year, mon)
{
  var row = createTiddlyElement(cal, &quot;tr&quot;, null, null, null);
  createCalendarMonthHeader(cal, row, config.macros.calendar.monthnames[mon], false, year, mon);
  createCalendarMonthHeader(cal, row, config.macros.calendar.monthnames[mon+1], false, year, mon);
  createCalendarMonthHeader(cal, row, config.macros.calendar.monthnames[mon+2], false, year, mon);
  row = createTiddlyElement(cal, &quot;tr&quot;, null, null, null);
  createCalendarDayHeader(row, 3);
  createCalendarDayRows(cal, year, mon);
}
//}}}

//{{{
function createCalendarMonthHeader(cal, row, name, nav, year, mon)
{
  var month;
  if(nav) {
    var back = createTiddlyElement(row, &quot;td&quot;, null, null, null);
    back.align = &quot;center&quot;;
    back.style.background = config.macros.calendar.monthbg;

/*
    back.setAttribute(&quot;colSpan&quot;, 2);

    var backYearHandler = function() {
      var newyear = year-1;
      removeChildren(cal);
      cacheReminders(new Date(newyear, mon , 1, 0, 0), 31);
      createCalendarOneMonth(cal, newyear, mon);
    };
    createTiddlyButton(back, &quot;&lt;&lt;&quot;, &quot;Previous year&quot;, backYearHandler);
*/
    var backMonHandler = function() {
      var newyear = year;
      var newmon = mon-1;
      if(newmon == -1) { newmon = 11; newyear = newyear-1;}
      removeChildren(cal);
      cacheReminders(new Date(newyear, newmon , 1, 0, 0), 31);
      createCalendarOneMonth(cal, newyear, newmon);
    };
    createTiddlyButton(back, &quot;&lt;&quot;, &quot;Previous month&quot;, backMonHandler);


    month = createTiddlyElement(row, &quot;td&quot;, null, &quot;calendarMonthname&quot;, name)
//    month.setAttribute(&quot;colSpan&quot;, 3);
//    month.setAttribute(&quot;colSpan&quot;, 5);
    month.setAttribute(&quot;colSpan&quot;, config.options.chkDisplayWeekNumbers?6:5);//wn**

    var fwd = createTiddlyElement(row, &quot;td&quot;, null, null, null);
    fwd.align = &quot;center&quot;;
    fwd.style.background = config.macros.calendar.monthbg; 

//    fwd.setAttribute(&quot;colSpan&quot;, 2);
    var fwdMonHandler = function() {
      var newyear = year;
      var newmon = mon+1;
      if(newmon == 12) { newmon = 0; newyear = newyear+1;}
      removeChildren(cal);
      cacheReminders(new Date(newyear, newmon , 1, 0, 0), 31);
      createCalendarOneMonth(cal, newyear, newmon);
    };
    createTiddlyButton(fwd, &quot;&gt;&quot;, &quot;Next month&quot;, fwdMonHandler);
/*
    var fwdYear = createTiddlyElement(row, &quot;td&quot;, null, null, null);
    var fwdYearHandler = function() {
      var newyear = year+1;
      removeChildren(cal);
      cacheReminders(new Date(newyear, mon , 1, 0, 0), 31);
      createCalendarOneMonth(cal, newyear, mon);
    };
    createTiddlyButton(fwd, &quot;&gt;&gt;&quot;, &quot;Next year&quot;, fwdYearHandler);
*/
  } else {
    month = createTiddlyElement(row, &quot;td&quot;, null, &quot;calendarMonthname&quot;, name)
    //month.setAttribute(&quot;colSpan&quot;, 7);
    month.setAttribute(&quot;colSpan&quot;,config.options.chkDisplayWeekNumbers?8:7);//wn**
  }
  month.align = &quot;center&quot;;
  month.style.background = config.macros.calendar.monthbg;
}
//}}}

//{{{
function createCalendarDayHeader(row, num)
{
  var cell;
  for(var i = 0; i &lt; num; i++) {
    if (config.options.chkDisplayWeekNumbers) createTiddlyElement(row, &quot;td&quot;);//wn**
    for(var j = 0; j &lt; 7; j++) {
      var d = j + (config.options.txtCalFirstDay - 0);
      if(d &gt; 6) d = d - 7;
      cell = createTiddlyElement(row, &quot;td&quot;, null, null, config.macros.calendar.daynames[d]);
      if(d == (config.options.txtCalStartOfWeekend-0) || d == (config.options.txtCalStartOfWeekend-0+1))
        cell.style.background = config.macros.calendar.weekendbg;
    }
  }
}
//}}}

//{{{
function createCalendarDays(row, col, first, max, year, mon)
{
  var i;
  if (config.options.chkDisplayWeekNumbers){
    if (first&lt;=max) {
      var ww = new Date(year,mon,first);
      createTiddlyElement(row, &quot;td&quot;, null, null, &quot;w&quot;+ww.getWeek());//wn**
    }
    else createTiddlyElement(row, &quot;td&quot;, null, null, null);//wn**
  }
  for(i = 0; i &lt; col; i++) {
    createTiddlyElement(row, &quot;td&quot;, null, null, null);
  }
  var day = first;
  for(i = col; i &lt; 7; i++) {
    var d = i + (config.options.txtCalFirstDay - 0);
    if(d &gt; 6) d = d - 7;
    var daycell = createTiddlyElement(row, &quot;td&quot;, null, null, null);
    var isaWeekend = ((d == (config.options.txtCalStartOfWeekend-0) || d == (config.options.txtCalStartOfWeekend-0+1))? true:false);

    if(day &gt; 0 &amp;&amp; day &lt;= max) {
      var celldate = new Date(year, mon, day);
      // ELS 2005.10.30: use &lt;&lt;date&gt;&gt; macro's showDate() function to create popup
      if (window.showDate) {
        showDate(daycell,celldate,&quot;popup&quot;,&quot;DD&quot;,config.macros.calendar.journalDateFmt,true, isaWeekend); // ELS 5/29/06 - use journalDateFmt 
      } else {
        if(isaWeekend) daycell.style.background = config.macros.calendar.weekendbg;
        var title = celldate.formatString(config.macros.calendar.tiddlerformat);
        if(calendarIsHoliday(celldate)) {
          daycell.style.background = config.macros.calendar.holidaybg;
        }
        if(window.findTiddlersWithReminders == null) {
          var link = createTiddlyLink(daycell, title, false);
          link.appendChild(document.createTextNode(day));
        } else {
          var button = createTiddlyButton(daycell, day, title, onClickCalendarDate);
        }
      }
    }
    day++;
  }
}
//}}}

// //We've clicked on a day in a calendar - create a suitable pop-up of options.
// //The pop-up should contain:
// // * a link to create a new entry for that date
// // * a link to create a new reminder for that date
// // * an &lt;hr&gt;
// // * the list of reminders for that date
//{{{
function onClickCalendarDate(e)
{
  var button = this;
  var date = button.getAttribute(&quot;title&quot;);
  var dat = new Date(date.substr(6,4), date.substr(3,2)-1, date.substr(0, 2));

  date = dat.formatString(config.macros.calendar.tiddlerformat);
  var popup = createTiddlerPopup(this);
  popup.appendChild(document.createTextNode(date));
  var newReminder = function() {
    var t = store.getTiddlers(date);
    displayTiddler(null, date, 2, null, null, false, false);
    if(t) {
      document.getElementById(&quot;editorBody&quot; + date).value += &quot;\n&lt;&lt;reminder day:&quot; + dat.getDate() +
                                                                                         &quot; month:&quot; + (dat.getMonth()+1) +
                                                                                         &quot; year:&quot; + (dat.getYear()+1900) + &quot; title: &gt;&gt;&quot;;
    } else {
      document.getElementById(&quot;editorBody&quot; + date).value = &quot;&lt;&lt;reminder day:&quot; + dat.getDate() +
                                                                                       &quot; month:&quot; + (dat.getMonth()+1) +
                                                                                       &quot; year:&quot; + (dat.getYear()+1900) + &quot; title: &gt;&gt;&quot;;
    }
  };
  var link = createTiddlyButton(popup, &quot;New reminder&quot;, null, newReminder); 
  popup.appendChild(document.createElement(&quot;hr&quot;));

  var t = findTiddlersWithReminders(dat, [0,14], null, 1);
  for(var i = 0; i &lt; t.length; i++) {
    link = createTiddlyLink(popup, t[i].tiddler, false);
    link.appendChild(document.createTextNode(t[i].tiddler));
  }
}
//}}}

//{{{
function calendarMaxDays(year, mon)
{
 var max = config.macros.calendar.monthdays[mon];
 if(mon == 1 &amp;&amp; (year % 4) == 0 &amp;&amp; ((year % 100) != 0 || (year % 400) == 0)) {
 max++;
 }
 return max;
}
//}}}

//{{{
function createCalendarDayRows(cal, year, mon)
{
 var row = createTiddlyElement(cal, &quot;tr&quot;, null, null, null);

 var first1 = (new Date(year, mon, 1)).getDay() -1 - (config.options.txtCalFirstDay-0);
 if(first1 &lt; 0) first1 = first1 + 7;
 var day1 = -first1 + 1;
 var first2 = (new Date(year, mon+1, 1)).getDay() -1 - (config.options.txtCalFirstDay-0);
 if(first2 &lt; 0) first2 = first2 + 7;
 var day2 = -first2 + 1;
 var first3 = (new Date(year, mon+2, 1)).getDay() -1 - (config.options.txtCalFirstDay-0);
 if(first3 &lt; 0) first3 = first3 + 7;
 var day3 = -first3 + 1;

 var max1 = calendarMaxDays(year, mon);
 var max2 = calendarMaxDays(year, mon+1);
 var max3 = calendarMaxDays(year, mon+2);

 while(day1 &lt;= max1 || day2 &lt;= max2 || day3 &lt;= max3) {
 row = createTiddlyElement(cal, &quot;tr&quot;, null, null, null);
 createCalendarDays(row, 0, day1, max1, year, mon); day1 += 7;
 createCalendarDays(row, 0, day2, max2, year, mon+1); day2 += 7;
 createCalendarDays(row, 0, day3, max3, year, mon+2); day3 += 7;
 }
}
//}}}

//{{{
function createCalendarDayRowsSingle(cal, year, mon)
{
 var row = createTiddlyElement(cal, &quot;tr&quot;, null, null, null);

 var first1 = (new Date(year, mon, 1)).getDay() -1 - (config.options.txtCalFirstDay-0);
 if(first1 &lt; 0) first1 = first1+ 7;
 var day1 = -first1 + 1;
 var max1 = calendarMaxDays(year, mon);

 while(day1 &lt;= max1) {
 row = createTiddlyElement(cal, &quot;tr&quot;, null, null, null);
 createCalendarDays(row, 0, day1, max1, year, mon); day1 += 7;
 }
}
//}}}

// //ELS 2005.10.30: added styles
//{{{
setStylesheet(&quot;.calendar, .calendar table, .calendar th, .calendar tr, .calendar td { text-align:center; } .calendar, .calendar a { margin:0px !important; padding:0px !important; }&quot;, &quot;calendarStyles&quot;);
//}}}
</pre>
</div>
<div title="case statement" modifier="Fhopecc" created="200709160230" tags="Ruby" changecount="1">
<pre>{{{
case inputLine

  when &quot;debug&quot;
    dumpDebugInfo
    dumpSymbols

  when /p\s+(\w+)/
    dumpVariable($1)

  when &quot;quit&quot;, &quot;exit&quot;
    exit

  else
    print &quot;Illegal command: #{inputLine}&quot;
end
}}}</pre>
</div>
<div title="class &lt;&lt; self" modifier="fhopecc" modified="200711210124" created="200710270634" tags="Ruby" changecount="5">
<pre>&gt; That, to me, is obfuscated.  'self' is generally understood as the current
&gt; instance of the class.  

Yes.

&gt; Therefore, it is only meaningful inside instance methods.  

Well, not really.  Self is available anytime there is a &quot;current
instance&quot; active ... which is all the time in Ruby.

At the top level, self refers to the &quot;main&quot; object ...

   traken$ irb
   irb(main):001:0&gt; self
   main

Inside a class definition, the current instance is the class itself! 
That is why attr_reader (and its friends) work.  Bare code (i.e. anyting
not inside a method definition) is live code that is executed.  What is
the object that handles method calls inside a class?   It is the class
object.  So the current instance inside a class definition is the
instance of the Class object being defined, in other words ... self.

This is what allows things like &quot;attr_reader&quot; to work.  attr_reader is a
method defined in the class object.  For example the following code ...

  class A
    attr_reader :prop
  end

is equivalent to ...

  class A
    self.attr_reader :prop
  end

(except that attr_reader is private and so won't work with an explicit
target.  You can fix this with: class Module; public :attr_reader; end)

If self didn't refer to the class instance, the call to the attr_reader
method wouldn't work.

&gt; There's a yawning gulf between syntax and semantics, and I suggest that it's
&gt; taking advantage of an undocumented feature.

Actually, you can argue that there is the syntax and semantics are
*tightly* coupled.  Knowing what &quot;class &lt;&lt; obj&quot; means and knowing that
inside a class, self is the current class instance, directly leads to
the meaning of &quot;class &lt;&lt; self&quot;.</pre>
</div>
<div title="class variable 和 flyweight pattern" modifier="fhopecc" modified="200711190842" created="200711181441" tags="Ruby" changecount="3">
<pre></pre>
</div>
<div title="digiclockPlugin" modifier="fhopecc" modified="200804090843" created="200710030441" tags="systemConfig" changecount="40">
<pre>//{{
var digiclockplace = 0;
function printClock() {
       t = new Date();
       timestring = t.getHours() + ':' + t.getMinutes() + ':' + t.getSeconds()
       digiclock = document.getElementById('digiclock')
       digiclock.innerHTML=timestring
}

 config.macros.digiclock = {
   handler: function (place, macroName, params, wikifier, paramString, tiddler)
   { 
     this.startClock(place)    
   }, 
   startClock: function(place) {
       t = new Date();
       timestring = t.toTimeString();
      var timespan = createTiddlyElement(place,&quot;span&quot;,&quot;digiclock&quot;,&quot;digiclock&quot;,timestring); 
      setInterval('printClock()', 1000)
   }
 };
//}}</pre>
</div>
<div title="e-網通連線管理" modifier="fhopecc" modified="200711010239" created="200710020208" tags="稅捐處業務 XDQ" changecount="5">
<pre>|系統代碼|XDQ|
|系統負責人|李兆宣|(02)27631833#4342|
|工程師|吳家政|(02)27631833#1072|
|工程師|楊政達|(02)27631833#1072|
|工程師|楊政達|(02)27631833#1069|
!常見問題
[[FAQ.doc:file]]
![[新增開機注意事項：啟動 XDQ 服務]]</pre>
</div>
<div title="elt/shared_tmp/log/batchlog/*備出記錄檔" modifier="fhopecc" created="200709190225" tags="資通安全" changecount="2">
<pre>|!執行月份|!資料月份|!存放地點|</pre>
</div>
<div title="find" modifier="fhopecc" modified="200803060235" created="200712100558" tags="unix" changecount="4">
<pre>!語法
{{{find [ -H | -L ] Path ... [ Expression ]}}}
find 會遞降的搜尋 {{{Path}}} 所指定的目錄樹，
並找出所有檔案符合{{{Expression}}}條件。
所謂遞降就是先往第一個子目錄搜尋，等第一個子目錄完成後，
再往第二個子目錄搜尋。
!找出目前目錄下 120 天前的檔案
{{{
find . -mtime +120 -print
}}}
!Expression語法
!!+n
{{{n}}}表示任何整數，{{{+n}}}表示大於n的數字，
{{{-n}}}表示小於n的數字，
{{{n}}}表示等於n的數字。
!!\(Expression\)
若Expression 為真，則上式為真。
!!-exec Command


使用 UNIX find 命令的高級技術
	developerWorks
	
	
文檔選項
	将此页作为电子邮件发送	

將此頁作為電子郵件發送

級別： 中級

Bill Zimmerly (bill@zimmerly.com), 自由撰稿人兼知識工程師, Author

2006 年 5 月 25 日

    本文介紹如何使用 find 命令瀏覽 UNIX® 文件系統中豐富的內容。find 命令是 UNIX 程序員的技能中功能最強大和最有用的命令之一。各種版本的 UNIX 都具有可以包含數以千計的不同類型文件的文件系統。有了如此之多的選擇，要定位一個特定文件或文件集，將變得非常困難。而 find 命令能通過許多方式，讓這項任務變得更加輕鬆。

沒有什麼能比得上探索和發現新的人、地方、事物所帶來的刺激。領域可能有所不同，但有些原則卻是一樣的。在這些原則中，有一條是記錄下您的旅程，另一條則是瞭解和使用工具。

UNIX® 操作系統很像一片廣闊的、未經標識的荒野。當您在這樣的領域中旅行時，可以選擇一些日後能夠給您帶來幫助的工具。find 命令便是這樣一種工具。find 命令不僅能夠簡單地用來定位文件，正如本文將介紹的那樣，它還可以自動地執行其他 UNIX 命令的序列，其中使用所查找到的文件名作為輸入。

Find 的有關限制

所有稱職的操作系統都具有協助您查找相關內容的工具。與大多數工具不同的是，UNIX 中的 find 命令可以自動地對其查找到的文件執行許多操作。

圖形用戶界面 (GUI) 中的標準 find 工具允許您對所查找到的文件進行一些常規操作任務：您可以將它們標記為剪切、複製和粘貼，您可以將它們移動到一個新的位置，並且可以使用創建它們的應用程序來打開它們。這些操作涉及到兩個或更多的步驟，並且不是自動完成的，即首先查找到文件，然後使用 GUI 為下一步的操作對它們進行標記。這種方法對許多用戶來說沒有問題，但是 Explorer 需要的不僅是這些。

UNIX 的 find 命令可以刪除、複製、移動和執行其查找到的文件。另外，使用 -exec 參數可以根據您所需要的 UNIX 命令的序列來自動地運行這些文件。它甚至可以在對任何文件執行這些操作前，進一步讓您進行確認。

簡化文件系統的管理

與大多數 UNIX 命令一樣，UNIX find 命令具有一長串令人生畏的選項和開關，它們會阻礙人們深入地學習該命令，但正是因為其範圍廣闊，真正的 Explorer 並不會被它們嚇倒。一條好的通用原則在簡化一個複雜問題時都會經過漫長的過程。啟動一個 xterm，並嘗試執行下面的命令：

$ find . -name *.gif -exec ls {} \;


-exec 參數中包含了真正有價值的操作。當查找到匹配搜索條件的文件時，-exec 參數定義了將對這些文件進行什麼操作。該示例告訴計算機進行如下操作：

   1. 從當前文件夾開始往下搜索，緊跟在 find 之後，使用點號 (.)。
   2. 定位所有名稱以 .gif 結尾的文件（圖形文件）。
   3. 列出所有查找到的文件，使用 ls 命令。

需要對 -exec 參數進行更深入地研究。當查找到匹配搜索條件的文件名時，find 命令執行 ls {} 字符串，用文件名和路徑代替文本 {}。假設在搜索中查找到 saturn.gif 文件，find 將執行如下所示的命令：

$ ls ./gif_files/space/solar_system/saturn.gif


本文餘下的內容建立在這條一般原則之上：仔細地使用 find 命令可以讓 UNIX 文件系統的管理工作變得更加容易。例如，如果您使用了 -fstype 參數，find 命令可以根據查找到的文件所處的文件系統的類型來對命令進行相應的處理。在 find 命令對查找到的文件執行相應命令前將對您進行提示，這通常是非常有用的，您可以使用 -ok 參數告訴它繼續執行該操作，接下來我們將對其進行介紹。

可選的執行

-ok 是 -exec 參數的一個重要的替代項，它的行為和 -exec 一樣，但它會提示您是否要對文件運行相應的命令。假設您想要刪除 home 目錄中的大部分 .txt 文件，但希望能夠逐個文件地執行該操作。像 UNIX 中的 rm 命令那樣的刪除操作是很危險的，因為當使用像 find 這樣的自動化處理方式來查找文件時，它可能一不小心會刪除重要的文件，您也許希望在刪除這些系統查找到的文件之前對其進行仔細檢查。

下面的命令列出了您的 home 目錄中所有的 .txt 文件。要刪除這些文件，必須在 find 命令通過列出文件名提示您確認操作時輸入 Y 或者 y：

$ find $HOME/. -name *.txt -ok rm {} \;


它列出了查找到的每個文件，並且系統將暫停以等待您輸入 Y 或者 y。如果您按下 Enter 鍵，系統將不會刪除該文件。清單 1 顯示了一些示例結果：

清單 1. 示例結果

&lt; rm ... /home/bill/./.kde/share/apps/karm/karmdata.txt &gt; ?
&lt; rm ... /home/bill/./archives/LDDS.txt &gt; ?
&lt; rm ... /home/bill/./www/txt/textfile1.txt &gt; ?
&lt; rm ... /home/bill/./www/txt/faq.txt &gt; ?
&lt; rm ... /home/bill/./www/programs/MIKE.txt &gt; ?
&lt; rm ... /home/bill/./www/programs/EESTRING.txt &gt; ?
.
.
.


系統將在每個問號之後暫停，在本示例中，每次都按下了 Enter 鍵以繼續處理下一個文件。（沒有刪除任何文件。）-ok 參數允許您控制每個查找到的文件的自動化處理過程，這樣就添加了一種避免自動刪除文件的安全措施。

如果在使用 -ok 參數時涉及到過多的文件，那麼一個好的方法是先運行帶 -exec 的 find 命令以列出所有將要刪除的文件，然後在經過檢查確保其中不會刪除重要的文件後，再次運行該命令，其中用 rm 代替 ls。

-exec 和 -ok 都非常有用，您必須確定在當前情況下哪一個能夠更好的工作。請記住，安全第一！

創造性地使用 find

您可以使用 find 命令執行各種各樣的任務。本部分內容提供了使用 find 命令來管理文件系統的幾種方式的示例。

為了保持簡單，這些示例都避免了使用涉及通過管道將一個命令的輸出傳遞到另一個命令的 -exec 命令。然而，您完全可以根據自己需要在 find 命令的 -exec 子句中使用這樣的命令。

清除臨時文件

您可以使用 find 命令來清除目錄或子目錄中在正常使用過程中生成的臨時文件，這樣可以節省磁盤空間。要實現該操作，請使用下面的命令：

$ find . \( -name a.out -o -name '*.o' -o -name 'core' \) -exec rm {} \;


括號中的文件掩碼 標識出了需要刪除的文件類型，每個文件掩碼的前面都有 -name。該列表可以擴展為包括您需要清除的系統中的任何臨時文件類型。在代碼的編譯和連接過程中，程序員及其工具會生成示例中的那些文件類型：a.out、*.o 和 core。其他的用戶通常也會生成類似的臨時文件，可以使用如 *.tmp、*.junk 等文件掩碼來對命令進行相應的編輯。您可能還發現將命令放入一個稱作 clean 的腳本中非常有用，當需要清除一個目錄中的內容的時候就可以執行該腳本。

複製目錄中的內容

find 命令允許您複製目錄中的全部內容，同時保持每個文件和子目錄的權限、時間和所有權。要完成該操作，需要組合使用 find 和 cpio 命令，如下所示：

清單 2. 組合使用 find 和 cpio 命令


$ cd /path/to/source/dir

$ find . | cpio -pdumv /path/to/destination/dir


cpio 命令是一個複製命令，它設計用來將文件複製到或複製出一個 cpio 或 tar 存檔文件，並自動地保持文件和子目錄的權限、時間和所有權。

列出文本文件的第一行內容

有些人使用每個文本文件的第一行作為標題或者文件內容的描述。可以使用列出文件名和所有文本文件第一行內容的報表更方便地對大量的文本文件進行篩選。下面的命令在報表中列出了您的 home 目錄中所有文本文件的第一行內容，便於進一步地根據需要使用 less 命令進行檢查：

清單 3. less 命令


$ find $HOME/. -name *.txt -exec head -n 1 -v {} \; &gt; report.txt

$ less &lt; report.txt


維護 LOG 和 TMP 文件的存儲空間

要為生成大量文件的應用程序維護 LOG 和 TMP 文件存儲空間，可以將下列命令放入到每天運行的 cron 任務中：

清單 4. 維護 LOG 和 TMP 文件存儲空間


$ find $LOGDIR -type d -mtime +0 -exec compress -r {} \;

$ find $LOGDIR -type d -mtime +5 -exec rm -f {} \;


第一個命令找到 $LOGDIR 目錄中所有包含在 24 小時內 (-mtime +0) 進行了修改的數據的目錄 (-type d)，並對它們進行壓縮 (compress -r {}) 以節省磁盤空間。如果這些目錄超過了一個工作周 (-mtime +5)，第二個命令則將其刪除 (rm -f {})，以便增加磁盤上的可用空間。通過這種方式，cron 任務自動地根據您所指定的時間窗口對目錄進行維護。

複製複雜的目錄樹

如果您想要將複雜的目錄樹從一台計算機複製到另一台計算機，同時保持副本權限以及 User ID 和 Group ID（UID 和 GID——操作系統所使用的標記文件的所有權的數值），並且不複製用戶文件，那麼就需要再次使用 find 和 cpio：

清單 5. 複製複雜的目錄樹

$ cd /source/directory

$ find . -depth -print | cpio -o -O /target/directory


查找不指向任何地方的鏈接

要查找不指向任何地方的鏈接，可以使用帶 find 的 perl 解釋器，如下所示：

$ find / -type l -print | perl -nle '-e || print';


該命令從最頂層目錄 (/) 開始，列出由 perl 解釋器確定不指向任何地方 (-nle '-e || print') 的所有鏈接 (-type l -print)，關於 Unix Guru Universe 站點中這個技巧的更詳細的信息，請參閱參考資料部分。如果您想要刪除這些文件，可以進一步使用管道將輸出傳遞到 rm -f {} 命令。當然，Perl 可以在大多數的 UNIX 工具包中找到，它是許多功能強大的解釋性語言工具中的一種。

定位和重命名無法打印的目錄

在 UNIX 中，可能會有錯誤的或惡意的程序創建包含無法打印的字符的目錄。定位和重命名這些目錄，這樣就可以更容易地檢查並刪除它們。要完成該操作，您首先需要在 ls 中包含 -i 開關，以獲取該目錄的索引節點的數值。然後，使用 find 將索引節點的數值轉換為一個可以使用 mv 命令進行重命名的文件名：

清單 6. 定位和重命名無法打印的目錄

$ ls -ail

$ find . -inum 211028 -exec mv {} newname.dir \;


列出長度為零的文件

要列出所有長度為零的文件，請使用下面的命令：

$ find . -empty -exec ls {} \;


在查找到空文件之後，您可以選擇用 rm 命令來代替 ls 命令，以刪除這些文件。

很明顯，您對 UNIX find 命令的使用受到知識和創造性的限制。

結束語

使用 find 命令，可以輕鬆地瀏覽 UNIX 文件系統中豐富的內容。很值得花時間來試驗該命令，並瞭解它能為您做些什麼。正如本文中所列出的示例，您可以通過許多創造性的方式來使用 find，這樣可以輕鬆地瀏覽和管理文件系統，並且充滿樂趣。</pre>
</div>
<div title="flash" modifier="Fhopecc" modified="200709211408" created="200709211403" tags="ROR" changecount="3">
<pre>{{{flash}}} 可以傳值給下一個 {{{action}}}。
{{{
  class WeblogController &lt; ActionController::Base
    def create
      # save post
      flash[:notice] = &quot;Successfully created post&quot;
      redirect_to :action =&gt; &quot;display&quot;, :params =&gt; { :id =&gt; post.id }
    end

    def display
      # doesn't need to assign the flash notice to the template, that's done automatically
    end
  end
}}}
display.rhtml
{{{
    &lt;% if flash[:notice] %&gt;&lt;div class=&quot;notice&quot;&gt;&lt;%= flash[:notice] %&gt;&lt;/div&gt;&lt;% end %&gt;
}}}
通常{{{flash}}}會用來作上個動作的即時通告，或是訊息用。</pre>
</div>
<div title="gmail as default mail client" modifier="fhopecc" created="200709030745" tags="小工具" changecount="1">
<pre>you should download gamil notifer</pre>
</div>
<div title="grep" modifier="fhopecc" modified="200711210118" created="200710181428" tags="unix" changecount="2">
<pre>!syntax
{{{grep [options] PATTERN [FILE...]}}}
!options
!!{{{-v, --invert-match}}}
列出不符合 PATTERN 的行</pre>
</div>
<div title="his.rar" modifier="fhopecc" created="200807280841" changecount="1">
<pre>File his.rar (17661 KB) uploaded!

Thank you for your upload. Remember that only those people are able to access your files knowing the exact link.
RapidShare is a file hoster and does not announce your files anywhere.
Your Download-Link #1:	http://rapidshare.de/files/40099977/his.rar.html
Your Delete-Link #1:	http://rapidshare.de/files/40099977/his.rar?killcode=2186694214</pre>
</div>
<div title="htmp print control" modifier="fhopecc" modified="200808210141" created="200709121353" tags="CSS" changecount="10">
<pre>列印 html 時，css 要直接用 style tag 不能 include css file，
否則不會產生效果。
----
網頁的列印無法控制嗎? 你可以試試這個方法.



設計網頁的時候, 通常考慮到的是 '讓瀏覽者賞心悅目' 的排版問題。
如果瀏覽者打算列印你的網頁, 或是你的網頁利用資料庫處理了一些資料,
準備製成報表, 這時便會遇到分頁的問題。


怎麼樣讓網頁於列印時自動分成適當的頁數呢？
其實有個簡單的指令, 馬上能讓你達成心願。


這個指令是:
{{{
&lt;P style='page-break-after:always'&gt;&lt;/P&gt;
}}}

雖然這是 HTML 的 css 而非 Javascript 的指令, 不過配合網頁進入時
所啟動的 Javascript 的 window.print() 印表機交談視窗指令,
更能讓網頁的列印方便許多！

{{{
example.htm

&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;網頁舉例&lt;/TITLE&gt;&lt;/HEAD&gt;
&lt;BODY&gt;

&lt;CENTER&gt;&lt;A HREF='print.htm'&gt;連結到想要分頁列印的網頁&lt;/A&gt;&lt;/CENTER&gt;

&lt;/BODY&gt;
&lt;/HTML&gt;
}}}


print.htm
{{{
&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;自動分頁列印！&lt;/TITLE&gt;&lt;/HEAD&gt;
&lt;BODY onLoad='printPage()'&gt;

&lt;SCRIPT LANGUAGE='JavaScript'&gt;
&lt;!--// 自動列印: 會彈出印表機交談視窗
function printPage() {
   window.print();
}
//--&gt;
&lt;/SCRIPT&gt;

&lt;CENTER&gt;這是列印的第一頁！&lt;/CENTER&gt;

&lt;P style='page-break-after:always'&gt;&lt;/P&gt;

&lt;CENTER&gt;這是列印的第二頁！&lt;/CENTER&gt;

&lt;/BODY&gt;
&lt;/HTML&gt;
}}}
----
昨天跟同事研究一個小問題，是要把註冊繳費單列印出來，原本這個工作是用word的合併列印來讀取excel裡面的資料，再把它們印出來。 現在想要用網頁+資料庫，讓用戶端可以直接從網頁上瀏覽後再列印，解決方式就是為這個網頁設計一個列印專用的 css樣式表:
&lt;style type=&quot;text/css&quot; media=&quot;print&quot;&gt;
...
&lt;/style&gt;
 
接下來的問題就是A4印表機的整頁內容最大邊界為何，經過昨天的測試大致上得到下列的結果...
   #printArea{
    width:170mm;
    height:258mm;
    border:solid 1px #000000; 
    font-size:12pt;
   }
我在&lt;body&gt;區塊裡面放了一個&lt;div&gt;並把它的id名為printArea，
在預覽列印的時候可以看到一個大框框(border:solid 1px #000000;)
調到這個大小(w:170mm,h:258mm)剛剛好佈滿可列印的內容區。
 
另一個要注意的就是字型與字體的變化:
一般我們在公文書上的字型都是用標楷體居多，所以我們可以這麼定義...
font-family:&quot;標楷體&quot;;
字體的部份是要以列印出來的實際大小為準，所以用pt作為字體單位...
exam:
font-size:16pt;  /*段落項目的大小 */
font-size:12pt; /* 一般內文的大小 */
font-size:10pt; /* 較小的字體 */
font-size:8pt; /* 如果是要列印出來，那到8pt已經差不多夠小了，再小就不能看嘍! */
 
因為上列的css都是針對print用的CSS，所以針對網頁瀏覽時呈現方面也要另外製作一個css
&lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;
...
&lt;/style&gt;
 
這是比用Crystal Report更方便的網頁列印Solution，不過有點累人就是了....</pre>
</div>
<div title="in-place-editing " modifier="fhopecc" modified="200709050130" created="200709041338" tags="ROR" changecount="3">
<pre>ㄜ，其實真的很難解釋什麼叫做 in-place-editing 這個 AJAX 效果，簡單講就是你可以直接編輯畫面上某些欄位，而不用進入專門編輯的頁面，上圖就是最典型的效果。

這個效果廣泛的使用在 Flickr 以及其他的 AJAX 網頁。由於太過方便，常用，所以 script.aculo.us 就有這個效果，Rails 也對這個效果寫了相當方便的 Javascript Helper，並且做出一個相當完善的整合。雖然這個功能在 Rails 2.0 裡面即將被取消內建，轉為 plugin 形式，但是由於日常生活使用到的機會也蠻多的，我還是第一個 AJAX 效果就介紹這個。Ruby on Rails 上面要使用 in-place-editing 是相當相當方便的。一共有三步，我們假設我們想 in-place-editing abc model 裡面的 name column。

第一步：加入相關 Lib
在 HTML head 裡面加入相關 Javascritp Lib
{{{javascript_include_tag :defaults}}}
第二步：View
在view 裡面，你需要 in-place-editing的位置，加入相關 in-place-editor 的 field
{{{in_place_editor_field 'abc' , 'name'}}}
第三步：Controller
在你的 controller 裡面，加入 in-place-editor 的宣告
{{{
    class AbcController &lt; ApplicationController
    in_place_edit_for :abc , :name
    end
}}}


沒錯，不多不少三步就好。沒有任何 Javascript 宣告，只有簡潔有力的 Rails Style Coding，很棒吧。

中文化

如果你想將裡面內建的 ok , cancel 改成中文的話，請在 view 裡面使用

    in_place_editor_field 'abc' , 'name' , {} , :save_text =&gt; '儲存' , :cancel_text =&gt; '取消' , :loading_text =&gt; '儲存中'

即可變成中文字。

多個 column in-place-editing

如果你想要一個 controller 有多個 in-place-editing 的 column，這裡就有點不方便了，可能必須要這樣寫

    class AbcController &lt; ApplicationController
    in_place_edit_for :abc , :name
    in_place_edit_for :abc , :nickname
    end


延伸閱讀

    * JavaScript helper Manual


張貼者： thegiive 位於 16:39   標籤： ajax, rails

3 意見:

ABON 提到...

    in_place_editor_field 'product','description', :save_text =&gt; '儲存' , :cancel_text =&gt; '取消' , :loading_text =&gt; '儲存中' ,:rows=&gt;8, :click_to_edit_text=&gt; '點這裡編輯'

    我在view裡面是這樣寫的
    不知道為什麼 save_text之後的功能全部都沒有出現 是我有語法還是其他設定的錯誤呢
    3/03/2007 4:12 下午   
thegiive 提到...

    Sorry，寫錯了。請看我更正過的版本。
    3/03/2007 8:05 下午   
電風扇 提到...

    請參考這篇文章：
    http://zusocfc.blogspot.com/2007/03/rails-inplaceedit.html
    我有寫上一個小技巧:P
    3/04/2007 2:39 上午   

張貼意見
較新的文章 較舊的文章 首頁
訂閱： 張貼意見 (Atom)
</pre>
</div>
<div title="include" modifier="fhopecc" modified="200805290634" created="200802211326" tags="Ruby" changecount="3">
<pre>{{{
 class Module
     def include(*mods)
       mods.each do |mod|
         mod.append_features(self)
         mod.included(self)
       end
     end
   end
}}}</pre>
</div>
<div title="included 方法" modifier="fhopecc" modified="200802211326" created="200802211323" tags="Ruby" changecount="2">
<pre>C:\Users\fhopecc&gt;irb
irb(main):001:0&gt; module M
irb(main):002:1&gt; def self.included(klass)
irb(main):003:2&gt; puts &quot;Included in #{klass}&quot;
irb(main):004:2&gt; end
irb(main):005:1&gt; end
=&gt; nil
irb(main):006:0&gt; class A
irb(main):007:1&gt; include M
irb(main):008:1&gt; end
Included in A
=&gt; A</pre>
</div>
<div title="install" modifier="fhopecc" created="200709200341" tags="rpm" changecount="1">
<pre>RPM 安裝( install )
安裝就是 install 嘛！所以囉，使用 rpm 來安裝就很簡單啦！假設我要安裝一個檔名為 rp-pppoe-3.1-5.i386.rpm 的檔案，那麼我可以這樣( 記得某些套件可能需要以系統管理員的身份來安裝 )：

[root@linux ~]# rpm -i rp-pppoe-3.1-5.i386.rpm

不過，這樣的參數其實無法顯示安裝的進度，所以，通常我們會這樣下達安裝指令：

[root@linux ~]# rpm -ivh package_name
參數：
-i ：install 的意思
-v ：察看更細部的安裝資訊畫面
-h ：以安裝資訊列顯示安裝進度
範例：

範例一：安裝 rp-pppoe-3.1-5.i386.rpm
[root@linux ~]# rpm -ivh rp-pppoe-3.1-5.i386.rpm
Preparing...     ####################################### [100%]
   1:rp-pppoe    ####################################### [100%] 

範例二、一口氣安裝兩個以上的套件時：
[root@linux ~]# rpm -ivh a.i386.rpm b.i386.rpm *.rpm
# 後面直接接上許多的套件檔案！

範例三、直接由網路上面的某個檔案安裝，以網址來安裝：
[root@linux ~]# rpm -ivh http://website.name/path/pkgname.rpm
</pre>
</div>
<div title="listTags" modifier="fhopecc" created="200803171200" tags="systemConfig" changecount="1">
<pre>config.macros.listTags = { text: &quot;Hello&quot; };
config.macros.listTags.handler = function(place,macroName,params)
{
	var tagged = store.getTaggedTiddlers(params[0],params[1]); 
//&lt;&lt; Second parameter is field to sort by (eg, title, modified, modifier or text)
	var ul = createTiddlyElement(place,&quot;ul&quot;,null,null,&quot;&quot;);
	for(var r=0;r&lt;tagged.length;r++)
	{
		var li = createTiddlyElement(ul,&quot;li&quot;,null,null,&quot;&quot;);
		createTiddlyLink(li,tagged[r].title,true);
	}
}</pre>
</div>
<div title="ls" modifier="fhopecc" modified="200801140912" created="200709190608" tags="unix" changecount="2">
<pre>{{{
[root@linux ~]# ls [-aAdfFhilRS] 目錄名稱
[root@linux ~]# ls [--color={none,auto,always}] 目錄名稱
[root@linux ~]# ls [--full-time] 目錄名稱
參數：
-a  ：全部的檔案，連同隱藏檔( 開頭為 . 的檔案) 一起列出來～
-A  ：全部的檔案，連同隱藏檔，但不包括 . 與 .. 這兩個目錄，一起列出來～
-d  ：僅列出目錄本身，而不是列出目錄內的檔案資料
-f  ：直接列出結果，而不進行排序 (ls 預設會以檔名排序！)
-F  ：根據檔案、目錄等資訊，給予附加資料結構，例如：
      *：代表可執行檔； /：代表目錄； =：代表 socket 檔案； |：代表 FIFO 檔案；
-h  ：將檔案容量以人類較易讀的方式(例如 GB, KB 等等)列出來(僅Linux)；
-i  ：列出 inode 位置，而非列出檔案屬性；
-l  ：長資料串列出，包含檔案的屬性等等資料；
-n  ：列出 UID 與 GID 而非使用者與群組的名稱 (UID與GID會在帳號管理提到！)
-r  ：將排序結果反向輸出，例如：原本檔名由小到大，反向則為由大到小；
-R  ：連同子目錄內容一起列出來；
-s  ：將檔案容量以 KB 列出來(僅 AIX)；
-S  ：以檔案容量大小排序！
-t  ：依時間排序
--color=never  ：不要依據檔案特性給予顏色顯示；
--color=always ：顯示顏色
--color=auto   ：讓系統自行依據設定來判斷是否給予顏色
--full-time    ：以完整時間模式 (包含年、月、日、時、分) 輸出
--time={atime,ctime} ：輸出 access 時間或 改變權限屬性時間 (ctime) 
                       而非內容變更時間 (modification time)
}}}</pre>
</div>
<div title="method argument list" modifier="fhopecc" created="200712301510" tags="Ruby" changecount="1">
<pre>Ruby方法參數列定義順序，
#normal arguments
#hash arguments
#array arguments
#block argument</pre>
</div>
<div title="mline" modifier="fhopecc" modified="200807020159" created="200807020138" tags="HIS" changecount="2">
<pre>!目的

!例
{{{
mline do
  mr col, col, col
  mr col, col, col
end
}}}
!mr
!!ex
{{{
mr &quot;a&quot;, &quot;b&quot;, &quot;c&quot;
&lt;tr&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;b&lt;/td&gt;
&lt;td&gt;c&lt;/td&gt;
&lt;/tr&gt;
}}}</pre>
</div>
<div title="modifier" modifier="Fhopecc" created="200709160212" tags="Ruby" changecount="2">
<pre>{{{
src = '' if src.nil?
}}}</pre>
</div>
<div title="net_use" modifier="fhopecc" modified="200711130856" created="200711130844" tags="網路指令" changecount="7">
<pre>Net use將電腦連線到共用資源或中斷電腦與共用資源的連線，或顯示電腦連線的相關資訊。此指令亦控制持續網路連線。若不使用參數，則 net use 會擷取網路連線的清單。

!!語法
{{{
net use [{DeviceName | *}] [\\ComputerName\ShareName[\volume]] 
[{Password | *}]] [/user:[DomainName\]UserName] 
[/user:[DottedDomainName\]UserName] 
[/user:[UserName@DottedDomainName] 
[/savecred] [/smartcard] [{/delete | /persistent:{yes | no}}]
}}}
{{{
net use [DeviceName [/home[{Password | *}] [/delete:{yes | no}]]
}}}
{{{
net use [/persistent:{yes | no}]
}}}
!!參數
!!!DeviceName 
指派名稱，以連線到要中斷連線的資源或指定裝置。裝置名稱有二種：磁碟機 (D: 到 Z:) 及印表機 (LPT1: 到 LPT3:)。請鍵入一個星號 (而非特定裝置的名稱) 來指派下一個可用裝置的名稱。 
!!!\\ComputerName\ShareName 
指定伺服器及共用資源的名稱。如果 ComputerName 包含空格，請使用引號括住整個電腦名稱，從 2 對反斜線 (\\) 到電腦名稱結尾 (例如，&quot;\\Computer Name\Share Name&quot;)。電腦名稱可以有 1 到 15 個字元長。 
!!!\volume 
指定伺服器上的 NetWare 磁碟區。必須安裝了 Client Service for NetWare，並執行之以連接 NetWare 伺服器。 
!!!Password 
指定用來存取共用資源所需的密碼。鍵入一個星號 (*) 以便產生密碼提示。在密碼提示中鍵入密碼時，不會顯示出所鍵入的密碼。 
!!!/user 
指定建立連線的不同使用者名稱。 
!!!DomainName 
指定其他網域。如果省略 DomainName，則 net use 會使用目前登入網域。 
!!!UserName 
指定用來登入的使用者名稱。 
!!!DottedDomainName 
指定使用者帳戶所在網域之完整名稱。 
!!!/savecred 
存放所提供的憑證以備重新使用。 
!!!/smartcard 
指定網路連線要使用智慧卡上的憑證。如果可使用多種智慧卡，則要求您指定憑證。 
!!!/detele 
取消所指定的網路連線。如果使用星號 (*) 來指定連線，則會取消所有的網路連線。 
!!!/persistent:{yes | no} 
控制持續網路連線的使用。預設是使用上次的設定。無裝置的連線無法持續。Yes 會在建立連線時同時儲存所有的連線，並在下次登入時予以還原。No 不會儲存正在建立或後續的連線。現存的連線會在下次登入時還原。使用 /delete 來移除持續連線。 
!!!/home 
將使用者連線到主目錄。 
!!!net help command 
顯示指定的 net 指令的說明。 
!!備註
從網路資源連線與中斷連線 
使用 net use 可建立與中斷網路資源連線，以及檢視目前網路資源的連線。如果在目前磁碟機或使用中的處理正使用共用目錄的同時使用之，則您無法從共用目錄中斷連線。

!!檢視連線資訊 
若要檢視連線的相關資訊，請參考下列作法：

鍵入 net use DeviceName 以取得特定連線的資訊。 
鍵入 net use 以取得所有電腦連線的清單。 
使用無裝置連線 
無裝置的連線無法持續。

!!連線 NetWare 伺服器 
安裝並執行了 Client Service for NetWare 之後，您就可以連接 Novell 網路上的 NetWare 伺服器。除了必須包含要連接的磁區以外，請使用用於連接 [Windows 網路] 伺服器的相同語法。

!!使用引號
如果您提供的 ServerName 包含空格，則請使用引號括住文字 (也就是，&quot;Server Name&quot;)。如果省略引號，則會出現錯誤訊息。 

!!範例
若要將磁碟機裝置名稱 E: 指派到 \\Financial 伺服器上的 Letters 共用目錄，請鍵入： 
{{{
net use e:\\financial\letters 
}}}
若要將磁碟機裝置名稱 M: 指派 (對應) 到 \\Financial NetWare 伺服器之 Letters 磁碟區內的 Mike 目錄，請鍵入：
{{{
net use m:\\financial\letters\mike 
}}}
若要連接使用者識別元 Dan 就像從 [帳戶] 網域所作的連線一樣，請鍵入：
{{{
net use d:\\server\share /user:Accounts\Dan 
}}}
若要中斷 \\Financial\Public 目錄的連線，請鍵入： 
{{{
net use f:\\financial\public /delete 
}}}
若要與 \\Financial 2 伺服器上的共用資源備忘錄連線，請鍵入： 
{{{
net use k:&quot;\\financial 2&quot; \memos 
}}}
若要在每次登入時還原目前的連線，而不管未來的變更，請鍵入： 
{{{
net use /persistent:yes 
}}}</pre>
</div>
<div title="netstat" modifier="fhopecc" modified="200804220742" created="200709100719" tags="網路連線" changecount="6">
<pre>netstat
如果你覺得你的某個網路服務明明就啟動了，但是就是無法造成連線的話，那麼應該怎麼辦？ 首先你應該要查詢一下自己的網路介面所監聽的埠口 (port) 來看看是否真的有啟動， 因為有時候螢幕上面顯示的 [OK] 並不一定是 OK 啊！ ^_^

[root@linux ~]# netstat -[rn]       &lt;==與路由有關的參數
[root@linux ~]# netstat -[antulpc]  &lt;==與網路介面有關的參數
參數：
與路由 (route) 有關的參數說明：
-r  ：列出路由表(route table)，功能如同 route 這個指令；
-n  ：不使用主機名稱與服務名稱，使用 IP 與 port number ，如同 route -n
與網路介面有關的參數：
-a  ：列出所有的連線狀態，包括 tcp/udp/unix socket 等；
-t  ：僅列出 TCP 封包的連線；
-u  ：僅列出 UDP 封包的連線；
-l  ：僅列出有在 Listen (監聽) 的服務之網路狀態；
-p  ：列出 PID 與 Program 的檔名；
-c  ：可以設定幾秒鐘後自動更新一次，例如 -c 5 每五秒更新一次網路狀態的顯示；

範例一：列出目前的路由表狀態，且以 IP 及 port number 顯示：
[root@linux ~]# netstat -rn
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
192.168.10.0    0.0.0.0         255.255.255.0   U         0 0          0 eth0
169.254.0.0     0.0.0.0         255.255.0.0     U         0 0          0 eth0
0.0.0.0         192.168.10.30   0.0.0.0         UG        0 0          0 eth0
# 其實這個參數就跟 route -n 一模一樣，對吧！這不是 netstat 的主要功能啦！

範例二：列出目前的所有網路連線狀態，使用 IP 與 port number
[root@linux ~]# netstat -an
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address               Foreign Address             State
tcp        0      0 0.0.0.0:25                  0.0.0.0:*                   LISTEN
tcp        0      0 :::22                       :::*                        LISTEN
tcp        0      0 ::ffff:192.168.10.100:25    ::ffff:192.168.10.200:57509 TIME_WAIT
tcp        0     52 ::ffff:192.168.10.100:22    ::ffff:192.168.10.210:1504  ESTABLISHED
udp        0      0 127.0.0.1:53                0.0.0.0:*
Active UNIX domain sockets (servers and established)
Proto RefCnt Flags       Type       State         I-Node Path
unix  2      [ ACC ]     STREAM     LISTENING     4792   public/cleanup
unix  2      [ ACC ]     STREAM     LISTENING     4799   private/rewrite
......(底下省略)......

netstat 的輸出主要分為兩大部分，分別是 TCP/IP 的網路介面部分，以及傳統的 Unix socket 部分。 還記得我們在基礎篇裡面曾經談到檔案的類型嗎？那個 socket 與 FIFO 檔案還記得吧？ 那就是在 Unix 介面用來做為程式資料交流的介面了，也就是上頭表格內看到的 Active Unix domain sockets 的內容囉～

通常鳥哥都是建議加上『 -n 』這個參數的，因為可以避過主機名稱與服務名稱的反查，直接以 IP 及埠口號碼 (port number) 來顯示，顯示的速度上會快很多！至於在輸出的訊息當中， 我們先來談一談關於網路連線狀態的輸出部分，他主要是分為底下幾個大項：



基本上，我們常常談到的 netstat 的功能，就是在觀察網路的連線狀態了，而網路連線狀態中， 又以觀察『我目前開了多少的 port 在等待用戶端的連線』以及 『目前我的網路連線狀態中，有多少連線已建立或產生問題』最常見。 那你如何瞭解與觀察呢？通常鳥哥是這樣處理的：

範例三：秀出目前已經啟動的網路服務
[root@linux ~]# netstat -tulnp
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address   Foreign Address  State    PID/Program name
tcp        0      0 0.0.0.0:25      0.0.0.0:*        LISTEN   2141/master
tcp        0      0 :::22           :::*             LISTEN   1924/sshd
tcp        0      0 :::25           :::*             LISTEN   2141/master
udp        0      0 127.0.0.1:53    0.0.0.0:*                 1911/named
# 上面最重要的其實是那個 -l 的參數，因為可以僅列出有在 Listen 的 port

你可以在上面的範例當中發現，我的網路連線僅有對外開放 port 25 以及 port 22 而已 (因為針對 0.0.0.0 開放)， 至於 port 53 則僅針對內部的 127.0.0.1 來開放，所以是不對 Internet 開放這個服務的喔！ 而其中 port 22,25 都是使用 TCP 封包，至於 port 53 則是開放在 UDP 封包的狀態！ 再仔細的看，每一行輸出的最右邊，你可以發現鳥哥的主機 port 22 是由 sshd 這支程式所啟動的， 並且他的 PID 是 1924 ，看到這邊，聰明的您應該知道，『那我如何關閉這個 port 』吧？使用 kill 或 killall 即可啊！ ^_^

範例四：觀察本機上頭所有的網路連線狀態
[root@linux ~]# netstat -atunp
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address     Foreign Address     State       PID/Program name
tcp        0      0 0.0.0.0:25        0.0.0.0:*           LISTEN      2141/master
tcp        0      0 :::22             :::*                LISTEN      1924/sshd
tcp        0      0 :::25             :::*                LISTEN      2141/master
tcp        0     68 192.168.1.100:22  192.168.1.210:1504  ESTABLISHED 30417/sshd:
udp        0      0 127.0.0.1:53      0.0.0.0:*                       1911/named

看到上頭的特殊字體吧？那代表目前已經建立連線的一條網路連線，他是由遠端主機 192.168.1.210 啟動一個大於 1024 的埠口向本地端主機 192.168.1.100 的 port 22 進行連線的一條連線， 你必須要想起來的是：『Client 端是隨機取一個大於 1024 以上的 port 進行連線』，此外『只有 root 可以啟動小於 1023 以下的 port 』，那就看的懂上頭那條連線囉！如果這條連線你想要砍掉他的話， 看到最右邊的 30417/sshd 了沒？ kill 會用吧！ ^_^

至於傳統的 Unix socket 的資料，記得使用 man netstat 查閱一下吧！ 這個 Unix socket 通常是用在一些僅在本機上運作的程式所開啟的插槽介面檔， 例如 X Window 不都是在本機上運作而已嗎？那何必啟動網路的 port 呢？當然可以使用 Unix socket 囉，另外，例如 Postfix 這一類的網路伺服器，由於很多動作都是在本機上頭來完成的， 所以以會佔用很多的 Unix socket 喔！

例題一：請說明服務名稱與 port number 的對應在 Linux 當中，是用那個檔案來設定對應的？

答：

      /etc/services </pre>
</div>
<div title="netstat顯示的欄位資訊" modifier="fhopecc" modified="200805150343" created="200710181323" tags="Network" changecount="8">
<pre>|Proto|該連線的封包協定，主要為 TCP/UDP 等封包|
|Recv-Q|非由使用者程式連接所複製而來的總 bytes 數|
|Send-Q|由遠端主機所傳送而來，但不具有 ACK 標誌的總 bytes 數， 意指主動連線 SYN 或其他標誌的封包所佔的 bytes 數|
|Local Address|本地端的位址，可以是 IP (-n 參數存在時)， 也可以是完整的主機名稱。如上表我們看到的 IP 格式有兩種，一種是 IPv4 的標準， 亦即是四組十進位的數字後面加上冒號『:』後，接著 port number 。一種是 IPv6 ， 前面的 IP 加上很多冒號『:』的格式。我們可以由這個顯示的資料看出這個服務是開放在哪一個介面， 例如上表當中， port 22 是開放在 0.0.0.0 ，亦即是所有介面都可以連到 port 22 ， 至於 port 53 則僅開放在本機的 127.0.0.1 這個介面而已，所以是不對外部介面開放的意思。|
|Foreign Address|遠端的主機 IP 與 port number|
|stat|連線狀態列|
!連線狀態
*ESTABLISED：已建立連線的狀態。
*~SYN_SENT：發出主動連線 (SYN 標誌) 的連線封包。
*~SYN_RECV：接收到一個要求連線的主動連線封包。
*~FIN_WAIT1：該插槽服務(socket)已中斷，該連線正在斷線當中。
*~FIN_WAIT2：該連線已掛斷，但正在等待對方主機回應斷線確認的封包。
*~TIME_WAIT：該連線已掛斷，但 socket 還在網路上等待結束。
*LISTEN：通常用在服務的監聽 port ！可使用『 -l 』參數查閱。</pre>
</div>
<div title="operator overloding" modifier="fhopecc" modified="200712240945" created="200712240351" tags="Ruby" changecount="2">
<pre> &lt;=&gt; &lt;= &lt; &gt;= &gt; == !=
    Relational operators, used to compare objects. &lt; is also used to define class inheritance. 
===
    Case comparison operator. 
+ - * / % **
    Arithmetic operators. % is for modulo arithmetic and also a shortcur for printf-style formatting. 
~ &lt;&lt; &gt;&gt; &amp; ^ |
    Bitwise operators for integers: not, shift left/right, and, xor, or. &lt;&lt; is also for appending to strings and arrays, here documents and defining singleton classes. 
.. …
    For defining range literals. 
: ?: ::
    : is for creating/accessing Symbols. ?: and :: are the ternary and scope operators, respectively. 
?c
    ?c is the ASCII value of c. 
][
    [] is for Array definition and Array/Hash access. 
{} =&gt;
    Hash definition, as in {1 =&gt; :one}. {} also used to wrap code to create Procs. =&gt; is also used in rescue clauses. 
!
    Logical negation. 
@ @@
    Instance and class variables. 
method? method!
    ? and ! can be part of a method name to indicate a predicate or destructive behaviour, respectively. 
$
    Global variable. 
&amp;
    A method parameter denoting a Proc object. 
|x,y|
    Arguments to a Proc object. 
*var
    Array expansion. 
// %r{}
    Regular expression definition. 
=~ !~
    Regular expression matching. 
#{}
    Expression substitution inside a double-quoted string. 
%q{} %Q{} %{}
    Quoting mechanisms. 
%w{}
    Special quoting mechanism that produces an array. 
%x{} ``
    Command execution string.</pre>
</div>
<div title="partials" modifier="Fhopecc" modified="200709080411" created="200709080315" tags="ROR" changecount="18">
<pre>rails 有一種特殊的子樣版可畫出，稱為 partials。
它的命名規則與一般的樣版不同，總是前置一個 '_' 在檔名前，
如{{{_partial1.rhtml}}}就是一個partial 樣版檔。 
常見的用法如下：
{{{
&lt;%= render :partial =&gt; &quot;account&quot; %&gt;
}}}
若 :partial 選項值為 &quot;account&quot;，則會畫出檔案路徑為{{{app/views/controllers/_account.rhtml}}}樣版。
!畫出其它 controller 的 partials
想畫出其它 controller 的 partials ，:partial 選項值必須如下指定：
{{{
&lt;%= render :partial =&gt; &quot;advertisement/ad&quot;, :locals =&gt; { :ad =&gt; @advertisement } %&gt;
}}}
上述會畫出檔案路徑為{{{app/views/advertisement/_ad.rhtml}}}的partial。
!傳值給 partial
!!利用物件變數傳值給 partial
rails 中 controller 會自動將物件變數設定為 view  的全域變數，如下：
{{{
  &lt;% for @item in @items %&gt;             
    &lt;%= render_partial 'item_brief' %&gt;
  &lt;% end %&gt;
}}}
partial 可用物件變數 @item 接收 controller 的訊息
{{{
&lt;p&gt;&lt;%= @item.text %&gt;: &lt;%= @item.due_date %&gt;&lt;/p&gt;
}}}
!!利用 {{{:locals}}} 選項傳值給 partial  的區間變數
指定 {{{:locals}}} 選項便能設定 partial 的區間變數值。
{{{:locals}}}的選項值為一個符號表，
符號為區間變數的名稱，而符號值則為區間變數的指定值。
{{{
&lt;%= render :partial =&gt; &quot;ad&quot;, :locals =&gt; { :ad =&gt; ad } %&gt;
}}}
如上述程式碼會設定 partial 的區間變數 {{{:ad}}} 為目前的 ad 的值。</pre>
</div>
<div title="pathping" modifier="fhopecc" modified="200805020718" created="200804220146" tags="網路檢測 WINDOWS" changecount="4">
<pre>Pathping提供有關在來源與目的地之間的中繼躍點，網路延遲及網路遺失的資訊。Pathping 會在一段時間內將多個 [回應要求] 訊息傳送到來源及目的之間的每個路由器，然後，根據每個路由器傳回的封包計算結果。只要 pathping 顯示任何給定路由器或連結的封包遺失程度，您就可判定哪個路由器或連結可能有網路問題。藉由識別路徑上的路由器，Pathping 會執行與 tracert 相同的功能。然後，再定期傳送 ping 到所有的路由器，並依據每個路由器所傳回的數字來計算統計。若不使用參數，則 pathping 會顯示說明。

!語法
{{{
pathping [-n] [-h MaximumHops] [-g HostList] [-p Period] [-q NumQueries [-w Timeout] [-T] [-R] [TargetName]
}}}

!參數
-n 
防止 pathping 將中介路由器的 IP 位址解析為其名稱。這可能會加快顯示 pathping 的結果。 
-h MaximumHops 
在搜尋目標 (目的地) 的路徑中指定最大的躍點數目。預設為 30 個躍點。 
-g HostList 
指定 [回應要求] 訊息使用指定於 HostList 的中間目錄集的 IP 標題內使用 [喪失資源路徑] 選項。透過鬆散來源路由，連續的中介目的地，可以由一或多個路由器加以區隔。在主機清單中的位址定址名稱的最大數為 9。 HostList 是由空格分隔的 IP 位址 (以小數點標記) 系列。 
-p period 
指定連續 ping 處理間的等待毫秒數。預設值為 250 毫秒 (1/4 秒)。 
-q NumQueries 
指定傳送到路徑中每個路由器的 [回應要求] 訊息數量。預設值為 100 查詢。 
-w Timeout 
指定等待每個回覆的毫秒數。預設值為 3000 毫秒 (3 秒)。 
-T 
將第二層優先順序標記 (例如，802.1p) 貼附到 [回應要求] 訊息，這樣它就能經由路由傳送到各個網路裝置。這可協助您識別未設定為第二層優先順序的網路裝置。此切換會用於測試 Quality of Service (QoS) 連接性。 
-R 
確認經由路由的各個網路裝置是否支援 Resource Reservation Protocol (RSVP)，它可讓主機電腦保留特定頻寬的資料流。此切換會用於測試 Quality of Service (QoS) 連接性。 
TargetName 
指定由 IP 位址或主機名稱識別的目的地。 
/? 
在命令提示字元上顯示說明。 
備註
Pathping 參數區分大小寫。 
若要避免網路擁塞，則必須用夠低的間隔來傳送 ping。 
若要減少大量遺失的影響，請不要太常傳送 ping 。 
當使用 -p 參數時，會將 ping 分別傳送到每個中繼躍點。因此，傳送給相同躍點之兩個 ping 間的間隔為 (period) x (躍點數)。 
當使用 -w 參數時，會平行傳送多個 ping。因此，在 Timeout 參數中指定的時間數量，不會受到 Period 參數中指定時間數量的限制，而在兩個 ping 之間等待。 
使用 -T 參數 
啟用主電腦上的第二層優先順序，以讓封包以第二層優先順序標記 (讓第二層裝置用以指派順序到封包) 傳送。無法識別層級-2 優先順序的傳統設備，因為顯示的格式錯誤而捨棄這些封包。此參數會幫助識別捨棄這些封包的網路電腦。 

使用 -R 參數 
不存在的工作階段之 RSVP 保留訊息，被傳送到路由的各個網路裝置。如果裝置不支援 RSVP，則會傳回 [達不到網際網路控制訊息通訊協定 (ICMP) 目的地 - 通訊協定無法連線] 訊息。如果裝置支援 RSVP，則會傳回 [RSVP 保留區錯誤] 訊息。有些裝置可能無法傳回這些訊息。如果發生這種情況，則會顯示逾時訊息。

唯有將 Internet Protocol (TCP/IP) 通訊協定安裝成 [網路連線] 中網路介面卡的內容元件，才能使用此指令。 
範例
下列範例顯示 pathping 指令的輸出：



D:\&gt;pathping -n corp1

Tracing route to corp1 [10.54.1.196]
over a maximum of 30 hops:
  0  172.16.87.35
  1  172.16.87.218
  2  192.168.52.1
  3  192.168.80.1
  4  10.54.247.14
  5  10.54.1.196

Computing statistics for 125 seconds...
Source to Here   This Node/Link
Hop  RTT    Lost/Sent = Pct  Lost/Sent = Pct  Address
  0                                           172.16.87.35
                                0/ 100 =  0%   |
1   41ms     0/ 100 =  0%     0/ 100 =  0%  172.16.87.218
                               13/ 100 = 13%   |
2   22ms    16/ 100 = 16%     3/ 100 =  3%  192.168.52.1
                                0/ 100 =  0%   |
3   24ms    13/ 100 = 13%     0/ 100 =  0%  192.168.80.1
                                0/ 100 =  0%   |
4   21ms    14/ 100 = 14%     1/ 100 =  1%  10.54.247.14
                                0/ 100 =  0%   |
5   24ms    13/ 100 = 13%     0/ 100 =  0%  10.54.1.196

Trace complete.


執行 pathping 時，第一個結果會列出路徑。這與 tracert 指令所顯示的路徑相同。接著，會顯示大約 90 秒 (該時間會根據躍點計數而變化) 的忙碌訊息。在這期間，會收集來自所有先前列出的路由器及介於它們之間連結的資訊。結束時，會顯示測試結果。

上述的樣式報告，This Node/Link、 Lost/Sent = Pct 及 Address 欄位顯示 172.16.87.218 與 192.68.52.1 間的連結正在丟棄 13% 的封包。在躍點 2 與 4 上的路由器，丟棄定址給它們的封包，但是，此遺失不會影響它們轉送傳輸的能力，該傳輸未定址給這些路由器。

顯示連結 (識別為 [位址] 欄位中的垂直線 (|)) 的遺失率，指出導致在路徑上轉送封包遺失的連結阻塞。顯示路由器 (由其 IP 位址識別) 的遺失率，指出這些路由器可能超載。

格式圖例
格式 意義 
斜體 使用者必須提供的資訊 
粗體 使用者必須依照顯示的原狀輸入的元素 
省略符號 (...) 可以在命令列中重複數次的參數 
方括弧 ([]) 間 選用項目 
大括弧 ({}) 間；以 | 區隔選項。範例：{even|odd} 使用者必須從中擇其一的選項組 
Courier 字型 程式碼或程式 
</pre>
</div>
<div title="plugins" modifier="fhopecc" modified="200710200144" created="200708301310" tags="ROR" changecount="3">
<pre>active_search
別名是simple_search，因為本身在Win32下開發....acts_as_ferret的核心，Ruby版的ferret會掛點|||，
所以改用這個需要另加欄位的全文搜尋外掛

acts_as_authenticated
登入系統的plugin，不太好改但很好用，網路上有將其改成OpenID可以用的教學:)....[當然你的系統和我的系統一樣的小時...應該不用
花那功夫|||]

acts_as_taggable_on_steroids
acts_as_taggable的擴充版，可以類似以User.book.tag_list的方式來求得所有的子
tag，acts_as_taggable轉過去很容易，修正一下migrate差異處來做update即可，而比較要注意的地方是一些語法，和這個套
件預定是以&quot;,&quot;逗點為斷句，需另外設定為&quot; &quot;空白，及一些語法差異性就是了

acts_as_threaded
討論區套件......雖然開發到目前和平板式的無異(自己的關係...)......但資料還是有繼承關係的XD

simple_captcha
檢核碼套件，前身是讓人噴飯的validates_captcha...[固定字串random + 問題雙模式|||]，而這套件固定出現英文26字
母六位元+可以選內定的theme，好用的很:) [非常大的缺點是....他的view產出時....class(CSS)部份寫的不是很好|||要
小改一下才能入手](需使用Ruby的Rmagick，而有看到另外一套用GD2的plugin....無奈Win32的Ruby的GD2會掛
點|||)

sitealizer
流量統計使用，像是超級精簡版的Awstats...不過這套是每N個session就會儲存才是，而如果Rails Server有加用-
prefix參數的話，必須修正這plugin內的view中所有超連結和圖片連結才是(.....因為是寫死的|||...)

[[目前自己有在用的Lib有]]

paginate_collection
嗯...不像Rails內定的那種model的分頁方式，有了這個，不管是什麼都可以讓你亂分頁 XD

tag cloud
A...(好吧...自己是真的想不起來有啥lib才會提出這個...略過略過XD)

玩Rails的人沒有不裝外掛的，我使用外掛的理由有三個。

第一、有現成的功能直接拿來用就好，幹嘛重新發明輪子？

第二、這就像玩Eclipse及Firefox一樣，好用的外掛總要嘗試一下。

第三、可以趁機瞭解外掛的原始碼及範例，多服用甜的語法糖可以提升一甲子功力。

使用外掛之前，建議先安裝Rapt這顆寶石，這顆寶石會把網路上可以找到的外掛安裝路徑cache在你的電腦上，以後安裝外掛又快又方便。
我目前使用的外掛如下：

    * acts_as_commentable: 選定一個model，自動幫你加入留言功能，非常物件導向以及好用。
    * acts_as_sluggable: 選定一個model，自動幫你組成漂亮網址。以網路書店為例，原本Agile Web Development with Rails這本書的網址應該是

      http://bookstore.rubyonrails.org/show/1234

      經過此外掛加持之後，會變成

      http://bookstore.rubyonrails.org/show/1234-agile-web-development-with-rails

      這就是一個非常漂亮，而且容易記憶的網址。
    * acts_as_taggable: 選定一個model，自動幫你加上Web 2.0最流行的tag功能，這個外掛的缺點是沒辦法搭配分頁一起使用。這個問題是可以解決的，以後再說明。
    * annotate_models: 以前介紹過，請參考這裡。
    * deprecated: 因為Rails改版實在太快了，很多舊的語法新版都不支援，這個外掛可以掃瞄你的程式，並提醒你哪些語法新版不支援。
    * file_column: 只消三行程式幫你實現圖片上傳以及縮圖功能，簡單好用。
    * footnotes: TextMate限定。某個頁面出現bug時，如需修改程式勢必要找到某支程式的某一行才來修改，安裝這個外掛之後，會在頁面下方加入連結，讓你直接點選連結，馬上幫你用TextMate開啟那支程式，跳到那一行讓你修改，這是TextMate開發者必備武器。
    * growl_deprecated: Mac OS X限定，搭配deprecated使用，直接利用Growl提示你哪些語法新版不支援，沒有比這個更酷的了。
    * rav: 幫你產生model, controller關連圖，非常有視覺效果，範例請看下圖。
    * stickies: 以前介紹過，請參考這裡。
    * testly_reporter: 以前介紹過，請參考這裡。</pre>
</div>
<div title="rdoc" modifier="fhopecc" modified="200710171125" created="200709260019" tags="Ruby" changecount="2">
<pre>!功能
培析 ruby 的源碼，產出文件檔。
!語法
{{{rdoc [options]  [names...]}}}
!names...
{{{name}}} 若是一個目錄名則會處理目錄之下所有的rb 檔。若未指定 {{{name}}} 則預設為目前的目錄。
!options
!!{{{[--op|-o]}}} dir
會將產出文件檔放到 {{{dir}}} 所指定的目錄</pre>
</div>
<div title="return expression" modifier="Fhopecc" modified="200709160543" created="200709160538" tags="Ruby" changecount="4">
<pre>!例碼:
{{{
	return
	return 12
	return 1,2,3
}}}
!語法
{{{
	return [expr[`,' expr...]]
}}}
!語義
跳出現在的方法，並依下列條件，傳回恰當的值。
若其後沒有任何表示式，則傳回{{{nil}}}。
後面只有一個表示式，則傳回其表示式的值。
後面只有多個以{{{,}}}分開表示式，則以{{{陣列}}}傳回所有表示式的值。</pre>
</div>
<div title="route命令" modifier="fhopecc" modified="200711230753" created="200711090658" tags="網路指令" changecount="15">
<pre>{{{route}}}顯示及修改本機 IP 路由表中的項目。不使用參數情況下，route 會顯示說明。
!語法
route [-f] [-p] [Command [Destination] [mask Netmask] [Gateway] [metric Metric]] [if Interface]]

!參數
!!-f 
清除含下列路由項目的路由表：非主機路由 (含有網路遮罩 255.255.255.255 的路由)、回送網路路由 (含有目的地 127.0.0.0 和網路遮罩 255.0.0.0 的路由) 或多點傳送路由 (含有目的地 224.0.0.0 和網路遮罩 240.0.0.0 的路由)。若搭配其中一個指令 (例如 add、change 或 delete) 使用這個表格，就會先清除表格之後再執行指令。 
!!-p 
與 add 指令一起使用時，指定的路由會新增至登錄中而且每次啟動 TCP/IP 通訊協定時會使用該路由初始 IP 路由表。在預設狀況下，啟動 TCP/IP 通訊協定時不保留新增的路由。與 print 指令搭配使用時，會顯示已登錄的持續路由清單。其他指令忽略此參數。持續路由儲存在登錄位置 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\PersistentRoutes。 
!!Command 
指定要執行的指令。下表列出有效指令。 指令 用途 
*add 新增路由 
*change 修改現存的路由 
*delete 刪除一個路由或多個路由。 
*print 列印一個路由或多個路由。 
!!!Destination 
指定路由的網路目的地。目的地可以是
*IP 網路位址:網路位址的主機位元設成 0，選取一整個網路
*主機路由的 IP 位址:選取一台主機
*預設路由的 0.0.0.0，也可以用 0 代替
!!!mask Netmask 
指定與網路目的地相關的網路遮罩 (也稱為子網路遮罩)。子網路遮罩可以是 IP 網路位址的適當子網路遮罩、255.255.255.255 代表主機路由或 0.0.0.0 代表預設路由。若省略的話，會使用子網路遮罩 255.255.255.255。因為目的地與子網路遮罩之間的關係而定義路由，所以目的地不可以比它的對應子網路遮罩更明確。換句話說，若子網路遮罩中的對應位元是 0，那麼在目的地中不可以有位元設成 1。 
!!!Gateway 
指定透過根據網路目的地和子網路遮罩定義的位址集可以到達的轉寄或下個躍點 IP 位址。對於本機連線的子網路路由來說，閘道位址是指派給連接子網路的介面的 IP 位址。對於遠端路由來說，可以在一個或多個路由器之間使用，閘道位址是指派給鄰接路由器的直接連線的 IP 位址。 
!!!metric Metric 
指定路由的整數成本公制 (從 1 到 9999)，從路由表中的多個路由中選取最符合所轉寄的封包目的地位址的路由時使用此公制。選擇最低成本的路由。此成本可以反映躍點數目、路徑速度、路徑可靠性、路徑輸送量或管理內容。 
!!if Interface 
指定透過它到達目的地的介面的介面索引。關於介面和它們的對應介面清單，請使用 route print 指令畫面。您可以使用介面索引的十進位或十六進位值。對於十六進位值來說，請在 0x 前面加上十六進位數字。省略 if 參數時，會從閘道位址決定介面。 
!!/? 
在命令提示字元上顯示說明。 
!!備註
路由表的 [公制] 欄位中的較大值是允許 TCP/IP 的結果根據每一個 LAN 介面的 IP 位址、子網路遮罩和預設閘道，自動決定路由表中的路由的公制。依預設自動決定介面公制、決定介面速度並調整介面的公制或路由，使得最快介面使用最低成本建立路由。若要移除較大公制，請從 LAN 連線的 TCP/IP 通訊協定的進階內容停用介面公制的自動決定。 
若適當項目存在於本機 [網路] 檔案 (此檔案儲存在 systemroot\System32\Drivers\Etc 資料夾)，那麼名稱可以用於 Destination。只要可以透過標準主機名稱解析技術如網域名稱系統 (DNS) 查詢、使用儲存在 systemroot\system32\drivers\etc 資料夾的本機 Hosts 檔案和 NetBIOS 名稱解析，那麼這些名稱就可以用於 gateway。 
若指令是 print 或 delete，就可以省略 Gateway 參數，而且萬用字元可用於目的地和閘道。Destination 值可以是由星號指定的 (*) 的萬用字元值。若指定的目的地含有星號 (*) 或問號 (?)，就會將該星號或問號視為萬用字元，並只列印或刪除符合的目的地路由。星號表示符合任何字元集，而問號表示符合任何單一字元。例如，10.*.1、192.168.*、127.* 和 *224* 是星號萬用字元的有效用法。 
若使用的目的地和子網路遮罩 (網路遮罩) 值組合無效，會顯示 &quot;Route: bad gateway address netmask&quot; 錯誤訊息。當目的地在位元位置中含有一個或多個位元設成 1，但是對應的子網路遮罩位元設成 0 時會出現此錯誤訊息。若要測試此狀況，請使用二進位表示法表達目的地和子網路遮罩。使用二進位表示法的子網路遮罩由一連串 1 位元 (代表目的地的網路位址部份)，以及一連串 0 位元 (代表目的地的主機位址部份) 組成。檢查以判斷在目的地中是否有位元設成 1 代表是主機位址的目的地部份 (由子網路遮罩定義)。 
只有 Windows NT 4.0、Windows 2000、Windows Millennium Edition 和 Windows XP 的路由指令才支援 -p 參數。Windows 95 或 Windows 98 的 route 指令不支援此參數。 
唯有將 Internet Protocol (TCP/IP) 通訊協定安裝成 [網路連線] 中的網路介面卡內容中的元件才能使用此指令。 
!範例
若要顯示 IP 路由表的整個內容，請鍵入：
{{{
route print
}}}
若要在 IP 路由表中顯示開頭是 10. 的路由，請鍵入：
{{{
route print 10.*
}}}
若要新增含有預設閘道位址 192.168.12.1 的預設路由，請鍵入：
{{{
route add 0.0.0.0 mask 0.0.0.0 192.168.12.1
}}}
若要新增路由到含有子網路遮罩 255.255.0.0 和下個躍點位址 10.27.0.1 的目的地 10.41.0.0，請鍵入：
{{{
route add 10.41.0.0 mask 255.255.0.0 10.27.0.1
}}}
若要新增持續路由到含有子網路遮罩 255.255.0.0 和下個躍點位址 10.27.0.1 的目的地 10.41.0.0，請鍵入：
{{{
route -p add 10.41.0.0 mask 255.255.0.0 10.27.0.1
}}}
若要新增路由到含有子網路遮罩 255.255.0.0、下個躍點位址 10.27.0.1 和成本公制 7 的目的地 10.41.0.0，請鍵入：
{{{
route add 10.41.0.0 mask 255.255.0.0 10.27.0.1 metric 7
}}}
若要新增路由到含有子網路遮罩 255.255.0.0、下個躍點位址 10.27.0.1 並使用介面索引 0x3 的目的地 10.41.0.0，請鍵入：
{{{
route add 10.41.0.0 mask 255.255.0.0 10.27.0.1 if 0x3
}}}
若要刪除含有子網路遮罩 255.255.0.0 的目的地 10.41.0.0 的路由，請鍵入：
{{{
route delete 10.41.0.0 mask 255.255.0.0
}}}
若要在 IP 路由表顯示開頭是 10. 的路由，請鍵入：
{{{
route delete 10.*
}}}
若要將含有目的地 10.41.0.0 和子網路遮罩 255.255.0.0 的路由的下個躍點位址從 10.27.0.1 變更成 10.27.0.25，請鍵入：
{{{
route change 10.41.0.0 mask 255.255.0.0 10.27.0.25
}}}
!AIX特殊選項
更改的路由表重開機後才會生效。
!!Command 多出 family 選項
{{{Command [family] [Destination] [mask Netmask] [Gateway] [metric Metric]}}}
!!!family
*-inet:預設選項，表示使用 tcp/ip 協定
*-xns:使用 Xerox Network System</pre>
</div>
<div title="rpm" modifier="fhopecc" modified="200709200324" created="200709200311" tags="unix" changecount="9">
<pre>&lt;&lt;tiddler &quot;rpm&amp;srpm&quot;&gt;&gt;
&lt;&lt;tiddler 套件命名規則&gt;&gt;</pre>
</div>
<div title="rpm&amp;srpm " modifier="fhopecc" modified="200709200323" created="200709200317" tags="rpm" changecount="6">
<pre>!!RPM 與 SRPM
RPM 全名是『 ~RedHat Package Manager 』簡稱則為 RPM 啦！顧名思義，當初這個套件管理的程式是由 Red Hat 這家公司發展出來的， 但其實在很多的其他套件也有相類似的套件管理程式。不過由於 RPM 使用上很方便，所以就成了目前最熱門的套件管理程式啦！
那麼什麼是 RPM 呢？說的簡單一點， RPM 是以一種資料庫記錄的方式來將你所需要的套件安裝到你的 Linux 主機的一套管理程式。他最大的特點就是將您要安裝的套件先編譯過( 如果需要的話 )並且打包好了，透過包裝好的套件裡頭預設的資料庫記錄， 記錄這個套件要安裝的時候必須要的相依屬性模組( 就是你的 Linux 主機需要先存在的幾個必須的套件 )，當安裝在你的 Linux 主機時， RPM 會先依照套件裡頭的紀錄資料查詢 Linux 主機的相依屬性套件是否滿足， 若滿足則予以安裝，若不滿足則不予安裝。那麼安裝的時候就將該套件的資訊整個寫入 RPM 的資料庫中，以便未來的查詢、驗證與反安裝！這樣一來的優點是：
#由於已經編譯完成並且打包完畢，所以安裝上很方便( 不需要再重新編譯 )；
#由於套件的資訊都已經記錄在 Linux 主機的資料庫上，很方便查詢、升級與反安裝； 
但是這也造成很大的困擾，由於 RPM 程式是已經包裝好的資料，也就是說， 裡面的資料已經都『編譯完成』了！所以， 安裝的時候一定需要當初安裝時的主機環境才能安裝 ，也就是說，當初建立這個套件的安裝環境必須也要在你的主機上面出現才行！例如 rp-pppoe 這個 ADSL 撥接套件，他必須要在 ppp 這個套件存在的環境下才能進行安裝！如果你的主機並沒有 ppp 這個套件，那麼很抱歉，除非您先安裝 ppp 否則 rp-pppoe 就是不讓你安裝的( 當然您可以強制安裝，但是通常都會有點問題發生就是了！ )。
所以，通常不同的 distribution 所釋出的 RPM 檔案，並不能用在其他的 distributions 裡面，舉例來說， Fedora 釋出的 RPM 檔案，通常無法直接在 Mandriva 上面進行安裝的，更有甚者， 不同版本之間也無法互通，例如 Fedora Core 4 的 RPM 檔案就無法直接套用在 FC3 上面！因此，這樣可以發現他的缺點是：
#安裝的環境必須與打包時的環境需求一致或相當；
#需要滿足套件的相依屬性需求；
#反安裝時需要特別小心，最底層的套件不可先移除，否則可能造成整個系統的問題！ 
那怎麼辦？呵呵！還好，還有 SRPM 這個東西！ SRPM 是什麼呢？顧名思義，他是 Source RPM 的意思，也就是這個 RPM 檔案裡面含有原始碼( Source Code )哩！特別注意的是，這個 SRPM 所提供的套件內容『並沒有經過編譯』， 他提供的是原始碼喔！
通常 SRPM 的附檔名是以 ***.src.rpm 這種格式來命名的 。不過，既然 SRPM 提供的是原始碼，那麼為什麼我們不使用 Tarball 直接來安裝就好了？！這是因為 SRPM 雖然內容是原始碼， 但是他仍然含有該套件所需要的相依性套件說明、以及所有 RPM 檔案所提供的資料，同時，他與 RPM 不同的是，他也提供了參數設定檔( 就是 configure 與 makefile 啦！ )。所以，如果我們下載的是 SRPM ，那麼要安裝該套件時，RPM 套件管理員將會
#先將該套件以 RPM 管理的方式編譯
#然後將編譯完成的 RPM 檔案安裝到 Linux 系統當中。與 RPM 檔案相比， SRPM 多了一個重新編譯的動作， 而且 SRPM 編譯完成會產生 RPM 檔案。
怪了，怎麼 SRPM 這麼麻煩吶！還要重新編譯一次，那麼我們直接使用 RPM 來安裝不就好了！？通常一個套件在釋出的時候，都會同時釋出該套件的 RPM 與 SRPM 。我們現在知道 RPM 檔案必須要在相同的 Linux 環境下才能夠安裝，而 SRPM 既然是原始碼的格式，自然我們就可以透過修改 SRPM 內的參數設定檔，然後重新編譯產生能適合我們 Linux 環境的 RPM 檔案，如此一來，不就可以將該套件安裝到我們的系統當中，而不必與原作者打包的 Linux 環境相同了？這就是 SRPM 的用處了！</pre>
</div>
<div title="ruby-oci" modifier="fhopecc" modified="200712220244" created="200712181203" tags="Ruby" changecount="4">
<pre>當今的應用程式沒有不需要連接資料庫的，
所以連接各家資料庫的介面和基本IO一樣，
對你用來養家活口的程式語言而言，
是基礎函式庫。
Java有整合良好的JDBC介面，
而Ruby則是模仿它的祖先，Perl的DBI介面，
但不是每個資料庫連接介面套件都使用DBI，
但有一套標準總是比較好，不會溝通不良，
若妳想為Ruby寫一套介面，連接妳家的資料庫，
麻煩遵守DBI。
{{{ruby-oci8}}}套件，便是用來連接Oracle資料庫的DBI介面。

</pre>
</div>
<div title="ruby-oci8" modifier="fhopecc" modified="200711150121" created="200711150114" tags="Ruby" changecount="4">
<pre>!安裝
1. Check the Oracle client version.
Binary packages are available only for Oracle 8.1.5 or later.
2. Download
Download {{{ruby-oci8-VERSION-mswin32.rb}}} from rubyforge.
note: 1.0 is stable version. 2.0-unstable is in development.
3. Run the package.
{{{
 C:&gt; ruby ruby-oci8-VERSION-mswin32.rb
}}}
!解除安裝
刪除以下檔案
*oci8.rb:在sitelib目錄中
*oci8lib.so:在sitearch目錄中
*DBD/OCI8/OCI8.rb:在sitelib目錄中
oci8.rb and DBD/OCI8/OCI8.rb are in sitelib directory:
{{{
ruby -r rbconfig -e &quot;puts Config::CONFIG['sitelibdir']&quot;
}}}
oci8lib.so is in sitearch directory:
{{{
ruby -r rbconfig -e &quot;puts Config::CONFIG['sitearchdir']&quot;
}}}
sitelib 是存放 ruby 的 script 檔，
sitearch 是存放相依不同機器架構的 binary 檔</pre>
</div>
<div title="ruby-oci8-0.1.16-mswin32.rb" modifier="fhopecc" modified="200712220249" created="200712210934" tags="Ruby" changecount="10">
<pre>!例子：{{{ruby-oci8-0.1.16-mswin32.rb}}}
&lt;&lt;tiddler ruby-oci&gt;&gt;
但本文可不是教妳如何使用{{{ruby-oci}}}來連接資料庫，
而是{{{ruby-oci8-0.1.16-mswin32.rb}}}，ruby-oci的安裝檔。

要安裝{{{ruby-oci}}}函式庫，必須安裝以下的檔案：
*oci8lib.so:共用程式庫 DLL 檔案，
*oci.rb
*~OCI8.rb
為了讓安裝所需的檔案都能放在一個安裝的 ruby script 中，
作者便很巧妙的先把三個檔案用 zip 壓縮，
再用 Base64 把壓縮檔轉成文字字串，
再把文字字串貼到安裝的 script 檔中， 
如下便是oci8lib.so壓縮檔經由Base64編碼轉換後的ascii字串，
作者把字串存在 install_files['oci8lib.so'] 變數裡：
{{{
install_files['oci8lib.so'] = &lt;&lt;-EOS
eJzsvQ18VMXVOHw32YQFFrJIoqipLggVFHHzyeYT8rGYQDbZ3WQFFA0hH2xC
SDDZIChB6BLNsqbFChYttaDY8lTaByttUdEnaApB0xpo2uap0SfUtL2Y9HFb
...
...
/xGft7HG1xPN8Zj3pF3Au3EwwIMsyAIH9kBsb7I95r0V+/eGwkAC0Am0HDyU
2A8i2BZv9P0N4S7rEQ==
EOS
}}}
下面的安裝程式則是先將上述的Base64的ascii字串，解譯成壓縮檔的二進位字串，
再解壓成原來的 oci8lib.so 檔，便能把此檔從源碼取出，再安裝到所需的目錄。
{{{
File.open(&quot;#{dirname}/#{basename}&quot;, &quot;wb&quot;) do |f|
   f.write(Zlib::Inflate::inflate(Base64.decode64(content)))
end
}}}
當所有的資源都能放在這個檔案，
只要一個 ruby script 便能完成所有的安裝。
是不是很妙呢？</pre>
</div>
<div title="session" modifier="Fhopecc" modified="200709211410" created="200709211409" tags="ROR" changecount="2">
<pre>&lt;&lt;tiddler SessionConcept&gt;&gt;

</pre>
</div>
<div title="spam mail" modifier="fhopecc" modified="200809180658" created="200809180657" changecount="4">
<pre>[[spammail|http://172.17.1.6]]</pre>
</div>
<div title="sqlplus用法" modifier="fhopecc" modified="200711130359" created="200711130343" tags="資料庫" changecount="6">
<pre>用法 1: sqlplus -H | -V

    -H             顯示 SQL*Plus 版本和
                   用法說明.
    -V             顯示 SQL*Plus 版本.

用法 2: 
{{{sqlplus [ [&lt;option&gt;] [&lt;logon&gt;] [&lt;start&gt;] ]}}}

  &lt;option&gt; 為: [-C &lt;version&gt;] [-L] [-M &quot;&lt;options&gt;&quot;] [-R &lt;l

    -C &lt;version&gt;   將受影響之命令的相容性設為
                   &lt;version&gt; 指定的版本.  版本
                   格式為 &quot;x.y[.z]&quot;.  例如, -C 10.2.0
    -L             僅嘗試登入一次, 而非
                   在發生錯誤時重新提示.
    -M &quot;&lt;options&gt;&quot; 設定自動輸出 HTML 標記.  選項
                   格式為:
                   HTML [ON|OFF] [HEAD text] [BODY text] [
                   [ENTMAP {ON|OFF}] [SPOOL {ON|OFF}] [PRE
    -R &lt;level&gt;     將限制模式設為停用 SQL*Plus 命令
                   與檔案系統互動.  層次可為
                   1, 2 或 3.  限制最高的層次為 -R 3,
                   它會停用所有使用者命令與
                   檔案系統的互動.
    -S             設定安靜模式, 這會隱藏顯示
                   SQL*Plus 標幟, 提示和呼應
                   命令.

  &lt;logon&gt; 為: (&lt;username&gt;[/&lt;password&gt;][@&lt;connect_identifie
              [AS SYSDBA | AS SYSOPER] | /NOLOG

    指定資料庫帳戶使用者名稱, 密碼和連線
    資料庫連線 ID.  沒有連線
    ID, SQL*Plus 會連線預設資料庫.

    AS SYSDBA 和 AS SYSOPER 選項是資料庫管理
    權限.

    /NOLOG 選項會啟動 SQL*Plus, 但不連線
    資料庫.

  &lt;start&gt; 為: @&lt;URL&gt;|&lt;filename&gt;[.&lt;ext&gt;] [&lt;parameter&gt; ...]

    執行指定的 SQL*Plus 命令檔, 從 Web 伺服器 (URL) 或
    具指定之參數的本機檔案系統 (filename.ext) 執行,
    會將這些參數指定給命令檔中的替代變數.

當 SQL*Plus 啟動, 在 CONNECT 命令之後, 位置設定檔
(例如 $ORACLE_HOME/sqlplus/admin/glogin.sql) 和使用者設定檔
(例如, 工作目錄中的 login.sql) 會執行.  檔案可以
包含 SQL*Plus 命令.

請參考 SQL*Plus User's Guide and Reference 瞭解詳細資訊.</pre>
</div>
<div title="svnadmin hotcopy" modifier="fhopecc" modified="200712040251" created="200712040222" tags="svn" changecount="5">
<pre>!SVN檔案庫備份
!!語法
{{{
svnadmin hotcopy 源檔案庫路徑 備份檔案庫路徑
}}}
例如
{{{
svnadmin hotcopy D:\SVNRoot\Proj1 E:\SVNBack\Proj1
}}}
另外備份目標必須為空目錄，
所以備份前需要先刪除舊有資料或是建立新資料夾，
可以使用windows所提供的批此檔及排程來自動備份，
批次檔內容例如下方。
{{{
@echo off

set SVN_BackUp=E:\SVNBackup
set SVN_ROOT=D:\SVNRoot
set SVN_BackUp_Dir=%SVN_BackUp%\%date:~0,4%%date:~5,2%%date:~8,2%

if not exist %SVN_BackUp% mkdir %SVN_BackUp%
if exist %SVN_BackUp_Dir% goto ALREADY_EXIST_DATE
mkdir %SVN_BackUp_Dir%
for /r %SVN_ROOT% %%D in (.) do @if exist &quot;%%D\conf\svnserve.conf&quot; svnadmin hotcopy %%~fD %SVN_BackUp_Dir%\%%~nD
goto END

:ALREADY_EXIST_DATE
echo 目錄%SVN_BackUp_Dir%已存在

:END
}}}
將上方內容存檔到 {{{D:\SVNRoot\BackUp.bat}}}，並利用 Windows 排程 每天晚上10點備份。
指令如下：
{{{
at 22:00 /every:s,m,t,w,th,f,sa &quot;D:\SVNRoot\BackUp.bat&quot;
}}}
不過這一個功能僅能本機端使用
可以注意到svnadmin後面的參數給的都是本機端的路徑
所以處理檔案也都不需要經過SVNService
</pre>
</div>
<div title="svnsync" modifier="fhopecc" created="200712040251" tags="svn" changecount="1">
<pre>!SVN檔案庫同步
在 svn 1.4 後，提供一個複製檔案庫的新指令 svnsync。
它會利用源檔案庫 revision 的訊息，
來對目的檔案庫模擬那次 revision 的 commit 動作，
並從第一個版本執行到最近版本，來達成複製檔案庫的功能。
它要求對源檔案庫有讀的權利而目的檔案庫有讀寫的權利。
!建立一個空目的檔案庫
在新版的SVN提供了SVNSYNC的程式 可以達成兩個檔案庫之間的同步，
和上方備份不同的是，可以經由遠端來運作，因此可以備份到不同電腦上，
另外在備份之前不需要刪除舊有資料，因為他是同步，
在Subversion的官網上雖然有文章介紹如何使用，
不過是針對Linux的環境下的說明...
那在Windows雖然很類似 不過要作一些修改

#要建立同步目標的檔案庫
{{{
svnadmin create DestRepository
}}}
然後設定DestRepository的Conf檔跟建立一個新的帳號 (例如&quot;SvnSync&quot;)
並在來源檔案庫新增一筆一樣的帳號密碼
並且在hooks的目錄下建立一個新的檔案叫
{{{
&quot;pre-revprop-change.bat&quot;
}}}
檔案內容使用空白即可運作
不過這一個目標檔案庫有一個限制 他不應該被一般使用者Commit資料上去
也就是說應該只有svnsync可以對他作寫入的動作
應此建議將檔案內容修改為下列所述
{{{
@echo off

set repos=%1
set rev=%2
set user=%3
set propname=%4
set action=%5

if not '%user%'=='SvnSync' goto ERROR_USERNAME
exit 0
:ERROR_USERNAME
echo Only allow user SvnSync. &gt;&amp;2
exit 1
}}}
此動作是檢查使用者帳號是否為SvnSync (大小寫有分)
如果要不分大小寫 請將此行改為
{{{
if /I not '%user%'=='SvnSync' goto ERROR_USERNAME
}}}
接下來要對此檔案庫做初始化的動作 讓他知道要跟哪個來源作同步
{{{
svnsync init --username SvnSync --password XXX 目標檔案庫位址 來源檔案庫位址
}}}
這一個命令的目標跟來來源都是使用位址 因此可以使用本地端或是遠端路徑
例如
{{{
svnsync init --username SvnSync --password XXX file:///E:/SVNBackup/DestRepository svn://SVNServer/SourceRepository
}}}
注意 本地端位置中斜線的方向跟數量

最後就是同步的動作
{{{
svnsync sync --username SvnSync --password XXX 目標檔案庫位址
}}}
同樣的 我們可以寫一些批次檔來達成自動化的目的
方式是在來源檔案庫的hooks的目錄下 建立一個新檔案叫做
&quot;post-commit.bat&quot;
他會在來源檔案庫接受每一次的Commit之後啟動 內容為下
{{{
@echo off
svnsync sync --non-interactive --username SvnSync --password XXX svn://SVNServer2/DestRepository
}}}
這邊是備份到跟來源檔案庫不同的Server上
可以依據每個人不同的需求作更動...

結論是 新的1.4版中的svnsync實在很好用
上半段文章看看就好 使用hotcopy的方式實在是太浪費磁碟空間了
不過前提示 要先把伺服器換成1.4版或以後的版本
並且 目標檔案庫必須是使用1.4版以後的svnadmin所建立的

另外可以發現 寫一些批次檔放進hooks目錄中
可以達成蠻多功能的 有興趣可以網路上搜尋一下文章看看

希望此文章對有使用SVN並架設在Windows上的人有一些幫助</pre>
</div>
<div title="tagCloud" modifier="fhopecc" modified="200710040439" created="200709170031" tags="systemConfig" changecount="2">
<pre>version.extensions.tagCloud = {major: 1, minor: 0 , revision: 0, date: new Date(2006,2,04)};
//Created by Clint Checketts, contributions by Jonny Leroy and Eric Shulman

config.macros.tagCloud = {
 noTags: &quot;No tag cloud created because there are no tags.&quot;,
 tooltip: &quot;%1 tiddlers tagged with '%0'&quot;
};

config.macros.tagCloud.handler = function(place,macroName,params) {
 
var tagCloudWrapper = createTiddlyElement(place,&quot;div&quot;,null,&quot;tagCloud&quot;,null);

var tags = store.getTags();
for (var t=0; t&lt;tags.length; t++) {
  for (var p=0;p&lt;params.length; p++) if (tags[t][0] == params[p]) tags[t][0] = &quot;&quot;;
}

 if(tags.length == 0) 
   createTiddlyElement(tagCloudWrapper,&quot;span&quot;,null,null,this.noTags);
 //Findout the maximum number of tags
 var mostTags = 0;
 for (var t=0; t&lt;tags.length; t++) if (tags[t][0].length &gt; 0){
  if (tags[t][1] &gt; mostTags) mostTags = tags[t][1];
 }
 //divide the mostTags into 4 segments for the 4 different tagCloud sizes
 var tagSegment = mostTags / 4;

  for (var t=0; t&lt;tags.length; t++) if (tags[t][0].length &gt; 0){
 var tagCloudElement = createTiddlyElement(tagCloudWrapper,&quot;span&quot;,null,null,null);
 tagCloudWrapper.appendChild(document.createTextNode(&quot; &quot;));
 var theTag = createTiddlyButton(tagCloudElement,tags[t][0],this.tooltip.format(tags[t]),onClickTag,&quot;tagCloudtag tagCloud&quot; + (Math.round(tags[t][1]/tagSegment)+1));
  theTag.setAttribute(&quot;tag&quot;,tags[t][0]);
 }

};

setStylesheet(&quot;.tagCloud span{height: 1.8em;margin: 3px;}.tagCloud1{font-size: 1.2em;}.tagCloud2{font-size: 1.4em;}.tagCloud3{font-size: 1.6em;}.tagCloud4{font-size: 1.8em;}.tagCloud5{font-size: 1.8em;font-weight: bold;}&quot;,&quot;tagCloudsStyles&quot;);</pre>
</div>
<div title="tar" modifier="fhopecc" created="200709190812" tags="unix" changecount="1">
<pre>!tar
{{{
[root@linux ~]# tar [-cxtzjvfpPN] 檔案與目錄 ....
參數：
-c  ：建立一個壓縮檔案的參數指令(create 的意思)；
-x  ：解開一個壓縮檔案的參數指令！ 
-t  ：查看 tarfile 裡面的檔案！
      特別注意，在參數的下達中， c/x/t 僅能存在一個！不可同時存在！
      因為不可能同時壓縮與解壓縮。
-z  ：是否同時具有 gzip 的屬性？亦即是否需要用 gzip 壓縮？
-j  ：是否同時具有 bzip2 的屬性？亦即是否需要用 bzip2 壓縮？
-v  ：壓縮的過程中顯示檔案！這個常用，但不建議用在背景執行過程！
-f  ：使用檔名，請留意，在 f 之後要立即接檔名喔！不要再加參數！
　　　例如使用『 tar -zcvfP tfile sfile』就是錯誤的寫法，要寫成
　　　『 tar -zcvPf tfile sfile』才對喔！
-p  ：使用原檔案的原來屬性（屬性不會依據使用者而變） 
-P  ：可以使用絕對路徑來壓縮！
-N  ：比後面接的日期(yyyy/mm/dd)還要新的才會被打包進新建的檔案中！ 
--exclude FILE：在壓縮的過程中，不要將 FILE 打包！ 
範例：
範例一：將整個 /etc 目錄下的檔案全部打包成為 /tmp/etc.tar 
[root@linux ~]# tar -cvf /tmp/etc.tar /etc  &lt;==僅打包，不壓縮！
[root@linux ~]# tar -zcvf /tmp/etc.tar.gz /etc  &lt;==打包後，以 gzip 壓縮
[root@linux ~]# tar -jcvf /tmp/etc.tar.bz2 /etc  &lt;==打包後，以 bzip2 壓縮
# 特別注意，在參數 f 之後的檔案檔名是自己取的，我們習慣上都用 .tar 來作為辨識。
# 如果加 z 參數，則以 .tar.gz 或 .tgz 來代表 gzip 壓縮過的 tar file ～
# 如果加 j 參數，則以 .tar.bz2 來作為附檔名啊～
# 上述指令在執行的時候，會顯示一個警告訊息：
# 『tar: Removing leading `/' from member names』那是關於絕對路徑的特殊設定。

範例二：查閱上述 /tmp/etc.tar.gz 檔案內有哪些檔案？
[root@linux ~]# tar -ztvf /tmp/etc.tar.gz 
# 由於我們使用 gzip 壓縮，所以要查閱該 tar file 內的檔案時，
# 就得要加上 z 這個參數了！這很重要的！

範例三：將 /tmp/etc.tar.gz 檔案解壓縮在 /usr/local/src 底下
[root@linux ~]# cd /usr/local/src
[root@linux src]# tar -zxvf /tmp/etc.tar.gz
# 在預設的情況下，我們可以將壓縮檔在任何地方解開的！以這個範例來說，
# 我先將工作目錄變換到 /usr/local/src 底下，並且解開 /tmp/etc.tar.gz ，
# 則解開的目錄會在 /usr/local/src/etc 呢！另外，如果您進入 /usr/local/src/etc
# 則會發現，該目錄下的檔案屬性與 /etc/ 可能會有所不同喔！

範例四：在 /tmp 底下，我只想要將 /tmp/etc.tar.gz 內的 etc/passwd 解開而已
[root@linux ~]# cd /tmp
[root@linux tmp]# tar -zxvf /tmp/etc.tar.gz etc/passwd
# 我可以透過 tar -ztvf 來查閱 tarfile 內的檔案名稱，如果單只要一個檔案，
# 就可以透過這個方式來下達！注意到！ etc.tar.gz 內的根目錄 / 是被拿掉了！

範例五：將 /etc/ 內的所有檔案備份下來，並且保存其權限！
[root@linux ~]# tar -zcvpf /tmp/etc.tar.gz /etc
# 這個 -p 的屬性是很重要的，尤其是當您要保留原本檔案的屬性時！

範例六：在 /home 當中，比 2005/06/01 新的檔案才備份
[root@linux ~]# tar -N '2005/06/01' -zcvf home.tar.gz /home

範例七：我要備份 /home, /etc ，但不要 /home/dmtsai 
[root@linux ~]# tar --exclude /home/dmtsai -zcvf myfile.tar.gz /home/* /etc

範例八：將 /etc/ 打包後直接解開在 /tmp 底下，而不產生檔案！ 
[root@linux ~]# cd /tmp
[root@linux tmp]# tar -cvf - /etc | tar -xvf -
# 這個動作有點像是 cp -r /etc /tmp 啦～依舊是有其有用途的！
# 要注意的地方在於輸出檔變成 - 而輸入檔也變成 - ，又有一個 | 存在～
# 這分別代表 standard output, standard input 與管線命令啦！
# 這部分我們會在 Bash shell 時，再次提到這個指令跟大家再解釋囉！

這是一個多用途的壓縮指令！剛剛我們提到的 compress 與 gzip 是可以適用在一個檔案的壓縮上面， 但是如果是要將一個目錄壓縮成一個檔案呢？！這時該如何是好？！呵呵！ tar 就派上用場了！ tar 可以將整個目錄或者是指定的檔案都整合成一個檔案！例如上面的範例一，他可以將 /etc 底下的檔案全部整合成一個檔案！同時， tar 可以配合 gzip (這個 gzip 的功能已經已經附加上 tar 裡面去了) ，同時整合並壓縮！呵呵！很方便吧！

『 tar 用來作備份是很重要的指令！ 』而由於 tar 整合過後的檔案我們通常會取名為 *.tar ，而如果還含有 gzip 的壓縮屬性，那麼就取名為 *.tar.gz 囉！取這個檔名只是為了方便我們記憶這個檔案是什麼屬性罷了！並沒有實際的意義在！
}}}</pre>
</div>
<div title="test" modifier="fhopecc" created="200804090847" changecount="1">
<pre>&lt;&lt;currentLNDAuditor&gt;&gt;</pre>
</div>
<div title="tooltip in html" modifier="Fhopecc" created="200709241133" tags="html" changecount="1">
<pre>Creating tooltips using the title attribute of HTML

Images have long supported the &quot;alt&quot; attribute, which displays a textual tooltip when the mouse moves over it.

&lt;img src=&quot;monster&quot; alt=&quot;Big scary monster&quot;&gt;

Big scary monster

That's fine, and even great, but why should images get all the glory? Shouldn't other elements inside the document be able to carry a tooltip as well, such as a text link or form element? Wouldn't that be pretty cool, not be mention crucial in guiding devises with limited capabilities such as PDAs navigate your site and its various elements? Well, starting in HTML 4, the concept of the &quot;alt&quot; attribute for images have been expanded to all elements on the page.
The title attribute

Here's the idea: HTML 4 supports a &quot;title&quot; attribute that can be inserted inside any HTML tag. Inserting this attribute effectively gives the element a tooltip that pops up when the mouse moves over it. Are you prepared to give a text link a tooltip? Here goes:

&lt;a href=&quot;http://www.dynamicdrive.com&quot; title=&quot;Free DHTML and JavaScripts&quot;&gt;Dynamic Drive&lt;/a&gt;

Dynamic Drive

The title attribute is supported in all modern web browsers, and can be applied to virtually any element that falls under the &lt;body&gt; tag. Let's see a couple of more examples:

&lt;form&gt;
&lt;input type=&quot;text&quot; size=25 title=&quot;Enter your email address here&quot;&gt;
&lt;input type=&quot;button&quot; value=&quot;Submit&quot;&gt;
&lt;/form&gt;

JavaScript Kit

&lt;div title=&quot;JavaScript Kit&quot;&gt;JavaScript Kit&lt;/div&gt;

Scripting the title attribute

For most of you, simply knowing how to use the title attribute is probably good enough, but just in case you need to, JavaScript does provide a way for you to access the title attribute programmatically (in your scripts), and change its value dynamically. This is possible through a property of all HTML elements named &quot;title&quot; (appropriately enough) that contains the text inside the title attribute, and is read/write.

A script is worth a thousand words, so I first illustrate, then explain:

&lt;b id=&quot;text1&quot; title=&quot;A bold text&quot;&gt;Hello my friends!&lt;/a&gt;

&lt;script type=&quot;text/javascript&quot;&gt;
document.getElementById(text1).title=&quot;New tooltip&quot;
&lt;/script&gt;

The next question is figuring out when you'll actually want to use JavaScript to manipulate the title attribute!</pre>
</div>
<div title="toyota" modifier="fhopecc" created="200711220037" tags="公司 汽車保養" changecount="1">
<pre>|toyota|美崙修車廠|
廖文益|038223122|0932656603|</pre>
</div>
<div title="traceroute" modifier="fhopecc" modified="200805300242" created="200709100702" tags="網路檢測 unix" changecount="13">
<pre>traceroute
我們前面談到的指令大多數都是針對主機的網路參數設定所需要的，而 ping 是兩部主機之間的回聲與否判斷， 那麼有沒有指令可以追蹤兩部主機之間通過的各個節點 (node) 通訊狀況的好壞呢？ 舉例來說，如果我們連線到 yahoo 的速度比平常慢，你覺得是 (1)自己的網路環境有問題？ (2)還是外部的 Internet 有問題？如果是 (1) 的話，我們當然需要檢查自己的網路環境啊， 看看是否又有誰中毒了？但如果是 Internet 的問題呢？那只有『等等等』啊！ 判斷是 (1) 還是 (2) 就得要使用 traceroute 這個指令啦！
{{{
[root@linux ~]# traceroute [-nwig] IP
參數：
-n ：可以不必進行主機的名稱解析，單純用 IP ，速度較快！
-w ：若對方主機在幾秒鐘內沒有回聲就宣告不治...預設是 5 秒
-i ：用在比較複雜的環境，如果你的網路介面很多很複雜時，才會用到這個參數；
     舉例來說，你有兩條 ADSL 可以連接到外部，那你的主機會有兩個 ppp，
     你可以使用 -i 來選擇是 ppp0 還是 ppp1 啦！
-g ：與 -i 的參數相仿，只是 -g 後面接的是 gateway 的 IP 就是了。

範例一：
[root@linux ~]# traceroute -n tw.yahoo.com
traceroute to tw.yahoo-ap1.akadns.net (203.84.202.164), 30 hops max, 38 byte packets
 1  61.59.121.1  42.174 ms  41.690 ms  41.058 ms
 2  139.175.172.2  40.962 ms  41.978 ms  40.973 ms
 3  192.72.122.130  40.983 ms  41.930 ms  41.003 ms
 4  139.175.58.210  42.956 ms  41.997 ms  42.337 ms
 5  139.175.58.153  47.591 ms  47.972 ms  48.748 ms
 6  139.175.56.30  48.193 ms  47.970 ms  47.986 ms
 7  139.175.57.94  47.959 ms  47.951 ms  47.985 ms
 8  139.175.56.138  48.363 ms  47.586 ms  47.995 ms
 9  139.175.58.42  49.256 ms  50.668 ms  47.490 ms
10  61.58.33.133  201.882 ms  201.565 ms  200.973 ms
11  61.58.33.50  199.910 ms  199.019 ms  198.961 ms
12  203.84.200.226  202.391 ms  202.567 ms  209.283 ms
}}}
這個 traceroute 挺有意思的，這個指令會針對欲連接的目的地之所有 router 進行 ICMP 的逾時等待， 例如上面的例子當中，由鳥哥的主機連接到 Yahoo 時，他會經過 12 個節點，traceroute 會主動的對這 12 個節點做 ICMP 的回聲等待，並偵測回覆的時間，每個節點會偵測三次。 所以像上頭顯示的結果，發現每個節點其實回覆的時間大約在 200 ms 以內，算是還可以的 Internet 環境了。 而且由上面的資訊來看，可以看出在 61.58.33.133 這個節點後的傳輸延遲較久，至於之前的 9 個節點則有不錯的表現。透過這種解析，可以讓您瞭解到這條連線是那個環節出了問題喔。

另外，如果在預設的 5 秒鐘之內 traceroute 聽不到節點的回聲，那麼螢幕上就會跑出一個『 * 』的符號， 告知該節點無法有順利的回應。由於我們的 traceroute 用的是 ICMP 封包，有些防火牆或者主機可能會將 ICMP 可通過的權力拿掉，因此就會造成等不到回聲的狀態！另外，有些 gateway 本來就不支援 traceroute 的功能，因此也會產生那個『 * 』的狀況。所以分析時得要注意一下吶！
</pre>
</div>
<div title="tracert" modifier="fhopecc" created="200804220148" tags="網路檢測 WINDOWS" changecount="1">
<pre>Tracert以逐漸遞增的 Time to Live (TTL) 欄位值傳送 Internet Control Message Protocol (ICMP)， 回應要求訊息至目的地，以決定到達目的地的路徑。顯示的路徑是指來源主機與目的地之間的路徑，其路由器之近端路由器介面所組成的清單。近端介面是指路徑上最接近傳送端主機的路由器介面。若不使用參數，則 tracert 顯示說明。

語法
tracert [-d] [-h MaximumHops] [-j HostList] [-w Timeout] [TargetName]

參數
-d 
防止 tracert 試圖將中間路由器的 IP 位址轉換成其名稱。這可加速顯示 tracert 結果。 
-h MaximumHops 
在搜尋目標 (目的地) 的路徑中指定最大的躍點數目。預設為 30 個躍點。 
-j HostList 
指定「回應要求」訊息，以指定於 HostList 的一組中間目的 IP 標題，使用 [鬆散來源路徑] 選項。透過 [鬆散來源路徑] 功能，連續的中介目的地可使用一或多個路由器來區隔。主機清單中的位址或名稱的最大數為 9。HostList 是由空格分隔的 IP 位址 (以小數點標記) 系列。 
-w Timeout 
以毫秒指定等待 ICMP Time Exceeded 或 Echo Reply 訊息的時間量，此訊息對應接收之給定的 Echo Request 訊息。如果在逾時期間內未接收，則顯示星號 (*)。預設等候逾時為 4000 (4 秒)。 
TargetName 
指定目的地 (由 IP 位址或主機名稱所識別)。 
-? 
在命令提示字元上顯示說明。 
備註
此診斷工具以不同的 Time to Live (TTL) 值傳送 ICMP Echo Request 訊息至目的地，以決定到達目的地的路徑。在轉寄封包之前，路徑上的每一台路由器都需要將 IP 封包上的 TTL 至少減少 1。實際上，TTL 是最大連結計數器。當封包上的 TTL 為 0 時，路由器將預期把 ICMP Time Exceeded 訊息傳送給來源電腦。Tracert 會傳送第一個 TTL 為 1 的 Echo Request 訊息，並將每個後續傳輸的 TTL 都以 1 遞增，直到目標回應或達到 躍點最大值，以判定路徑。依預設，最大躍點數是 30，並可使用 -h 參數指定。路徑由檢查中間路由器傳回的 ICMP Time Exceeded 訊息及目的地傳回的 Echo Reply 訊息來決定。然而，有些路由器不傳回具有過期 TTL 值之封包的 Time Exceeded 訊息，且 tracert 指令看不到它們。在此情況下，會針對該躍點顯示一列星號 (*)。 
若要追蹤路徑並提供網路延遲與封包遺失給路徑上的每一個路由器和連結，請使用 pathping 指令。 
唯有將 Internet Protocol (TCP/IP) 通訊協定，在 [網路連線] 中安裝為網路介面卡內容的元件，才能使用此指令。 
範例
若要追蹤通往主機 corp7.microsoft.com 的路徑，請鍵入：

tracert corp7.microsoft.com

若要追蹤通往主機 corp7.microsoft.com 的路徑，並防止每一個 IP 位址轉換成其名稱，請鍵入：

tracert -d corp7.microsoft.com

若要追蹤通往主機 corp7.microsoft.com 的路徑，並使用鬆散來源路徑 10.12.0.1-10.29.3.1-10.1.44.1，請鍵入：

tracert -j 10.12.0.1 10.29.3.1 10.1.44.1 corp7.microsoft.com
</pre>
</div>
<div title="unix_mbox" modifier="fhopecc" modified="200802120807" created="200802010705" tags="unix thunderbird" changecount="3">
<pre>Unix mbox format

This document describes the format traditionally used by Unix hosts to store mail messages locally. mbox files typically reside in the system's mail spool, under various names in users' Mail directories, and under the name mbox in users' home directories.

An ''mbox'' is a text file containing an arbitrary number of e-mail messages. Each message consists of a ''postmark'', followed by an e-mail message formatted according to RFC 822. The file format is line-oriented. Lines are separated by line feed characters (ASCII 10).

A postmark line consists of the four characters &quot;From&quot;, followed by a space character, followed by the message's envelope sender address, followed by whitespace, and followed by a time stamp. The sender address is expected to be an addrspec as defined in appendix D of RFC 822.

The date is expected to be formatted according to the following syntax (represented in the augmented Backus-Naur formalism used by RFC 822):

mbox-date	=	weekday month day time [ timezone ] year
weekday	=	&quot;Mon&quot; / &quot;Tue&quot; / &quot;Wed&quot; / &quot;Thu&quot; / &quot;Fri&quot;
		/ &quot;Sat&quot; / &quot;Sun&quot;
month	=	&quot;Jan&quot; / &quot;Feb&quot; / &quot;Mar&quot; / &quot;Apr&quot; / &quot;May&quot;
		/ &quot;Jun&quot; / &quot;Jul&quot; / &quot;Aug&quot; / &quot;Sep&quot;
		/ &quot;Oct&quot; / &quot;Nov&quot; / &quot;Dec&quot;
day	=	1*2DIGIT
time	=	1*2DIGIT &quot;:&quot; 1*2DIGIT [ &quot;:&quot; 1*2DIGIT ]
timezone	=	( &quot;+&quot; / &quot;-&quot; ) 4DIGIT
year	=	( 4DIGIT / 2DIGIT )

For compatibility reasons with legacy software, two-digit years greater than or equal to 70 should be interpreted as the years 1970+, while two-digit years less than 70 should be interpreted as the years 2000-2069.

Software reading files in this format should also be prepared to accept non-numeric timezone information such as &quot;CET DST&quot; for Central European Time, dailight saving time.

Example:

From noone@example.org Fri Jun 23 02:56:55 2000

In order to avoid mis-interpretation of lines in message bodies which begin with the four characters &quot;From&quot;, followed by a space character, the character &quot;&gt;&quot; is commonly prepended in front of such lines.

----
mbox(5)            Headers, Tables, and Macros            mbox(5)



NAME
     mbox - file containing mail messages

INTRODUCTION
     The most common format for storage of mail messages is  mbox
     format.   An  mbox  is a single file containing zero or more
     mail messages.

MESSAGE FORMAT
     A message encoded in mbox format begins with a  From_  line,
     continues  with a series of non-From_ lines, and ends with a
     blank line.  A From_ line means any line  that  begins  with
     the characters F, r, o, m, space:

          From god@heaven.af.mil Sat Jan  3 01:05:34 1996
          Return-Path: &lt;god@heaven.af.mil&gt;
          Delivered-To: djb@silverton.berkeley.edu
          Date: 3 Jan 1996 01:05:34 -0000
          From: God &lt;god@heaven.af.mil&gt;
          To: djb@silverton.berkeley.edu (D. J. Bernstein)

          How's that mail system project coming along?


     The final line is a completely  blank  line  (no  spaces  or
     tabs).  Notice that blank lines may also appear elsewhere in
     the message.

     The  From_  line  always  looks  like  From  envsender  date
     moreinfo.  envsender is one word, without spaces or tabs; it
     is usually the envelope sender of the message.  date is  the
     delivery date of the message.  It always contains exactly 24
     characters in asctime format.  moreinfo is optional; it  may
     contain arbitrary information.

     Between the From_ line and the blank line is  a  message  in
     RFC  822 format, as described in qmail-header(5), subject to
     &gt;From quoting as described below.

HOW A MESSAGE IS DELIVERED
     Here is how a program appends a message to an mbox file.

     It first creates a From_ line given the  message's  envelope
     sender  and  the  current  date.   If the envelope sender is
     empty (i.e., if this is a bounce message), the program  uses
     MAILER-DAEMON  instead.   If  the  envelope  sender contains
     spaces, tabs, or newlines, the program  replaces  them  with
     hyphens.

     The program then copies the message, applying &gt;From  quoting
     to  each  line.   &gt;From  quoting  ensures that the resulting
     lines are not From_ lines:  the program prepends a &gt; to  any



SunOS 5.5                 Last change:                          1






mbox(5)            Headers, Tables, and Macros            mbox(5)



     From_ line, &gt;From_ line, &gt;&gt;From_ line, &gt;&gt;&gt;From_ line, etc.

     Finally the program appends a blank line to the message.  If
     the  last  line of the message was a partial line, it writes
     two newlines; otherwise it writes one.

HOW A MESSAGE IS READ
     A reader scans through an mbox file looking for From_ lines.
     Any From_ line marks the beginning of a message.  The reader
     should not attempt to take advantage of the fact that  every
     From_ line (past the beginning of the file) is preceded by a
     blank line.

     Once the reader finds a message,  it  extracts  a  (possibly
     corrupted)  envelope  sender  and  delivery  date out of the
     From_ line.  It then reads until the next From_ line or  end
     of  file,  whichever  comes  first.  It strips off the final
     blank line and deletes  the  quoting  of  &gt;From_  lines  and
     &gt;&gt;From_ lines and so on.  The result is an RFC 822 message.

COMMON MBOX VARIANTS
     There  are  many  variants  of  mbox  format.   The  variant
     described above is mboxrd format, popularized by Rahul Dhesi
     in June 1995.

     The original mboxo  format  quotes  only  From_  lines,  not
     &gt;From_ lines.  As a result it is impossible to tell whether

          From: djb@silverton.berkeley.edu (D. J. Bernstein)
          To: god@heaven.af.mil

          &gt;From now through August I'll be doing beta testing.
          Thanks for your interest.

     was quoted in the original message.  An mboxrd  reader  will
     always strip off the quoting.

     mboxcl format is like mboxo format, but includes a  Content-
     Length  field  with  the  number  of  bytes  in the message.
     mboxcl2 format is like mboxcl  but  has  no  &gt;From  quoting.
     These  formats  are used by SVR4 mailers.  mboxcl2 cannot be
     read safely by mboxrd readers.

UNSPECIFIED DETAILS
     There are many locking mechanisms for  mbox  files.   qmail-
     local  always  uses flock on systems that have it, otherwise
     lockf.

     The delivery date in a From_ line does not  specify  a  time
     zone.   qmail-local  always creates the delivery date in GMT
     so that mbox files can be safely transported from  one  time
     zone to another.



SunOS 5.5                 Last change:                          2</pre>
</div>
<div title="utllock" modifier="fhopecc" created="200810070939" tags="ORACLE" changecount="1">
<pre>查 lockl</pre>
</div>
<div title="weblogic" modifier="fhopecc" modified="200711220303" created="200711220301" tags="weblogic" changecount="3">
<pre>!啟動停止服務
{{{
# 啟動服務
/etc/rc.d/rc2.d/S99bea.cssd start
# 停止服務
/etc/rc.d/rc2.d/S99bea.cssd stop
}}}</pre>
</div>
<div title="window.location" modifier="Fhopecc" created="200709211347" tags="Javascript" changecount="2">
<pre>!window.location
設定此屬性值可以有重導向 (redirect) 的功能
{{{
&lt;HEAD&gt;
&lt;SCRIPT language=&quot;JavaScript&quot;&gt;
&lt;!--
window.location=&quot;http://someplace.com&quot;;
//--&gt;
&lt;/SCRIPT&gt;
&lt;/HEAD&gt;
}}}</pre>
</div>
<div title="下拉選單" modifier="fhopecc" created="200708270640" tags="如何使用wiki" changecount="1">
<pre>!說明
這個[[巨集]]的功能很好玩，可以把一個 Tiddler 製作成''滑動式方塊''，用滑鼠點選產生的連結，可以滑動式的展開或收合 Tiddler 的內容。
!用法
{{{
&lt;&lt;slider chkSlider '如何做...' '如何做…' '所有如何做… Tiddler 列表'&gt;&gt;&gt;
}}}
*slider：這個巨集的名稱。
*chkSlider：用來儲存 slider 是展開或收合狀態的瀏覽器 cookie 變數名稱。
*第一個&quot;如何做…&quot;： Tiddler 的標題。
*第二個&quot;如何做…&quot;： 產生的連結上顯示的文字。
*'所有……'：滑鼠停在 slider 連結上時會顯示在游標右下角的說明文字。
!效果
&lt;&lt;slider chkSlider 如何做… 如何做… '所有如何做… Tiddler 列表'&gt;&gt;</pre>
</div>
<div title="中信標" modifier="fhopecc" modified="200711230319" created="200711230315" changecount="3">
<pre>~PhotoImpact 中文版 (內含Gif Animator中文版)最新版_單套盒裝	 	套	NT$ 2,891
~CorelDRAW 最新版中文盒裝(win)	 	套	NT$ 15,080</pre>
</div>
<div title="中期目標" modifier="fhopecc" modified="200802210836" created="200711070103" changecount="2">
<pre>#完成[[HIS專案]]
#完成[[MRAS論文]],[[碩3下]]
#完成ParserGenerator專案
#通過TOEIC高級</pre>
</div>
<div title="中華電信" modifier="fhopecc" modified="200711220032" created="200711220030" tags="公司" changecount="2">
<pre>|花蓮中華電信|8511824|</pre>
</div>
<div title="中華電信時數入終身學習" modifier="fhopecc" modified="200808020202" created="200805160126" tags="重要事項 完成事項" changecount="3">
<pre></pre>
</div>
<div title="中華電信板橋電信訓練所" modifier="fhopecc" modified="200802260929" created="200801310050" tags="地點" changecount="12">
<pre>|中華電信板橋電信訓練所|&gt;|
|地 址|台北縣板橋市民族路168號|
|公車|請搭乘231、245青山線、265、307號公車至電信訓練所站下車|
|捷運|請搭乘板南線至新埔站下車再轉乘245青山線公車至電信訓練所站下車或至板橋站再轉乘307公車或步行15分鐘：步道、民安街、海山路、訓練所(民權街、民族路、訓練所) 火車：請至板橋火車站下車再轉乘307公車或步行15分鐘：步道、民安街、海山路、訓練所(或民權路、民族路、訓練所)|
[img[file:///d:/fhopecc/twFhopecc/image/中華電信板橋電信訓練所地圖.jpg]]</pre>
</div>
<div title="亞培" modifier="fhopecc" modified="200807260917" created="200807260902" tags="奶粉" changecount="7">
<pre>亞培
|高慧芬|0927939313|03355178#312|
|謝文儀|0928166330|210$NT/400g|
!S26
|0912906976|025591305|</pre>
</div>
<div title="交年度預算" modifier="YourName" created="200704132343" tags="chkTodo xAA">
<pre>1027以前</pre>
</div>
<div title="人事系統問題" modifier="fhopecc" modified="200809170119" created="200809160704" tags="緊急事項 完成事項" changecount="4">
<pre>service 無法起來
&lt;&lt;tiddler 人事系統廠商&gt;&gt;</pre>
</div>
<div title="人事系統廠商" modifier="fhopecc" modified="200807150543" created="200807140159" tags="資訊廠商" changecount="2">
<pre>!穎順科技
李經理0920387322
!辛經理 刷卡機廠商
0422383303
0928655600
要配四個 IP
</pre>
</div>
<div title="人工智慧學會碩博士論文獎" modifier="fhopecc" created="200712261243" tags="論文獎" changecount="1">
<pre>人工智慧學會碩博士論文獎作業要點

一、宗旨

為落實本會第五屆第三次理監事會議之決議，鼓勵國內研究所學生從事人工智慧學相關研究，並有重要貢獻者，特訂定本作業要點。

二、獎項

分為碩士論文組及博士論文組，碩士論文獎獎額至多三人，博士論文獎獎額至多一人，均得從缺。

三、申請人資格

國內公私立大學院校研究所研究生在申請截止日前一學年度內完成畢業論文口試者，不限科系。

四、獎勵方式

•  碩博士論文獎每人獲頒獎牌一面及人工智慧學會永久會員之權利。 ( 永久會員會費為新台幣 12000 元及同時可享受各項 TAAI 會員福利。 )

•  得獎論文之指導教授亦將獲得獎狀一紙。

•  為肯定得獎人研究成果，本學會將在當年度之 TAAI 研討會以公開儀式頒發獎狀、獎牌。

•  得獎論文之摘要將刊登在當年度之 TAAI 研討會論文集，碩博士論文獎得獎人並將獲邀在會中發表成果，且由本會負擔旅運費（實報實銷，上限新台幣五千元）。

五、申請辦法

•  申請人提出申請須檢附下列文件，以郵戳為憑於每年八月一日前提送本會秘書處。

•  紙本申請表一份 （如附件表格）

•  內含畢業論文電子檔（ PDF 格式），簡報檔（ PPT 格式或 PDF 格式）及學歷證件（學生證影本、畢業證書影本或在學證明等）掃描檔（ JPG 格式）的光碟一張。光碟內可同時含有其他對評審審查有幫助的任何內容，如可安裝執行之軟體程式、系統展示影音檔、推薦信、相關著作、比賽得獎之獎狀掃描檔等。

•  申請人應負責光碟之可讀性，並自行說明內容（請內含一 README 文字檔）使審查程序得以順利進行。

•  本會除交由審查人員評審使用，以及『四、獎勵方式』所規定之發表方式以外，不會在其他方面使用光碟之內容。

•  本會不要求轉移光碟內容之著作權。但本會不保證光碟內容之保密，亦不退還光碟。

 

六、審查程序

•  評選應由本會理監事會議推選審查委員會五至七位組成之。

•  由審查委員會進行初審後，邀請國內外相關專家進行複審。審查委員會應依據專家之複審意見後決定各組得獎名單。

•  初審之任務為過濾申請文件不合者，及篩選對人工智慧有貢獻之論文。

•  複審之任務為就初審通過之論文內容創新性 (20%) 、正確性 (30%) 、文圖呈現 (presentation)(20%) 、研究成果貢獻度 (30%) 等方面進行評比。

•  申請人之指導教授，以及與申請人研究計畫相關之人員，應迴避擔任審查委員，同時應迴避擔任評審專家。

•  審查結果應於每年九月十五日前公布於學會網站，並以電子郵件通知申請人。
七、本作業要點經本會理監事會議通過，理事長核定後公布實施，修訂時亦同。
       (本作業要點已經由九十六年五月十九日第七屆第二次理監事會議修正通過。)</pre>
</div>
<div title="以遞降法剖析標籤語言" modifier="Fhopecc" modified="200708261227" created="200708260340" tags="編譯器原理">
<pre>{{{
other''content''other
}}}
上面用 {{{''}}} 括起來的字串，便將它與其它字串區分開來，
如何剖析上面這種語言呢？
{{{
M := (O|T)*
T := ''S''
}}}
剖析語言，首先要能寫出描述它的文法，以上就是這種語言的文法。
我們使用''遞降法''來剖析此語言。
首先為每個非終端元定義其
{{{
def M(s) #M := (O|T)*
  until s.eos?
     if s.check(/''/) then T(s) else O(s) end
  end
end
}}}


{{{
	def apply_em_style(src)
		s = StringScanner.new(src)
		def s.o
      @o
		end
		def s.o=(newo)
			@o = newo
		end
		s.o=&quot;&quot;
		M(s);s.o
	end



  def T(s)
		s.scan(/''/);s.o+=&quot;&lt;em&gt;&quot;;S(s);s.o+=&quot;&lt;/em&gt;&quot;
	end

	def S(s)
		s.o+=s.scan(/[^']*/)
		if s.check(/''/)
      s.scan(/''/)
		else
			s.o+=s.scan(/'/);S(s)
		end
	end
  
	def O(s)
		if s.check(/'/)
			s.o+=s.scan(/'/);O(s)
		else
			s.o+=s.scan(/[^']*/)
		end
	end
}}}</pre>
</div>
<div title="伍晉居" modifier="fhopecc" modified="200803180039" created="200709120257" changecount="6">
<pre>0936820762
8310027
8349393
討論它的網站如何做</pre>
</div>
<div title="低收入戶證明申請期間" modifier="fhopecc" created="200710040634" tags="稅捐處業務" changecount="1">
<pre>!排程
&lt;&lt;reminder month:10 day:15 title:&quot;低收入戶證明申請期間&quot; leadtime:15&gt;&gt;
!注意事項
#民眾會利用多功能櫃檯查調財產，盡量不要干擾線上活動</pre>
</div>
<div title="余美珠" modifier="fhopecc" created="200808280827" changecount="1">
<pre>0916940419</pre>
</div>
<div title="例行事項" modifier="fhopecc" modified="200902040137" created="200808040257" changecount="9">
<pre>&lt;&lt;newJournal 'YYYY.MM.DD' label:&quot;新增例行事項&quot; focus:title tag:例行事項&gt;&gt;&lt;&lt;forEachTiddler
 where 'tiddler.tags.contains(&quot;例行事項&quot;) &amp;&amp;
             ! tiddler.tags.contains(&quot;完成事項&quot;)'
 sortBy 'tiddler.title'
 script ' function getFirstLine(s) { var m = s.match(/\s*(.*)/);
            return m != null &amp;&amp; m.length &gt;= 1 ? m[1] : &quot;&quot;;  } '
 write '&quot;|[X(&quot;+tiddler.title+&quot;:完成事項)] |[[&quot;+tiddler.title+&quot;]]|&quot;+getFirstLine(tiddler.text)+&quot;|\n&quot;'
&gt;&gt;</pre>
</div>
<div title="例行報表" modifier="fhopecc" modified="200710010831" created="200709030043" tags="稅捐處業務" changecount="15">
<pre>!每月例行報表
# 月初報[[機時統計報表]]至中辦及財稅中心
# 每月5日前執行YHQ705L_查詢統計表列印mail件數給桃園縣稅捐處
# 月初執行YHQ705L_查詢清冊列印分送業務課
# 月初執行EGX315L_＊列印非欠稅查調清單送政風室
# 月初清SCO之XUML901、XUML902
# 月初備份前2個月elt/shared_tmp/log/batchlog之執行結果檔
# 月初刪除前2個月elt/shared_tmp/rpt/temp之過渡檔
!每月來文報表
# 稅收退稅快報
!資訊稽核
# 5日前詢問本月查核土地歸戶查詢作業之稽核委員欲查核之(上月)日期請地價系統列印查詢記錄日報表交稽核委員
# 每年8-10月執行本年度資訊稽核作業
# 每年至少執行專案稽核乙次
# 每年至少執行災變回復演練乙次
# 每年8-9月執行本課度內部稽核作業</pre>
</div>
<div title="信用卡帳單週期" modifier="fhopecc" modified="200712241108" created="200710120111" tags="財務" server.type="file" server.host="file://D:\sfhopecc\stwFhopecc\sfhopetw.bak.htm" server.page.revision="200712241108">
<pre>&lt;&lt;reminder day: title:帳單寄送日 leadtime:3&gt;&gt;
&lt;&lt;reminder day:5 title:付款截止日 leadtime:5&gt;&gt;
!郵局劃撥
０１１２６１１９　中國信託 商業銀行 備註：身份證</pre>
</div>
<div title="信箱的問題反應給柯泰成" modifier="fhopecc" modified="200806020109" created="200805230108" tags="重要事項 完成事項" changecount="2">
<pre></pre>
</div>
<div title="修腳踏車" modifier="fhopecc" modified="200805260654" created="200803270541" tags="完成事項" changecount="2">
<pre>50元</pre>
</div>
<div title="值日" modifier="fhopecc" created="200805150341" tags="稅捐處業務" changecount="1">
<pre>訂餐：8227171#415</pre>
</div>
<div title="備出 /opt/bea/elt/eltua0[1-3]/accesss.log[nnnn]" modifier="fhopecc" modified="200709190627" created="200709190557" tags="地方稅主機清檔" changecount="3">
<pre>!備出 /opt/bea/elt/eltua0[1-3]/accesss.log[nnnn]
這是 weblogic 的log</pre>
</div>
<div title="備出 elt/shared_tmp/log/batchlog/*" modifier="fhopecc" modified="200709190553" created="200709190221" tags="地方稅主機清檔" changecount="7">
<pre>!備出 elt/shared_tmp/log/batchlog/*
目錄內結果檔及記錄檔擬保留一個月
#每月 5 日前將上上月結果檔及記錄檔備份至光碟
#存放1, 2 媒，保留 7 年
#填寫[[elt/shared_tmp/log/batchlog/*備出記錄檔]]</pre>
</div>
<div title="元件生命週期 IN XPCOM" modifier="fhopecc" created="200801290237" tags="XPCOM" changecount="1">
<pre>Generally, the QueryInterface method performs an implicit AddRef on the component being queried when returning a valid interface pointer. When a piece of client code is done using the interface, it calls the Release method to indicate to the component that it is done with that interface. This is an important burden on all XPCOM client software: for every QueryInterface or AddRef on a component there must also be a Release. A large portion of XPCOM bugs can be traced to either a missing or an extra Release on a component.</pre>
</div>
<div title="內容無關文法比較表" modifier="fhopecc" modified="200805290632" created="200708252357" tags="編譯器原理" changecount="1">
<pre>| 文法 |  剖析方向 | 定義 |
|[[運算子文法]]|由下而上|展開式不能有 2 相連的非終端元|</pre>
</div>
<div title="內網防火牆" modifier="fhopecc" modified="200801110118" created="200709100427" tags="資通安全" changecount="8">
<pre>|SGS5420|10.66.253.201|
|管理介面|https://10.66.253.201:2456|

# [[SGS5420 client 無法使用]]已解決</pre>
</div>
<div title="全國財產總歸戶系統" modifier="fhopecc" modified="200801070549" created="200711050133" tags="EGX" changecount="2">
<pre>!!EGX
中心：簡松州　#3316

!問題處理
中午似乎主機會變慢
#ping 10.6.252.13: 財稅中心 ELT 主機

</pre>
</div>
<div title="全域轉換函數" modifier="Fhopecc" modified="200709220132" created="200709180749" tags="圖靈機" changecount="40">
<pre>!!全域轉換函數
d~~M~~^^*^^:D~~M~~XD~~M~~
令 w:D~~M~~ 為一個瞬間描述，
則 w' = d~~M~~^^*^^(w) 為以瞬間描述 w 開始，M 停止時所出現的''終端瞬間描述''。</pre>
</div>
<div title="公文範本" modifier="fhopecc" modified="200709280405" created="200709280306" changecount="4">
<pre>[[函附簽|file:///d:/fhopecc/twFhopecc/函附簽.doc]]</pre>
</div>
<div title="公文系統" modifier="fhopecc" created="200710020207" tags="稅捐處業務" changecount="1">
<pre>|系統代碼|YPM|
|系統負責人|邱風蘭|(02)27631833#2318|
|主機 IP|10.66.4.8|</pre>
</div>
<div title="凱撒加密法" modifier="fhopecc" modified="200712060837" created="200712060654" tags="密碼學 編碼理論" changecount="7">
<pre>!凱撒密碼
凱撒密碼（Caesar Cipher）是很古老的替代加密法，據傳由古羅馬帝國的皇帝凱撒所發明，用在與遠方將領的通訊上，每個字母被往後位移三格字母所取代，而解密時就把每個英文字母往前面逆移三格字即完成解密動作。
!!加密範例
明文字串： abxyz
{{{
a--向後移3個字母--&gt;d
b--向後移3個字母--&gt;e
x--向後移3個字母--&gt;a
y--向後移3個字母--&gt;b
z--向後移3個字母--&gt;c
}}}
密文字串： deabc (這就是加密後產生的密文字串)
!!解密範例 
密文字串： deabc
{{{
d--向後移3個字母--&gt;a
e--向後移3個字母--&gt;b
a--向後移3個字母--&gt;x
b--向後移3個字母--&gt;y
c--向後移3個字母--&gt;z
}}}
明文字串： abxyz (這就是解密後產生的明文字串)</pre>
</div>
<div title="列出屬於某個標籤的所有 Tiddler" modifier="fhopecc" modified="200708270716" created="200708270701" tags="如何使用wiki" changecount="6">
<pre>The TaggingMacro produces a list of links to tiddlers that carry the specified tag. If no tag is specified, it looks for tiddlers tagged with the name of the current tiddler. It looks like this:

&lt;&lt;tagging&gt;&gt;
&lt;&lt;tagging 待辦事項&gt;&gt;
&lt;&lt;tagging sep:[[, ]]&gt;&gt;

In HTML, the list is formatted like so:

&lt;ul&gt;
&lt;li class=&quot;listTitle&quot;&gt;List title label&lt;/li&gt;
&lt;li&gt;&lt;a class=&quot;tiddlyLink ...&quot; href=&quot;javascript:;&quot; onclick=&quot;...&quot;
	   refresh=&quot;link&quot; tiddlyLink=&quot;ExampleOne&quot;&gt;ExampleOne&lt;/a&gt;&lt;/li&gt;javascript:;
完成
&lt;/ul&gt;

The optional sep parameter specifies a string of characters to be inserted as a separator between each &lt;li&gt; element. In conjunction with the CSS ul li {display: none;} this allows the tagging list to be formatted as a nicely formatted inline list.</pre>
</div>
<div title="加班記錄" modifier="fhopecc" modified="200802210726" created="200708310246" tags="稅捐處業務" changecount="19">
<pre>每月 6 小時

</pre>
</div>
<div title="加班費申請" modifier="fhopecc" created="200808040144" tags="緊急事項 完成事項" changecount="1">
<pre></pre>
</div>
<div title="北區國稅局" modifier="fhopecc" modified="200812020245" created="200802260200" tags="組織 SCO" changecount="3">
<pre>|北區國稅局|
|SCO|管理師|謝國榮|03-3396789#1150|
|JMQ|系統人員|鄭巧診|03-3396811#1162|
</pre>
</div>
<div title="南台代理伺服器" modifier="fhopecc" created="200805270251" changecount="1">
<pre>N9490001/e271828</pre>
</div>
<div title="南台科技大學資訊管理系" modifier="fhopecc" modified="200803240311" created="200803210016" changecount="3">
<pre>|南台科技大學 資訊管理系 |
| 地址: 台南縣永康市南台街1號 L棟 3F | 電話: 06-2533131#4301|</pre>
</div>
<div title="南瓜濃湯" modifier="fhopecc" created="200806080015" tags="食譜" changecount="1">
<pre>&lt;&gt;材料&lt;&gt;

1.南瓜：半顆
2.馬鈴薯：一小顆
3.洋蔥：1/4個
4.高湯
5.鹽、胡椒：少許
6.奶油：少許
7.巴西利：少許


&lt;&gt;要進廚房嘍~&lt;&gt;

1.將南瓜及馬鈴薯削皮後，切塊，放進電鍋蒸煮。(註0)
2.蒸煮完成後，將南瓜及馬鈴薯搗成泥(註一)，備用。
3.將洋蔥切成粒狀，放進高湯(註二)，滾煮一會兒。
4.將南瓜及馬鈴薯泥放進高湯，待煮滾後加入鹽、胡椒及奶油少許(註三)。
5.熄火，灑上巴西利少許。
6.完成!

註0：
小貓對於難搞的南瓜皮有更好的解決方法，
也就是將南瓜外表洗淨後，切塊，直接放進電鍋蒸煮。
待整個熟透之後，再慢慢把皮剝掉，
還可以順便吃軟香的南瓜:D

註一：
根據經驗，馬鈴薯比南瓜需要較多的蒸煮時間才能成為薯泥，
最好是將南瓜及馬鈴薯分別裝在兩個容器中，
第一次兩者可一起進電鍋蒸煮，
若發現馬鈴薯經過一次蒸煮仍不夠軟時，可單獨將馬鈴薯再進一次電鍋。

若想要更綿密的口感，可以使用果汁機~

註二：
因為是南瓜濃湯，所以高湯不用太多。
濃稀可依個人喜好。

註三：
奶油讓南瓜濃湯更香，味道也比較飽足。
若用作南瓜牛奶湯的話，可以用較多的牛奶代替奶油，味道較清淡。


&lt;&gt;Loretta拿湯瓢心得&lt;&gt;

第一次喝到南瓜濃湯，是在遙遠的北海道，
回來台灣後，一直很懷念幸福的南瓜濃湯。
忙碌的工作到上個月終於稍稍緩和了下來，
很少下廚房的Loretta就開始計畫要來親手做做看。

一開始在網路上尋找食譜，發現各家對於南瓜湯的說法不一，
我看了幾個重點，記得「南瓜湯就是要用果汁機」的印象，
開始了第一次的測試……當然是「失敗!!」
我想，是因為我只有「貴婦人」果汁機，而沒有「貴婦人她媽牌」果汁機的關係吧!XD

我親愛的家人們給予我很多認為它是「失敗的南瓜湯」的原因(我也覺得失敗:p)，
後來，我又認真的把所有的食譜再看一次，
同時開始在在腦海中「想像」各種食材混合後的味道，
在不同的說法中，找到自己認為較可行的做法。
有人告訴我，靠得「想像力」可以煮得一手好菜，原來是這麼一回事啊…

爸爸開始舀湯的時候，我突然好緊張…
坐在一旁的我，直直看著前方，聽到爸爸喝下第一口湯的嘓啅(ㄍㄨㄛ ㄓㄨㄛ˙)聲，
爸爸說：蠻好喝的啊~
我睜大眼，受寵若驚地說：真的嗎?!?!
姐姐大拍我的肩膀說：爸爸說好喝，那就是真的過關了啦~

哈哈~好像有一點信心，可以大步踏進廚房嘍~
^__^</pre>
</div>
<div title="博士班考試" modifier="fhopecc" modified="200805020658" created="200803201035" tags="博士" changecount="3">
<pre>!!簡章公告 97年1 月3 日起
著作審查認定
（以同等學力報考博士班者） 97 年3 月25 日起至97 年4 月2 日止
!索取繳費帳號 
!網路報名
!系所指定繳交資料寄送(國內郵戳為憑，逾期恕不受理)
97 年5 月5 日上午9 時起至
97 年5 月9 日下午4 時止
!寄發應考證 97年5 月23 日前
!筆試
97 年5 月31 日
(應用數學系及自然資源與環境研究筆試日期為97 年6 月
16 日)
!公告初試結果 97年6 月9 日前
!複試 97 年6 月16 日至97 年6 月17 日
（確切日期以各系正式通知為準）
!放榜 97年6 月27 日

初試 請於報名時繳交：
碩士論文、博士研究計劃書、大學及碩士班歷年成績單正本、其他學術著作各
1 份及推薦函2 封。
繳
交
資
料 複試 複試報名費500 元整(請使用ATM 轉帳)。
注意事項 1.資料審查及口試滿分各為100 分。
2.推薦函須由推薦人密封並於封口處簽名。
3.資料審查所需資料請於報名時繳交。
4.初試成績達到最低通過標準者，請於初試放榜公告後，自行上網列印複試通
知單，並轉帳繳交複試報名費。
5.複試日期為97 年6 月16 日、17 日。
6.本系博士班畢業生除須通過資格考及學位考試外，另有外語能力相關規定，
詳見本系網頁/校系相關規定/博士班入學及修業要點。</pre>
</div>
<div title="印出[010101...]的機器" modifier="Fhopecc" modified="200709201101" created="200709190302" tags="圖靈機" changecount="28">
<pre>!!!印出[010101...]的機器
P~~0101~~
|!現在狀態|!掃描符號|!印出符號|!移動|!後繼狀態|
|b|X~~b~~|0|R|c|
|c|X~~b~~|s|R|e|
|e|X~~b~~|1|R|f|
|z|X~~b~~|s|R|b|

</pre>
</div>
<div title="取得 CSS3 的文件" modifier="fhopecc" created="200708270643" tags="已辦事項" changecount="1">
<pre>已由 ~CSS2.1 取代</pre>
</div>
<div title="取得 DOML2 core 的文件" modifier="fhopecc" created="200708270642" tags="已辦事項" changecount="1">
<pre></pre>
</div>
<div title="取得網頁上選取的文字" modifier="fhopecc" modified="200805260210" created="200712061406" tags="Javascript" changecount="2">
<pre>{{{
function ShowSelectedText()
{
if (window.getSelection) // recent Mozilla versions
{
var selectedString = window.getSelection();
}
else if (document.all) // MSIE 4+
{
var selectedString = document.selection.createRange().text;
}
else if (document.getSelection) //older Mozilla versions
{
var selectedString = document.getSelection();
};

alert(&quot;The text you selected is \n'&quot; + selectedString + &quot;'&quot;);
}
}}}</pre>
</div>
<div title="台北教師會館" modifier="fhopecc" created="200803110114" tags="旅館" changecount="1">
<pre>歡迎光臨台北教師會館

為方便顧客上網預訂房間，請詳閱訂房相關規定確認後，您可以透過下面表格預約房間，我們收到資料後，會儘快與您聯繫確認。
   
     本訂房系統接受3個月內之訂房(不含當日)， 限本人訂房，或當日住房房客之一， 
    不得以他人代訂。 
   本館將依訂房額滿情況及訂房數量要求預付訂金、若因故需更改住宿日期，請於 
    原定住房日期 前一天通知本館取消不收費用，當天取消者，收取一晚之住宿費用 
    未預付訂金者仍需繳交。 
   更改訂房時間請一律以電話方式辦理，本館將保留本次訂房記錄，於訂房日起 
    90天內使用有效。 
   入住時間為13.00至18.00，如未能及時到達，請於下午六點以前以電話確認、以便 
    保留房間，退房時間12.00之前。 
   住房當日，住宿人員務必攜帶身份証明文件，如具優待身份者，並須攜帶服務機 
    關學校之服務證件(如識別證、薪資單、在職證、學生證…等)才能依住宿者身份分 
    別享受優惠價，不予事後補證。 
   會員：在職中小學校教職員(含持有退休證者)本人配偶及同行直系親屬。 
    有關：在職大專院校教職員學生 軍 公 警人員。 
    一般：軍公教學生以外人員。 
      
    如需本館相關訂房資訊，請洽訂房組電話02-23419161轉106 傳真02-23219378  
      
   
</pre>
</div>
<div title="台北裝機" modifier="fhopecc" created="200801230909" tags="HIS專案" changecount="2">
<pre>身分證字號:  S123020695    
電腦代碼:  916698
車次:         1060          車種:   自強
乘車時刻:   2008/01/24 19:00
起站:   花蓮         到站:   台北         張數:   01
取票或網路付款截止時間:   2008/01/23 22:00</pre>
</div>
<div title="台東縣稅" modifier="fhopecc" created="200810150643" changecount="1">
<pre>黃正平</pre>
</div>
<div title="台東賞鯨" modifier="fhopecc" modified="200711210150" created="200711010634" tags="旅行" changecount="12">
<pre>&lt;&lt;reminder year:2007 month:11 day:24 title:台東賞鯨&gt;&gt;
|羅得榮|Q122311757|630801|花蓮縣鳳林鎮公園路50巷13號|
|林宛萱|U221325968|710915|花蓮市民政里中美十街78巷4號|
|張簡稜剛|S123020695|680729|花蓮市民勤里勵志新村30號|
|沈懿嬅|S222566827|660403|花蓮市民勤里勵志新村30號|

|楊志隆|fax:089853865|</pre>
</div>
<div title="台灣鐵路公司" modifier="fhopecc" created="200711220035" tags="公司" changecount="1">
<pre>|台鐵訂票|038411111 #333|034121111 #333|</pre>
</div>
<div title="吳展政" modifier="fhopecc" modified="200803171226" created="200803171213" tags="黃詩芬" changecount="7">
<pre>|吳展政|0919134220|
</pre>
</div>
<div title="吳展政結婚" modifier="fhopecc" modified="200803171226" created="200803171224" tags="吳展政" changecount="6">
<pre>&lt;&lt;tiddler 吳展政&gt;&gt;
&lt;&lt;reminder year:2008 month:4 day:12 title:吳展政結婚&gt;&gt;
&lt;&lt;tiddler 情定大飯店&gt;&gt;</pre>
</div>
<div title="吳建達" modifier="fhopecc" created="200803110407" changecount="1">
<pre>黑心蕃茄園
鹽地蕃茄園</pre>
</div>
<div title="和平電廠參訪心得" modifier="fhopecc" modified="200808040307" created="200710310033" tags="旅行 稅捐處業務" changecount="21">
<pre>考進稅捐處也已七個月了，因為業務需要，已出差不下十幾次，回顧以前的生活，從來沒有這麼經常性生活在鐵路車廂內，雖然行動受限，但視野及心情卻能隨著窗外的風景遨遊於天地之間。
幾次以來，總驚豔於和平車站旁，如此小的腹地，卻有一個專屬港口，及許多延著陡峭山壁的粗大管線，當然最令人注目的是，那直聳天際的大煙囪，尚未參訪以前，我認為它是一個為觀光所立的大鋼柱，更不曉得原來它是標識著我們進入花蓮縣，或離開花蓮縣的地標。
進入廠區後，廠區以一個電廠而言，實在是小了點，但是經電廠課長介紹，它的發電量可供給十個花蓮市使用時，又覺得小巧但效率高。
效率與管理從整個廠區及辦公區的乾淨與寧靜散發出來，辦公區沒有多餘的交談聲，而機具，廠房的擺放也恰如其所，坐在廠區專車內，組長帶我們繞行整個電廠，可以發現每一項設備如儲水槽、儲煤槽、發電機組、降溫設備、過濾器等等其動線及位置都是經過經心安排的，如儲煤槽靠近港口、降溫設備設在岸邊，可就近利用海水、過濾設施延著煙的流動排列，這都是考量過環境特性與設備特性，所規畫出來的，廠區佈局就是一個良好管理的成品。
環保意識的高漲，相對的如電廠這種會影嚮環境的設施，自然在擴建上阻力重重。由電廠課長說明電廠在環保上的設施與回饋金上的難題，便了解目前企業在環保議題上受到日益嚴峻的挑戰，當然這是為了全人類生存所必須給予的法律限制，這使得目前所有企業生存下去的重要議題，是如何正視環保問題，並能以有效率且低成本的方法解決問題。
人們自古以來便會力求以最低成本，去取得最高的效益，但是人性自私，是故往往為了求得已身的最大利益而忽略了環境與社會的考量，是故必以社會群體所取得的共識，形成法律，來限制個人的特定行為，以取得社會最高的利益，加諸於工廠的環保成本，便是為了整個人類生存的環境能夠永續發展，加諸於專利權的成本，能激勵發明家去貢獻自已的發明，好的法律必須平衡個人權利與社會的福祉。稅法對個人及私人組織的財產權影嚮重大，是故良好稅法與稅務工作的切實執行對社會的公平正義，及永續發展影嚮甚大，當然我相信良好的管理必須根植於人性的暸解上，現今社會能達到如此繁榮的境界，除了是科學的進展，另外就是制度面也的大幅改進，從以往的專制進化到目前的民主，而違反人性的制度也由時間證明它的失敗，如共產主義就是比資本主義更不符合人性，故時間宣告它的失敗，管理面上如何符合人性，也是相當重要的議題。
這次的實地參訪，看了一個與公務體系完全不同的文化，確實開了眼界，期望將啟發的想法應用到工作上，當然也希望以後稅處能多有類似參訪活動。</pre>
</div>
<div title="問信用卡拖吊服務的事" modifier="fhopecc" created="200808081149" tags="緊急事項 完成事項" changecount="1">
<pre></pre>
</div>
<div title="回去拿證書" modifier="fhopecc" modified="200808011139" created="200807282227" tags="碩士 完成事項" changecount="15">
<pre>!回去帶的東西
#回去拿手機
#繳手機費
#訂下次的車票
#手機充電器
#坐鳳山到台南6:36-07:45
#回去拿證書
!OK
#7560 奶錢
#戶口名簿
#照片
#學生證
#論文
#VCD
#車票
!訂票
身分證字號:  S123020695    
電腦代碼:  951603
車次:         178          車種:   復興
乘車時刻:   2008/07/31 16:55
起站:   花蓮         到站:   台東         張數:   01
取票或網路付款截止時間:   2008/07/30 22:00
----
身分證字號:  S123020695    
電腦代碼:  951622
車次:         178          車種:   復興
乘車時刻:   2008/07/31 20:25
起站:   台東         到站:   林邊         張數:   01
取票或網路付款截止時間:   2008/07/30 22:00
----
身分證字號:  S123020695    
電腦代碼:  979589
車次:         93          車種:   莒光
乘車時刻:   2008/08/03 15:29
起站:   林邊         到站:   台東         張數:   01
取票或網路付款截止時間:   2008/08/01 22:00
----
身分證字號:  S123020695    
電腦代碼:  979651
車次:         1080          車種:   自強
乘車時刻:   2008/08/03 17:35
起站:   台東         到站:   花蓮         張數:   01
取票或網路付款截止時間:   2008/08/01 22:00</pre>
</div>
<div title="回家訂票" modifier="fhopecc" modified="200709290628" created="200709240914" tags="訂票" changecount="10">
<pre> 身分證字號:     S123020695
電腦代碼:     768018
車次:    1055              車種:    自強號
乘車時刻:    2007/10/05 16:24
起站:    花蓮              到站:    台東              張數:        2
取票或網路付款截止時間:    2007/09/26 22:00 
----
 身分證字號:     S123020695
電腦代碼:     768069
車次:    1055              車種:    自強號
乘車時刻:    2007/10/05 19:10
起站:    台東              到站:    林邊              張數:        2
取票或網路付款截止時間:    2007/09/26 22:00 
----
 身分證字號:     S123020695
電腦代碼:     768097
車次:    2055              車種:    自強號
乘車時刻:    2007/10/07 17:32
起站:    林邊              到站:    花蓮              張數:        1
取票或網路付款截止時間:    2007/09/26 22:00
----
身分證字號:     S123020695       電腦代碼:     767967
車次:   16              車種:   莒光號
乘車時刻:   2007/10/08 08:55
起站:   高雄              到站:   斗六              訂票張數:      1
取票或網路付款截止時間:   2007/09/26 22:00
----
身分證字號:     S123020695
電腦代碼:     783776
車次:    35              車種:    莒光號
乘車時刻:    2007/10/09 16:20
起站:    斗六              到站:    高雄              張數:        1
取票或網路付款截止時間:    2007/09/28 22:00 
----
身分證字號:     S123020695
電腦代碼:     783882
車次:    2059              車種:    自強號
乘車時刻:    2007/10/10 08:20
起站:    高雄              到站:    台東              張數:        1
取票或網路付款截止時間:    2007/09/28 22:00 
----
身分證字號:     S123020695
電腦代碼:     783895
車次:    2059              車種:    自強號
乘車時刻:    2007/10/10 10:31
起站:    台東              到站:    花蓮              張數:        1
取票或網路付款截止時間:    2007/09/28 22:00 </pre>
</div>
<div title="國旅卡入帳確認" modifier="fhopecc" modified="200805220540" created="200805160126" tags="完成事項" changecount="2">
<pre>|97|8000|</pre>
</div>
<div title="國民旅遊卡" modifier="fhopecc" modified="200710110905" created="200710090205" tags="財務" changecount="3">
<pre>&lt;&lt;reminder year:2007 month:10 day:11 title:國民旅遊卡開卡 leadtime:2&gt;&gt;</pre>
</div>
<div title="國稅地方稅資訊運用系統" modifier="fhopecc" modified="200906220648" created="200708230545" tags="稅捐處業務" changecount="13">
<pre>|系統代碼|YMQ|
|系統負責人|賴桐海|(02)27631833#2312|thlai@fdc.gov.tw|
|程式師|林遠隆|(02)27631833#1071|0966257180|long.linyl92@gmail.com|
|IP|10.250.4.1|
----
#7/15更新去年所得資料
''國稅地方稅運用系統連線問題處理''
# Telnet -&gt; 10.66.7.10 [[SCO]]
# ping 10.18.7.10 [[北區國稅局]]
## 不通，請北區國重開 router
## 通
### 在網頁測試查詢一筆
### 若失敗，則打給北區國稅局，國地稅系統管理員 

</pre>
</div>
<div title="圖靈機" modifier="Fhopecc" modified="200709220138" created="200709160222" tags="圖靈機" changecount="40">
<pre>!!圖靈機
T = {Q, X~~b~~, P, q~~0~~}
如上式，一個圖靈機包含四個組件：
*Q 是一組圖靈機可能的狀態集合。
*X 是一組符號，可以印在紙帶上。
*X~~b~~ 是包含空白符號 ''b'' 的符號組。
*P為本地轉換函數用來描述機器依照現在的狀態，進行下一個動作。
*q~~0~~ 是機器的初始狀態。
&lt;&lt;tiddler 本地轉換函數&gt;&gt;
&lt;&lt;tiddler 瞬間描述&gt;&gt;
&lt;&lt;tiddler 後繼瞬間描述函數&gt;&gt;
&lt;&lt;tiddler 終端瞬間描述&gt;&gt;
&lt;&lt;tiddler 計算&gt;&gt;
&lt;&lt;tiddler 全域轉換函數&gt;&gt;
&lt;&lt;tiddler 圖靈機可計算函數&gt;&gt;</pre>
</div>
<div title="圖靈機可計算函數" modifier="Fhopecc" modified="200709231229" created="200709220131" tags="圖靈機" changecount="6">
<pre>!!編碼函數
h~~1~~:M~~b~~^^*^^ X D~~M~~
令 s:X~~b~~^^*^^ 為機器 T 紙帶的初始字串，
則 h~~1~~(s) 會傳回瞬間描述 q~~0~~s，
即將掃描頭移到紙帶的最左邊，並將掃描頭的狀態設為初始狀態q~~0~~s。
!!解碼函數
h~~2~~:D~~T~~ X X~~b~~^^*^^
令 w:D~~T~~ 為機器 T 的瞬間描述，
且 w = ~AqxB,A, B:X~~b~~^^*^^, x:X~~b~~,q:Q。
則 h~~2~~(w) 會傳回字串 ~AxB，
即將瞬間描述轉為紙帶的字串。
!!計算函數
F~~M~~^^*^^:X~~b~~^^*^^ X X~~b~~^^*^^
定義為 F~~M~~^^*^^(x)=h~~2~~(q~~M~~^^*^^(h~~1~~(x)))，
其中 x 為輸入字串，
而 F~~M~~^^*^^(x) 傳回輸入字串 x 至圖靈機 M 所計算的結果，
F~~M~~^^*^^(x) 稱為由圖靈機 M 所計算的函數。
令 f(x) 為一函數，且存在一個圖靈機 M 使得 f(x) = F~~M~~^^*^^(x)，
則稱 f(x) 為圖靈機可計算函數。</pre>
</div>
<div title="土增電話語音服務" modifier="YourName" created="200710220051" tags="稅捐處業務" changecount="1">
<pre>|8228010|
|8228011|</pre>
</div>
<div title="地價稅外業清查查報系統" modifier="fhopecc" modified="200709120616" created="200709120313" tags="稅捐處業務" changecount="5">
<pre>|地價稅外業清查查報系統|
|開發公司|昌田科技|(04)36002345|
|業務經理|李孟武|0918157024|
|程式師|賴彥良|0920270386|

[[圖層更新慢]]
[[可否以鄉鎮市為單位一次更新，而非分段下載]]
[[載入所有權人資料 landowner]]
</pre>
</div>
<div title="地政系統" modifier="fhopecc" created="200810200533" changecount="1">
<pre>97tt027
96tt006
97tt024
97tt025
96tt003
97tt040</pre>
</div>
<div title="地方政府資通安全服務中心" modifier="fhopecc" modified="200709130345" created="200709060637" tags="資通安全" changecount="2">
<pre>http://www.sss.org.tw</pre>
</div>
<div title="地方稅主機清檔" modifier="fhopecc" modified="200903180125" created="200709190554" tags="資通安全 每月例行工作" changecount="7">
<pre>!程序
&lt;&lt;tiddler '備出 elt/shared_tmp/log/batchlog/*'&gt;&gt;
&lt;&lt;tiddler '清理 elt/shared_tmp/rpt/work/*.rpt 檔'&gt;&gt;
&lt;&lt;tiddler '備出 /opt/bea/elt/eltua0[1-3]/accesss.log[nnnn]'&gt;&gt;
!排程
&lt;&lt;reminder day:6 title:&quot;地方稅主機清檔&quot; leadtime:5&gt;&gt;</pre>
</div>
<div title="地方稅系統程式館" modifier="fhopecc" modified="200812220613" created="200708220742" tags="稅捐處業務 程式館" changecount="28">
<pre>|系統代碼|YPM|
|派館通知|許彩雲|(02)27631833#4374|
|SQL 傳真單及有SQL 的派館通知|陳振漢|(02)27631833#4375|hank@fdc.gov.tw|
|程式師|林志偉|(02)27631833#1071-4|
|YPM LOG檔|/elt/eltweb/log/ypm.log|
|YPM 中心主機|10.6.252.13|
!!目的
異動地方稅資訊應用系統的應用程式
!!入館通知 email
user/pw:eltypm/innhltb@2
!!流程
每天上網收信一至二次
# 於外網收程式更新 email
## email 印1份，傳真單印2份
# 分配*email + 傳真單*給各系統負責人
# email 承辦人蓋章-&gt;管理師
# 跑流程：承辦人蓋章-&gt;股長蓋章-&gt;課長蓋章-&gt;管理師進館
## 於內網進入*地方稅資訊應用系統/程式館管理系統/程式館異動執行作業(稅處)*
## 按*執行*異動程式
## 管理師蓋*已進館*,*職章*,*日期章*
# 歸檔
!!注意事項
*執行異動程式由較低單號到較高單號依序執行
*一組程式若有包含 SQL 指令檔，先執行 SQL 指令檔
*若為建立表格或索引，修正其 tblespace 至其正確的 tablespace，所以 I_EGXT038 其對應的 tablespace應為 ELTEGXIDX
&lt;&lt;tiddler 表格範本檔複製到公文系統&gt;&gt;</pre>
</div>
<div title="地方稅系統負責人" modifier="fhopecc" modified="200709030722" created="200709030717" changecount="3">
<pre>|WUU|負責人|沈淑慧|程式師|楊政達|
</pre>
</div>
<div title="地方稅繳款書管理系統" modifier="fhopecc" modified="200809300135" created="200711010722" tags="稅捐處業務" changecount="6">
<pre>!硬體
|惠陽電腦有限公司|
|林崇鎰|0916960646|0982369426|
!軟體
|和訊(股)公司|0222782668|fax:|0222782666|
|郭政靄|0922846906|#213|
|江東岳|0922330080|
|李力行|0952227530|
|闕東海|0935015476|</pre>
</div>
<div title="地理資訊回報" modifier="fhopecc" created="200810070023" tags="緊急事項 完成事項" changecount="1">
<pre></pre>
</div>
<div title="型態館" modifier="fhopecc" created="200801290222" tags="XPCOM" changecount="1">
<pre>''型態館(Type Library)''提供描述元件的方法、屬性、參數及介面的中介交換格式。
XPConnect</pre>
</div>
<div title="執行戶政查詢清冊" modifier="fhopecc" modified="200710020032" created="200709050029" tags="每月例行工作" changecount="8">
<pre>!程序
#執行YHQ705L_報表
#分送各股簽收
!排程
&lt;&lt;reminder day:6 title:&quot;執行戶政查詢清冊&quot; leadtime:5&gt;&gt;</pre>
</div>
<div title="執行機時統計報表" modifier="fhopecc" modified="200710020031" created="200709030731" tags="每月例行工作" changecount="18">
<pre>!內容
執行機時統計報表(中辦、財稅中心、資管課)
!程序
#執行機時統計報表(批次、線上、主機(DB, ~AP1,~AP2, ~AP3))
#影印3份
#進筆硯製作函稿
#簽核(包括機時報表4份，每一張的製表人員)
#進筆硯製作函
#發文
!排程
&lt;&lt;reminder day:6 title:&quot;執行機時統計報表&quot; leadtime:5&gt;&gt;</pre>
</div>
<div title="執行非欠稅查調國地稅連線記錄" modifier="fhopecc" modified="200710010736" created="200709050029" tags="每月例行工作" changecount="9">
<pre>!程序
#打開 &quot;ELT/ 批次作業管理系統/排程及執行作業/非定期批次作業&quot;
#工作代號選擇 &quot;EGX315L_(戶政連線查詢清冊與統計表列印)
#&quot;存檔&quot;後編輯相關參數
#至&quot;操管報表列印作業&quot;，
#將報表送給政風室
!程序
&lt;&lt;reminder day:6 title:&quot;執行非欠稅查調國地稅連線記錄&quot; leadtime:5&gt;&gt;
</pre>
</div>
<div title="報告的繪製層級" modifier="fhopecc" modified="200806210201" created="200806210132" tags="HIS專案" changecount="11">
<pre>!Todo
#Blood.routin_comment rename to results
!報告的繪製層級
|!繪製層級|!繪製模組|
|欄位型態|SectionModel|
|欄位|ItemHelper|
|行|SectionHelper|
|節|[[_form.rhtml]]|
|份|print.rhtml|
!欄位型態
欄位型態除了基本的DB，
還有特殊定義的 enum_column, range_column, file_column</pre>
</div>
<div title="報稅" modifier="fhopecc" modified="200805261448" created="200805230030" tags="完成事項" changecount="3">
<pre>!列舉證明
#保費
#</pre>
</div>
<div title="報表格式" modifier="YourName" modified="200711081245" created="200708271354" tags="HIS專案" changecount="20">
<pre>!報表格式
#列印除{{{血液檢查}}}都設為1頁內;not completed
#可控制那些檢查項目要列印出來，且目錄會反應那些選取的項目
#文件最上方指示檔案存放的 CD 編號可以依已列印的檢查項目自動遞增
#可列印成 PDF 檔;not completed
#列印報表時，中文自動套用標楷體，英文自動套用Times New Roman</pre>
</div>
<div title="外網防火牆" modifier="fhopecc" modified="200902130902" created="200711300726" tags="資通安全" changecount="2">
<pre>|FG-100A|https://192.168.1.254|
</pre>
</div>
<div title="外部連結" modifier="fhopecc" modified="200802260929" created="200702090119" tags="如何使用wiki" changecount="4">
<pre>要連結到網際網路上，只要打上完整的網址，系統會自動處理成超連結。或者，使用 FreeLink 的方式也可以，只要把 Tiddler 的名稱換成網址的 URL 即可。請看下面的範例：

http://www.tiddly.com
[[一般網址|http://www.tiddly.com]]
[[相對網址|path/filename]]
[[Windows 的網路芳鄰|file://server/share/path/file]]
[[Windows 的本機檔案|file:///c:/path/file]]
[[Unix-style 的本機檔案|file:///path/file]]

以上範例的寫法：
{{{
http://www.tiddly.com
[[一般網址|http://www.tiddly.com]]
[[相對網址|path/filename]]
[[Windows 的網路芳鄰|file://server/share/path/file]]
[[Windows 的本機檔案|file:///c:/path/file]]
[[Unix-style 的本機檔案|file:///path/file]]
}}}</pre>
</div>
<div title="大眾銀行" modifier="fhopecc" created="200803040655" tags="銀行" changecount="1">
<pre>|大眾銀行|
|吳佩珊|高雄市前鎮區中山二路2號|
|FAX|073356673|</pre>
</div>
<div title="套件命名規則" modifier="fhopecc" modified="200709200337" created="200709200316" tags="rpm" changecount="9">
<pre>!套件命名規則
好啦！現在我們已經知道 RPM 與 SRPM 的格式了，分別為：
{{{
xxxxxxxxx.rpm   &lt;==RPM 的格式，已經經過編譯且包裝完成的 rpm 檔案；
xxxxx.src.rpm   &lt;==SRPM的格式，包含未編譯的原始碼資訊。
}}}
那麼我們怎麼知道這個套件的版本、適用的平台、打包的次數呢？呵呵！只要透過檔名就可以知道了！例如 rp-pppoe-3.1-5.i386.rpm 這的檔案的意義為：
|!rp-pppoe|!-3.1|!-5|!.i386|!.rpm|
|套件名稱|套件的版本資訊|釋出的次數|適合的硬體平台|副檔名|
除了後面適合的硬體平台與附檔名外，主要是以『-』來隔開各個部分， 這樣子可以很清楚的發現該套件的名稱、版本資訊、打包次數與操作的硬體平台！ 好了，來談一談每個不同的地方吧：
*套件名稱：
&gt; 當然就是每一個套件的名稱了！上面的範例就是 rp-pppoe 。
*版本資訊：
&gt; 每一次更新版本就需要有一個版本的資訊，否則如何知道這一版是新是舊？ 這裡通常又分為主版本跟次版本，以上面為例，主版本為 3 ，在主版本的架構下更動部分原始碼內容，而釋出一個新的版本，就是次版本啦！ 以上面為例，就是 1 囉！
*釋出版本次數：
&gt; 也就是編譯的次數啦！那麼為何需要重複的編譯呢？ 這是由於同一版的套件中，可能由於有某些 bug 或者是安全上的顧慮，所以必須要重新設定當初打包時候的設定參數， 設定完成之後重新編譯並打包成 RPM 檔案！因此就有不同的打包數出現了！( 註：這個時候原始碼其實還是 3.1 那個版本，只是下達編譯時的參數不同而已！ )
*操作硬體平台：
&gt; 這是個很好玩的地方，由於 RPM 可以適用在不同的操作平台上， 但是由於不同的平台設定的參數還是有所差異性！並且，我們可以針對比較高階的 CPU 來進行最佳化參數的設定，所以就有所謂的 i386, i586, i686 與 noarch 等的檔案名稱出現了！
&lt;&lt;tiddler '平台值'&gt;&gt;</pre>
</div>
<div title="套用樣式至指定的媒體" modifier="Fhopecc" created="200708271308" tags="CSS" changecount="1">
<pre>{{{
@media print {
	.hide { DISPLAY: none }
}

@media print, screen {
	em {color:red;font-style:normal}
  :lang(en) {font-family:&quot;Times New Roman&quot;}

  body { background-color: #fff; color: #333; }

  body, p, ol, ul, td {
    font-family: verdana, arial, helvetica, sans-serif;
    font-size:   13px;
    line-height: 18px;
  }
}
}}}</pre>
</div>
<div title="如何使 WikiWord 失效" modifier="fhopecc" modified="200708230023" created="200708230022" tags="如何使用wiki">
<pre>有時候，滿篇的 Tiddler 連結，會讓人看得眼花瞭亂。為了版面的乾淨，我們不需要到處都是 ~WiKiWord 。那麼要如何讓 Tiddler 連結失效呢？你注意到了嗎？在這一個 Tiddler 裡，我讓 ~WikiWord 失效了。

答案是：在 ~WikiWord 前面加上一個 ~ (蝌蚪符號)。像下面這樣：
{{{
~WikiWord
}}}

另外， ~FreeLink 形式的 Tiddler 連結，只要我們不使用中括弧，就不會產生 Tiddler 了。</pre>
</div>
<div title="如何指定 ROR 啟動的 port" modifier="fhopecc" modified="200708270644" created="200708270125" tags="ROR 已辦事項" changecount="1">
<pre>server 啟動的 port number 可以在 script/server 這個命令的參數指定。
{{{
C:\Rails\presentror&gt;ruby script/server --help
=&gt; Booting WEBrick...
Usage: ruby server [options]
    -p, --port=port                  Runs Rails on the specified port.
                                     Default: 3000
    -b, --binding=ip                 Binds Rails to the specified ip.
                                     Default: 0.0.0.0
    -e, --environment=name           Specifies the environment to run this server under (test/development/production).
                                     Default: development
    -m, --mime-types=filename        Specifies an Apache style mime.types configuration file to be used for mime types
                                     Default: none
    -d, --daemon                     Make Rails run as a Daemon (only works if fork is available -- meaning on *nix).
    -c, --charset=charset            Set default charset for output.
                                     Default: UTF-8
    -h, --help                       Show this help message.
}}}
以上會顯示 script/server 的用法，其中就有說明如何改變 port。
{{{
C:\Rails\presentror&gt;ruby script/server --port=3020
=&gt; Booting WEBrick...
=&gt; Rails application started on http://0.0.0.0:3020
=&gt; Ctrl-C to shutdown server; call with --help for options
[2006-02-18 13:54:41] INFO  WEBrick 1.3.1
[2006-02-18 13:54:41] INFO  ruby 1.8.2 (2004-12-25) [i386-mswin32]
[2006-02-18 13:54:41] INFO  WEBrick::HTTPServer#start: pid=5948 port=3020
}}}
</pre>
</div>
<div title="如何挑選保存絲瓜？" modifier="fhopecc" created="200806110710" changecount="1">
<pre>!如何挑選保存絲瓜？
1.看大小：
買絲瓜千萬別貪心，如手掌大的絲瓜最甜美，太大反而瓜肉老，小心吃起來
像吃「菜瓜布」。

2.挑外表：
碧綠色瓜皮是挑絲瓜的基本要求。絲瓜表面愈完整愈優，盡量選擇沒有黑點、
壓傷、變形的絲瓜。

3.壓軟硬：
試著輕壓絲瓜，感覺有些硬度代表這條瓜的品質好，如果壓起來軟綿綿，
切開就會發現已經熟過頭了。

如何保存

主廚建議，絲瓜買回家最好能在1-2天內吃完，最能品嘗到絲瓜的新鮮甘甜。
如果沒有馬上食用，可用報紙包好，再套上塑膠袋收冰箱冷藏，
延長絲瓜保存期限。

最後小小叮嚀，要烹調前再削皮，薄薄的瓜皮是絲瓜的天然屏障。

絲瓜真心話

大家好，我原產印度，喜歡高溫多濕日照充足，四月到九月是我的盛產期。
我含有蛋白質、醣類、維生素B、C。因為熱量低、纖維質高，怕胖的女生
也可以放心食用。因為性涼，煮我的時候別忘加薑平衡寒性，夏天吃有清熱功效喔。

家族成員

澎湖絲瓜：

以細長外表著名的澎湖絲瓜，吃起來口感略脆。而飄洋過海到台灣本島栽種的
澎湖絲瓜，因為養分好、水分足，成熟的果實比澎湖當地還來得大又長，
在一般超市就能見到它的蹤影。

蛇瓜：

表皮光滑、形狀彎曲如蛇的蛇瓜，也是絲瓜家族的一員。蛇瓜因量少，一般少見，
也可食用。 </pre>
</div>
<div title="如何更改資料庫為 audit 模式" modifier="fhopecc" modified="200709030105" created="200709030034" tags="資料庫" changecount="3">
<pre>{{{
ALTER SYSTEM SET AUDIT_TRAIL= db_extended SCOPE=SPFILE;
AUDIT UPDATE TABLE, INSERT TABLE, DELETE TABLE, EXECUTE PROCEDURE BY gavin BY ACCESS;
AUDIT CREATE SESSION BY gavin BY ACCESS;
}}}</pre>
</div>
<div title="嬅回去選舉" modifier="fhopecc" modified="200803090435" created="200803090201" tags="訂票" changecount="4">
<pre> 身分證字號:     S123020695
電腦代碼:     305951
車次:    1079              車種:    自強號
乘車時刻:    2008/03/21 11:53
起站:    花蓮              到站:    台東              張數:        1
取票或網路付款截止時間:    2008/03/11 22:00 
----
 身分證字號:     S123020695
電腦代碼:     306009
車次:    94              車種:    莒光號
乘車時刻:    2008/03/21 14:05
起站:    台東              到站:    鳳山              張數:        1
取票或網路付款截止時間:    2008/03/11 22:00 
----
 身分證字號:     S123020695
電腦代碼:     310489
車次:    81              車種:    莒光號
乘車時刻:    2008/03/22 11:08
起站:    林邊              到站:    台東              張數:        1 
----
 身分證字號:     S123020695
電腦代碼:     310568
車次:    47              車種:    莒光號
乘車時刻:    2008/03/22 13:22
起站:    台東              到站:    花蓮              張數:        1
取票或網路付款截止時間:    2008/03/11 22:00 </pre>
</div>
<div title="字元類別" modifier="fhopecc" modified="200709130310" created="200709090837" tags="Ruby 正則表示式" changecount="10">
<pre>正則表達式[]負責指定字符範圍。這將匹配[]內列出的任何一個字符。
例如/[abc]/表示只要匹配&quot;a&quot;, &quot;b&quot;, &quot;c&quot;中任何一個即可。也可以按照ASCII代碼順序，在連續的字符串之間插入“-”後寫成/[a-c]/也是一樣的效果。另外，若頭上是“^”的話，表示要匹配指定字符之外的一個字符。

若“^”不在頭上的話，表示匹配該字符本身。 同時，當“-”出現在頭或尾上時，表示匹配該字符本身。

p /[a^]/ =~ &quot;^&quot; # =&gt; 0p /[-a]/ =~ &quot;-&quot; # =&gt; 0p /[a-]/ =~ &quot;-&quot; # =&gt; 0p / [-]/ =~ &quot;-&quot; # =&gt; 0 

空的字符範圍將引發錯誤。

 p /[]/ =~ &quot;&quot;  p /[^]/ =~ &quot;^&quot;  # =&gt; invalid regular expression; empty character class: /[^]/ p /[]/ =~ &quot;&quot;p /[^]/ =~ &quot;^&quot;# =&gt; invalid regular expression; empty character class: /[^]/ 

當“]”出現在頭上(或否定的“^”之後)時，表示“]”本身，而並非字符範圍的結尾。

p /[]]/ =~ &quot;]&quot; # =&gt; 0p /[^]]/ =~ &quot;]&quot; # =&gt; nil 

可以使用反斜線對&quot;^&quot;, &quot;-&quot;, &quot;]&quot;以及&quot;\\&quot;(反斜線)進行轉義，使其匹配該字符本身。

p /[\^]/ =~ &quot;^&quot; # =&gt; 0p /[\-]/ =~ &quot;-&quot; # =&gt; 0p /[\]]/ =~ &quot;]&quot; # =&gt; 0p / [\\]/ =~ &quot;\\&quot; # =&gt; 0 

在[]中可以使用反斜線表示法以及正則表達式\w, \W, \s, \S, \d, \D (這些都是表示字符範圍的簡寫法)。

請注意，下列包含否定意味的字符範圍也將匹配換行符(正則表達式\W,\D也是如此)。

p /[^a-z]/ =~ &quot;\n&quot; # =&gt; 0 

字符範圍中也可以使用下列特殊的表達法，但是，將來這些表達法是否會繼續得到支持還未可知(所以此處從略，欲知詳情請參考grep(1)的手冊)。

[:alnum:]數字和字母0-9a-zA-Z[:alpha:]字母a-zA-Z[:blank:]空白類[:cntrl:]控製字符[:digit:]數字[:graph:]除空白以外的可打印可視字符[:lower:]小寫字母[:print:]可視字符[:punct:]符號[:space:]空白字符[:upper:]大寫字母[:xdigit:] 16進製字符 

例: (包括&quot;[]&quot;在內，&quot;[:...:]&quot;表示1個字符。並非文字類的&quot;[]&quot;)

p /[[:alnum:]][[:cntrl:]]/ =~ &quot;a\x01&quot; # =&gt; 0 

注:全角字符不在考慮範圍之內。 即使指定讓正則表達式對漢字進行匹配時，[:alpha:]等也不會匹配全角的字母。
p /[[:alpha:]]/e =~ &quot;Ａ&quot; # =&gt; nil 
</pre>
</div>
<div title="安裝外網記憶體及防毒軟體" modifier="fhopecc" created="200809250049" tags="緊急事項 完成事項" changecount="1">
<pre></pre>
</div>
<div title="完成事項" modifier="fhopecc" modified="200808031034" created="200703020125" tags="chkPacking chkList" changecount="8">
<pre>&lt;&lt;forEachTiddler
      where 'tiddler.tags.contains(&quot;完成事項&quot;)'
      sortBy 'tiddler.title'
 script 
 ' function getFirstLine(s) { var m = s.match(/\s*(.*)/);
 return m != null &amp;&amp; m.length &gt;= 1 ? m[1] : &quot;&quot;;  } '
 write '&quot;|[X(&quot;+tiddler.title+&quot;:完成事項)] |[[&quot;+tiddler.title+&quot;]]|\n&quot;'
&gt;&gt;</pre>
</div>
<div title="宏廣素食" modifier="fhopecc" modified="200801160755" created="200708310256" tags="素食 餐廳" changecount="2">
<pre>|電話|8227493|</pre>
</div>
<div title="宏碁" modifier="fhopecc" created="200803040243" tags="公司" changecount="1">
<pre>|27841000|</pre>
</div>
<div title="宿舍修繕費" modifier="fhopecc" modified="200901160140" created="200803180203" changecount="3">
<pre>每年可申請 1440 元
!97年
|換鎖|1400|
!98年
|地板|1440|</pre>
</div>
<div title="密技偷偷報投稿" modifier="YourName" modified="200711180434" created="200711160505" changecount="3">
<pre>Re:請問投稿格式?
糟糕.....竟然完全沒發現這篇還有人在提問
大略回覆一下：

1.電子郵件投稿，理論上有採用的話，一個禮拜內會回覆，但未採用的話，可能就不會另外回覆了

2.軟體教學的稿子也是可以投，但是要特別一點、厲害一點的軟體，而且是要我們沒寫過的，所以最好先來信詢問一下

3.海外讀者也可以投稿，但因匯款方式較麻煩，且金額又不是很多，最好在台灣有個戶頭比較好啦~~

投稿信箱 totalpost@pcuser.com.tw , 主旨請註明：「讀者投稿」喔, 不然垃圾信太多啦 XD</pre>
</div>
<div title="寫出破解 http auth 的程式" modifier="fhopecc" modified="200709130549" created="200709022319" tags="資通安全" changecount="5">
<pre></pre>
</div>
<div title="將捷徑加入「傳送到」" modifier="fhopecc" created="200802102327" tags="VISTA" changecount="1">
<pre>方法簡易，只要將捷徑複製到「C:\使用者\[你登入的名稱]\AppData\Roaming\Microsoft\Windows\SendTo」底下即可。</pre>
</div>
<div title="專家系統建置過程" modifier="fhopecc" created="200712270336" changecount="1">
<pre>#知識表徵設計
#推理規則設計
</pre>
</div>
<div title="小會議室廣播系統架設" modifier="fhopecc" created="200806190915" tags="重要事項 完成事項" changecount="1">
<pre></pre>
</div>
<div title="常用通訊錄" modifier="fhopecc" modified="200711090917" created="200709040713" tags="記事" changecount="26">
<pre>[[編輯|常用通訊錄]]
|花稅處 |
|03-8226121 |
|花稅處傳真 |
|03-8224673 |
|紅會 |
|(03)8234860 |
|宿舍 |
|03-8234836 |
|月霞家 |
|03-8225579 |
|主機房 |
|304 |
|王世烈 |
|0911861937 |
|郭金幼 |
|0911299123 |
|廖美惠 |
|0912522886 |
|廖玉胤 |
|0919923898 |
|038567927 |
|羅得榮 |
|公(03)8760193 |
|0920125152|</pre>
</div>
<div title="幫小蘋果洗澡" modifier="fhopecc" modified="200807260208" created="200807260157" tags="女兒" changecount="3">
<pre>#輕輕的解開臍帶紗布
!洗頭部
#用左手托住頭，左腋夾住腳，固定住
#看有無舌苔，用毛巾包住食指洗舌苔
#洗眼皮，用毛巾摺小條由內向外擦一次
#擦臉
#用毛巾沾泡泡水，洗頭
!洗胸腹部
#左手托頭，右手抓住腳，讓寶寶呈坐姿入水
#左手手指撐開寶寶腋下，寶寶頭躺在手臂上
#用泡泡水洗身體，腋下、鼠蹊部、皮膚皺褶處
!洗背部
#右手手指撐開寶寶腋下，寶寶頭躺在手臂上
#用泡泡水洗身體，腋下、鼠蹊部、皮膚皺褶處
!擦乾寶寶
!消毒肚臍
#用棉花棒沾酒精消毒肚臍</pre>
</div>
<div title="平台值" modifier="fhopecc" modified="200709200338" created="200709200331" tags="rpm" changecount="4">
<pre>|平台名稱|適合平台說明|
|i386|幾乎適用於所有的 x86 平台，不論是舊的 pentum 或者是新的 pentum-IV 與 K7 系列的 CPU等等，都可以正常的工作！那個 i 指的是 Intel 相容的 CPU 的意思，至於 386 不用說，就是 CPU 的等級啦！|
|i586|就是 586 等級的電腦，那是哪些呢？包括 pentum 第一代 MMX CPU， AMD 的 K5, K6 系列 CPU ( socket 7 插腳 ) 等等的 CPU 都算是這個等級；|
|i686|在 pentium2 以後的 Intel 系列 CPU ，及 K7 以後等級的 CPU 都屬於這個 686 等級！|
|noarch|就是沒有任何硬體等級上的限制。一般來說，這種類型的 RPM 檔案，裡面應該沒有 binary file 存在。|
|aix5.1.ppc|在 power pc 上的 aix 作業系統|
      需要額外說明的是， i386 的檔案可以在任何的機器上面安裝， 不論是 586 或者是 686 的機器，但是 i686 則不一定可以使用於 386 或者是 586 的硬體上面，這是因為 i686 的 RPM 檔案在編譯的時候，主要是針對 686 硬體等級的 CPU 來進行最佳化編譯，而 386/586 等級的硬體可能由於無法支援該最佳化參數， 所以無法使用呢！另外，在 686 的機器上使用 i686 的檔案會比使用 i386 的檔案，效能可能比較好一些！無論如何，使用 i386 應該就是比較沒有問題的啦！另外，由於不同的 distirbution 會有不同的環境與函式庫，所以在 i386 之後也有可能會額外再加上該套件的簡寫！</pre>
</div>
<div title="建立''分頁標籤''式的頁面" modifier="fhopecc" modified="200708270620" created="200708270609" tags="如何使用wiki">
<pre>!說明
這個[[巨集]]功能非常強大，可以讓我們建立''分頁標籤''式的頁面，每個分頁標籤負責顯示一個 Tiddler 的內容。相對地，用法也比較複雜一點。(一點點而已啦！)
!用法
{{{
&lt;&lt;tabs tabsClass
編譯器原理 '列出所有編譯器原理' 編譯器原理
介紹巨集 '介紹內建巨集的功能' 巨集
&gt;&gt;
}}}
*第一行
**tabsClass 是用來顯示分頁標籤效果的 CSS 樣式定義類別。可以在 StyleSheet 裡自行定義。
*其它行(以第二行為例說明)
**如何做系列：產生的分頁標籤上的文字，當做標題使用。
**'列出所有........'：當滑鼠停在分頁標籤上時顯示在游標右下角的說明文字。
**如何做…：這個分頁標籤要顯示的 Tiddler 。
!效果
&lt;&lt;tabs tabsClass
編譯器原理 '列出所有編譯器原理'待辦事項
如何做系列 '列出所有如何做…系列的文章' 如何做…
介紹巨集 '介紹內建巨集的功能' 巨集
&gt;&gt;</pre>
</div>
<div title="建立表格" modifier="fhopecc" modified="200708200935" created="200708200930" tags="如何使用wiki">
<pre>要建立[[表格]]，只要在儲存格的兩側加上垂直線(|)，就是鍵盤上，用 Shift + 反斜線(\) 才能按出來的那個符號。要製作表格之前，建議先畫個草稿，再依草稿製作。下面是一個有合併儲存格的表格範例：

|在第二個垂直線的後面加上小寫的英文字母 c ，則變成表格的標題|c
|!標題儲存格：加一個驚嘆號(!)在第一個垂直線的後面，儲存格就變成標題儲存格。|!標題2|!標題3|
| 開頭有空白代表靠右對齊| 兩邊有空白代表置中 |結尾有空白代表靠左 |
|&gt;|&gt;|要橫向合併儲存格，則是在被合併的儲存格裡加上大於符號(&gt;)|
|要縱向合併儲存格，則是在被合併的儲存格裡加上蝌蚪符號(~)|&gt;|另一個靠左對齊的例子 |
|~|&gt;| 另一個靠右對齊的例子|
|&gt;|&gt;|bgcolor(green):儲存格的背景顏色可以用bgcolor(顏色代碼): 指定|

上面的表格範例寫法如下：
{{{
|在第二個垂直線的後面加上小寫的英文字母 c ，則變成表格的標題|c
|!標題儲存格：加一個驚嘆號(!)在第一個垂直線的後面，儲存格就變成標題儲存格。|!標題2|!標題3|
| 開頭有空白代表靠右對齊| 兩邊有空白代表置中 |結尾有空白代表靠左 |
|&gt;|&gt;|要橫向合併儲存格，則是在被合併的儲存格裡加上大於符號(&gt;)|
|要縱向合併儲存格，則是在被合併的儲存格裡加上蝌蚪符號(~)|&gt;|另一個靠左對齊的例子 |
|~|&gt;| 另一個靠右對齊的例子|
|&gt;|&gt;|bgcolor(green):儲存格的背景顏色可以用bgcolor(顏色代碼): 指定|
}}}</pre>
</div>
<div title="引用其它 Tiddler 的內容" modifier="fhopecc" modified="200708270641" created="200708270606" tags="如何使用wiki 已辦事項" changecount="1">
<pre>!說明
這個[[巨集]]讓我們引用其它 Tiddler 的內容。我們可以用 Tiddler 隨時記下小段落的內容，最後再利用這個[[巨集]]將所有的 Tiddler 組織成一篇文章而不用將他們重寫。像在[[如何建立一個 Tiddler|Tiddler]]裡面，我們就利用這個巨集引用了 FreeLink 這個 Tiddler 。
!用法
{{{
&lt;&lt;tiddler 待辦事項&gt;&gt;
}}}
!效果
以下引用[[待辦事項]]這個 Tiddler 的內容：
&gt;&lt;&lt;tiddler 待辦事項&gt;&gt;</pre>
</div>
<div title="張宏光" modifier="fhopecc" modified="200809240211" created="200809240106" changecount="2">
<pre>8227171#238</pre>
</div>
<div title="張玉秋" modifier="fhopecc" created="200801281137" tags="親戚" changecount="1">
<pre>張玉秋
大女：洪佩珊
次女：洪偉婷
萬板大橋下
651
捷運：江子翠站</pre>
</div>
<div title="張簡稜剛" modifier="fhopecc" modified="200809030623" created="200801280220" tags="連絡人" changecount="10">
<pre>|姓名|張簡稜剛|
|身分證字號|S123020695|
|生日|680729|
|戶籍地址|高雄縣大竂鄉義仁村16鄰鳳林一路1號之15|
|通訊地址|花蓮市民勤里勵志新村30號|

|郵局代號|700|
|帳號|009 1003 0543395|
|戶名|張簡稜剛|

|職業|花蓮縣稅捐稽徵處|資訊管理課|電子作業管理師|
&lt;&lt;tiddler 花蓮縣稅捐處&gt;&gt;</pre>
</div>
<div title="張簡稜芸" modifier="fhopecc" created="200805280202" changecount="1">
<pre>局名：林園三庄郵局(鳳山25支)
局號：010125-1
帳號：002389-9
戶名：張簡稜芸
</pre>
</div>
<div title="彈出列印交談視窗" modifier="fhopecc" created="200709200010" tags="CSS" changecount="1">
<pre>print.htm
{{{
&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;自動分頁列印！&lt;/TITLE&gt;&lt;/HEAD&gt;
&lt;BODY onLoad='printPage()'&gt;

&lt;SCRIPT LANGUAGE='JavaScript'&gt;
&lt;!--// 自動列印: 會彈出印表機交談視窗
function printPage() {
   window.print();
}
//--&gt;
&lt;/SCRIPT&gt;

&lt;CENTER&gt;這是列印的第一頁！&lt;/CENTER&gt;

&lt;P style='page-break-after:always'&gt;&lt;/P&gt;

&lt;CENTER&gt;這是列印的第二頁！&lt;/CENTER&gt;

&lt;/BODY&gt;
&lt;/HTML&gt;
}}}</pre>
</div>
<div title="彌月蛋糕名單" modifier="fhopecc" modified="200808250313" created="200807210226" tags="緊急事項 完成事項" changecount="14">
<pre>彌月蛋糕名單
|序號|姓名|禮物|
|1|羅惠媚|
|2|王月華||
|3|邱錦蓮||
|4|賴麗蜜||
|5|高慧玲||
|6|葉秀桃||
|7|邱月霞||
|8|王世烈|

|序號|姓名|禮物|
|1|郭金幼||
|2|廖美惠||
|3|孫嘉成||
|4|陳英男||
|5|鄧惠雄||
|6|鄧玉蘭||
|7|劉阿蔭||
|8|鄭月霞||
|9|游玉葉||
|10|曹金蓮||
|11|金淑芬||
|12|李美虹||
|13|石慧玲||
|14|姜姵如||
|15|蔡慧瑛||
|16|陳玟玲||
|17|楊淑嬌||
|18|徐瑞枝||
|19|王奕云||
|20|古順華||</pre>
</div>
<div title="影像掃描問題" modifier="fhopecc" created="200810070030" tags="緊急事項 完成事項" changecount="1">
<pre></pre>
</div>
<div title="待辦事項" modifier="fhopecc" modified="200809250038" created="200708200518" tags="記事" changecount="24">
<pre>&lt;&lt;newJournal 'YYYY.MM.DD' label:&quot;新增重要事項&quot; focus:title tag:待辦事項&gt;&gt;&lt;&lt;forEachTiddler
 where 'tiddler.tags.contains(&quot;待辦事項&quot;) &amp;&amp;
             ! tiddler.tags.contains(&quot;完成事項&quot;)'
 sortBy 'tiddler.title'
 script ' function getFirstLine(s) { var m = s.match(/\s*(.*)/);
            return m != null &amp;&amp; m.length &gt;= 1 ? m[1] : &quot;&quot;;  } '
 write '&quot;|[X(&quot;+tiddler.title+&quot;:完成事項)] |[[&quot;+tiddler.title+&quot;]]|&quot;+getFirstLine(tiddler.text)+&quot;|\n&quot;'
&gt;&gt;</pre>
</div>
<div title="後繼瞬間描述函數" modifier="Fhopecc" modified="200709220120" created="200709180230" tags="圖靈機" changecount="20">
<pre>!!後繼瞬間描述函數
d~~M~~:D~~M~~ x D~~M~~
如上述，後繼瞬間描述函數 d~~M~~，
會接受機器 T 一個瞬間描述，並傳回其下一個瞬間描述。
其形式定義如下：
#對所有的 q:Q 及 B:X~~b~~^^+^^ 而言，d~~M~~(qB)=d~~M~~(bqB) 
#對所有的 A:X~~b~~^^+^^、q:Q 及 x:X~~b~~ 而言，d~~M~~(Aqx)=d~~M~~(Aqxb) 
#對所有的 A,B:X~~b~~^^*^^、q:Q 及 x~~1~~,x:X~~b~~ 而言
**若 P(q, x) = (q', x', L) 則 d~~M~~(Ax~~1~~qxB) = Aq'x~~1~~x'B
**若 P(q, x) = (q', x', N) 則 d~~M~~(Ax~~1~~qxB) = Ax~~1~~q'x'B
**若 P(q, x) = (q', x', L) 則 d~~M~~(Ax~~1~~qxB) = Ax~~1~~x'q'B</pre>
</div>
<div title="徐龍珠" modifier="fhopecc" created="200803270312" tags="台北縣稅捐處 YRM" changecount="1">
<pre>|台北縣稅捐處資訊科|徐龍珠|
|YRM|
|email|ab0926@tpc.gov.tw|
|fax|89528034|</pre>
</div>
<div title="從正式機同步程式館到測式機" modifier="fhopecc" created="200801070804" tags="程式館 YPM" changecount="1">
<pre>!程式館目錄定義
|尚未入館的程式|/data/elt/shared_perm/ypm/send_prog|
|要送到測式機的程式|/data/elt/shared_perm/ypm/test_prog|

#進入到 10.66.250.1
#進入 /data/elt/shared_perm/ypm/send_prog
#copy 未到測式機的程式至 test_prog</pre>
</div>
<div title="心靈課程學習" modifier="fhopecc" modified="200710020559" created="200709140143" tags="線上學習" changecount="2">
<pre>https://public.uhcs.com.tw</pre>
</div>
<div title="必要條件和充份條件" modifier="fhopecc" created="200712261354" tags="邏輯 人工智慧" changecount="1">
<pre>必要和足夠條件，於描述兩個概念或不同事物之間的關係時十分重要。
必要條件
當我們說甲是乙的必要條件(necessary condition)時，意思是說沒有甲，乙便不可能存在。例如：

        * 有四條邊是一個正方形的必要條件。
        * 廉潔是成為好的公務員的必要條件。
        * 氧氣是人類生存的必要條件。 

足夠條件
當我們說甲是乙的足夠(或充份)條件(sufficient condition)時，意思是說若甲存在，則乙亦必定存在。換句話說，沒有可能有甲而沒乙。例如：

        * 擁有十個椰子是擁有多過三個椰子的足夠條件。
        * 絕對零度是物質份子活動停頓的足夠條件。 

要點
必要條件和足夠條件可以幫助我們解釋概念或事物之間的關係。任何兩種狀況之間的關係，可以如下般分類：

        * 甲既是乙的必要條件，亦是乙的足夠條件。
        * 甲是乙的必要條件，但甲並不是乙的足夠條件。
        * 甲並不是乙的必要條件，但甲是乙的足夠條件。
        * 甲既不是乙的必要條件，亦甲不是乙的足夠條件。 

界定「必要條件」和「足夠條件」之時利用到「可能性」這個概念。從以下的例子，我們可以看到「可能性」其實可以有不同的意思：

        * 沒有可能有一個正方形是只得三條邊的。
        * 純金並不可能溶解於水中。
        * 我們沒有可能於五分鐘之內從香港趕到紐約。
        * 沒有上級批准這份文件是不可外借的。 

第一個例子所描述的是「邏輯可能性」。「只得三條邊的正方形」所指述的是邏輯上不可能的事態，因其違反邏輯規律。但第二個例子中的「不可能」卻並非指邏輯可能性。純金溶解於水中，本身並沒有任何矛盾，但卻違反經科學引證的自然定律。違反普遍的自然定律的事態稱為「經驗上不可能」。至於第三個例子所指的「可能性」則是「技術可能性」，主要是相對人類的技術知識水平而言。五分鐘之內從香港趕到紐約，既沒有違反邏輯規律，亦可能合乎自然定律，問題是不能夠以現時的科技達到而已。而最後一個例子所指的「可能性」便是法律或規條上的可能性。規條上不可能的事態，很多時候可以是邏輯上、經驗上、技術上皆可能的。</pre>
</div>
<div title="忙碌海狸" modifier="fhopecc" created="200709260020" tags="圖靈機" changecount="1">
<pre>!忙碌海狸
忙碌海狸(busy beaver)是一種紙帶為空白，
做完很多事，且會停止的圖靈機。</pre>
</div>
<div title="情定大飯店" modifier="fhopecc" created="200803171225" changecount="1">
<pre>|情定大飯店|台南縣仁德鄉中正路三段92號|</pre>
</div>
<div title="慈益素食店" modifier="fhopecc" modified="200712120222" created="200712120221" tags="自助餐 便當 素食" changecount="2">
<pre>|慈益素食店|黃色娥|
|038359929|038334728|
|花蓮市商校街139號|
</pre>
</div>
<div title="我的論文" modifier="fhopecc" modified="200802220740" created="200709110354" tags="記事" changecount="3">
<pre>|論文編號|P0114 論文作者 張儀興,張簡稜剛
論文名稱 導入語義網技術於法規檢核系統同步化之研究</pre>
</div>
<div title="我的車" modifier="YourName" modified="200807220756" created="200807220754" changecount="2">
<pre>|型號|toyota|
|[[車險]]|
|鑰匙|放在辦公室|
|停車地點|紅十字會|</pre>
</div>
<div title="戶役政廢除&quot;先民政局後內政部&quot;選項問題" modifier="fhopecc" modified="200802210605" created="200708270934" tags="YHQ" changecount="17">
<pre>目前不能廢除，
此選項是為了讓內政部負擔不要太重，
問神通，民政系統掛了能否自動轉內政部。
</pre>
</div>
<div title="戶役政電子閘門講習" modifier="fhopecc" modified="200712251006" created="200712130153" tags="差旅" changecount="5">
<pre>&lt;&lt;reminder year:2007 month:12 day:18 title:戶役政電子閘門講習&gt;&gt;
台北新店
----
身分證字號:  S222566827    電腦代碼:  933227
車次:         1062          車種:   自強
乘車時刻:   2007/12/18 05:41
起站:   花蓮         到站:   台北         張數:   01
取票或網路付款截止時間:   2007/12/16 22:00
----
身分證字號:  S222566827    
電腦代碼:  933309
車次:         1063          車種:   自強
乘車時刻:   2007/12/18 14:30
起站:   台北         到站:   花蓮         張數:   01
取票或網路付款截止時間:   2007/12/16 22:00</pre>
</div>
<div title="戶政問題處理" modifier="fhopecc" modified="200809260301" created="200803060303" tags="YHQ" changecount="7">
<pre>#若為民政局無法連線，先至 SCO ，再 ping 民政局。
#ping 不到主機，自已先重開路由器，再請民政局重開。
&lt;&lt;tiddler 花蓮縣民政局系統&gt;&gt;</pre>
</div>
<div title="戶政回傳代碼" modifier="fhopecc" created="200805300238" tags="YHQ" changecount="1">
<pre>|代碼|說明|
|RS2045|遠端戶所不存在|以地址查詢，內政部無資料|</pre>
</div>
<div title="戶政資料查詢系統" modifier="fhopecc" modified="200906220809" created="200708270145" tags="YHQ 稅捐處業務" changecount="31">
<pre>|系統代碼|YHQ|
|系統負責人|董蕙蘭|(02)27631833#2309|FAX:|(02)27682726|
|YHQ大批檔案傳檔|范彩雲|4321|syfan@fdc.gov.tw|
|程式師|李述申(sam)|(02)27631833#1073|0921875317|samlee17@gmail.com|
|管理師|何正宇|1054|
&lt;&lt;tiddler 桃園轉運中心&gt;&gt;
&lt;&lt;tiddler 花蓮縣民政局系統&gt;&gt;
&lt;&lt;tiddler 戶政資訊交流作業管理&gt;&gt;

#usr/xum/dat/XUML907  elt 送給戶政 結果檔
#usr/xum/dat/XUML907  戶政要傳給 xum 的結果檔</pre>
</div>
<div title="戶政資訊交流作業管理" modifier="fhopecc" modified="200803250242" created="200708270201" tags="YHQ" changecount="3">
<pre>|!戶政資訊交流作業管理|系統代碼|XUM9|
|系統負責人|劉盈志|0933906073|yc3916@gmail.com|
|系統負責人|廖春豪|0920722767|chliau@mitac.com.tw|
|電話|(02)276318331#1069|
|系統主機IP|10.66.7.10|
|Telnet|a/p:xum/xum123|
|[[xum:a@xumweb|http://10.66.7.10:8888/xum]]|[[WEB網路介面管理系統]]|
|~XUM901|統計檔|
|~XUM902|異常記錄檔|
|~XUM903|連線記錄檔|~XUML903.dat|
''手動開啟停止服務''
{{{
STARTXUM9
STOPXUM9
}}}
''檢查服務狀態''
{{{
#輸入以下命令
#pa9 為一個 ksh 的 alias
#ps9='ps -efuxum | grep XUM9'
ps9
#正常結果如下：
     xum  4328  2617  0 09:21:49       ?    00:00:00 XUM921N 0
     xum  2614     1  0 08:00:00       ?    00:00:00 /usr/xum/exe/XUM900N
     xum  2615     1  0 08:00:00       ?    00:00:00 /usr/xum/exe/XUM905N
     xum  2616     1  0 08:00:00       ?    00:00:00 /usr/xum/exe/XUM910N
     xum  2617     1  0 08:00:00       ?    00:00:00 /usr/xum/exe/XUM920N
     xum  2618     1  0 08:00:00       ?    00:00:00 /usr/xum/exe/XUM930N
}}}
''目前有幾筆記錄在查''
{{{
xuml903r.sh
}}}
''清除統計檔''
{{{
# syntax: xum_clean_903.sh YYYMMDD
# 清除 YYYMMDD 以前的戶政統計檔，並backup 到
# /usr/xum/db/backup/%date%/下的 XUML901.dat
# 及 XUML901.idx
cd db
STOPXUM9
xum_clean_901.sh 0960424
STARTXUM9
}}}
''清除異常記錄檔''
{{{
# syntax: xum_clean_903.sh YYYMMDD
# 清除 YYYMMDD 以前的異常檔，並backup 到
# /usr/xum/db/backup/%date%/下的 XUML902.dat
# 及 XUML902.idx
cd db
STOPXUM9
xum_clean_902.sh 0960424
STARTXUM9
}}}
''清除連線記錄檔''
{{{
# syntax: xum_clean_903.sh YYYMMDD
# 清除 YYYMMDD 以前的日期檔，並backup 到
# /usr/xum/db/backup/%date%/下的 XUML903.dat
# 及 XUML903.idx
cd db
STOPXUM9
xum_clean_903.sh 0960424
STARTXUM9
}}}</pre>
</div>
<div title="戶政錯誤代碼" modifier="fhopecc" modified="200811040120" created="200811040118" tags="YHQ" changecount="2">
<pre>#[[戶政錯誤代碼|file:///d:/fhopecc/twFhopecc/YHQ/戶政錯誤代碼.csv]]</pre>
</div>
<div title="房屋修膳" modifier="fhopecc" modified="200809010149" created="200808040328" tags="緊急事項 完成事項" changecount="6">
<pre>#星期四水兄拉水電
#洗嬰兒車
#調整床位
!done
#與美惠姐拉黑網</pre>
</div>
<div title="扶星公司" modifier="fhopecc" modified="200711220039" created="200708261142" tags="公司" changecount="3">
<pre>|地址|高雄縣大發工業區大有一街28號|
|電話|077874066|</pre>
</div>
<div title="批次作業管理系統" modifier="fhopecc" modified="200710020252" created="200710020233" tags="地方稅系統" changecount="2">
<pre>|代號|YCM
&lt;&lt;tiddler &quot;YCM服務&quot;&gt;&gt;
</pre>
</div>
<div title="找保姆" modifier="fhopecc" modified="200903190315" created="200808040311" tags="緊急事項 保姆 完成事項" changecount="7">
<pre>許玉容
|家扶中心|曉靜|8242533|

!預定名單
|姓名||
|吳素秋|中美路69巷9號|8232032|1歲7個月|52|護理|
|吳玉鳳|中興路84號|8225057, 0933997172|1歲7個月|51|十年，與婆婆住|
|許玉容|化道路89巷2號|8226682|1歲10個月|43|5-6年, 先生警察, 小孩國中國小|
|古素菁|花蓮市南京街1巷12號|0933006761|志工|</pre>
</div>
<div title="找出方型私章" modifier="fhopecc" modified="200809250035" created="200808070214" tags="重要事項 完成事項" changecount="2">
<pre></pre>
</div>
<div title="抽油煙機修復" modifier="fhopecc" modified="200805270604" created="200711220035" tags="家庭修理" changecount="4">
<pre>|抽油煙機修復|8534418|</pre>
</div>
<div title="挑出 pk 重覆的列" modifier="fhopecc" modified="200805270555" created="200709130149" tags="SQL" changecount="6">
<pre>當要建立 PK index時，
PK 內的 key 項若有重覆的列，
則無法建立。
所以必須先能挑出重覆的列，再對其做處理。
第一個直覺便是使用兩個 alias 並限定其 rowid 不同。
{{{
select *
from tb as t1, tb as t2
where t1.pk_1 = t2.pk_1
and t1.pk_2 = t2.pk_2
and t1.pk_3 = t2.pk_3
}}}
但若 t1 有 550000 筆時，
則會有 302500000000 筆， 要跑到什麼時候?
另一個是利用 group，
{{{
select pk_1, pk_2, pk_3, count(*)
from tb 
group by pk_1, pk_2, pk_3 having count(*) &gt; 1
}}}
就只要處理 550000 就好了。</pre>
</div>
<div title="接女兒來到世上" modifier="fhopecc" modified="200807221350" created="200807220055" changecount="13">
<pre>!工作之事
#YHQ每月陳核單
!回高雄前要整理的東西:
#枕頭被子收好以防灰塵
#家中門窗全部關上和插頭要拔，由其是冷氣的和烘碗机
#家門確定有關好
#水倒光
!已完成
#汽車的行駕和天珠家用鑰放到辦公室
#你的身份証影印本
#奶瓶消毒鍋和頭髮乾洗劑「我放在和室的大塑膠帶內」
#照相機和電腦放在一起
#程式館,資料庫檢核
#手機充電器
#倒垃圾</pre>
</div>
<div title="政府應用安全保密函式庫介面訓練說明會" modifier="fhopecc" modified="200803070217" created="200802260810" tags="資通安全" changecount="6">
<pre>&lt;&lt;reminder year:2008 month:3 day:12 title:政府應用安全保密函式庫介面訓練說明會&gt;&gt;
&lt;&lt;reminder year:2008 month:3 day:13 title:電子化政府公開金鑰基礎建設電子認證應用說明會&gt;&gt;
!訂票
身分證字號:  S123020695    
電腦代碼:  978929
車次:         1062          車種:   自強
乘車時刻:   2008/03/12 05:41
起站:   花蓮         到站:   台北         張數:   01
取票或網路付款截止時間:   2008/03/09 22:00
----
身分證字號:     S123020695
電腦代碼:     255232
車次:    1188              車種:    自強號
乘車時刻:    2008/03/14 10:05
起站:    台北              到站:    花蓮              張數:        1
取票或網路付款截止時間:    2008/03/09 22:00 
!地點
&lt;&lt;tiddler 中華電信板橋電信訓練所&gt;&gt;</pre>
</div>
<div title="政府網際服務網(GSN)" modifier="fhopecc" modified="200712120632" created="200712100645" tags="網路連線" changecount="3">
<pre>|GSN客服中心|02-87681628|
|中華電信|徐官興|038511824|
|傳輸方式|HDSL|
|傳輸速率|1544K(T1)|
|專線編號|38D81070|</pre>
</div>
<div title="敏感性牙齒" modifier="fhopecc" modified="200709180057" created="200709170429" tags="保健" changecount="6">
<pre>!牙齒為什麼會酸軟？
當牙齒遇冷、熱、酸、甜而感到疼痛，通常是因為：琺瑯質受損、蛀牙、牙周病、牙齦萎縮等，造成牙齒表面受損或牙根裸露。當口腔中的酸鹼濃度或溫度產生變化時，象牙質小管內的液體便受影響而產生瞬間流動，進而壓迫神經，而使牙齒感到酸軟疼痛，我們稱之為「牙齒知覺過敏症」。
根據臨床上的經驗，敏感性牙齒的定義是：對於冷、熱和滲透壓(如酸、甜等感覺)的刺激，產生短暫、尖 銳等疼痛感覺的牙齒。
近年來罹患牙齒知覺過敏症的民眾越來越多，據統計：台灣地區患有此症的人約占總人口數的64%；根據牙醫師指出，牙齒知覺過敏症是一種牙齒的慢性病，若不注意將會影響患者的飲食與呼吸，甚至造成情緒改變或異常反應。
!找尋病因，對症治療
在治療牙本質敏感的問題之前，我們必須先確定其致病原因，然後排除一些如蛀牙、牙齒裂痕、牙套或補牙不密合的情形，再加以治療，才能得到一個可預期而有效的處置結果。通常大部分牙齒敏感的患者（包括蛀牙、牙周病患者），均可經由某些特殊之去敏感牙膏，自行使用幾週後即可有明顯的改善。
但有些患者效果不佳，有些患者停用後又會有敏感之情形，這類的牙膏大致上含有一些離子，可以塞住或使暴露之牙本質小管變小，如氯化鍶、氟化物等，也有一類是阻斷感覺神經末稍去極化而降低敏感的疼痛，如硝酸鉀、氯化鉀之類，這些產品在市面上大概都可以買到。若是這類牙膏使用一段時間後，症狀還是沒有明顯的改善，那可能就要找牙醫師幫您解決了！

!牙膏的治療
通常大部分的敏感性牙齒患者(包括蛀牙、牙周病等)，均可藉由自行使用一些特殊去敏感牙膏，幾週後即可明顯改善。此類牙膏的作用原理為：
''形成沉殿，阻塞牙本質小管''
!!可以塞住或使暴露之牙本質小管變小，以隔絕外界刺激。
氯化鍶 -&gt; 可產生氯化磷灰石(這是最早使用的成份)
氟化物 -&gt; 氟化物，可產生氟化磷灰石
!!阻斷感覺神經
此類牙膏通常使用鉀離子來阻斷感覺神經，使神經的傳導速率降低，提高其對疼痛的耐受度，而去除牙齒酸軟的感覺，如：磷酸鉀、硝酸鉀、氯化鉀…等，改變神經幹內外鈉鉀離子之平衡，達到提高牙髓神經耐受度的目的，藉以消除牙齒酸軟疼痛的感覺。
磷酸鉀、硝酸鉀、氯化鉀 -&gt; 阻斷感覺神經末稍去極化而降低敏感的疼痛
!!抗出血
含Allantoin能強化牙齦組織，促進傷口癒合，預防牙齦出血。
!!防蛀牙
含0.22%氟化鈉(約1000ppm)，除能有效防止蛀牙外，亦可阻塞牙本質小管，以隔絕外界刺激 
!塗上
通常牙醫師會採用的方式大概有：塗上一層含鈣或高濃度之氟化物，也有採用草酸鹽製劑不一而足。通常視醫師手上有的藥物而定，如果有明顯的齒頸部磨損，則用樹脂、玻璃離子之復形物覆蓋，依筆者之經驗，可以得到立即減緩的效果，如果磨損不深的話，也有人使用薄層之樹脂塗蓋，大約會有幾個月的效果。
!牙齦覆蓋的手術
而對於那些牙齦已萎縮的患者，可以考慮用牙齦覆蓋的手術來減少敏感的情形，且改善美觀上的問題；另外也有一類實驗性的治療，用雷射來減少敏感的程度，目前在台大醫院牙科有提供這類的服務，據說也有不錯的治療效果。

!敏感性牙齒預防須知
不當的刷牙方式是造成牙齒敏感最主要的原因之一，因此使用正確的刷牙方式，選擇軟硬適中的刷毛，甚至於在敏感牙齒部位使用軟毛牙刷，即可改善大部分的問題；對於已經磨損的部分，一定要立即的填補，否則凹陷的部分，不僅不易清潔，更會加重其敏感的程度。
建議您正確使用''貝氏刷牙法''刷牙。</pre>
</div>
<div title="新城鄉" modifier="fhopecc" created="200803250148" changecount="1">
<pre>新城鄉公所財政課：江月英：8267223#143</pre>
</div>
<div title="新城鄉公所" modifier="fhopecc" created="200710110214" tags="組織" changecount="2">
<pre>8267223#143</pre>
</div>
<div title="新增開機注意事項：啟動 XDQ 服務" modifier="fhopecc" modified="200711010146" created="200710020209" tags="XDQ 稅捐處業務" changecount="3">
<pre>e-網通及公文自動同步需要正常啟動 XDQ 服務，
擬請主機操作人員於下列兩台主機開機時，
執行以下操作，來啟動並確認 XDQ 服務正常執行。

一、OA 主機開機，請啟動 &lt;code&gt;OA_FTX&lt;/code&gt; 服務及 &lt;code&gt;eTaxRun.exe&lt;/code&gt;
# 啟動 OA_FTX 服務
## 請點選桌面上 &lt;code&gt;runSocketServer.bat&lt;/code&gt;
## 看到一 DOS 視窗即啟動成功
# 啟動  &lt;code&gt;eTaxRun.exe&lt;/code&gt; 服務
## 請點選桌面上 &lt;code&gt;eTaxRun.exe&lt;/code&gt;
## 點選[開始執行]按鈕

二、ELTAP1 開機，請啟動稅務主機 XDQ 服務
啟動 XDQ 服務步驟：
&lt;pre&gt;
以 apsvr 身份登入 ELTAP1
$cd elt/eltapp/bin/xdq
$STARTOA
&lt;/pre&gt;
*確認每個服務要有 2 筆記錄*：
{{{
$ps -ef | grep XDQ
   apsvr 397520      1   0 15:59:05      -  0:02 java XDQIOAReceive
   apsvr 422112      1   0 15:59:05      -  0:01 java XDQICallOA
   apsvr 438510      1   0 15:59:05      -  0:06 java XDQISendOA2Etax
   apsvr 442582      1   0 09:52:00  pts/0  0:01 java XDQICallOA
   apsvr 462854      1   0 09:52:00  pts/0  0:02 java XDQIOAReceive
   apsvr 553068 577736   0 10:12:22  pts/0  0:00 grep XDQ
   apsvr 581868      1   0 09:52:00  pts/0  0:06 java XDQISendOA2Etax
}}}

三、測試服務是否執行成功：
1.將測試檔搬入傳送目錄
&lt;pre&gt;
#以 apsvr 身份登入 ELTAP1
$cd elt/shared_tmp/xmvo/oa/backup
$mv OA00001_OLF012001 ../tmp
&lt;/pre&gt;
2.進入 OA 主機

2.1 
檢查 c:\OA_FTX_SERVER\send 目錄下是否有
OA00001_OLF012001 檔案，有此檔表示啟動成功。

2.2 
*請立刻將 OA00001_OLF012001 刪除*，才不會轉到公文系統。


申請人：

股長：

主機操作人員：</pre>
</div>
<div title="新稅處網站需求" modifier="fhopecc" created="200902110609" tags="重要事項" changecount="1">
<pre>#後台帳號要與AD整合</pre>
</div>
<div title="新約會事項" modifier="YourName" modified="200703031213" created="200703030252" tags="chkList">
<pre>&lt;&lt;newTiddler
 label:&quot;新約會事項&quot;
 focus:text
 text:'&lt;script&gt;ocReminder(&quot;2007/06/01&quot;)&lt;/script&gt;'
 tag:appointment&gt;&gt;</pre>
</div>
<div title="施秀美" modifier="fhopecc" modified="200711210252" created="200709190140" changecount="6">
<pre>|施秀美|(O)8344575|

老公有作一些士木工程</pre>
</div>
<div title="日常生活費用系統" modifier="fhopecc" modified="200709030832" created="200708300225" tags="家務事" changecount="8">
<pre>主要用來登入日常生活費用
!表格定義
|!表格代碼|fees|
|!欄位|!型態|!定義|
|type|字串|生活費用類別|
|desc|字串|花費項目|
|date|日期|花費的日期|
|value|float|花費金錢值|
</pre>
</div>
<div title="時光書局" modifier="fhopecc" modified="200712230445" created="200711210256" tags="商家" changecount="6">
<pre>|時光書局|038-358312|0918226845|
|吳宛霖|
|建國路1號|
|舊書回收|二手書|飲品|</pre>
</div>
<div title="更改密碼" modifier="fhopecc" modified="200901060911" created="200711120232" tags="緊急事項 資通安全 完成事項" changecount="23">
<pre>花蓮縣稅捐稽徵處更改稅務系統密碼步驟
請注意!!!!   密碼有分大小寫
!一、更改下列 WINDOWS 作業系統 administrator 帳號之密碼
# OAAP(10.66.249.1)
# ELTBKS01(10.66.250.22)
!!更改 WINDOWS 作業系統密碼方式
# 以 administrator 登入系統
# 按 ALT+CTRL+DEL 更改密碼
!二、更改下列 AIX 作業系統 root 帳號之密碼
# ELTUD01 (10.66.250.1)  
# ELTUD02 (10.66.250.2)
# EOAUD01 (10.66.250.10)
# ELTUDT   (10.66.248.1)
# ELTUA01 (10.66.251.1或250.11)
# ELTUA02 (10.66.251.2或250.12)
# ELTUA03 (10.66.251.3或250.12)
!!更改 AIX 作業系統帳號之密碼流程
# 以 root 身分登入系統
# 執行 passwd
{{{
# passwd
Changing password for &quot;root&quot;
root's New password:
Enter the new password again:
#
}}}
!三、更改下列 AIX 作業系統 ora10g 帳號之密碼
# ELTUD01 (10.66.250.1)
# ELTUD02 (10.66.250.2)
# EOAUD01 (10.66.250.10)
# ELTUDT
!四、更改下列 AIX 作業系統 apsvr 帳號之密碼
# ELTUA01
# ELTUA02
# ELTUA03
# ELTUDT
!五、更改下列 ORACLE 系統 sys, system 帳號之密碼
#ELTUD
#ELTUDT
#EOAUD
!!更改 ORACLE 系統帳號之密碼流程
# 以 sys 帳號登入 OEM
# 選取左側目錄 [資料庫SID]/SECURITY/USER/[user帳號] 選單
# 按 passwd 更改 user帳號之密碼
!六、更改每日正式機資料庫匯出批次檔之system密碼
#ELTUD
!!更改方法
#以ora10g登入
#/開啟 opt/oracle/script/expdb/fullexp_eltud.sh 
#更改 PWD
!七、更改每日資料庫匯入批次檔之system密碼
#ELTUDT
!!更改方法
#以ora10g登入
#/開啟opt/oracle/script/impdp/fullimpdp_eltudt.sh
#更改 PWD
!八、更改DB環控程式密碼
#ELTUD
#ELTUDT
!!更改方法
#以root登入
#開啟/home/envcon/chk_oracle
!九、更改下列 weblogic 系統 weblogic 帳號之密碼
# ELTUA01 
# ELTUA02
# ELTUA03
# ELTUDT
!!1.以 weblogic Console 登入系統
# 以 IE 登入 &quot;http://10.66.251.1:8008/console&quot; 
# 選取左側目錄 elt/security/realms/myrealm/users 選單
# 選取右側 weblogic/change/new passwd apply
!!2.更改系統設定檔
!!!A.更改 boot.properties 檔中 weblogic 之密碼
# 以 apsvr 身分登入 AIX
# 備份 /opt/bea/elt/boot.properties 成 boot.properties.bak
# 開啟 /opt/bea/elt/boot.properties  
# 找出 password=$#@!#(加密之亂碼) 這行
# 更改 password=newpassword(weblogic 新密碼)
!!!B.更改 weblogic_autostart.sh 檔中 weblogic 之密碼
# 以 apsvr 登入 AIX  
# 備份 /opt/bea/weblogic_autostart.sh
# 開啟 /opt/bea/weblogic_autostart.sh
# 在檔首加入這二行(已有這二行則更改帳號及密碼的右側)
{{{
WLS_USER=weblogic
WLS_PWD=newpassword
}}}
!!!C.更改 S99bea.cssd 檔中 weblogic 之密碼
# 以 root 登入 AIX
# 備份 /etc/rc.d/rc2.d/S99bea.cssd 
# 開啟 /etc/rc.d/rc2.d/S99bea.cssd
# 在檔首加入這二行(已有這二行則更改帳號及密碼的右側)
{{{
WLS_USER=weblogic
WLS_PWD=newpassword
...
-username weblogic  –passwd=newpassword
}}}
!十、更改 ELTWEB 連線帳號
!!1.更改下列稅務系統中 ELTWEB 連線帳號(須重新開機才生效)
# AP1
# AP2
# AP3
# TestAP
!!!方法
# 登入地方稅資訊應用系統/系統基礎工具/管理作業/資料庫連線設定維護 DEFAULT/更改密碼
!!2.更改 JDBC 的 ELTWEB 帳號密碼
# AP1
# AP2
# AP3
# TestAP
!!!方法
# 登入 WEBLOGIC CONSOLE 
# 執行 /elt/services/JDBC/connecting pools/eltJDBC/passwd:newpassword/apply
!!3.更改 ORACLE 系統的 ELTWEB 密碼
# ELTUD
# ELTUDT
!!!方法
# 用 sys 身份登入 OEM 改密碼
!十一、所有主機重開機</pre>
</div>
<div title="更新 TiddlyWiki" modifier="fhopecc" modified="200708270631" created="200708270623" tags="如何使用wiki" changecount="1">
<pre>目前版本 &lt;&lt;version&gt;&gt;
如同其它軟體一樣，TiddlyWiki 也會更新版本。就在最近，官方網站推出了新的 1.2.37 版本。新的版本會更正一些已經發現的問題，或是推出新功能。關於新版本的 ~ChangeLog ，都會固定在 http://www.tiddlywiki.com/dev 裡說明。

要更新 TiddlyWiki ，請依照下面的步驟：

#先確定''偏好設定''裡的''儲存備份''是否已經勾選？若沒有，記得要先勾選。
#做''儲存變更''。這兩個步驟是為了萬一更新後有任何不正常的地方，可以由備分檔還原。
#請參照[[如何開始]]裡的方法下載新版的 TiddlyWiki 。但是存檔時，@@color(#cc0000):請選擇覆寫目前正在使用的 TiddlyWiki 檔案@@。
#下載完成後，再做一次''儲存變更''，然後重新整理一次網頁即可。

&lt;&lt;tiddler 更新的原理&gt;&gt;</pre>
</div>
<div title="更新內部OA 通訊錄" modifier="fhopecc" modified="200802140854" created="200708300728" tags="稅捐處業務" changecount="19">
<pre>|ip|10.66.4.8|
#詢問文書股葉麗英(發文電子檔)是否完成工作
#詢問總收發羅美雲(收文電子檔)是否完成工作
#詢問登記桌陳致如(從 OA 載入)是否完成工作
#主機連至外網
#遠端桌面連入主機
#執行 c:\eic_server\adbook.kws\create_xml\sysnc.wsf
#可以查看工作管理員 WSScript.exe 程序是否執行完畢，判斷上述
#再接回內網
#執行 c:\eic_server\adbook.kws\create_xml\build_log.wsf
!Client 端如需馬上更新時
c:/eic/adbook/hltb/adbook.ini
將最後一行刪除，存檔，即會馬上更新。
</pre>
</div>
<div title="本地轉換函數" modifier="Fhopecc" modified="200709220117" created="200709170330" tags="圖靈機" changecount="47">
<pre>!!本地轉換函數
P:[Q, X~~b~~] x [Q, X~~b~~, D]
D = {L, R, N}
&gt; 如上 D 則為掃描頭移動方向的集合，
&gt; *L 表掃描頭向左移一格，
&gt; *R 表掃描頭向左移一格，
&gt; *N 表掃描頭沒有移動。
本地轉換函數是用來描述掃描頭如何依照現在的狀態，進行下一個動作。
P(q~~0~~, 0) = (1, L,q~~1~~) 
上式描述若機器的狀態為 q~~0~~ 而掃描到的符號為 0，
則機器會在掃描格印上 1，並向左移一格，同時機器的狀態轉為 q~~1~~。
由上述，我們可以用 5 欄表格，稱作''狀態轉移表''來描述 P。
例子如下：
&lt;&lt;tiddler 計算[1001-&gt;1100]的機器&gt;&gt;
</pre>
</div>
<div title="李學智婦產科診所" modifier="fhopecc" created="200803051009" tags="診所" changecount="1">
<pre>李學智婦產科診所. 03-8325880 </pre>
</div>
<div title="李宣霓" modifier="fhopecc" modified="200808040306" created="200807150121" tags="保姆" changecount="4">
<pre>0912143523
中美3街23巷1號</pre>
</div>
<div title="李述申" modifier="fhopecc" modified="200805010249" created="200805010242" tags="宏碁" changecount="2">
<pre>|程式師|李述申(sam)|(02)27631833#1073|0921875317|samlee17@gmail.com|</pre>
</div>
<div title="東海岸之旅" modifier="fhopecc" modified="200711120713" created="200709231138" tags="差旅" changecount="6">
<pre>2007年09月23日
今天和婆走東岸台11線，
早上東岸雨勢強大，公公嚇壞了，一直踩剎車，還一直讓後面的車先走。
但進入海岸山脈來到另一面的水漣，雨勢漸小，
後來再進入牛山、
海灣風景壯觀，
再來來到了蕃著寮休息區，
上了18號橋，看到了如太魯閣堅硬的溪谷，
往下看大約2,300公尺高，令人害怕，
應該再停芭崎晀望台望著磯崎海濱，我在路旁看到一條大蛇。不知它的名稱，希望它沒有被車輾過。
之後在磯崎海濱的後面山停靠一下，
再到大灣停，公公真貪心，每個地方都想拍拍，風景都是一樣，不是山啊!就是海啊!
再到石梯漁港，婆婆上廁所
先在石梯坪出入口吃婆婆的愛心油炒飯後，ps:還是我一大早炒，且前一晚準備料，
公公還在客廳躺著看電視，不理會我，現在還閒我妙太油。
再去看海岸被海侵蝕的岩石，
老闆是從高雄崗山來花蓮發展建聖地牙哥的一間白屋，還不錯
但咖啡一坏150元，之後到了月洞，此有蝙輻，公公發現賣咖啡的先生看高考的書，
又到長虹橋，是到舊長虹橋拍照。
後過靜埔在北迴歸線停留，有臭豆腐公公想吃。
來長濱市區後，
在 7/11 買了咖啡，還有茶葉蛋，
直達玉長公路長濱端，有一條長的玉長隧道
上了玉長公路後，
最後在安通溫泉飯站投宿，住301房，未帶泳衣，只好洗浴室溫泉。</pre>
</div>
<div title="東茂資訊" modifier="fhopecc" created="200808280221" tags="資訊設備" changecount="1">
<pre>8359433</pre>
</div>
<div title="查詢可用空間" modifier="fhopecc" modified="200712100333" created="200709120705" tags="unix 磁碟管理" changecount="5">
<pre>!查詢可用空間
{{{
bash-3.00# df -g
Filesystem    GB blocks      Free %Used    Iused %Iused Mounted on
/dev/hd4           0.50      0.48    5%     2719     3% /
/dev/hd2           4.00      2.05   49%    41638     8% /usr
/dev/hd9var        4.00      3.95    2%      598     1% /var
/dev/hd3           2.00      1.64   19%      239     1% /tmp
/dev/fwdump        0.25      0.25    1%        4     1% /var/adm/ras/platform
/dev/hd1           2.00      1.99    1%       67     1% /home
/proc                 -         -    -         -     -  /proc
/dev/hd10opt       8.00      0.79   91%    47065    21% /opt
/dev/hd12          8.00      7.61    5%    15163     1% /elt
/dev/eltdb       349.75      6.98   99%     1762     1% /data/eltdb
/dev/eltbat       99.75     99.42    1%       24     1% /data/eltbat
/dev/eltdatlv1     10.00      8.45   16%   113756     6% /elt/shared_perm
/dev/eltdatlv2     89.75     43.51   52%    77528     1% /elt/shared_tmp
}}}
上述會列出所有儲存體可用的空間，&quot;-g&quot; 選項表示以 GB 為單位計算空間，目前儲存體空間很大，一般都以 GB 計比較容易作規劃。
!查詢檔案使用空間
{{{
du
}}}
!查詢檔案使用空間 &gt; 1GB
{{{
du -g | grep ^[123456789].*
}}}</pre>
</div>
<div title="桃園縣稅捐處" modifier="fhopecc" modified="200709030137" created="200709030136" tags="組織" changecount="3">
<pre>|鍾宜燕|inf212@tytax.gov.tw|</pre>
</div>
<div title="桃園轉運中心" modifier="fhopecc" modified="200809030345" created="200802210557" tags="YHQ" changecount="5">
<pre>|!桃園轉運中心|10.250.4.1|
|!桃稅處鍾宜燕|mailto:inf212@tytax.gov.tw|03-3326181#2533|</pre>
</div>
<div title="楊振城命理老師" modifier="fhopecc" created="200807260849" tags="命理" changecount="1">
<pre>7619549</pre>
</div>
<div title="楊清鶯" modifier="fhopecc" created="200803270320" tags="南投縣政府稅務局" changecount="2">
<pre>|南投縣政府稅務局|楊清鶯|
|YMQ|
|email|59q105@mail.nttb.gov.tw|
|office|049222121#509|
</pre>
</div>
<div title="標檢局資安諮詢" modifier="fhopecc" created="200712120147" tags="資通安全" changecount="1">
<pre>&lt;&lt;reminder year:2007 month:12 day:24 title:標檢局資安諮詢&gt;&gt;</pre>
</div>
<div title="標準描述" modifier="Fhopecc" modified="200709201120" created="200709200024" tags="圖靈機" changecount="6">
<pre>!!標準描述
描述一個圖靈機可以使用[[狀態轉換表|本地轉換函數]]
一個狀態轉移表的例子如下：
|!現在狀態|!掃描符號|!印出符號|!移動|!後繼狀態|
|b|0|0|R|c|</pre>
</div>
<div title="標題" modifier="Fhopecc" created="200709080407" tags="如何使用wiki" changecount="1">
<pre>這裡的[[標題]]，是對應到 HTML 裡的 &lt;H1&gt; 到 &lt;h5&gt; 標籤。要建立標題很簡單，只要使用驚嘆號(!)即可。看範例最清楚：

!標題 1
!!標題 2
!!!標題 3
!!!!標題 4
!!!!!標題 5

{{{
!標題 1
!!標題 2
!!!標題 3
!!!!標題 4
!!!!!標題 5
}}}</pre>
</div>
<div title="機房消防設備" modifier="fhopecc" modified="200805060753" created="200805060752" tags="機房" changecount="2">
<pre>&lt;&lt;tiddler 緯安消防設備公司&gt;&gt;</pre>
</div>
<div title="機時統計系統 " modifier="fhopecc" modified="200709030323" created="200709030322" tags="稅捐處業務" changecount="3">
<pre>|系統代碼|YRM|
|林志偉|02-27631833#1071-4|</pre>
</div>
<div title="檢查 AIX 的 login 記錄" modifier="fhopecc" created="200812170827" tags="AIX" changecount="1">
<pre>last 指令</pre>
</div>
<div title="正則表示式語法" modifier="Fhopecc" modified="200709090837" created="200709090750" tags="Ruby" changecount="2">
<pre>下面就來講講ruby支持的正則表達式符號(元字符)。

有这么个规则：有這麼個規則：

    * 不带\的数字和字母不是元字符不帶\的數字和字母不是元字符
    * 带\的符号也不是元字符帶\的符號也不是元字符 

下文中出现的“匹配多字节字符的正则表达式”是指，通过使用$KCODE进行设定，或显式地使用汉字选项(请参考正则表达式字面值 )等方式进行的匹配多字节字符的正则表达式。下文中出現的“匹配多字節字符的正則表達式”是指，通過使用$KCODE進行設定，或顯式地使用漢字選項(請參考正則表達式字面值 )等方式進行的匹配多字節字符的正則表達式。

    *

      ^

      行首。行首。 与字符串的头部或换行符之后的位置相匹配。與字符串的頭部或換行符之後的位置相匹配。
    *

      $

      行尾。行尾。 与字符串的尾部或换行符之前的位置相匹配。與字符串的尾部或換行符之前的位置相匹配。 不包括换行符本身。不包括換行符本身。

      ruby 1.8 特性 ：以前，只匹配字符串尾部换行符前的位置，现在则扩大到字符串的尾部。 ruby 1.8特性 ：以前，只匹配字符串尾部換行符前的位置，現在則擴大到字符串的尾部。 trap::Regexp

       p &quot;\n&quot;.gsub(/$/, &quot;o&quot;)  =&gt; &quot;o\n&quot;  (1.6)  =&gt; &quot;o\no&quot; (1.8) p &quot;\n&quot;.gsub(/$/, &quot;o&quot;)=&gt; &quot;o\n&quot; (1.6)=&gt; &quot;o\no&quot; (1.8) 

    *

      .

      匹配除换行符以外的任意一个字符。匹配除換行符以外的任意一個字符。 使用正则表达式选项 m(多行模式。请参考正则表达式字面值 ) 时，则匹配包括换行符在内的任意一个字符。使用正則表達式選項m(多行模式。請參考正則表達式字面值 )時，則匹配包括換行符在內的任意一個字符。 在匹配多字节字符的正则表达式中，则匹配一个字(非单字节)。在匹配多字節字符的正則表達式中，則匹配一個字(非單字節)。

      当遇到不完整的多字节字符的一部分(无法判断该字符是多字节字符？二进制？还是ASCII)时，也不会匹配。當遇到不完整的多字節字符的一部分(無法判斷該字符是多字節字符？二進制？還是ASCII)時，也不會匹配。

       p /./e =~ &quot;あ&quot;[0,1]     # =&gt; nil p /./e =~ &quot;あ&quot;[0,1] # =&gt; nil 

    *

      \w

      字母和数字。字母和數字。 等同于[0-9A-Za-z] 。等同於[0-9A-Za-z] 。

      若为匹配多字节字符的正则表达式时，则也会匹配日语的全角字符。若為匹配多字節字符的正則表達式時，則也會匹配日語的全角字符。
    *

      \W

      非字母和数字。非字母和數字。 \w以外的单个字符。 \w以外的單個字符。
    *

      \s

      空字符。空字符。 相当于[ \t\n\r\f]相當於[ \t\n\r\f]
    *

      \S

      非空字符。非空字符。 [ \t\n\r\f]以外的单个字符。 [ \t\n\r\f]以外的單個字符。
    *

      \d

      数字。數字。即[0-9]
    *

      \D

      非数字非數字
    *

      \A

      字符串头部。字符串頭部。 与^不同的是，它不受有无换行符的影响 。與^不同的是，它不受有無換行符的影響。
    *

      \Z

      字符串尾部。字符串尾部。 若字符串以换行符结尾，则匹配换行符前的位置。若字符串以換行符結尾，則匹配換行符前的位置。

      ruby 1.8 特性 ：以前，只匹配字符串尾部换行符前的位置，现在则扩大到字符串的尾部。 ruby 1.8特性 ：以前，只匹配字符串尾部換行符前的位置，現在則擴大到字符串的尾部。 trap::Regexp

       p &quot;\n&quot;.gsub(/\Z/, &quot;o&quot;)  =&gt; &quot;o\n&quot;   (1.6)  =&gt; &quot;o\no&quot;  (1.8) p &quot;\n&quot;.gsub(/\Z/, &quot;o&quot;)=&gt; &quot;o\n&quot; (1.6)=&gt; &quot;o\no&quot; (1.8) 

    *

      \z

      字符串结尾。字符串結尾。 与$以及\Z不同的是，它不受有无换行符的影响。與$以及\Z不同的是，它不受有無換行符的影響。
    *

      \b

      在字符范围描述符之外时表示词边界(匹配从\w到\W)。在字符範圍描述符之外時表示詞邊界(匹配從\w到\W)。 在字符范围描述符之内时表示退格符(0x08)。在字符範圍描述符之內時表示退格符(0x08)。
    *

      \B

      非词边界非詞邊界
    *

      \G

      在上次成功匹配的地方(之后)进行匹配(不留余地)。在上次成功匹配的地方(之後)進行匹配(不留餘地)。 只有在首次使用时才会匹配到头部(与\A相同)。只有在首次使用時才會匹配到頭部(與\A相同)。

      可以用在scan和gsub中。可以用在scan和gsub中。 当您想在上次匹配的地方之后再进行匹配的话，可以使用。當您想在上次匹配的地方之後再進行匹配的話，可以使用。

      举个简单(没什么用)的例子。舉個簡單(沒什麼用)的例子。

       # 从头取出3位数字(数字必须相连)。 #從頭取出3位數字(數字必須相連)。 str = &quot;123456 789&quot;  str.scan(/\G\d\d\d/) {|m| p m } str = &quot;123456 789&quot;str.scan(/\G\d\d\d/) {|m| p m } 

    *

      [ ] [ ]

      指定字符范围。指定字符範圍。 请参考字符范围請參考字符範圍
      。
    *

      *

      前面元素至少出现0次。前面元素至少出現0次。 尽可能匹配较长的部分。盡可能匹配較長的部分。
    *

      *?

      负责指定数量(quantifiers)。負責指定數量(quantifiers)。 表示前面元素至少出现0次(尽量匹配短的部分)表示前面元素至少出現0次(盡量匹配短的部分)
    *

      +

      负责指定数量(quantifiers)。負責指定數量(quantifiers)。 表示前面元素至少出现1次表示前面元素至少出現1次
    *

      +?

      负责指定数量(quantifiers)。負責指定數量(quantifiers)。 表示前面元素至少出现1次(尽量匹配短的部分)表示前面元素至少出現1次(盡量匹配短的部分)
    * {m}
    * {m,}
    *

      {m,n}

      指定元素重复出现的次数(interval quantifier)。指定元素重複出現的次數(interval quantifier)。 分别表示前面元素重复出现分別表示前面元素重複出現
          o m 次 m次
          o 至少 m 次至少m次
          o 至少 m 次，至多 n 次至少m次，至多n次 

      {,n}或{,}将导致匹配失败。 {,n}或{,}將導致匹配失敗。

       str = &quot;foofoofoo&quot;  p str[/(foo){1}/]   # =&gt; &quot;foo&quot;  p str[/(foo){2,}/]  # =&gt; &quot;foofoofoo&quot;  p str[/(foo){1,2}/] # =&gt; &quot;foofoo&quot; str = &quot;foofoofoo&quot;p str[/(foo){1}/] # =&gt; &quot;foo&quot;p str[/(foo){2,}/] # =&gt; &quot;foofoofoo&quot;p str[/(foo){ 1,2}/] # =&gt; &quot;foofoo&quot; 

      正则表达式? , * , +分别等同于{0,1} , {0,} {1,} 。正則表達式? , * , +分別等同於{0,1} , {0,} {1,} 。
    * {m}?
    * {m,}?
    *

      {m,n}?

      指定元素重复出现的次数(interval quantifier)。指定元素重複出現的次數(interval quantifier)。 分别表示前面元素重复出现分別表示前面元素重複出現
          o m 次 m次
          o 至少 m 次至少m次
          o 至少 m 次，至多 n 次至少m次，至多n次 

      (尽量匹配短的部分)。 (盡量匹配短的部分)。
    *

      ?

      负责指定数量(quantifiers)。負責指定數量(quantifiers)。 表示前面元素至多出现1次。表示前面元素至多出現1次。
    *

      ??

      负责指定数量(quantifiers)。負責指定數量(quantifiers)。 表示前面元素至多出现1次(尽量匹配短的部分)表示前面元素至多出現1次(盡量匹配短的部分)
    *

      |

      选择(alternative)。選擇(alternative)。
    *

      ( ) ( )

      正则表达式的群组化。正則表達式的群組化。 与括号中的正则表达式相匹配的字符串将被保存下来，供后方参考使用。與括號中的正則表達式相匹配的字符串將被保存下來，供後方參考使用。
    *

      \1 , \2 ... \ n

      后方参考(back reference)。後方參考(back reference)。 请参考后方参考 。請參考後方參考 。
    *

      (?# ) (?# )

      注释。註釋。 括号中的任意字符串将被忽视。括號中的任意字符串將被忽視。
    *

      (?: ) (?: )

      不具备后方参考功能的群组化。不具備後方參考功能的群組化。 它不为\1,\2(或$1 , $2 )提供服务，是一种单纯的群组功能。它不為\1,\2(或$1 , $2 )提供服務，是一種單純的群組功能。

       /(abc)/ =~ &quot;abc&quot;  p $1  =&gt; &quot;abc&quot;    /(?:abc)/ =~ &quot;abc&quot;  p $1  =&gt; nil /(abc)/ =~ &quot;abc&quot;p $1=&gt; &quot;abc&quot;/(?:abc)/ =~ &quot;abc&quot;p $1=&gt; nil 

    *

      (?= ) (?= )

      先行(lookahead)。先行(lookahead)。 使用模式(pattern)指定位置(不留间隔)使用模式(pattern)指定位置(不留間隔)

       (?=re1)re2 

      表示将匹配同时符合re1和re2的要求的字符串。表示將匹配同時符合re1和re2的要求的字符串。

       re1(?=re2) 

      という山附は、稿に re2 とマッチする矢机误が鲁く、正则表达式 re1 です。という山附は、稿にre2とマッチする矢機誤が魯く、正則表達式re1です。

       p /foo(?=bar)/ =~ &quot;foobar&quot;      # =&gt; 0  p $&amp;    # =&gt; &quot;foo&quot;   (bar の婶尸の攫鼠はない) p /foo(?=bar)/ =~ &quot;foobar&quot; # =&gt; 0p $&amp; # =&gt; &quot;foo&quot; (barの嬸屍の攫鼠はない) 

    *

      (?! ) (?! )

      否定先行(negative lookahead)。否定先行(negative lookahead)。 使用否定的模式(pattern)来指定位置(不留间隔)使用否定的模式(pattern)來指定位置(不留間隔)

       (?!re1)re2 

      该正则表达式表示，匹配re1但不匹配re2。該正則表達式表示，匹配re1但不匹配re2。

       # 除000以外的3位数字  re = /(?!000)\d\d\d/  p re =~ &quot;000&quot;   # =&gt; nil  p re =~ &quot;012&quot;   # =&gt; 0  p re =~ &quot;123&quot;   # =&gt; 0    # C语言标识符 (首位是[A-Za-z_]然后是[0-9A-Za-z_]的字符串)  /\b(?![0-9])\w+\b/ #除000以外的3位數字re = /(?!000)\d\d\d/p re =~ &quot;000&quot; # =&gt; nilp re =~ &quot;012&quot; # =&gt; 0p re =~ &quot;123&quot; # =&gt; 0# C語言標識符(首位是[A-Za-z_]然後是[0-9A-Za-z_]的字符串)/\b(?![0-9])\w+\ b/ 

    *

      (?&gt; ) (?&gt; )

      禁用回缩功能 。禁用回縮功能 。

      该功能尚处于试验阶段。該功能尚處於試驗階段。 将来有可能被停用，请您注意使用。將來有可能被停用，請您注意使用。 特别是不要在广义库中使用。特別是不要在廣義庫中使用。
    *

      (?ixm-ixm)

      正则表达式中的i选项、x选项、m选项的开关。正則表達式中的i選項、x選項、m選項的開關。 请您参考正则表达式字面值来了解选项的详细内容。請您參考正則表達式字面值來了解選項的詳細內容。

       re = /A(?i)a(?-i)A/  p re =~ &quot;AaA&quot;         # =&gt; 0  p re =~ &quot;AAA&quot;         # =&gt; 0  p re =~ &quot;AAa&quot;         # =&gt; nil re = /A(?i)a(?-i)A/p re =~ &quot;AaA&quot; # =&gt; 0p re =~ &quot;AAA&quot; # =&gt; 0p re =~ &quot;AAa&quot; # =&gt; nil 

    *

      (?ixm-ixm: ) (?ixm-ixm: )

      括号中的i选项、x选项、m选项的开关。括號中的i選項、x選項、m選項的開關。 在括号范围内有效。在括號範圍內有效。

       re = /A(?i:a)A/  p re =~ &quot;AaA&quot;         # =&gt; 0  p re =~ &quot;AAA&quot;         # =&gt; 0  p re =~ &quot;AAa&quot;         # =&gt; nil re = /A(?i:a)A/p re =~ &quot;AaA&quot; # =&gt; 0p re =~ &quot;AAA&quot; # =&gt; 0p re =~ &quot;AAa&quot; # =&gt; nil 

后方参考 後方參考

正则表达式 \1 \2 ... \n 表示后方参考。正則表達式\1 \2 ... \n表示後方參考。 \n表示将匹配第n个括号(正则表达式的()表示群)的内容保存起来，供后面使用。 \n表示將匹配第n個括號(正則表達式的()表示群)的內容保存起來，供後面使用。

 /((foo)bar)\1\2/ 

和

 /((foo)bar)foobarfoo/ 

是一样的。是一樣的。

例:例:

 re = /(foo|bar|baz)\1/  p re =~ 'foofoo'   # =&gt; 0  p re =~ 'barbar'   # =&gt; 0  p re =~ 'bazbaz'   # =&gt; 0  p re =~ 'foobar'   # =&gt; nil re = /(foo|bar|baz)\1/p re =~ 'foofoo' # =&gt; 0p re =~ 'barbar' # =&gt; 0p re =~ 'bazbaz' # =&gt; 0p re =~ 'foobar' # =&gt; nil 

对应的括号必须位于后方参考表达式的左侧。對應的括號必須位於後方參考表達式的左側。

若后方参考表达式位于对应的括号中时，匹配常常会失败。若後方參考表達式位於對應的括號中時，匹配常常會失敗。 当后方参考表达式中的数字是1位，且没有对应的括号时，匹配也将失败。當後方參考表達式中的數字是1位，且沒有對應的括號時，匹配也將失敗。

 p /(\1)/ =~ &quot;foofoofoo&quot; # =&gt; nil  p /(foo)\2/ =~ &quot;foo\2&quot;  # =&gt; nil p /(\1)/ =~ &quot;foofoofoo&quot; # =&gt; nilp /(foo)\2/ =~ &quot;foo\2&quot; # =&gt; nil 

虽然可以指定2位以上的后方参考表达式，但是不要把它同反斜线表示法的\nnn(对应于8进制数nnn的字符)混为一谈。雖然可以指定2位以上的後方參考表達式，但是不要把它同反斜線表示法的\nnn(對應於8進制數nnn的字符)混為一談。 当数字只有1位时，通常是后方参考表达式。當數字只有1位時，通常是後方參考表達式。 当指定了一个超过2位的数字时，若没有对应括号的话，则被看作是8进制代码。當指定了一個超過2位的數字時，若沒有對應括號的話，則被看作是8進制代碼。

相反地，若在正则表达式中使用1位的8进制代码时，必须以0打头，例如\01等(不可能存在形如\0这样的后方参考表达式，因此不会混淆)。相反地，若在正則表達式中使用1位的8進制代碼時，必須以0打頭，例如\01等(不可能存在形如\0這樣的後方參考表達式，因此不會混淆)。

 p   /\1/ =~ &quot;\1&quot;   # =&gt; nil     # 无对应括号的后方参考  p  /\01/ =~ &quot;\1&quot;   # =&gt; 0       8 进制代码  p  /\11/ =~ &quot;\11&quot;  # =&gt; 0       8 进制代码    # 8 进制代码 (因为没有对应括号)  p /(.)\10/ =~ &quot;1\10&quot; # =&gt; 0    # 后方参考 (因为有对应的括号)  p /((((((((((.))))))))))\10/ =~ &quot;aa&quot;  # =&gt; 0    # 8 进制代码 (因为没有像&quot;\0&quot; + &quot;8&quot; -&gt; \08 这样的8进制代码)  p /(.)\08/ =~ &quot;1\0008&quot; # =&gt; 0    # 如果想在后方参考表达式之后插入数字的话，就必须使用括号加以分隔。 p /\1/ =~ &quot;\1&quot; # =&gt; nil #無對應括號的後方參考p /\01/ =~ &quot;\1&quot; # =&gt; 0 8進制代碼p /\11/ =~ &quot;\11&quot; # =&gt; 0 8進制代碼# 8進制代碼(因為沒有對應括號)p /(.)\10/ =~ &quot;1\10&quot; # =&gt; 0#後方參考(因為有對應的括號)p /((( (((((((.))))))))))\10/ =~ &quot;aa&quot; # =&gt; 0# 8進制代碼(因為沒有像&quot;\0&quot; + &quot;8&quot; -&gt; \08這樣的8進制代碼)p /(.)\08/ =~ &quot;1\0008&quot; # =&gt; 0#如果想在後方參考表達式之後插入數字的話，就必須使用括號加以分隔。 p /(.)(\1)1/ =~ &quot;111&quot;   # =&gt; 0 p /(.)(\1)1/ =~ &quot;111&quot; # =&gt; 0 


回缩(backtrack) 回縮(backtrack)

用特殊括号(?&gt; )将正则表达式括起来后，与该正则表达式相匹配的字符串中的回缩功能就将失效。用特殊括號(?&gt; )將正則表達式括起來後，與該正則表達式相匹配的字符串中的回縮功能就將失效。 举例如下。舉例如下。

例如在通常的正则表达式中例如在通常的正則表達式中

p /(a*)ab/ === 'aaab' p /(a*)ab/ === 'aaab'

是匹配的。是匹配的。 该匹配过程如下所示。該匹配過程如下所示。

   1. 正则表达式 a* 从索引0开始匹配3个a正則表達式a*從索引0開始匹配3個a
   2. 正则表达式 a 匹配失败正則表達式a匹配失敗
   3. 正则表达式 a* 将匹配部分稍稍“缩小”一下，匹配2个a(使用了回缩功能)正則表達式a*將匹配部分稍稍“縮小”一下，匹配2個a(使用了回縮功能)
   4. 正则表达式 a 与字符a匹配正則表達式a與字符a匹配
   5. 正则表达式 b 与字符b匹配正則表達式b與字符b匹配 

但是，如果用括号(?&gt; )把正则表达式括起来的话，就不再匹配了。但是，如果用括號(?&gt; )把正則表達式括起來的話，就不再匹配了。 详细过程如下。詳細過程如下。

   1. 正则表达式 a* 从索引0开始匹配3个a正則表達式a*從索引0開始匹配3個a
   2. 正则表达式 a 匹配失败正則表達式a匹配失敗
   3. a* 想把匹配部分回缩一下，但由于特殊括号的作用，回缩功能失效。 a*想把匹配部分回縮一下，但由於特殊括號的作用，回縮功能失效。
   4. 正则表达式 a* 从索引1开始匹配2个a正則表達式a*從索引1開始匹配2個a 

接下来的匹配都不成功，最终导致整体匹配失败。接下來的匹配都不成功，最終導致整體匹配失敗。

简单说来，通常的正则表达式是“贪婪型的匹配”，而(?&gt; )则是“超贪婪型的匹配”，因为它一旦匹配成功就决不放手。簡單說來，通常的正則表達式是“貪婪型的匹配”，而(?&gt; )則是“超貪婪型的匹配”，因為它一旦匹配成功就決不放手。
范例 範例

为了便于您拷贝使用，我们将其代入到以$re_开头的全局变量中。為了便於您拷貝使用，我們將其代入到以$re_開頭的全局變量中。
数值 數值

    *

      浮点数(包括整数)浮點數(包括整數)

       $re_float = /[-+]?(?:[0-9]+(\.[0-9]*)?|(\.[0-9]+))([eE][-+]?[0-9]+)?/    p $re_float =~ &quot;1.23&quot;    # =&gt; 0  p $&amp;.to_f                # =&gt; 1.23  p $re_float =~ &quot;.23&quot;     # =&gt; 0  p $&amp;.to_f                # =&gt; 0.23  p $re_float =~ &quot;1.23e1&quot;  # =&gt; 0  p $&amp;.to_f                # =&gt; 12.3  p $re_float =~ &quot;1.23e-1&quot; # =&gt; 0  p $&amp;.to_f                # =&gt; 0.123 $re_float = /[-+]?(?:[0-9]+(\.[0-9]*)?|(\.[0-9]+))([eE][-+ ]?[0-9]+)?/p $re_float =~ &quot;1.23&quot; # =&gt; 0p $&amp;.to_f # =&gt; 1.23p $re_float =~ &quot;.23 &quot; # =&gt; 0p $&amp;.to_f # =&gt; 0.23p $re_float =~ &quot;1.23e1&quot; # =&gt; 0p $&amp;.to_f # =&gt; 12.3p $re _float =~ &quot;1.23e-1&quot; # =&gt; 0p $&amp;.to_f # =&gt; 0.123 

用逗号将数字划分成3位一组的形式 用逗號將數字劃分成3位一組的形式

    *

      方法1：使用回行和先行的方法(回行(lookbehind)需要Oniguruma库的支持)方法1：使用回行和先行的方法(回行(lookbehind)需要Oniguruma庫的支持)

       p &quot;tone of 12345Hz&quot;.gsub(/(?&lt;=\d)(?=(?:\d\d\d)+(?!\d))/, ',')  =&gt; ruby 1.8.0 (2003-08-07) [i586-linux]     &quot;tone of 12,345Hz&quot; p &quot;tone of 12345Hz&quot;.gsub(/(?&lt;=\d)(?=(?:\d\d\d)+(?!\d))/, ',')=&gt; ruby 1.8 .0 (2003-08-07) [i586-linux] &quot;tone of 12,345Hz&quot; 

    *

      方法2：只使用先行的方法方法2：只使用先行的方法

       p &quot;tone of 12345Hz&quot;.gsub(/(\d)(?=(?:\d\d\d)+(?!\d))/, '\1,')  =&gt; ruby 1.8.0 (2003-08-07) [i586-linux]     &quot;tone of 12,345Hz&quot; p &quot;tone of 12345Hz&quot;.gsub(/(\d)(?=(?:\d\d\d)+(?!\d))/, '\1,')=&gt; ruby 1.8. 0 (2003-08-07) [i586-linux] &quot;tone of 12,345Hz&quot; 

    *

      方法3：不使用先行的方法方法3：不使用先行的方法

       s = &quot;tone of 12345Hz&quot;  nil while s.gsub!(/(.*\d)(\d\d\d)/, '\1,\2')  p s  =&gt; ruby 1.8.0 (2003-08-07) [i586-linux]     &quot;tone of 12,345 Hz&quot; s = &quot;tone of 12345Hz&quot;nil while s.gsub!(/(.*\d)(\d\d\d)/, '\1,\2')p s=&gt; ruby 1.8.0 ( 2003-08-07) [i586-linux] &quot;tone of 12,345 Hz</pre>
</div>
<div title="每月例行工作" modifier="fhopecc" created="200710010122" changecount="1">
<pre></pre>
</div>
<div title="每月陳報內政部戶政查調件數" modifier="fhopecc" modified="200806020107" created="200709030118" tags="每月例行工作 YHQ" changecount="40">
<pre>!內容
內政部戶政查調件數 mail 給桃園縣稅捐處
!程序
#打開 &quot;ELT/ 批次作業管理系統/排程及執行作業/非定期批次作業&quot;
#工作代號選擇 &quot;~YHQ705L_(戶政連線查詢清冊與統計表列印)
#&quot;存檔&quot;後編輯相關參數
#至&quot;操管報表列印作業&quot;，將&quot;內政部戶政查調''完成''件數&quot;結果 mail 至[[桃稅處鍾宜燕|mailto:inf212@tytax.gov.tw]]
!排程
&lt;&lt;reminder day:6 title:&quot;申報內政部戶政查調件數&quot; leadtime:5&gt;&gt;
!每月筆數
|月|筆數|
|8|1834|
|9|1053|
|10|1053|
|11|1166|
|12|960|

|97年|&gt;|
|1| 3,973|
|2|2,214|
|4|4449|
|5|1,164|</pre>
</div>
<div title="每週例行工作" modifier="fhopecc" modified="200709280242" created="200709280241" changecount="3">
<pre></pre>
</div>
<div title="水平線" modifier="fhopecc" created="200708230017" tags="如何使用wiki">
<pre>畫一條[[水平線]]做分隔線最簡單不過。只要在行開頭單行用四個減號(-)就行了。像這樣：
{{{
----
}}}
----</pre>
</div>
<div title="水費更名" modifier="fhopecc" created="200809040017" tags="緊急事項 完成事項" changecount="1">
<pre></pre>
</div>
<div title="汽車加油" modifier="fhopecc" created="200808290129" tags="緊急事項 完成事項" changecount="1">
<pre></pre>
</div>
<div title="沈志偉" modifier="fhopecc" modified="200903040804" created="200809010028" tags="經緯" changecount="3">
<pre>0927891688</pre>
</div>
<div title="沈懿嬅" modifier="fhopecc" modified="200803171229" created="200803171215" tags="沈懿嬅" changecount="9">
<pre>|沈懿嬅|S222566827|660403|
|花蓮市民勤里勵志新村30號|
&lt;&lt;reminder month:4 day:3 title:沈懿嬅生日 leadtime:7&gt;&gt;</pre>
</div>
<div title="沈懿萱" modifier="fhopecc" created="200805220652" changecount="1">
<pre>|沈懿萱|(O)075350079|</pre>
</div>
<div title="沈義雄" modifier="fhopecc" created="200805160252" tags="家人" changecount="2">
<pre>|沈義雄|31.10.11|T101976000|高雄市前鎮區瑞泰街140巷7號16F之5|</pre>
</div>
<div title="沙茶空心菜" modifier="fhopecc" modified="200805310944" created="200805280846" tags="食譜 空心菜" changecount="3">
<pre>!材料:
空心菜一把
香菇
薑
!調味料:
沙茶
!作法:
#爆香薑後.將香菇加入拌炒.再加入一大匙的沙茶醬.炒至六分熟
#加入空心菜一起炒至熟即可</pre>
</div>
<div title="法拍屋" modifier="fhopecc" modified="200804080539" created="200804072327" changecount="3">
<pre>!長安街27號14F-6 4/10
車庫
建多久
拍賣原因
沒人住
管理費
戶數
是否已欠管理費
!福祥段地號997
!建號</pre>
</div>
<div title="消除左遞迴產生式" modifier="fhopecc" modified="200712060145" created="200711251040" tags="編譯器原理" server.type="file" server.host="file://D:\sfhopecc\stwFhopecc\sfhopetw.htm.mine" server.page.revision="200711251059" changecount="1">
<pre>若文法 G 沒有迴圈產生式，以及空產生式，
將 G 的非終端元以下列方式排列
A~~1~~, A~~1~~,...,A~~n~~
則能以下面的演算法，消除 G 的左遞迴產生式。
for i = 1..n
*for j = 1..(i-1) 
**replace A~~i~~ -&gt; A~~j~~r by A~~i~~ -&gt; d~~1~~r | d~~2~~r |...|d~~l~~r where A~~j~~ -&gt; d~~1~~ | d~~2~~ |...|d~~l~~
**eliminate_immediate_left_recursion A~~i~~.productions
*end
end
</pre>
</div>
<div title="涼拌瓠瓜絲" modifier="fhopecc" created="200805310943" tags="瓠瓜 食譜" changecount="1">
<pre>材料：瓠瓜半條選較翠綠者，鹽、麻油、醬油、香菜，酸梅汁各少許。
作法：
   1. 瓠瓜去皮，切丁約0.3公分厚，三公分長，用少許鹽抓一抓，靜置至稍稍出水。
   2. 抓過鹽之瓠瓜絲加點麻油、醬油、香菜，滴上酸梅汁即可上桌。</pre>
</div>
<div title="清理 elt/shared_tmp/rpt/work/*.rpt 檔" modifier="fhopecc" modified="200709190553" created="200709190228" tags="地方稅主機清檔" changecount="5">
<pre>!清理 elt/shared_tmp/rpt/work/*.rpt 檔
每月 5 日前將上月的過渡檔清除</pre>
</div>
<div title="測試 Helper 類別" modifier="Fhopecc" modified="200708260434" created="200708260433" tags="ROR">
<pre>測試 Helper，我是放在 functional test，
所以在測試之前，要先 include Helper 進來。
例子如下：
{{{
include ReportsHelper
def test_apply_english_style
  s = apply_english_style(&quot;abcdEFG,,,,&quot;)
  assert_equal &quot;&lt;span class='en'&gt;abcdEFG&lt;/span&gt;,,,,&quot;, s
end
}}}</pre>
</div>
<div title="測試 route" modifier="Fhopecc" modified="200709080115" created="200709080101" tags="ROR" changecount="7">
<pre>通常測試 route 是放在 functional test 中。 
{{{assert_generates ( expected_path, options, defaults={}, extras = {}, [msg] )}}}
用來測試 ruby 碼中的 opts 是否會產生預定的 url_path，如下：
{{{
opts = {:controller =&gt; &quot;movies&quot;, :action =&gt; &quot;movie&quot;, :id =&gt; &quot;69&quot;}
assert_generates &quot;movies/movie/69&quot;, opts
}}}
{{{assert_recognizes ( expected_options, path, extras={}, [msg] )}}}
與 {{{assert_generates}}} 相反，測試 opts 是否會產生預期的 path
{{{
opts = {:controller =&gt; &quot;movies&quot;, :action =&gt; &quot;movie&quot;, :id =&gt; &quot;69&quot;}
assert_recognizes opts, &quot;/movies/movie/69&quot; 
}}}
{{{assert_routing ( path, options, defaults={}, extras={}, [msg] )}}}
綜合 {{{assert_generates}}} 和 {{{assert_generates}}} 的測試
{{{
opts = {:controller =&gt; &quot;movies&quot;, :action =&gt; &quot;movie&quot;, :id =&gt; &quot;69&quot;}
assert_routing &quot;movies/movie/69&quot;, opts
}}}</pre>
</div>
<div title="測試一" modifier="YourName" created="200704132327" tags="chkTodo xAA">
<pre></pre>
</div>
<div title="滕教官公祭" modifier="fhopecc" modified="200808190155" created="200806041345" changecount="12">
<pre>6/15(日)8:30 802 醫院忠誠
廖崇義0935693709  mobile076526923  home
方文鋒062519158  mobile0918154995  home
曾肇宏0931730203  mobile077018546  home
陳建宇0931788770  mobile078415541  home
----
身分證字號:     S123020695
電腦代碼:     117557
車次:    63              車種:    莒光號
乘車時刻:    2008/06/22 03:05 - 0615
起站:    花蓮              到站:    台東              張數:        1
取票或網路付款截止時間:    2008/06/11 22:00 
----
身分證字號:  S123020695    
電腦代碼:  906846
車次:         2052          車種:   自強
乘車時刻:   2008/06/15 06:18
起站:   台東         到站:   鳳山         張數:   01
取票或網路付款截止時間:   2008/06/11 22:00
----
身分證字號:  S123020695    
電腦代碼:  906571
車次:         81          車種:   莒光
乘車時刻:   2008/06/15 10:23
起站:   鳳山         到站:   台東         張數:   01
取票或網路付款截止時間:   2008/06/11 22:00
----
身分證字號:  S123020695    
電腦代碼:  906651
車次:         1056          車種:   自強
乘車時刻:   2008/06/15 13:20
起站:   台東         到站:   花蓮         張數:   01
取票或網路付款截止時間:   2008/06/11 22:00</pre>
</div>
<div title="濕熱也會悶出皮膚病" modifier="fhopecc" modified="200708220750" created="200708220743" tags="保健">
<pre>濕及流汗才是皮膚病的來源，花蓮是個潮溼的地方，如何保持乾燥，是很重要的。
黑體的，是我可能已患的疾病。

夏天陽光炙熱，許多人為免中暑曬傷選擇少出門在家避暑，但是這種燠熱的天候，縱使待在家裡，不吹冷氣，光吹電風扇，盡吹些別人家冷氣機排出的熱氣，又潮濕又悶熱，也要悶出不少皮膚病。
人類的皮膚自己有調節體溫、適應周圍環境的功能，也就是增加排汗，藉者汗液蒸發散出熱能，這是最基本的調節方式，但是流汗過度會引起皮膚病，尤其現代人冷氣房待久了，皮膚的調節能力也越來越差，這些排汗過多、排汗不良所致的眾家皮膚病號，在這個季節紛紛出籠。
一、 對磨疹：汗液留滯皮表，長時間的刺激後，皮膚的感覺是又〝癢〞又〝熱〞，最常見於皮膚皺褶處，大凡頸部、腋窩、肘窩、膝窩、股溝都是好發之處。
二、 股癬：或稱紅癬、錢癬，這種看起來邊緣特別紅，境界明顯，有如地圖形狀的皮膚疹子，好發部位不出對磨診的好發區域，尤以股溝、臀部最常見，主因體癬菌喜歡寄生在多汗潮癬之處。
三、汗疹：俗稱痱子，可分成較表淺的晶型汗疹，較深的紅色汗疹，好侵犯嬰幼兒與老年人，汗腺密集之處，如胸前、背後、額頭、衣服覆蓋之處、因大量汗液湧出，汗腺頓時堵塞在開口處或管腺內，形成汗疹，汗疹形成的速度很快，有時不一定要環境溫度高或濕熱，身體發燒體溫上升，也一樣會長汗疹，但來得快、去得也快，溫度涼了就會消失。
四、 汗儲留症：比汗疹更嚴重，在衣服覆蓋處，出現大量鮮紅色圓錐狀、浮腫的丘疹，紅疹大小不一約半公分左右，因汗管閉塞之後，周圍皮膚也引起發炎。
五、 皮屑芽包菌毛囊炎：在悶熱環境下工作的廚師、礦工、運動員等，毛囊的毛屑芽包菌遽增，引起毛囊發炎，易生於前胸、後背、手臂會癢，與一般的痤瘡外表很難區別。
六、 ''黃菌毛症''：腋毛變白或變黃，不易折斷，是細菌或真菌寄生在潮濕的腋毛，形成白或黃色的披蓋物。
七、 青春痘：濕熱環境，皮脂出油量增加，易阻塞毛囊，引起痘痘的惡化。
八、 狐臭：排汗過度，大汗腺（頂漿腺）會分泌過多有味道的分泌物，在腐生菌的推波助瀾之後，狐臭的香味也就應適而生，越胖的人，似乎體臭特別明顯，應與肥胖分泌物不易揮發有關。
　　至於夏天的皮膚保健之道，常擦汗、常沐浴，保持皮膚乾爽是根本之道，噴些除臭劑、抑汗劑也無妨，常換乾淨的衣服與鞋子，也不失為讓自己舒服，也讓周遭的人聞了高興的好方法。
　　其實天氣熱不一定有上述問題，主要在於台灣氣候又熱又濕，例如在中東天氣雖熱但濕度低，縱使整天包罩巾，也不流汗，當然不會有上述這些疾病，怪不得台灣的皮膚科醫生夏天特別忙碌，不是沒有道理的。

健康的叮嚀
馬偕紀念醫院 皮膚科主任　蘇信義
夏天戶外活動多，但是還是要避免陽光曝曬，尤其是早上十點至下午二點，因為此時的紫外線輻射最強，暴曬太久會造成皮膚曬傷，甚至得到日光性皮膚炎。長期下來，更使得到皮膚癌的機會大增，所以，最好還是養成使用防曬產品的習慣。
馬偕紀念醫院 皮膚科主治醫師　林揚志
青春痘是一種生理現象，醫師可以幫助你治療，但是主控權仍在你自己手中，充足的睡眠、清淡的飲食、愉快的心情、以及臉部的清潔，可以防止痘痘在你臉上肆虐，如果已經到了無法控制的地步，記得趕快找醫師診治。</pre>
</div>
<div title="災變回復" modifier="fhopecc" modified="200710030159" created="200710030157" tags="資通安全" changecount="4">
<pre></pre>
</div>
<div title="炒絲瓜" modifier="fhopecc" modified="200808050604" created="200806080321" tags="食譜 絲瓜" changecount="2">
<pre>1)灰樹花用溫水泡發後洗淨。絲瓜去皮切成塊，泡入鹽水中，以免氧化變黑。枸杞用溫水浸泡5分鐘後洗淨備用。

2)鍋中倒入清水，大火加熱至沸騰後，放入少許鹽，倒入灰樹花，焯5分鐘後撈出，待冷卻後去掉根部，撕成小片。


3)炒鍋中入油，大火加熱7成熱時，倒入瀝乾的絲瓜塊，煸炒幾下後放入灰樹花和枸杞，倒入高湯煮3分鐘。然後，調入適量鹽，雞精，淋水澱粉出鍋。

絲瓜去皮切成塊，泡入鹽水中，以免氧化變黑。
或切塊後，調入少許鹽醃製5分鐘也可。

灰樹花是菌類的一種，在日本又叫舞茸，因為找到它的人會很興奮，手舞足蹈。在亞洲地區，灰樹花是頗受人們歡迎的烹飪及藥用蘑菇，這不僅因為它含有豐富的蛋白質、碳水化合物、纖維、維生素、多種微量元素和生物素，有利於人體健康，美味可口也是重要原因之一。</pre>
</div>
<div title="為嘉品報戶口" modifier="fhopecc" modified="200808070211" created="200808060707" tags="緊急事項 完成事項" changecount="4">
<pre>老婆的戶口名簿、簽名、身份證、私章</pre>
</div>
<div title="無線網路安全" modifier="fhopecc" modified="200709130549" created="200709070117" tags="資通安全" changecount="3">
<pre></pre>
</div>
<div title="牙齦出血" modifier="fhopecc" modified="200709180111" created="200709180056" tags="保健" changecount="4">
<pre>牙齦為什麼會出血？
一般來說，健康的牙齦應該不會流血，因此若出現刷牙時牙齦出血的情形，便是早期牙周病變的警告了。
牙周病是指牙周組織發炎、齒槽膿漏、牙槽骨疏鬆或萎縮、牙齒鬆動等慢性疾病，而形成牙周病的最主要因素，就是「牙菌斑」。
在初期，牙齦周圍會變紅變腫，牙齦組織脆弱；刷牙時會有出血情形；若繼續惡化，遇到輕微碰觸或磨擦，牙齦即會出血；同時有嚴重口臭；牙齒對於咬硬的東西會有酸軟的感覺，對冷熱等溫度變化敏感，常有牙齒酸軟疼痛的感覺。 
避免太多酸性食物的攝取，如飲料、可樂等，而攝食後，切勿立即刷牙，因其酸性會造成其表面暫時性的脫鈣，有學者建議稍後再刷。另外，在台灣因為抽煙、吃檳榔人口眾多，口腔衛生不佳，因此牙齒常有大量煙、檳榔垢堆積，而很多人為了有較強而有效的清潔效果，常採用很粗糙的牙粉，長期使用，常造成嚴重的磨損。
因此，在牙膏的選擇上也是必須要注意的，如果標榜去污力強的牙膏、牙粉在使用上也必須格外的謹慎，因為使用不當，可能造成的後果反而更為嚴重。另外喜嚼檳榔的患者最好能夠戒除，除了環境污染、雅觀與否的問題外，口腔癌、嚴重牙齒咬合面的磨損更是常見，也因此敏感性牙齒的症狀也常伴隨著這一類的患者。
最後，還是再次強調正確的刷牙方式，如果您能好好清潔您的牙齒，那您的牙齒才能免於蛀牙、牙周疾病的困擾。</pre>
</div>
<div title="狀態轉移表簡寫" modifier="Fhopecc" modified="200709201101" created="200709190356" tags="圖靈機" changecount="11">
<pre>!!!!掃描符號的簡寫
其中 X~~b~~ 是紙帶符號集合的簡寫，
若 X~~b~~ = {0, 1, b}，則下表
|!現在狀態|!掃描符號|!印出符號|!移動|!後繼狀態|
|b|X~~b~~|0|R|c|
為
|!現在狀態|!掃描符號|!印出符號|!移動|!後繼狀態|
|b|0|0|R|c|
|b|1|0|R|c|
|b|b|0|R|c|
的簡寫。
!!!!印出符號的簡寫
其中 s:X~~b~~ 是紙帶符號集合的簡寫，
若 X~~b~~ = {0, 1, b}，則下表
|!現在狀態|!掃描符號|!印出符號|!移動|!後繼狀態|
|b|X~~b~~|s|R|c|
為
|!現在狀態|!掃描符號|!印出符號|!移動|!後繼狀態|
|b|0|0|R|c|
|b|1|1|R|c|
|b|b|b|R|c|
的簡寫。</pre>
</div>
<div title="理髮" modifier="fhopecc" created="200806200603" changecount="1">
<pre>|衛生局美髮室|038227141#111|</pre>
</div>
<div title="琢磨妳的紅寶石" modifier="fhopecc" modified="200711160559" created="200711160039" changecount="3">
<pre>[[Base64於Ruby上的妙用]]</pre>
</div>
<div title="環保補蚊罐" modifier="fhopecc" modified="200710310829" created="200710290429" tags="生活常識" changecount="5">
<pre>永安環保滅蚊罐

研究學生：郭家安、陳穎涵、沈奕均
指導老師：徐佳璋、陳文億

A. 材料： 2000 ml 保特瓶、50 ml 砂糖、1g包子饅頭酵母粉
成本共約2.5元(瓶子算0.5元)

B. 容器的製作
2000 ml 寶特瓶(沒有擠壓變形過)
延標籤上緣約1cm處(最凸出處)環狀切開
此時可得 「漏斗狀之瓶口」 與「瓶之底座 」

C. 發酵糖水之製備
1. 200ml 熱水 加入半瓶小瓶養樂多的砂糖(約50g 也正好約 50 ml)完全溶化
2. 降溫至40度以下 倒入「瓶之底座 」中，灑上酵母粉不用攪拌（溫度太高 酵母死亡 保證失敗）
3. 將「漏斗狀之瓶口」倒塞入「瓶之底座 」中
4.外圍可包上黑紙
5.靜置黑暗角落中
6.約兩小時後，冒泡泡速最快。糖水約可發酵一至二週

D. 注意事項
1.實際使用測試 在隱藏蚊子的地下室有奇效---曾在一週內一瓶捕獲1427隻蚊子
2.若家中蚊子只有兩三隻則效果有限，畢竟此非滅絕性殺蚊法，對蚊子而言生物的吸引力 應該還是會大於發酵糖水。
3.放房間中央 完全無效。放牆邊 有效。放角落 效果最大
本文 POST 於台北市永安國小 自然科教師 徐佳璋網頁
cation.uclass.com.tw

PS.下圖中寶特瓶使用時 瓶口不塞紙 要保持通暢

這個瓶子的頂端有用使用熱熔膠,但最後發現只要切的平整
不用熱熔膠,直接套上去效果不差,且方便製作與清洗
----
夏天夜裡最討厭的就是蚊子來干擾睡眠，其實想要輕鬆抓蚊子不一定要花大錢，台北市永安國小師生就發明了一種，用寶特瓶和發酵糖水做成的環保捕蚊罐，成本不到3塊錢，一個禮拜就抓了將近1500隻蚊子。
台北市永安國小老師徐佳璋指出，環保補蚊罐最多一個禮拜，有抓到1400多隻，還有連續放1個月，累積抓到有3、5000隻的紀錄，簡直很可怕，厚厚的一層就像是地毯一樣。
而關於這個環保補蚊罐的原理，徐佳璋指出，其實就是利用發酵糖水散發的二氧化碳來吸引蚊子，瓶罐的設計則能夠留住蚊子不讓蚊子跑掉。
且所要準備的方法和材料也相當簡單，只要寶特瓶、砂糖、發粉和黑色紙，首先從寶特瓶最突出的部分割開再用量杯加熱水把砂糖溶化，接著要加冷水讓溫度降到40度以下，才能讓發粉順利發酵像人體一樣慢慢產生二氧化碳，接著扣上切開的寶特瓶口讓蚊子進去出不來，再拿黑色紙包住。
徐佳璋並指出，做好的環保補蚊罐最好放置在牆角，因為蚊子有飛簷走壁的行為，遇到牆以後會沿著牆邊飛行，假如罐子放在牆壁邊或者放在牆角的地方，效果特別好，而且兩邊的蚊子碰到牆壁都會往這邊集中。
但因為環保捕蚊罐內有過期糖水，要每2周定期更換新的補蚊罐，否則可能會長小果蠅。
</pre>
</div>
<div title="瓠瓜炒麵條" modifier="fhopecc" modified="200805310944" created="200805310943" tags="瓠瓜 食譜" changecount="2">
<pre>材料：瓠瓜半條、紅蘿蔔半條，素火腿、乾香菇、全麥麵條一包、香菜。
作法：
   1. 燒一鍋熱水燙麵，燙好的麵拌些許橄欖油。
   2. 將所有材料切絲，起油鍋爆香菇，續加入紅蘿蔔絲、瓠瓜絲，素火腿少許水燜軟，放鹽，再加入燙好的麵條，炒勻。
   3. 食用時加點香菜、甜辣醬、或黑胡椒粉均非常可口。</pre>
</div>
<div title="申請 pc2-3200r 記憶體" modifier="fhopecc" modified="200808280236" created="200808271010" tags="緊急事項 完成事項" changecount="3">
<pre>[[東茂資訊]]
oaserver</pre>
</div>
<div title="申請生育補助" modifier="fhopecc" created="200808270850" tags="緊急事項 完成事項" changecount="1">
<pre></pre>
</div>
<div title="異常值之顯示" modifier="YourName" modified="200711051225" created="200709040644" tags="HIS專案" changecount="16">
<pre>!異常值之顯示
!!範圍數值欄位
#若欄位型態為範圍數值，則此欄位會附掛一個正常值範圍，當數值超出正常值範圍即以紅色顯示。
#於''輸入模式''時，其正常值範圍顯示在旁，並有一按鈕可更改正常值範圍
!!!預設為範圍數值欄位
#BMI 值為範圍數值(預設為 18..24)
#Circumference of waist為範圍數值且男女有別
!!文字欄位
#把要突顯的文字以[']字元括住即可</pre>
</div>
<div title="省電信費" modifier="fhopecc" created="200710300454" tags="電信費" changecount="1">
<pre>省荷包的消息，爭議多年的「5元屋內市話配線月租費」，回饋有譜；中華電信終於讓步，同意不強制收取全台930萬市話用戶，每個月5元的配線月租費，民眾只要打123專線取消就行了，尤其是20年以上的用戶，如果電話線壞了可以終身免費維修。

市話帳單上，這5元的「屋內配線月租費」，終於可以不用再被白A！中華電信在消保會不斷要求下，決定停止「強制」收費，把錢還給消費者。中華電信行銷處科長許家村：「明年1月1日正式把優惠方案，回饋給我們的消費者客戶，20年以上的，當然終身免繳(5元配線月租費)，這樣的優惠。」

也就是說，同一支市話號碼用了20年以上，可以立刻打123專線，找專人取消收費，不但每個月省5元還能終身免費維修，15年以上未滿20年，免費修2次，7年到15年免費修一次，但消保官建議，使用不到7年的用戶，每個月還是繼續繳交5元維修費比較划算。消保官張嘉麟：「包括檢修費跟施工費，大概有400元，所以這個部分(取消配線費)，消費者可能要衡量一下，(使用年資)7年以下，是沒有免費維修的服務。」

從民國79年收到現在，中華電信光「配線月租費」的進帳就超過47億這次回讓步，全台有930萬戶受惠，算是真正把5元放回民眾荷包。</pre>
</div>
<div title="看新城的法拍" modifier="fhopecc" modified="200806020313" created="200805230345" tags="待辦事項 完成事項" changecount="2">
<pre></pre>
</div>
<div title="瞬間描述" modifier="Fhopecc" modified="200709212116" created="200709180201" tags="圖靈機" changecount="18">
<pre>!!瞬間描述
由圖靈機的定義，可以知道使用下述的瞬間描述表示圖靈機 M 任一時刻的狀態，
w = ~AqxB 為 M 的一個瞬間描述，其中 A:(X~~b~~)^^*^^表示掃描頭之前的紙帶符號，
x:X~~b~~表示掃描頭目前的紙帶符號，B:(X~~b~~)^^*^^表示掃描頭之後的紙帶符號，
q:Q表示掃描頭目前的狀態。
我們使用 D~~M~~ 表示 M 的所有瞬間描述的集合。</pre>
</div>
<div title="知識管理系統問題" modifier="fhopecc" modified="200811060319" created="200809160705" tags="重要事項" changecount="4">
<pre></pre>
</div>
<div title="研究 C-ISAM 資料庫系統" modifier="fhopecc" modified="200710020607" created="200708270645" tags="資料庫" changecount="9">
<pre>!命令簡介
{{{
isinfo – 查詢 C-ISAM 資料庫格式索引個數及位置
islist – 查詢 C-ISAM 資料庫格式內容
isload – 載入檔案至 C-ISAM 資料庫
isbuild – 產生 C-ISAM 資料庫索引的定義
}}}</pre>
</div>
<div title="碩3下" modifier="fhopecc" modified="200804010059" created="200802210822" tags="碩士" changecount="10">
<pre>&lt;&lt;tiddler  碩3註冊&gt;&gt;

&lt;&lt;tiddler 學位考試&gt;&gt;

&lt;&lt;tiddler 碩3下書報討論時間&gt;&gt;</pre>
</div>
<div title="碩3下書報討論時間" modifier="fhopecc" modified="200804062245" created="200803090422" tags="碩士" changecount="8">
<pre>&lt;&lt;reminder year:2008 month:4 day:12 title:期中第1次報告&gt;&gt;
&lt;&lt;reminder year:2008 month:4 day:19 title:期中第2次報告&gt;&gt;
&lt;&lt;reminder year:2008 month:6 day:21 title:期未第1次報告&gt;&gt;
&lt;&lt;reminder year:2008 month:6 day:28 title:期未第2次報告&gt;&gt;
期中第一次報告 4/12 張簡、建洲、昭明、琮富、侑峻
期中第二次報告 4/19 其餘人


期中第一次報告 6/21 其餘人
期中第二次報告 6/28 張簡、建洲、昭明、琮富、侑峻

說明：
1.報告時間為 13:30-15:40
2.4/19 繳交期末報告所閱讀的paper
3.有人想要調時間請跟我說
</pre>
</div>
<div title="碩士" modifier="fhopecc" created="200802210732" changecount="1">
<pre>97年3月21日至3月26日</pre>
</div>
<div title="碼塊" modifier="fhopecc" modified="200802130310" created="200802130221" tags="Ruby" changecount="5">
<pre>Block and Proc
blockprocclosurefunction

Ruby 可以將程式碼參數化，Ruby 稱被參數化的程式碼為 block 。Ruby 語法以 {||} 表示一個 block ，其中的 || 為參數列宣告，若無參數則可省略。

Ruby 的 Proc 類似 ECMAScript 的 Function。在 ECMAScript 中使用關鍵字 function 即可配置一個 Function 實例。 Ruby 則使用 Kernel::proc、Kernel::lambda 方法 (兩者相同) 或是直接建構一個 Proc 實例(Proc.new)，需提供一個 block 作為引數。

Ruby: proc { |arguments| codes }
ECMAScript: function(arguments) { codes }

Block and Proc

Block 無法單獨存在，只能作為 Ruby 指令或呼叫方法時的引數。Ruby 會主動將 block 參數化，程序員僅需利用流程指令 yield 即可將流程轉移到被參數化的 block 中運行。

Block way. 這種用法較常見。
view plainprint?

   1. def nP(n)  
   2.     if block_given?  
   3.         yield n    # yield to black  
   4.     else  
   5.         puts 'no block'  
   6.     end  
   7. end  

def nP(n) if block_given? yield n # yield to black else puts 'no block' end end

Proc way. 細節後述。
view plainprint?

   1. def nP(n, &amp;p)  
   2.     if block_given?  
   3.         p.call n    # call proc p  
   4.     else  
   5.         puts 'no block'  
   6.     end  
   7. end  

def nP(n, &amp;p) if block_given? p.call n # call proc p else puts 'no block' end end

用例:
view plainprint?

   1. nP('hello') {|n| puts n}  
   2. nP(10) do |n|  
   3.     n.times do  
   4.         puts 'a'  
   5.     end  
   6. end  

nP('hello') {|n| puts n} nP(10) do |n| n.times do puts 'a' end end

不論是用 block 或是 Proc ，都可以用 Kernel::block_given? 方法判斷使用方有無傳遞 block 。

Proc::call 方法也可以運算子 [ ] 形式調用。上例之 p.call n 亦可寫成 p[n]。
view plainprint?

   1. def nP1(n)  
   2.     if block_given?  
   3.         yield n    # yield to black  
   4.     else  
   5.         puts 'no block'  
   6.     end  
   7. end  
   8.   
   9. def nP2(n, &amp;p)  
  10.     if block_given?  
  11.         p[n]    # call proc p  
  12.     else  
  13.         puts 'no block'  
  14.     end  
  15. end  

def nP1(n) if block_given? yield n # yield to black else puts 'no block' end end def nP2(n, &amp;p) if block_given? p[n] # call proc p else puts 'no block' end end

ECMAScript 只有 Function 類，沒有 block 與 proc 的區分。上述的 Ruby 程式，以 ECMAScript 表達如下列所示:
view plainprint?

   1. function nP(n, p) {  
   2.     return p(n);  
   3. }  
   4.   
   5. nP(10, function(n){print(n)});  
   6. nP(10,  
   7.   function(n) {  
   8.     for (var i = 0; i &lt; n; ++i)  
   9.       print('a');  
  10.   }  
  11. );  

function nP(n, p) { return p(n); } nP(10, function(n){print(n)}); nP(10, function(n) { for (var i = 0; i &lt; n; ++i) print('a'); } );
Block and Method

定義方法時，若參數名稱前冠上 &amp; 符號， Ruby 將自動轉換 block 為 Proc 實例(隱性調用 Proc.new)，令其成為具名參數。
view plainprint?

   1. def nP(n, &amp;p)  
   2.     p.call n  
   3. end  
   4.   
   5. def mP(m, p)  
   6.     p.call m  
   7. end  
   8.   
   9. nP('john') {|name| puts name}  
  10.   
  11. mP('bob', Proc.new {|name| puts name} )  
  12. mP('bob', proc {|name| puts name} )  # Kernel::proc  

def nP(n, &amp;p) p.call n end def mP(m, p) p.call m end nP('john') {|name| puts name} mP('bob', Proc.new {|name| puts name} ) mP('bob', proc {|name| puts name} ) # Kernel::proc

大多數情形，我們只需要傳遞一段程式 (一個block) ，所以 Ruby 提供了自動轉換 block 為 Proc 實例的機制。作為待轉換為具名參數的程式碼區塊引數，必須位於方法定義之參數列的最後一個。

如果要傳遞多段程式，則不適用上述轉換機制。程序員必須明確指示處理動作。
view plainprint?

   1. def xP(n, &amp;p1, &amp;p2)  # ERROR!  
   2. end  
   3.   
   4. def xP(n, p1, p2)  
   5.     p1.call n  
   6.     p2.call n  
   7. end  
   8.   
   9. xP(5,  
  10.     proc {|n| puts n },  
  11.     proc {|n| n.times {puts 'a'} }  
  12. )  

def xP(n, &amp;p1, &amp;p2) # ERROR! end def xP(n, p1, p2) p1.call n p2.call n end xP(5, proc {|n| puts n }, proc {|n| n.times {puts 'a'} } )

自動轉換 block 為 Proc 實例的機制通常應用於動態繫結的場合。
view plainprint?

   1. class DP  
   2.     def initialize(&amp;p)  
   3.         @do = p  
   4.     end  
   5.     def do(n)  
   6.         @do.call n  
   7.     end  
   8. end  
   9.   
  10. d = DP.new {|n| puts n}  
  11. d.do 5  

class DP def initialize(&amp;p) @do = p end def do(n) @do.call n end end d = DP.new {|n| puts n} d.do 5

Block 與 Closure 的應用可參考 Martin 《Closure》。 </pre>
</div>
<div title="神通" modifier="fhopecc" created="200711220033" tags="公司" changecount="1">
<pre>|神通|
|財資中心|1061~1065|SCO|
|劉盈志|0933906073|yingchih@mitac.com.tw|
|廖春豪|0920722767|chliau@mitac.com.tw|
</pre>
</div>
<div title="科工館演講廳旁的行道樹(98資安訓練)" modifier="fhopecc" modified="200808240005" created="200808120712" tags="植物" changecount="3">
<pre>果：似桃子、核果、皮具絨毛、槳果
葉：互生、不具托葉(我錯了)、全緣、波浪狀、長披針狀、初生葉紅黃葉
莖：黑具白色縱紋
樹冠：圓錐狀
應該是毛柿</pre>
</div>
<div title="稅務e網通" modifier="fhopecc" modified="200903240332" created="200903170605" changecount="2">
<pre>UDD3765501/2wsx3edc</pre>
</div>
<div title="稅務圍琪" modifier="fhopecc" created="200808150819" tags="緊急事項 完成事項" changecount="1">
<pre>8/16(Sa)2:30 宜昌國中佈置埸地
8/17(Su)7:00 宜昌國中</pre>
</div>
<div title="稅局網站" modifier="fhopecc" modified="200903260549" created="200711300728" tags="公司" changecount="6">
<pre>!康佳多媒體
|胡小姐|8334774|
|張文俊|08334774#15|
|洪先生|#15|
!袁浩雲:0928605390
</pre>
</div>
<div title="稅捐" modifier="YourName" created="200710220029" changecount="1">
<pre></pre>
</div>
<div title="稅捐處值勤" modifier="fhopecc" created="200807300020" tags="稅捐處業務" changecount="1">
<pre>&lt;&lt;reminder year:2008 month:8 day:28 title:稅捐處值勤&gt;&gt;</pre>
</div>
<div title="稅捐處業務" modifier="fhopecc" modified="200710010855" created="200709040756" tags="稅捐處業務" changecount="2">
<pre># 管理及執行機時統計系統
# 管理及執行網路連線應用介面管理資訊系統
# 管理及執行程式館管理系統
# 管理全國財產總歸戶系統
# 管理戶政資料查詢系統
# 管理國稅地方稅資訊應用系統
# 管理媒體管理系統
# 管理稅務及 OA 資料庫系統
# 管理稅務及 OA 的 Weblogic 系統
# 管理稅務及 OA 的 AIX 系統
# 管理防火牆
# 管理資料備份系統
# 管理網路連線
# 管理 Windows 網域伺服器
# 執行稅處資料庫稽核業務
# 執行資訊稽核業務
# 執行資訊安全業務</pre>
</div>
<div title="稅收及退稅快報電腦網路傳輸作業情形表" modifier="fhopecc" modified="200907130548" created="200708230626" tags="稅捐處業務" changecount="18">
<pre>#收文後核對，至http://www.fdc.gov.tw/list.asp下載公文
#列印出花蓮縣的表(1,4,7,10,13)
#並用瑩光筆強調花蓮縣的記錄
#修改[[附簽|file:///d:/fhopecc/twFhopecc/稅收退稅快報附簽.odt]]範本的文號及日期
#文同附簽呈股長
#奉 核後影印自存，文存
----
紙本範本於公文範本夾 p1
</pre>
</div>
<div title="程序員" modifier="fhopecc" modified="200803270332" created="200803031340" tags="投稿 Ruby投稿" changecount="5">
<pre>您有什麼好的思想、成果、文章、技巧並想與他人一起分享嗎？那麼趕快投稿吧！《程序員》等待你的參與！
一、投稿範圍
|版塊|欄目|簡介|
|名人堂|國內外有突出貢獻且為人們所公認的計算機技術知名人士報導|
|人物&amp;報導|人物專訪|業界有特色的人物的專訪|
|報導|對業界新近發生的事件進行及時的報導|
|名家專欄|經驗豐富的業界人士所作的開發、管理等方面的經驗之談|
|管理|軟件創業 走向編程之路所需要的各種技術、工具、素養，學習導引、思想指點等|
|CTO論道|各大軟件公司的管理之道，多方面、寬領域，如公司的管理、項目的開發、市場戰略等等|
|CMM專欄|為解決軟件危機，CMM在中國的發展分析、實施CMM的要點、CMM的具體內容分析對比等|
|案例剖析|對某個公司或某個項目的完整、理性分析，不論開發人員或者管理層都可以從中吸引經驗或教訓|
|軟件工程|目前為專欄作者高展的軟件工程，以後可多方面介紹或分析、評析，軟件工程的重要性，實施要點等等|
|技術|技術專題|系統闡述某一開發課題|
|電腦英語|精選電腦專業英文原著進行對譯|
|linux專欄|Unix、Linux開發工具、經驗、技巧|
|MSDN專欄|面向微軟的平台、開發工具的文章|
|數據庫專欄|闡述大型網絡數據庫開發、維護經驗和技巧|
|解決方案|以報導不同行業的解決方案為主|
|系統管理員專欄|面向系統管理員文章|
|技術講座|完整地闡述某一開發技術|
|開發心得|常見、實用、較為高級的編程技巧|
|源碼分析|詳細分析實用源代碼的思路、實現方式|
|開發工具|介紹常見、實用的開發工具的實用方法和技巧|
|編程擂台|讀者參與的互動欄目，每一期一題，對積極參與、答案正確的讀者進行獎勵|
|專家門診|基於CSDN專家門診頻道的編程FAQ|
|服務|書評 評點圖書市場或某一類、某一本書圖書|
|好書推薦|當前市場上暢銷且內容優秀圖書的推薦或分門別類的某一種工具、語言的圖書推薦|
|教育培訓|各種考試、認證等技巧、攻略、心得|
|新書快訊|配合廣告、市場的最新圖書信息，包括新書出版、征名、書目等圖書快訊|
|編讀往來|雜誌和讀者之間交流、溝通的園地、雜誌活動公告欄、程序員論壇等|

二、投稿要求
1．文責自負。作者保證其擁有該作品的完全著作權（版權），該作品不侵犯任何他人的著作權；
2．全權許可。《程序員》雜誌有權以任何形式（包括但不限於紙媒體、網絡、光盤等介質）使用、編輯、修改該作品，無須另行徵得作者同意，無須另行支付稿酬；
3．獨家使用。未經《程序員》雜誌書面許可，稿件在《程序員》發表後兩個月內作者不同意任何單位和個人以任何形式使用（包括但不限於通過紙媒體、網絡、光盤等介質轉載、張貼、集結、出版）該作品，著作權法另有規定的除外。

三、稿酬標準
文章通過審核，《程序員》與作者簽署正式約稿協議，並另外支付稿酬為：
1．原創稿件稿費為每千字80-140元。
2．翻譯稿件稿費為每千字60元。
3．質量高的稿件稿酬不受以上限制。

四、投稿方法
1．字數：不限；
2．格式：請使用Word文件格式；
3．投稿時請寫清楚你的地址、郵編、筆名、真實姓名及身份證號碼，如果有招行一卡通請告知您的一卡通卡號；
4．投遞形式：通過E-mail發送，地址是 editor@csdn.net （投稿或來信查詢用稿情況標題請注稿件或投稿）。
　　　 如有疑問可電話諮詢 （Tel：010-51661202-211；010-64341425）

五、注意事項
1．投稿在半月內通知投稿人稿件是否錄用。無特殊情況，刊發稿件的稿費將在刊登當月發放，如該月有多篇稿件被刊登，則稿費累計發放；
2．稿件不能一稿多投，且必須是未在其他媒體發表過的文章，一經發現有從其它媒體摘抄或一稿多投將取消稿費，並刊登譴責聲明；
3．《程序員》和CSDN還同多家傳統媒體合作，推薦優秀的稿件。因此，我們希望大家踴躍投稿和推薦作者或稿件，我們一定做到有稿必復。
4．在您提交稿件的同時，請在稿件末尾附上您個人簡介，格式如：
「本文作者王輝 是 微軟 的顧問軟件工程師。他目前在中國北京 中國科學院計算機研究所 工作，從事 XML 的研究。可以通過 wanghui@csdn.com.cn 與他聯繫。」</pre>
</div>
<div title="程式碼格式化" modifier="fhopecc" modified="200711210237" created="200711210232" tags="vim" changecount="2">
<pre>!多行縮排
先按 v 進入 visual mode，
選好要縮排的行，
再按 &gt; 便能對所有選取的行縮排</pre>
</div>
<div title="程式館入館列印" modifier="fhopecc" created="200808040143" tags="緊急事項 完成事項" changecount="1">
<pre></pre>
</div>
<div title="程式館測試報告" modifier="fhopecc" created="200810270933" tags="緊急事項" changecount="1">
<pre></pre>
</div>
<div title="種茱萸" modifier="fhopecc" modified="200806191312" created="200806191310" tags="園藝" changecount="2">
<pre>齊民要術
 種 茱 萸 第 四 十 四
　 　 食 茱 萸 也 ， 山 茱 萸 【 一 】 則 不 任 食 。

　 　 二 月 、 三 月 栽 之 。 宜 故 城 、 隄 、 僴 高 燥 之 處 。 凡於 城 上 種 蒔 者 ， 先 宜 隨 長 短 掘 鹗 【 二 】 ， 停 之 經 年 ， 然後 於 鹗 中 種 蒔 ， 保 澤 沃 壤 ， 與 平 地 無 差 。 不 爾 者 ， 土 堅澤 流 ， 長 物 至 遲 ， 歷 年 倍 多 ， 樹 木 尚 小 （ 一 ） 。

　 　 候 實 開 ， 便 收 之 ， 掛 著 屋 裏 壁 上 ， 令 廕 乾 ， 勿 使煙 熏 。 煙 熏 則 苦 而 不 香 也 。

　 　 用 時 ， 去 中 黑 子 。 肉 醬 、 魚 鮓 ，偏 （ 二 ） 宜 所 用 。

　 　 《 術 》 曰 ： 「 井 上 宜 種 茱 萸 ， 茱 萸 葉 落 井 中 ， 飲此 水 者 ， 無 溫 病 。 」

　 　 《 雜 五 行 書 》 曰 ： 「 舍 東 種 白 楊 、 茱 萸 三 根 ， 增年 益 壽 ， 除 患 害 也 。 」

　 　 又 《 術 》 曰 ： 「 懸 茱 萸 子 於 屋 內 ， 鬼 畏 不 入 也 。」

（ 一 ） 　 各 本 作 「 小 」 ， 明 抄 作 「 少」 ， 二 字 雖 通 用 ， 明 抄 應 是 誤 字 。

（ 二 ） 　 「 偏 」 ， 各 本 同 ， 無 作 「 遍」 者 ， 《 輯 要 》 引 亦 作 「 偏 」 ， 並 非 錯 字 。 按 卷 八 有 《作 魚 鮓 》 篇 ， 全 用 茱 萸 ， 《 脯 臘 》 篇 則 用 椒 ， 烹 飪 各 篇也 用 椒 ， 說 明 茱 萸 對 於 魚 鮓 、 肉 醬 在 當 時 的 調 味 習 慣 上有 所 「 偏 宜 」 。 又 卷 九 《 素 食 》 篇 「 缹 瓜 瓠 法 」 有 「 偏宜 豬 肉 」 ， 也 證 明 此 處 「 偏 宜 」 不 誤 。 「 偏 宜 」 猶 言 特宜 。

【 一 】 　 食 茱 萸 ， 芸 香 科 ， 果 實 為 裂果 ， 味 辛 香 ， 供 食 用 。 又 名 「 欓 子 」 。 山 茱 萸 ， 山 茱 萸科 ， 果 實 甘 酸 ， 供 藥 用 。 又 有 吳 茱 萸 ， 芸 香 科 ， 果 實 亦供 藥 用 。

【 二 】 　 「 鹗 」 同 「 塹 」 ， 《 說 文 》： 「 阬 也 。 」 卷 五 《 種 榆 白 楊 》 篇 有 「 鹗 坑 」 ， 意 即 坑溝 。 </pre>
</div>
<div title="筆硯更新" modifier="fhopecc" created="200809020817" tags="公文系統" changecount="1">
<pre>#用 administrator 登入
#切換網卡到外網
#按桌面&quot;外網更新&quot;捷徑, 看「工作管理員」處理程序的 icon, wscript.exe 消失就完成了
#切換網卡到內網
#按桌面&quot;內網更新&quot;捷徑, 看「工作管理員」處理程序的 icon, wscript.exe 消失就完成了
#按桌面&quot;內網更新&quot;捷徑</pre>
</div>
<div title="節流計劃" modifier="fhopecc" modified="200710090523" created="200709040637" tags="財務" changecount="4">
<pre>#勞保節流
#健保節流
#公保節流
</pre>
</div>
<div title="紅十字會" modifier="fhopecc" modified="200802190350" created="200708200940" tags="組織" changecount="6">
<pre>|居家護理督導|沈懿嬅|(03)8234860|
|傳真|(03)8236258|</pre>
</div>
<div title="素食料理" modifier="fhopecc" created="200806080333" tags="食譜" changecount="1">
<pre>菜不同於葷菜，怎麼樣烹飪更好吃更有營養呢？

1．不同於葷菜，在油炸時油鍋溫度不宜太高，需要經過多次油炸，翻動。來達到酥脆的口感。

2．素食材料一般鮮味不足，所以必須翻炒透，才能讓調味料入味。

3．汆燙時，鍋中的熱水可以加鹽，米酒……等調味料，這樣可以讓蔬菜鮮綠，並去澀味。

4．在素食中常用勾芡技巧，主要原因是有些材料如：竹筍、豆腐等表面光滑，水分多，難以入味，必須要勾芡的湯汁附著在食物上，可以讓菜色更加鮮豔奪目，味道濃厚，質地柔嫩。

5．鹽會使蛋白質凝固，在烹調蛋白質含量豐富的食物時（如黃豆），不可先放鹽，否則讓黃豆的表面的蛋白質凝固，而無法吸水膨脹不易熟透。


</pre>
</div>
<div title="終端瞬間描述" modifier="Fhopecc" modified="200709220117" created="200709212119" tags="圖靈機" changecount="2">
<pre>!!終端瞬間描述
若 w:D~~T~~，且 d~~T~~(w) = d~~T~~(w)，
即 T 不會再轉換狀態，
則稱 w 為 T 的一個終端。</pre>
</div>
<div title="組成 actionpack 的重要物件簡述" modifier="Fhopecc" modified="200709080311" created="200709080307" tags="ROR" changecount="2">
<pre>!Components
可把其它 controller 的 action 當作 partial 的畫出來，如下：
{{{
  &lt;%= render_component :controller =&gt; &quot;greeter&quot;, :action =&gt; &quot;hello_world&quot; %&gt;
}}}</pre>
</div>
<div title="結婚紀念日" modifier="fhopecc" modified="200712231329" created="200709290453" tags="周年紀念日" changecount="3">
<pre>!!結婚紀念日
**&lt;&lt;reminder month:10 day:7 title:&quot;結婚紀念日&quot; leadtime:2&gt;&gt;</pre>
</div>
<div title="絲瓜" modifier="fhopecc" created="200808050604" tags="菜" changecount="1">
<pre>夏季水果</pre>
</div>
<div title="絲瓜三鮮菇" modifier="fhopecc" modified="200806110246" created="200806100943" changecount="2">
<pre>材料：
絲瓜１條、草菇數朵、玉米筍一百公克、蝦仁一百公克、紅蘿蔔、蔥、薑少許。

調味料：
鹽１小匙

作法：
#絲瓜去皮洗淨切長條備用。
#將玉米筍、紅蘿蔔分別洗淨切條。
#蝦仁加鹽洗淨後瀝乾水分。
#起油鍋放入薑絲、蔥段爆香，加入所有材料炒勻燜至水分出來後，加入調味料即可。</pre>
</div>
<div title="經緯" modifier="fhopecc" modified="200901170321" created="200711220029" tags="公司" changecount="4">
<pre>|經理|王清松|0918658259|
|花東|王世烈|0911861937|
|前經理|徐東平|0933404035|
|前台北市總公司|楊棋勝|0928898873|
</pre>
</div>
<div title="網站降級" modifier="fhopecc" modified="200806110245" created="200805230344" tags="待辦事項 完成事項" changecount="5">
<pre>&lt;&lt;reminder year:2008 month:6 day:24 title:網站降級&gt;&gt;
#問是否順便將網站移機至新電腦
&lt;&lt;tiddler 康佳多媒體&gt;&gt;</pre>
</div>
<div title="網路連線" modifier="fhopecc" created="200709100041" tags="稅捐處業務" changecount="1">
<pre>|中心網路連線|陳振源|#1246|</pre>
</div>
<div title="網路連線應用介面管理資訊系統" modifier="fhopecc" modified="200708300638" created="200708300541" tags="稅捐處業務" changecount="6">
<pre>|系統代碼|XUM|10.66.7.10|
|系統負責人|劉盈志|0933906073|yc3916@gmail.com|
|系統負責人|廖春豪|0920722767|chliau@mitac.com.tw|
|電話|(02)276318331#1069|
|Telnet|a/p:xum/xum123|
|http://xum:a@10.66.7.10:8888/xum|

!注意事項
** 主機每天 7:00 開機, 10:00 關機
** 連線問題發生時，所有服務手動重啟
** 傳加密檔發生問題時，把檔於離峰或傳不加密檔</pre>
</div>
<div title="緊急事項" modifier="fhopecc" modified="200902110609" created="200703020110" changecount="25">
<pre>&lt;&lt;newJournal 'YYYY.MM.DD' label:&quot;新增緊急事項&quot; focus:title tag:緊急事項&gt;&gt;&lt;&lt;forEachTiddler
 where 'tiddler.tags.contains(&quot;緊急事項&quot;) &amp;&amp;
             ! tiddler.tags.contains(&quot;完成事項&quot;)'
 sortBy 'tiddler.title'
 script ' function getFirstLine(s) { var m = s.match(/\s*(.*)/);
            return m != null &amp;&amp; m.length &gt;= 1 ? m[1] : &quot;&quot;;  } '
 write '&quot;|[X(&quot;+tiddler.title+&quot;:完成事項)] |[[&quot;+tiddler.title+&quot;]]|&quot;+getFirstLine(tiddler.text)+&quot;|\n&quot;'
&gt;&gt;</pre>
</div>
<div title="線上學習時數" modifier="fhopecc" modified="200805260654" created="200805060735" tags="待辦事項 完成事項" changecount="8">
<pre>|e等公務園|25.5|
|文官e學院|7|
|網路文官學院|4|
|地方e學中心||
|合計|46.5|
</pre>
</div>
<div title="緯安消防設備公司" modifier="fhopecc" created="200805060753" tags="消防 廠商" changecount="1">
<pre>|蕭政雄|陳茹芳|0937947822|
|038564920|</pre>
</div>
<div title="繞著校園走[專題演講]" modifier="fhopecc" modified="200803210008" created="200802270600" tags="活動" changecount="3">
<pre>&lt;&lt;reminder year:2008 month:4 day:18 title:繞著校園走[專題演講]&gt;&gt;
地點:明利國小 圖書室
聯絡教師:莊蕙瑛 8751048
學生:54人</pre>
</div>
<div title="繳信用卡費用" modifier="fhopecc" modified="200806030620" created="200805230031" tags="完成事項" changecount="2">
<pre></pre>
</div>
<div title="美崙鎖匠" modifier="fhopecc" created="200802130246" tags="鎖匠" changecount="1">
<pre>|美崙鎖匠|8224349|8223810|</pre>
</div>
<div title="腋毛菌症" modifier="fhopecc" modified="200708300842" created="200708300841" tags="保健" changecount="2">
<pre>我的腋毛上為啥麼會長白白的東西
附著在毛上面
之前我試著刮掉腋毛~等到腋毛有長出來時~
那些白白的東西又回到腋毛上了
長那個東西~不會癢~也不會痛~只是有狐臭

長這個到底是啥麼東西~?
如果要就醫~是要看哪一種科~?

最佳解答

    * 發問者自選
「腋毛菌症」是由棒狀桿菌屬感染所造成的。
　棒狀桿菌的分佈範圍很廣，可以存在人體的呼吸道黏膜上或是位在皮膚上。當棒狀桿菌在髮幹造成表淺性感染時，就稱之為「腋毛菌症」。
　此病好發在熱帶地區，由於棒狀桿菌喜好在潮濕的環境中生長，故在夏季或較易流汗的人身上（如青、壯年的體力勞動者、運動員等）更易感染到「腋毛菌症」。根據一項英國的研究顯示，男性的發生率約為27%，而女性患者的發生率則遠低於男性，有可能是因女性的腋毛數量較少之故。
　「腋毛菌症」通常只侵犯髮幹，不會波及到髮根或皮膚，所以患部的皮膚不會紅、也不會癢，因此往往不易被注意到，但因為頂漿腺的分泌物和棒狀桿菌作用後會產生不飽和脂肪酸，導致有些人可能會有味出現。
　　腋毛或恥毛在受到棒狀桿菌感染之後，髮幹上會出現具有黏著性的小結節狀或瀰漫性鞘狀的凝塊包圍，雖然附著較緊，但仍可剝下來。這種凝塊有的堅硬、有的較軟；呈黃色的最多，而呈紅色或黑色者較少，因此外觀上看起來就像是在毛髮外包上一層黃褐色的外衣，遠看就像是毛髮「生鏽」了。
　在診斷方面，一般是根據毛髮的外觀臨床表現來診斷「腋毛菌症」。另外，要做確定診斷，可將毛髮的凝塊物質刮下，用10%氫氧化鉀液塗片後，可在顯微鏡下觀察到凝塊內有纖細、短小、直徑1微米或更小的桿菌，而革蘭氏染色法為陽性反應。此外，亦可將凝塊物做細菌培養。
　　治療方面，最簡單的方式就是將病變的腋毛或恥毛除去，或可用過氧化苯甲醯凝膠來塗擦治療，另外，近來有報告指出，外用抗黴菌藥物(1%Naftifine hydrochloride)對「腋毛菌症」亦有療效。
　治癒之後，也需注重腋下和陰部的清潔，並保持乾爽，可使用含氯化鋁的制汗劑來避免復發。但如果民眾想一勞永逸，則可使用電針或雷射來「斬草除根」，永除後患。
去看皮膚科吧　 </pre>
</div>
<div title="自然人憑證展期訓練" modifier="fhopecc" modified="200802010101" created="200801280216" tags="差旅" changecount="7">
<pre>&lt;&lt;reminder year:2008 month:2 day:18 title:&quot;自然人憑證展期訓練&quot;&gt;&gt;
!交通
&lt;&lt;tiddler 中華電信板橋電信訓練所&gt;&gt;

</pre>
</div>
<div title="自然人憑證會議" modifier="fhopecc" modified="200711070126" created="200711070122" tags="差旅" changecount="2">
<pre>!報名
&lt;&lt;reminder year:2007 month:11 day:29 title:自然人憑證會議報名 leadtime:13&gt;&gt;
!日期
&lt;&lt;reminder year:2007 month:11 day:30 title:自然人憑證會議 leadtime:14&gt;&gt;</pre>
</div>
<div title="自訂macro" modifier="fhopecc" modified="200710030029" created="200710030019" tags="如何使用wiki" changecount="4">
<pre>!Introduction 
In this guide we will create a basic custom macro. Macros in TiddlyWiki look like this in a tiddler's markup (i.e. unformatted contents):
{{{&lt;&lt;myMacro&gt;&gt;}}}

!!Macro parameter formatting
You can pass parameters to a macro like so:
{{{ &lt;&lt;myMacro param1 param2&gt;&gt;}}}
''Parameter''s with spaces can be quoted using either single quotes, double quotes, or double square brackets. For example:
{{{ &lt;&lt;myMacro &lt;nowiki&gt;[[first param]]&lt;/nowiki&gt; 'second param' &quot;third param&quot;&gt;&gt;}}}
(To prevent confusion, it's a good idea to pick your favourite quoting character and stick with it.)
Macros can also have ''named parameter''s:
{{{ &lt;&lt;myMacro this:Foo that:Bar&gt;&gt;}}}
You can have quoted named parameters:
{{{ &lt;&lt;myMacro this:'hello there' that:&quot;what's up&quot;&gt;&gt;}}}
If you need to use your quotation character inside a parameter, put a ''backslash'' in front of it:
{{{ &lt;&lt;myMacro this:'what\'s up'&gt;&gt;}}}
You can execute JavaScript as a parameter to a macro. ~TiddlyWiki evaluates the expression before passing it along to the macro.
{{{ &lt;&lt;myMacro {{'tiddler.getTiddlerText(&quot;TiddlerName&quot;)'}} &gt;&gt; }}}
Your ''JavaScript expression'' can span multiple lines of text, so you can space it out as you like.
One thing you can't do is put double closing angle brackets in a parameter. This won't work, for example:
{{{
 &lt;&lt;myMacro 'over this way -&gt;&gt;'&gt;&gt;
}}}
The parser gets confused and thinks you've ended the macro invocation early.
Finally. you can put parameters on multiple lines to help readability:
{{{
 &lt;&lt;myMacro
   thing1
   thing2
 &gt;&gt;
}}}

</pre>
</div>
<div title="花教大網路" modifier="Fhopecc" modified="200709070410" created="200709070318" tags="組織" changecount="3">
<pre>210.60.47.22 255.255.255.0 210.60.27.1 192.192.6.110 192.192.6.120</pre>
</div>
<div title="花東帆布" modifier="fhopecc" created="200711220036" tags="公司" changecount="1">
<pre>|花東帆布|8566421|
</pre>
</div>
<div title="花蓮宿舍" modifier="fhopecc" modified="200709040800" created="200708301244" tags="組織" changecount="4">
<pre>|市話|03-8234836|查修|8224260|
|地址|花蓮縣民勤里勵志新村30村|
</pre>
</div>
<div title="花蓮教育大學--資訊網路研討會" modifier="fhopecc" modified="200808070202" created="200807040135" tags="教育訓練" changecount="4">
<pre>&lt;&lt;reminder year:2008 month:7 day:18 title:DNS安全(7/15)報名&gt;&gt;
&lt;&lt;reminder year:2008 month:7 day:31 title:UNIX/LINUX安全(7/28)報名&gt;&gt;
&lt;&lt;reminder year:2008 month:8 day:15 title:IPV6理論與應用(8/12)報名&gt;&gt;
&lt;&lt;reminder year:2008 month:8 day:22 title:Antispam(Postfix)(8/19)報名&gt;&gt;
!報名網站
http://lifelonglearn.cpa.gov.tw</pre>
</div>
<div title="花蓮縣地方稅務局" modifier="fhopecc" modified="200902240216" created="200710181037" tags="機關 稅捐處" changecount="9">
<pre>|機關代號|376551300D|
|統編|94505307|
|機關OID|2.16.886.101.90021.20002.20049|1Qaz2wsx|
|地址|(97058)花蓮市府前路19號|
|服務電話|0800-386969|03-8226121|
|傳真電話|03-8224673|</pre>
</div>
<div title="花蓮縣政府資管課" modifier="fhopecc" created="200711300710" changecount="1">
<pre>|張宏光|8227171|#327,#329|</pre>
</div>
<div title="花蓮縣民政局系統" modifier="fhopecc" modified="200809260301" created="200708270154" tags="YHQ" changecount="6">
<pre>|系統負責人|洪錦學|
|電話|(03)8235475|
|民政局路由器IP|128.253.15.11|
|花蓮電信局IP|128.253.15.1|
|主機IP|203.74.221.171|
</pre>
</div>
<div title="花蓮縣稅捐處備份辦法" modifier="fhopecc" modified="200801040327" created="200801040142" changecount="3">
<pre>|!備份資產|!備份實體檔案|!備份週期|
|人事系統|||
|會計系統|||
|防火牆記錄檔|||
|批次記錄檔|||
|影像管理系統|||
|地價稅外業查報系統|||
|本處網站|||</pre>
</div>
<div title="花蓮縣運動會" modifier="fhopecc" modified="200711010718" created="200709280237" tags="補假" changecount="5">
<pre>!福利
補假一天
!排程
&lt;&lt;reminder day:6 month:10 year:2007 title:&quot;花蓮縣運動會&quot; &gt;&gt;</pre>
</div>
<div title="萈菜" modifier="fhopecc" created="200801020907" tags="園藝" changecount="1">
<pre>紅莧菜

學名：Amaranthus spp.

科名：莧科Amaranthaceae莧菜屬

英名:amaranth

別名:杏 菜 或 荇 菜

植物特性:一年生草本，紅莧葉綠中帶有紫紅斑。

栽培方式:莧 菜 在 溫 度 高 、 日 照 充 足 的 環 境 下 ， 生 長 快 速 ， 因 此 ， 當 播 種 後 展 開 第 一 片本 葉 時 ， 應 施 尿 素 5 00 倍 ， 以 後 每 隔 一 週 施 用 台 肥 1 號 液 體 肥 料 5 00 倍 （ 其 基 本 施 肥量 每 分 地 1 ,0 00 公 斤 堆 肥 ， 12 公 斤 氮 素 、 5 公 斤 磷 酐 、 5 公 斤 氯 化 鉀 ） 。 當 本 葉 3～4 片 時 應 間 拔 疏 苗 ， 5?? 片 時 再 間 拔 一 次 以 保 持 株 與 株 間 通 風 及 良 好 的 生 長 空 間 並 預 防白 粉 病 的 發 生 。 由 於 莧 菜 對 養 分 及 水 分 之 吸 收 快 ， 故 生 長 期 間 必 須 充 分 灌 水 以 免 植 株纖 維 老 化 而 降 低 品 質 ， 但 是 畦 溝 間 亦 不 可 長 期 積 水 。 一 般 來 說 發 芽 後 20 ～ 25 天 植 株 可長 至 18 ～ 20 公 分 ， 此 時 即 可 採 收 ， 為 了 經 濟 效 益 上 之 考 量 也 可 延 至 24 ～ 25 公 分 左 右 再採 收 。 若 採 用 簡 易 溫 室 栽 培 ， 由 播 種 至 採 收 18 天 即 可 上 市 。

原產地:印度和熱帶美洲，熱帶及亞熱帶地區栽培普遍。
　莧菜在亞熱帶的台灣，算是極易栽培的蔬菜，生性很健旺，本省各地均見有栽培。品種分為白莧和紅莧兩大類，白莧葉片呈綠色。 另 外 台 灣 原 生 的 刺 莧 及 鳥 莧 （ 野 莧 ）亦 可 供 食 用 及 藥 用 。 此 外 的 尚 有 供 觀 賞 用 的 彩 葉 莧 和 以 食 用 種 子 為 主 的 穀 粒 莧 （ 老 鎗穀 ） 等 等 。

用途:葉 及 嫩 莖 為 食 用 部 分 。 其 維 生 素 A 及 鐵 質 含 量 高 。</pre>
</div>
<div title="萬用圖靈機" modifier="Fhopecc" modified="200709222306" created="200709200023" tags="圖靈機" changecount="4">
<pre>&lt;&lt;tiddler 標準描述&gt;&gt;
&lt;&lt;tiddler 描述數&gt;&gt;
</pre>
</div>
<div title="葉豊福" modifier="fhopecc" created="200901090230" tags="食物" changecount="1">
<pre>前政風室主任
0933798005
饅頭</pre>
</div>
<div title="董銘華" modifier="fhopecc" created="200805010551" tags="財稅資料中心 綜合所得稅" changecount="1">
<pre>|綜合所得稅|
|財稅資料中心|1337|

每年7/15 才會把綜所資料轉入到地方稅</pre>
</div>
<div title="蔡慧瑛" modifier="fhopecc" created="200711270057" changecount="1">
<pre>0910468092</pre>
</div>
<div title="虛弱" modifier="fhopecc" created="200711200851" tags="健康" changecount="1">
<pre>我今天變得很虛弱，
想可能是前二天趕程式，又熬夜所產生的後果。
虛弱的感覺好像是快感冒了，
牙齦馬上就抗議了，
身體也開始沒了能量，
很自然的開始只作一件事，
不會作一件事時又想作其它的事。</pre>
</div>
<div title="蠔油杏鮑菇" modifier="fhopecc" modified="200806051116" created="200806051008" tags="食譜" changecount="2">
<pre>蠔油杏鮑菇
----
杏鮑菇….....1斤
薑絲...........少許
蠔油.........2湯匙
油.............1湯匙
1. 杏鮑菇洗淨切滾方塊。
2. 油爆香薑絲加入蠔油、杏鮑菇快炒取出裝盤。</pre>
</div>
<div title="衣度空間" modifier="fhopecc" created="200709180722" tags="組織" changecount="1">
<pre>|衣度空間|自由街停車場旁|
|08343565|0937532918|</pre>
</div>
<div title="表格管理" modifier="fhopecc" created="200709120218" changecount="1">
<pre>!更動表格存放的 tablespace
{{{
alter table YRMT221 move talbespace NEWTABLESPACE;
}}}
執行完要動建所有的 index</pre>
</div>
<div title="表格範本檔複製到公文系統" modifier="fhopecc" modified="200709180725" created="200709110038" tags="程式館" changecount="9">
<pre>!!表格範本檔複製到公文系統
若程式傳真單其程式說明出現：
報表檔改館,請將此檔放入OA Server相對應位置
''請於入館後''，
找出 ~ELTUA01 上的 prog.doc
{{{
ftp://apsvr@10.66.251.1/../../elt/path/to/prog.doc
}}}
然後 copy 到
{{{
\\10.66.249.1\D$\docbatch\template
}}}
和
{{{
\\10.66.249.1\D$\Inetpub\wwwroot\JAVADOC\Template
}}}</pre>
</div>
<div title="計算" modifier="Fhopecc" modified="200709220129" created="200709220119" tags="圖靈機" changecount="4">
<pre>!!計算
Z~~M~~ = &lt;w~~0~~, w~~1~~...w~~j~~, w~~j+1~~...w~~n~~&gt;
w~~j~~:D~~M~~, j:{0..n},n:N
 Z~~M~~ 為一組有限的瞬間描述串列集合，
用來描述一個用圖靈機 M 所作的計算，也就是圖靈機一連串的動作。
其中最後一個瞬間描述 w~~n~~ 一定為''終端瞬間描述''，
且裡面所有瞬間描述滿足 w~~j+1~~=d~~M~~(w~~j~~) 的關係。</pre>
</div>
<div title="計算[1001-&gt;1100]的機器" modifier="Fhopecc" modified="200709212104" created="200709212059" tags="圖靈機" changecount="3">
<pre>M~~1001-&gt;1100~~為一個機器，
其紙帶若先印上&quot;1001&quot;字串，
啟動機器計算後，終止時。
則會在紙帶上印下&quot;1100&quot;的字串。
其正式描述如下：
M~~1001-&gt;1100~~ = {Q, X~~b~~, P, q~~0~~}
*Q={q~~0~~,q~~1~~,q~~2~~ }
*X={0, 1}
*P 定義如下表
&lt;&lt;tiddler 計算[1001-&gt;1100]的狀態轉換表&gt;&gt;</pre>
</div>
<div title="計算[1001-&gt;1100]的狀態轉換表" modifier="Fhopecc" modified="200709212058" created="200709201120" tags="圖靈機" changecount="4">
<pre>|!現在狀態|!掃描符號|!印出符號|!移動|!後繼狀態|
|q~~0~~|0|0|L|q~~1~~|
|q~~0~~|1|1|R|q~~1~~|
|q~~0~~|b|0|L|q~~1~~|
|q~~1~~|0|b|R|q~~1~~|
|q~~1~~|1|0|N|q~~2~~|
|q~~1~~|b|1|L|q~~2~~|
|q~~2~~|0|0|L|q~~0~~|
|q~~2~~|b|0|N|q~~2~~|</pre>
</div>
<div title="許財能" modifier="fhopecc" modified="200803270306" created="200803270305" tags="新竹市稅捐處" changecount="2">
<pre>|YPM|新竹市稅捐處|
|許財能|035225161#628|
|21089@ems.hccg.gov.tw|</pre>
</div>
<div title="註解欄位" modifier="fhopecc" modified="200711060031" created="200711060027" tags="HIS專案" changecount="4">
<pre>!註解欄位
#BMI、及腰圍都要加一個 comment 的欄位</pre>
</div>
<div title="語意網技術導論" modifier="fhopecc" created="200805150107" tags="重要事項" changecount="2">
<pre>1.為什麼需要語意網
2.描述邏輯
3.本體論
4.RDF語言
5.OWL語言
6.Jena</pre>
</div>
<div title="課程安排" modifier="fhopecc" created="200806200010" tags="課程" changecount="1">
<pre>#WebMail 的應用
#惡意程式簡介
#隨身諜安全防護</pre>
</div>
<div title="請購單" modifier="fhopecc" modified="200809010217" created="200809010215" tags="表單" changecount="2">
<pre>#[[請購單|file:///d:/fhopecc/twFhopecc/表單/請購單.xls]]</pre>
</div>
<div title="謝靜玫" modifier="fhopecc" created="200803270546" changecount="1">
<pre>|台中市稅捐處|謝靜玫|
|XUM|
|email|10163@msa.tctax.gov.tw|
|022585000#534|
</pre>
</div>
<div title="財務報告製作" modifier="fhopecc" modified="200806030621" created="200805230033" tags="待辦事項" changecount="2">
<pre>1.收支系統
2.保險支出系統
3.投資系統</pre>
</div>
<div title="財團法人黎明文化事業基金會九十六年度大專院校學生獎學金申請作業要點" modifier="fhopecc" modified="200710020031" created="200709100235" changecount="5">
<pre>依據： 
　　本會為國家培育英才，設置獎學金，以鼓勵軍（榮）眷學生、殘障學生、僑生 、低收入戶生等敦品勵學、向上精進，特訂定本要點實施之。 
 
獎勵種類及對象： 
　　凡現就讀教育部立案國內公私立大專（不含五專一、二、三年級）院校專科部、大學部、研究所之日、夜間、進修部（不含學分班） 及具學資之軍警學校學生（以上均不含公費生及另行申請其他獎學金者），並具有下列身分者。 
　（一）軍（榮）眷學生獎學金：現役軍人（含國軍編制內聘僱人員）、國軍遺族 （支領半俸人員） 
　　　　及一般榮民（即支領退休俸、生活補助費或轉任公職、或轉任公職後退休支領月退俸人員） 
             之子女。 
　（二）殘障學生獎學金：持有各縣、市政府核發殘障（身心障礙）手冊之學生。 
　（三）泰、越、柬、寮、緬等國僑生獎學金： 請於申請表中詳填姓名、出生年月日、僑居國、 
　　　　 就讀學校；由本會列冊送僑委會統一查核。 
   （四）低收入戶學生獎學金：持有各縣、市政府核發低收入戶卡（名冊）之學生。 
 
獎勵方式暨獎學金金額： 
　（一）研究生：每名頒發獎狀乙幀、獎學金新台幣二萬元。 
　（二）大學生：每名頒發獎狀乙幀、獎學金新台幣一萬五千元。 
　（三）專科生：每名頒發獎狀乙幀、獎學金新台幣一萬元。 
 
獎勵名額及評審方式： 
　（一）軍（榮）眷學生：各校研究生 一名、大學生 二名、專科生一名，各校得依本會提供獎學金 
　　　　之名額及成績，實施甄選，推薦績優學生，併申請表件，送本會覆審合格後給獎 。 
　（二）殘障學生：經學校驗證後，請各校將申請表件送本會；俟申請期限截止後，彙總全台灣地 
　　　　區各校殘障學生申請者，按比例方式，評選前六十名給獎。 
　（三）泰、越、柬、寮、緬等國僑生：經學校驗證後，請各校將申請表件送本會；俟申請期限截 
　　　　止後，彙整全台灣各學校該五個國家僑生申請者，按比例方式，評選前三十名給獎。 
   （四）低收入戶學生：經學校驗證後，請各校將申請表件送本會；俟申請期限截止後，彙整全台灣
                 地區各校低收入戶學生申請者，按比例方式，評選六十名給獎。 
 
申請手續： 
　　申請者應填本會規定之申請表 （如附件），可來電向本會索寄；或向各校承辦單位索印；或自行上本會網站（網址：www.lmcf.org.tw）以A4紙張下載備用，並繳交下列申請文件，向所就讀學校規定期限內申請。 
　（一）成績單正本或經學校驗證之影本（成績須達下列條件）： 
　　　　１．九十五學年度上、下學期學業平均成績：軍（榮）眷學生八十分、殘障生七十五分、  
　　　　　　、低收入戶學生七十五分、僑生七十分以上。 
　　　　２．九十五學年度上、下學期操行成績平均評列甲等（八十分）以上，研究生則免。 
　　　　３．已修中華民國憲法與立國精神 相關課程學分，軍（榮）眷學生八十分、殘障生七十五 
　　　　　　分、低收入戶七十五分、僑生七十分（研究生則免）以上。 
　　　　４．已修軍訓學分，成績七十五分以上（研究生、殘障生則免）。 
　　　　５．已修體育學分，成績七十五分以上（研究生、殘障生則免）。 
　　　　前３、４、５項若大學二、三、四年級（或五專四、五年級）已無該項課程，以致九十五 
　　　　學年度未修者，可檢附專科學校以上已修習該課程任何一學期之成績單，作為證明。 
　（二）身分證明： 
　　　　１．軍（榮）眷學生：以下七種身分，僅需檢附以下任何一項完整文件即可。 （就讀軍警 
                                                             院校之學生另需檢附自費証明) 
　　　　　（１）學生本人之「現役軍人眷屬身分證」影本乙份。 
　　　　　（２）學生家長之「國軍聘僱人員服務證」影本及「證明與學生為直系親屬關係之戶籍 
　　　　　　　　資料」各乙份。 
　　　　　（３）學生本人之「現役軍人眷屬特准證」影本乙份。 
　　　　　（４）學生本人之「國軍文職眷屬身分證」影本乙份。 
　　　　　（５）學生本人之「備役軍人眷屬身分證」影本乙份。 
　　　　　（６）學生家長之「國軍退除役官兵俸金支領憑證」影本及「證明與學生為直系親屬關 
　　　　　　　　係之戶籍資料」各乙份。 
　　　　　（７）學生家長之「榮民證」影本、「服務公職機關證明正本（或公職退休支領月退俸 
　　　　　　　　證明影本」及「證明與學生為直系親屬關係之戶籍資料」各乙份(三份缺一不可)。 
　　　　２．殘障學生：檢附殘障（身心障礙）手冊影本乙份 。 
　　　　３．泰、越、柬、寮、緬等國僑生： 申請表中詳填姓名、出生年月日、僑居國、就讀學校、 
　　　　　　；由本會列冊送僑委會統一查核。 
             ４．低收入戶學生：檢附低收入戶卡（名冊）影本。 
 
申請期限： 
　　各校可自行依照實際作業程序，規定學生送件起訖時間，本會自即日起受理各校送交申請表　件，截止日期為民國九十 六年十月十五日（以郵戳為憑），請寄台北市大安區安居街九十八巷二十二　號黎明基金會收（郵遞區號106）。 
&lt;&lt;reminder year:2007 month:10 day:15 title:&quot;黎明學生獎學金申請期限&quot; leadtime:24&gt;&gt;
頒獎方式： 
　　經本會評定獲獎者， 由本會將獎學金及獎狀寄送各得獎人、並登錄本會網站公告。 
 
其他注意事項： 
（一）學生申請表件資料不全或未經學校承辦獎學金單位驗證核章者恕不受理。 
（二）軍（榮）眷學生獎學金名額，請各校務必依本會分配名額甄選推薦 ，如超額推薦，本會將剔    　　             除該校獲獎名額；另經本會核定獲選後，不得以任何其他理由放棄， 否則本會得依據放棄比

             例，刪減該校下年度推薦名額。    
 
（三）如有任何疑問，請電TEL:（02）23770726或23778713轉分機612孔秘書洽詢。 
（四）本要點如有未盡事宜，得經本會修訂公布之。 
</pre>
</div>
<div title="財稅中心地方稅主機" modifier="fhopecc" modified="200709100643" created="200709100037" tags="網路連線" changecount="5">
<pre>|IP|10.6.252.13|
|xum|陳振源|#1246|</pre>
</div>
<div title="財稅資料中心" modifier="fhopecc" created="200711220032" tags="政府機關" changecount="1">
<pre>|財稅資料中心|02-27631833|
</pre>
</div>
<div title="買牛奶" modifier="YourName" created="200704132330" tags="chkTodo xBB">
<pre></pre>
</div>
<div title="資安事件處理" modifier="fhopecc" modified="200709130713" created="200708240130" tags="資通安全" changecount="1">
<pre>ISO14001 : 環境衛生標準
安全鑑識：ciber forei
audit standar: CISA,CISSP


ISO20000 : ITSM
management:
do the right thing 
do the thing right

secure code:</pre>
</div>
<div title="資料庫檔案毀損復原演練" modifier="fhopecc" modified="200710040658" created="200710030207" tags="災變回復" changecount="12">
<pre>!資料庫檔案毀損模擬程序
&lt;&lt;tiddler 資料庫檔案毀損模擬程序&gt;&gt;
!資料庫檔案毀損檢查程序
&lt;&lt;tiddler 資料庫檔案毀損檢查程序&gt;&gt;
!資料庫檔案毀損復原程序
&lt;&lt;tiddler 資料庫檔案毀損復原程序&gt;&gt;

</pre>
</div>
<div title="資料庫檔案毀損復原程序" modifier="fhopecc" modified="200710050021" created="200710040638" tags="資料庫檔案毀損復原演練" changecount="7">
<pre>1.取出近期備援磁帶，掛上磁帶機
2.查看測試機備份磁帶的Catalog (查看磁帶內容是否為需要即Media=磁帶編號)
3以ora10g 身份登入 sqlplus，執行以下命令：
{{{
#轉換 sysdba 身份
sqlplus / as sysdba
#關掉資料庫
shutdown immediate
#開啟資料庫
startup mount
#離開sysdba身份，回到ora10g 身份
exit
}}}
4.檢查回復—restore.sql 之 script是否正確
{{{
#切換目錄
cd /opt/oracle/script
#查看restore.sql檔案內容如附件
cat restore.sql
}}}
  
5.執行備份資料倒入測試機並回復資料庫:
{{{
#將磁帶備份資料倒入測試機
rman cmdfile /opt/oracle/script/restore.sql
}}}
6. 回復完成後，查看測試機資料庫檔案詳細資訊
{{{
cd /data/eltdb/oradata/ELTUDT
ls –l
}}}
7.重新啟動資料庫: 
{{{
#以 sysdba 身份登入資料庫
sqlplus / as sysdba
#開啟資料庫
alter database open;
}}}

8.資料庫復原後，進入AP程式驗證資料是否正確
</pre>
</div>
<div title="資料庫檔案毀損模擬程序" modifier="fhopecc" modified="200710040701" created="200710040540" tags="資料庫檔案毀損復原演練" changecount="12">
<pre>以下作業係以人為方式將資料庫移走
1.以 ora10g  身份登入資料庫並關掉資料庫:
{{{
#轉換sysdba身份
sqlplus / as sysdba      
#關掉資料庫
shutdown immediate    
#離開sysdba身份，回到ora10g 身份
exit
}}}
2.將資料庫移走
{{{
cd /data/eltdb/oradata/ELTUDT/
#查看data/eltdb/oradata/ELTUDT目錄內資料，
#並將/data/eltdb/ oradata/ELTUDT/目錄內除control*.ctl 與 temp*.dbf 檔案移走
ls
#於父目錄層建立暫存目錄(本例為 1122)
#暫存 data/eltdb/oradata/ELTUDT 的 *.dbf 資料檔
mkdir ../1122
#將 data/eltdb/oradata/ELTUDT 目錄內資料檔移至1122目錄內
mv *.dbf ../1122
#將 temp0 開頭之檔案自上一層移到目前目錄
mv ../1122/temp0* .
#將 TEMPBATCH01.dbf 檔案自上一層移到目前目錄
mv ../1122/TEMPBATCH01.dbf .
}}}
3.以ora10g 身份登入資料庫啟動資料庫
{{{
#sysdba 身份登入 sqlplus
sqlplus / as sysdba
#啟動資料庫
startup
#離開 sqlplus
exit 
}}}</pre>
</div>
<div title="資料庫檔案毀損檢查程序" modifier="fhopecc" modified="200710040658" created="200710040631" tags="資料庫檔案毀損復原演練" changecount="6">
<pre>1.利用AP程式查詢畫面是否確實無法作業
2.查看weblogic程式是否啟動
{{{
#ps -ef | grep java
}}}
3.lsnrctl stat     【查看Listener狀態】
Listener正常啟動訊息
{{{
Listening Endpoints Summary...
     (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=ELTUD01T)(PORT=1521)))
     (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))
Services Summary...
Service &quot;ELTUDT&quot; has 1 instance(s).
     Instance &quot;ELTUDT&quot;, status READY, has 1 handler(s) for this service...
Service &quot;PLSExtProc&quot; has 1 instance(s).
         Instance &quot;PLSExtProc&quot;, status UNKNOWN, has 1 handler(s) for this service...
The command completed successfully
}}}
未啟動訊息為：
{{{
Tns-1   : TNS： no  listener
Tns-1   : TNS： Protocol adapeer error
Tns-1   : TNS： no  listener
}}}
4.查看alert log檔案
{{{
#切換目錄
cd /data/eltdb/admin/ELTUDT/bdump/
}}}
查看alert log檔案內容
{{{
vi alert_ELTUDT.log
}}}
至檔尾如有錯誤訊息表示資料庫有問題，如
{{{
Wed Nov 22 11:47:59 2006
Errors in file /data/eltdb/admin/ELTUDT/bdump/eltudt_dbw0_704736.trc:
ORA-01157: cannot identify/lock data file 99 - see DBWR trace file
ORA-01110: data file 99: '/data/eltdb/oradata/ELTUDT/STATSPACK.dbf'
ORA-27037: unable to obtain file status
IBM AIX RISC System/6000 Error: 2: No such file or directory
Additional information: 3
}}}</pre>
</div>
<div title="資料庫檢核" modifier="fhopecc" modified="200711190750" created="200708270847" tags="資通安全 每週例行工作 資料庫" changecount="33">
<pre>!資料庫週檢核
!!檔案
[[資料庫週檢核表|file:///d:/fhopecc/twFhopecc/資料庫週檢核表.odt]]
!!排程
&lt;&lt;reminder dayofweek:2 title:&quot;資料庫週檢核&quot; leadtime:2&gt;&gt;
!資料庫每日檢查項目
!!檔案
[[資料庫每日檢查項目|file:///d:/fhopecc/twFhopecc/資料庫每日檢查項目.odt]]
</pre>
</div>
<div title="資料庫檢核表季加上備出功能" modifier="fhopecc" modified="200805150101" created="200803180226" tags="完成事項" changecount="2">
<pre></pre>
</div>
<div title="資料庫權限表" modifier="fhopecc" modified="200710040123" created="200708280042" tags="稅捐處業務 資料庫" changecount="17">
<pre>|~VOICE_AP|語音|
|~UACER02|測試|
|~UACER01|測試|
|~U9617ACE|宏基|
|~U9617CE1|經緯|
|~U9617CE2|經緯|
|~KJY04086|郭金幼|
|~SCC05141|孫嘉成|
|~LMH04265|廖美惠|DBA|
|~CCL00695|張簡稜剛|DBA|
|~THY09104|蔡慧瑛|VAB|WII|YCM|YRM|YRQ|
|~CWL07971|陳玟玲|LND|JRC|WAA|WII|WMM|WRR|WSS|
|~HJC03836|徐瑞枝|AVM|LRB|WAA|WII|WMM|WRR|WSS|WUU|
|~KSH07147|古順華|RGM|WAA|WII|WMM|WRR|WSP|WSS|WTG|
|~YSJ06660|楊淑嬌|NIG|RGM|TAC|WAA|WII|WMM|WRR|WSS|WXX|
|~WIY06831|王奕云|CHT|HOU|JUT|SMI|WAA|WII|WMM|WRR|WSS|WTG|
</pre>
</div>
<div title="資料與程式" modifier="fhopecc" created="200708200509" tags="電腦科學">
<pre>電腦不知何時開始，便開始區分資料與程式。
資料經常變動，而程式可依給定資料求出預定的結果。</pre>
</div>
<div title="資訊專案稽核" modifier="YourName" modified="200710220105" created="200708300702" tags="資通安全 稅捐處業務" changecount="36">
<pre>!程序
#專案計劃
#專案派員
#專案報告
!專案計劃
*簽
*年度資訊專案稽核工作計劃(草案)
*年度資訊專案稽核工作底稿
*資訊稽核小組成員名冊
*近5年專案稽核項目及稽核人員清冊;理論上應該是讓處長勾成員
!檔案
[[專案稽核工作底稿及封面|file:///d:/fhopecc/twFhopecc/MISAuditProject/專案稽核工作底稿及封面.xls]]</pre>
</div>
<div title="資訊稽核小組成員名冊" modifier="fhopecc" modified="200809080604" created="200710220105" tags="資通安全" changecount="6">
<pre>[[資訊稽核小組名冊|file:///d:/fhopecc/twFhopecc/資安稽核/資訊稽核小組名冊.xls]]
0920387322</pre>
</div>
<div title="跑migration失敗" modifier="fhopecc" modified="200712100740" created="200712100738" tags="ROR" changecount="2">
<pre>Rails Migrations 砍掉重練

Database, Ruby&amp;Rails

今天看 AWDwR 2nd. 第16章 Migrations 的時候，有一節叫 When Migrations Go Bad，意思是說若跑 Migrations 的時候意外死掉，例如以下這種情況，table one好了，table two還沒…

    def self.up do…
      create_table :one do …
      end
      create_table :two do..
      end
    end

    def self.down
      drop_table :two
      drop_table :one
    end

此時要怎麼處理呢? up跟down進退不得呢，書上的解法很簡單，就是砍掉重練，把全部 table drop掉，重新跑一遍 rake db:migrate。

讓我印象深刻的是這招最後一節又提到一次。問題是說隨著 migrations 的累進，每個 schema 定義可能會散佈在各個 migration 檔案中，我們要如何一眼看懂每張 table 最後到底有哪些欄位?

方法一是看 db/schema.rb 檔，有全部的定義(Ruby form)

方法二是保持每張 table 只有唯一的 migration 檔案，有任何修改不要新增再 migration檔案了，而是用編輯的方式，每次有修改就砍掉重練即可。話說此招雖然跟 Migrations 版本累進的概念不同，但也是可以work。

方法三是裝 annotate_models plugin，每次有變動你只要跑 rake annotate_models，他就會在你的 model 自動加上 table column 註解，一目瞭然。用法跟結果可以參考這篇。</pre>
</div>
<div title="躍盈" modifier="fhopecc" modified="200709130254" created="200709130223" tags="建商" changecount="5">
<pre>!好的建商
躍盈
!壞的建商
景德</pre>
</div>
<div title="車險" modifier="fhopecc" modified="200805220647" created="200805220549" changecount="2">
<pre>|強制險|1500000|1458|
|每人傷害|2000000|1908|
|意外傷害|4000000|1908|
|意外財產傷害|400000|1908|
|駕駛人傷害|1500000|1908|
|第一產險|業務|0934445157|</pre>
</div>
<div title="軟體管理" modifier="fhopecc" modified="200709200330" created="200709200310" tags="unix" changecount="3">
<pre>&lt;&lt;tiddler rpm&gt;&gt;</pre>
</div>
<div title="農曆七月拜" modifier="Fhopecc" modified="200708271250" created="200708271249" tags="記事" changecount="2">
<pre>地基主：2碗2筷
好兄弟：2筷無碗</pre>
</div>
<div title="通報範本" modifier="fhopecc" modified="200808210548" created="200808210141" tags="公文製作" changecount="2">
<pre>#製作[[通報|file:///d:/fhopecc/twFhopecc/公文範本/一般通報.doc]]
#陳核</pre>
</div>
<div title="運算子文法" modifier="Fhopecc" modified="200708260037" created="200708260003" tags="編譯器原理">
<pre>|剖析方向 | 定義 |
|由下而上|展開式不能有相連的非終端元|
{{{
E =&gt; EAE|(E)|-E|id
A =&gt; +|-|*|/|^
}}}
上述文法由於 EAE 為 3 個相連的非終端元，故不是運算子文法。
{{{
E =&gt; E+E|E-E|E*E|E/E|E^E|(E)|-E|id
}}}
若將前述文法改為上述文法，則為運算子文法。</pre>
</div>
<div title="選取 DOM 的元素" modifier="Fhopecc" modified="200708260014" created="200708230916" tags="DOM CSS">
<pre>''prototype framework''
----
擴充許多方便選取 DOM 元素的方法。
像是
{{{
Element.getElementsBySelector(css_selector) 
}}}
可以以 CSSSelector 語法來指定一群元素。
{{{
form.getElementsBySelector('input[type=&quot;text&quot;]', 'textarea')
}}}
為了可以選取所有 form 中的 text 及 ~TextArea 元件，使用 prototype frame work 中，Element.getElementBySelector 的方法。</pre>
</div>
<div title="選取特定階層關系元素" modifier="fhopecc" modified="200708310326" created="200708230355" tags="CSS 電腦科學" changecount="1">
<pre>如何用簡潔的語法指定樹狀結構內的一群或特定元素，
以及如何實作相當值得研究。
CSSSelector 即是很好的範例。
其語法簡潔，實作則應該是使用''過濾器串接''。
</pre>
</div>
<div title="邱婉婷" modifier="fhopecc" created="200808280755" changecount="1">
<pre>住壽豐
阮同事
0919909470</pre>
</div>
<div title="郭明華" modifier="fhopecc" created="200807150120" changecount="1">
<pre>0935237536</pre>
</div>
<div title="重要事項" modifier="fhopecc" modified="200809180917" created="200808020158" changecount="6">
<pre>&lt;&lt;newJournal 'YYYY.MM.DD' label:&quot;新增重要事項&quot; focus:title tag:重要事項&gt;&gt;&lt;&lt;forEachTiddler
 where 'tiddler.tags.contains(&quot;重要事項&quot;) &amp;&amp;
             ! tiddler.tags.contains(&quot;完成事項&quot;)'
 sortBy 'tiddler.title'
 script ' function getFirstLine(s) { var m = s.match(/\s*(.*)/);
            return m != null &amp;&amp; m.length &gt;= 1 ? m[1] : &quot;&quot;;  } '
 write '&quot;|[X(&quot;+tiddler.title+&quot;:完成事項)] |[[&quot;+tiddler.title+&quot;]]|&quot;+getFirstLine(tiddler.text)+&quot;|\n&quot;'
&gt;&gt;</pre>
</div>
<div title="門諾醫院" modifier="fhopecc" created="200803051013" changecount="1">
<pre>財團法人臺灣基督教門諾會醫院 | 970 花蓮市民權路 44 號 | TEL：03-824 -1234 | 捐款郵政劃撥帳號：06007006 | 戶名：基督教門諾會醫院 </pre>
</div>
<div title="閉包" modifier="fhopecc" modified="200802140931" created="200802110918" tags="Ruby" changecount="3">
<pre>碼塊與閉包
所以，閉包的第一個關鍵點是閉包是一段代碼加上和定義它的環境之間的綁定（they are a block of code plus the bindings to the environment they came from）。這是閉包和函數指針等其它相似技術的不同點（java匿名內類可以訪問局部變量，但是只有當這些內類是final的時候才行）。 

Ruby提供了好用的 syntax 跟 invocation 來支援 closure。是的，Syntax matters。

原著：Martin Fowler http://martinfowler.com/bliki/Closures.html

另外一片文章總結了各種語言實現的本文中的例子。閉包（Closures）在各種語言中的例子

2004/11/23

本文地址：http://www.ruby-cn.org/articles/closures.html

隨著人們對動態語言興趣的日益濃厚，越來越多的人都遇到了閉包（Closures ）和或塊（Blocks）等概念。有著C/C++/Java/C#等語言背景的人因為這些語言本身沒有閉包這個概念，所以可能不太了解閉包。本文將簡單的介紹一下閉包的概念，那些有大量支持閉包語言編程經驗的人也許覺得本文不會太有意思。閉包的概念已經提出很長時間了。我第一次碰到這它是在 smalltalk中，那時候還叫做塊（blocks）。Lisp語言中用的很多。Ruby中也有同樣的功能－這也是Ruby用戶喜歡Ruby的一個原因。

本質上來說，一個閉包是一塊代碼，它們能作為參數傳遞給一個方法調用。我將通過一個簡單的例子來闡述這個觀點。假設我們有一個包含一些雇員對象的列表，然後我想列出職位為經理的員工，這樣的員工可以通過IsManager判斷。在C#裡，我們可能會寫出下面類似的代碼：
{{{
    public static IList Managers(IList emps) {
      IList result = new ArrayList();
      foreach(Employee e in emps)
       if (e.IsManager) result.Add(e);
        return result;
    }
}}}
在一種支持閉包的語言中，比如Ruby，我們可以這樣寫：
{{{
    def managers(emps)
      return emps.select {|e| e.isManager}
    end
}}}
select是Ruby中定義的集合結構中的一個方法，它接受一個block，也就是閉包，作為一個參數。在Ruby中，閉包寫在一對大括號中（不止這一種方法，另一種為do .. end）。如果這個塊也接受參數，你可以將這些參數放到兩個豎線之間。select方法循環迭代給定的數組，對每個元素執行給定的block，然後將每次執行block返回true的元素組成一個新的數組再返回。

現在，如果你是C程序員你也許要想，通過函數指針也可以實現，如果你是JAVA程序員，你可能回想我可以用匿名內類來實現，而一個C#者則會想到代理（delegate）。這些機制和閉包類似，但是它們和閉包之間有兩個明顯得區別。

第一個是形式上的不同（The first one is a formal difference）。閉包可以引用它定義時候可見的變量。看看下面的方法：
{{{
    def highPaid(emps)
     threshold = 150
     return emps.select {|e| e.salary &gt; threshold}
    end
}}}
注意select的block代碼中引用了在包含它的方法中的局部變量，而其它不支持真正閉包的語言使用其它方法達到類似功能的方法則不能這樣做。閉包還允許你做更有趣的事情，比如下面方法：
{{{
    def paidMore(amount)
     return Proc.new {|e| e.salary &gt; amount}
    end
}}}
這個方法返回一個閉包，實際上它返回一個依賴於傳給它的參數的閉包。我可以用一個參數創建一個這樣的方法，然後再把它賦給另一個變量。
{{{
    highPaid = paidMore(150)
}}}
變量 highPaid 包含了一段代碼（在Ruby中是一個Proc對象），這段代碼將判斷一個對象的salary屬性是否大於150。我們可以這樣使用這個方法：
{{{
    john = Employee.new
    john.salary = 200
    print highPaid.call(john)
}}}
表達式highPaid.call(john)調用我之前定義的代碼，這時候此代碼中的amount已經在創建這方法的時候綁定為150。即使現在我執行print 的時候，150已經不在它的範圍內了，但是amount和150之間的綁定依然存在。

所以，閉包的第一個關鍵點是閉包是一段代碼加上和定義它的環境之間的綁定（they are a block of code plus the bindings to the environment they came from）。這是閉包和函數指針等其它相似技術的不同點（java匿名內類可以訪問局部變量，但是只有當這些內類是final的時候才行）。

第二個不同點不是定義形式的不同，但是也同樣重要。（The second difference is less of a defined formal difference, but is just as important, if not more so in practice）。支持閉包的語言允許你用很少的語法去定義一個閉包，儘管這點可能不是很重要的一點，但我相信這點是至關重要的－這是使得人們能很自然的使用閉包的關鍵點。看看Lisp，Smalltalk和Ruby，閉包遍布各處－比其它語言中類似的使用多很多。綁定局部變量是它的特點之一，但我想最大的原因是使用閉包的語法和符號非常簡單和清楚。

一個很好的相關例子是從Smalltalk程序員到JAVA程序員，開始時很多人，包括我，試驗性的將在Smalltalk中使用閉包的地方在Java中使用匿名內類來實現。但結果使得代碼變得混亂難看，所以我們不得不放棄。

我在Ruby經常使用閉包，但我不打算創建Proc對象，然後傳來傳去。大多數時間我用閉包來處理前面我提到的select等基於集合對象的方法。閉包另一個重要用途是’execute around method’，比如處理一個文件：
{{{
    File.open(filename) {|f| doSomethingWithFile(f)}
}}}
這裡open方法打開一個文件，然後執行給定的block，然後關閉它。這樣處理非常方便，尤其是對事務（要求commit或者rollback），或者其它的你需要在處理結束時候作一些收尾處理的事情。我在我的xml文檔轉換中廣泛使用這個優點。

閉包的這些用法顯然遠不如用Lisp語言的人遇到的多，即使我，在使用沒有閉包支持的語言的時候，也會想念這些東西。閉包就像一些你第一眼見到覺得不怎麼樣的東西，但你很快就會喜歡上它們。

其它語言例子

Joe Walnes在blog中提供了 closures in the next version of C#。這個例子是靜態類型語言的，基於delegate，且需要delegate關鍵字。

更新: Ivan Moore提供類類似的 Python 的例子

更新: Vadim Nasardinov 讓我知道了來自Guy Steeleled的 closures in Java 這個有趣的珍聞。 </pre>
</div>
<div title="關機" modifier="fhopecc" modified="200710020206" created="200710020204" tags="unix" changecount="2">
<pre>shutdown -Fr</pre>
</div>
<div title="阿嬅台北上按摩課" modifier="fhopecc" modified="200711270306" created="200711270245" changecount="3">
<pre>身分證字號:  S123020695
電腦代碼:  929945
車次:         62          車種:   莒光
乘車時刻:   2007/12/01 00:50
起站:   花蓮         到站:   台北         張數:   02
取票或網路付款截止時間:   2007/11/29 22:00
----
身分證字號:  S123020695    
電腦代碼:  930431
車次:         79          車種:   莒光
乘車時刻:   2007/12/02 07:58
起站:   台北         到站:   花蓮         張數:   02
取票或網路付款截止時間:   2007/11/29 22:00</pre>
</div>
<div title="電作查詢單" modifier="fhopecc" created="200805190714" changecount="2">
<pre>http://10.6.245.20/divide.jsp
U-HLTB/U-HLTB</pre>
</div>
<div title="需要及多餘的東西" modifier="fhopecc" modified="200711211311" created="200709170556" tags="財務" changecount="6">
<pre>!拍賣網站
kijiji
!需要的東西
除溼機
腳踏車
洗衣機
電熱水壺
!多餘的東西
筆記型電腦
舊相機
1G 隨身碟
512M 隨身碟
舊收音機</pre>
</div>
<div title="項目類型" modifier="fhopecc" created="200806180233" tags="HIS專案" changecount="1">
<pre>#range
#string
</pre>
</div>
<div title="順發3c" modifier="YourName" created="200807210250" changecount="1">
<pre>8K7Lhqjm</pre>
</div>
<div title="顏士淨 (Shi-Jim Yen)" modifier="fhopecc" modified="200803090207" created="200802181357" tags="碩士 博士" changecount="2">
<pre>顏士淨 (Shi-Jim Yen)
副教授 	學歷 	國立台灣大學資訊工程博士 	連至個人網站
研究室 	工C324 	研究領域 	人工智慧
電腦對局
機器學習
電話 	03-8634031
Office Hour 	星期一 15:00~17:00
e-mail 	sjyen@mail.ndhu.edu.tw 	LAB 	人工智慧實驗室</pre>
</div>
<div title="香椿" modifier="fhopecc" created="200806290130" changecount="1">
<pre></pre>
</div>
<div title="香椿拌蕎麥麵" modifier="fhopecc" modified="200806290130" created="200805270645" tags="食譜" changecount="2">
<pre>!材料
#純香椿醬
#蕎麥麵
#素肉燥
#鹽
#素G粉
!做法
#蕎麥麵煮熟後加上一匙香椿醬.一匙素肉燥與少許醬油.麻油拌勻就是一道好吃又簡單的麵食</pre>
</div>
<div title="骨關節炎" modifier="fhopecc" created="200710300538" tags="健康" changecount="1">
<pre>　 骨關節炎是最常見的一種關節炎，主要病徵為關節軟骨退化，導致骨骼之間相互摩擦，造成劇烈疼痛、僵硬與行動不便，常侵犯五十歲以上的老年人。

何謂關節炎？主要症狀為何？

    　 關節炎照字面解釋就是關節的發炎引起不適的感覺，臨床上來說，關節炎可分為許多種，如骨關節炎、類風濕性關節炎、痛風性關節炎、細菌性關節炎等等，每一種關節炎的表現、症狀及好發部位都不盡相同。而骨關節炎是關節炎中最常見的一種，是退化性的關節疾病，侵犯關節軟骨。但實際上來說，發炎的情形並不多見，患者多年是以疼痛來表現，我們知道軟骨是構成關節的主要成分，它能吸收振動，減少關節運動的摩擦力，若軟骨被破壞了，就會造成關節的退化，引發骨關節炎。病人主要的症狀除了疼痛之外，還有僵硬、腫脹、變形等，如果症狀久了，患者可能發生行動困難，上下樓梯不便，甚至需要靠柺杖或輪椅協助。

有哪些危險因素易造成骨關節炎？好發年齡？性別？

    　 骨關節炎可大致分為三種，一是原發性骨關節炎，一是次發性骨關節炎。原發性關節炎目前原因尚未明嘹，不過，醫學界認為可能和遺傳、基因及體重有關係。患者通常大於50歲，而且女性多於男性，而次發性骨關節炎則多半是由一個已知的原因所造成。如外傷後引起的關節破壞、痛風、骨頭缺血性壞死及重覆性的衝擊（像棒球選手）。次發性骨關節炎的患者年齡多半小於40歲和原發性關節炎是有些區別的。

骨關節炎主要侵害身體哪些部位？X光片有何發現？

    　 一般而言，骨關節炎主要侵犯常活動及負重的關節。如膝關節、髖關節、手指指間關節、腰椎及頸椎等。在X光片下，骨關節炎的持微包括關節面狹窄、變形、骨刺形成、軟骨下方硬化及退化性囊種形成。

病患該如何與醫師溝通他們的疼痛症狀？

    　 對於骨關節的病患來說，疼痛常是最常見的症狀，所以如何讓醫師了解你的狀況，必須適當的描述患者自身的狀況，如疼痛已經有多久了，是幾年、幾個月、或是幾天？什麼時候最痛，是白天、晚上、還是睡前？什麼樣的姿勢最痛，是站者痛、蹲著痛、還是走路才痛？什麼情況會引起疼痛，譬如說坐著要站起來時最痛，痛的情況是&quot;悶&quot;的痛，還是一點酸痛，像針刺一樣痛，痛的時候有沒有伴隨其他的症狀，如局部紅、腫、熱等，痛會不會延伸到別的部位等。

    　 門診時常遇到患者從小時候開始說起，幾歲時不小心從樹上摔下來，右手有受傷，之後當兵的時候，背部有扭傷，前幾乎走在路上不小心踢到牆壁，現在是膝蓋很不舒服，當然，醫師都會耐心的聽完病患的抱怨，不過最好是能夠清楚的說明你目前的症狀，如此醫師才能下正確的診斷，為病患做最好的治療。

骨關節炎有哪些治療方式？

    　 對於骨關節炎的治療方式，起初都是採取保守療法，也就是非手術性的治療。持保守療法無致成病人症狀加劇，才使用手術當作最佳的手段，一般而言，保守療法包括1.藥物治療2.復健治療3.注射針劑

    1. 藥物療法：

        a. 類固醇：
        早期尚未出現非類固醇性抗消炎藥時，類固醇被大量使用於關節炎的患者，類固醇的止痛效果快速顯著，但是它的副作用也相當大，如骨質疏鬆症、傷口不易癒合、皮膚變薄、上消化道出血，甚至會加重某些疾病，如高血壓、糖尿病等，因此，目前大多數的醫生，都已停止使用，但對於某些類風濕性關節炎、紅斑性狼瘡、僵直性脊椎炎或脊椎外傷患者仍需使用類固醇以緩解病情。
        b. 非類固醇抗炎藥：
        這一群的藥物有很多，目前相當普遍，止痛效果也都 不錯，但長期使用如有副作用，如消化性潰瘍、下肢水腫、腎臟功能的損傷等，故使用也需相當注意。
        c. 葡萄糖胺（Glucosamine）：
        目前相當流行的一種藥，研究上發現葡萄 糖胺可刺激關節內軟骨細胞合成醣蛋白，而且也有消炎止痛的效果，但是卻沒有非類固醇抗炎藥的副作用，大部分的患者也都反應良好。

    2. 復健治療：

        適度的運動增加肌肉的強度及應變能力，減少引發疼痛的活動，對於骨關節炎也是有很大的幫助，詳情稍後會再說明。

    3. 注射針劑：

        關節腔內注射玻尿酸（Hyaluronic acid）早已在日本及歐洲廣泛的使用於膝關節炎的患者，目前玻尿酸的機制尚未完全明瞭，不過它可以當作一種潤滑劑幫助關節活動，同時也可抑制一些發炎反應，對於關節炎的患者有減輕疼痛及改善功能的效果，而且也沒有副作用，國內目前已經引進此種注射針劑，一個療程是五週，一週打一針，但健保局規定注射玻尿酸時，不得開立口服止痛藥 。

    　 當以上的保守療法都無效時，且病患的症狀持續行動困難，醫師可能會建議手術治療，手術治療包括：1.關節鏡手術 2.切骨矯正手術 3.關節重建手術

    1. 關節鏡手術：

        關節鏡手術目前已廣泛應用於膝關節、踝關節、肘關節、肩關 節、腕關節以及脊椎。關節鏡的好處是傷口小，術後恢復快，疼痛也較輕微。關節鏡手術除了可以消除關節腔內異物之外，也可對受損的軟骨做修補手術，利用基因工程軟骨再生手術，但對於已經相當嚴重的患者效果有限。

    2. 切骨矯正手術：

        將變形的骨頭作矯正，讓已經被破壞的軟骨部分能休息，但 因人工關節置換術的成功，現在已經逐漸沒落了。

    3. 關節重建手術：

        即人工關節置換手術，將已經遭到破壞的關節部分切除， 植入含金做成的人工關節，目前的成功率有9成以上。

緩解疼痛是否重要？止痛藥都會傷胃嗎？

    　 關於骨關節炎最主要的症狀便是疼痛，因此緩解疼痛對於患者而言相當重要，傳統的止痛藥如類固醇，前面提過副作用很大，而非類固醇抗炎藥，由於這類藥物是作用在cyclooxygenase（COX）這種酵素，藉由此種方式，抑制前列腺素（prostaglandins）的產生，後來發現COX這個?，有兩種即COX-1和COX-2，COX-1主要存在於胃、腎、血管上，是好的酵素，如果被抑制了就會產生腹脹、過敏、胃酸、噁心、消化不良、下肢水腫等副作用，所以老只單純抑制COX-2產生止痛效果，而不去影響COX-1那該有多好？目前默沙東藥廠（MSD）已經找到了一種新藥，即偉克適（VIOXX），可達到這個目標，能夠迅速止痛，且又不傷胃，實在是病患的一大福音。

該如何寶貝我們的關節？

    　 （運動 / 生活） 對於骨關節炎的患者，我們常鼓勵病人運動，因為運動可以增加關節滑液的流動，加強肌肉、肌腱等支持的結構，和骨節曩的韌性，增加體能，同時情緒也會變好，睡眠自然充足且良好，減輕人的緊張度，強化骨骼等。我們常告訴病人，&quot;越走越會走&quot; ，因為怕痛而不動會導致關節僵硬，萎縮、痛可以藥物控制，運動則要靠自己。

    　 骨關節炎的患者的運動以適度為原則，必須依照自己的體能和年紀作調整，一般而言，步行、游泳及騎自行車等都是輕鬆而且能達到運動目的的活動。此外在生活上，也需適當的控制自己的體重，體重過重會造成關節多餘的負擔，引發不適。除此之外健康的飲食也是很重要的，少吃油炸類不消化的食物，多吃蔬果、多喝水，如果有糖尿病，高血壓或尿酸高的患者，不妨諮詢醫師或營養師，如何才能吃的好，吃的健康。

    　 總之，骨關節炎不是不治之症，只要您將症狀清楚的告訴醫生，和醫生配合，保持良好的生活習慣及運動，相信明天會更好!

 </pre>
</div>
<div title="體重記錄" modifier="fhopecc" modified="200805050655" created="200805020650" tags="健康" changecount="3">
<pre>|20080502|88|
|20080503|89|</pre>
</div>
<div title="高考二級" modifier="fhopecc" modified="200808060052" created="200807031009" tags="考試" changecount="5">
<pre>&lt;&lt;reminder year:2008 month:7 day:18 title:公告高考二級名額&gt;&gt;
&lt;&lt;reminder year:2008 month:7 day:28 title:高考二級報名&gt;&gt;
&lt;&lt;reminder year:2008 month:10 day:4 title:97年高考二級憲英、國文、資管&gt;&gt;
&lt;&lt;reminder year:2008 month:10 day:5 title:97年高考二級DB、NET、SA&gt;&gt;</pre>
</div>
<div title="高考二級報名" modifier="fhopecc" modified="200808040145" created="200808031024" changecount="3">
<pre>報名費</pre>
</div>
<div title="高雄市稅捐處" modifier="YourName" modified="200710120855" created="200710100502" tags="組織 稅捐處" changecount="8">
<pre>|高雄市稅捐處|
|高雄市新興區中正三路25號|搭248公車|
!交通
|!去程|
|莒光63|花蓮-&gt;台東|0304-0605|
|自強2052|台東-&gt;高雄|0700-0934|
|!回程|
|自強2055|高雄-&gt;花蓮|1638-2141|
</pre>
</div>
<div title="鮮炒瓠瓜薄片" modifier="fhopecc" modified="200805310944" created="200805310942" tags="瓠瓜 食譜" changecount="4">
<pre>材料：瓠瓜半條，香菇絲，紅蘿蔔絲各一小碟。
作法：1. 瓠瓜去皮切成約長2.5公分約寬1.5公分的薄片。
　　　2. 香菇爆香加入紅蘿蔔絲略炒。
　　　3. 倒入瓠瓜薄片，加點水，蓋緊鍋蓋，燜軟加點鹽即可起鍋。



</pre>
</div>
<div title="黃詩芬" modifier="fhopecc" created="200803171223" tags="吳展政" changecount="3">
<pre>|黃詩芬|0953502321|</pre>
</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->

<!--POST-BODY-END-->
<script type="text/javascript">
//<![CDATA[
//
// Please note:
// 
// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
//   in the project Subversion repository at http://svn.tiddlywiki.org/Trunk/core/
//
// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation
//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev
// 

//--
//-- Configuration repository
//--

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animDuration: 400, // Duration of UI animations in milliseconds
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5 // Depth of cascade animation
};

// Adaptors
config.adaptors = {};

// Backstage tasks
config.tasks = {};

// Annotations
config.annotations = {};

// Custom fields to be automatically added to new tiddlers
config.defaultCustomFields = {};

// Messages
config.messages = {
	messageClose: {},
	dates: {},
	tiddlerPopup: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkAnimate: true,
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	chkInsertTabs: false,
	chkUsePreForStorage: true, // Whether to use <pre> format for storage
	chkDisplayStartupTime: false,
	txtBackupFolder: "",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30",
	txtFileSystemCharSet: "UTF-8"
	};
config.optionsDesc = {};

// List of notification functions to be called when certain tiddlers are changed or deleted
config.notifyTiddlers = [
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: "SiteTitle", notify: refreshPageTitle},
	{name: "SiteSubtitle", notify: refreshPageTitle},
	{name: "ColorPalette", notify: refreshColorPalette},
	{name: null, notify: refreshDisplay}
];

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
};

// More messages (rather a legacy layout that shouldn't really be like this)
config.views = {
	wikified: {
		tag: {}
	},
	editor: {
		tagChooser: {}
	}
};

// Backstage tasks
config.backstageTasks = ["save","sync","importTask","tweak","plugins"];

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {sizeTextbox: 15},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {},
		touched: {}
	},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	options: {},
	newTiddler: {},
	newJournal: {},
	sparkline: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {},
	edit: {},
	tagChooser: {},
	toolbar: {},
	br: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {},
	sync: {},
	annotations: {}
};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: {hideReadOnly: true},
	cancelTiddler: {},
	deleteTiddler: {hideReadOnly: true},
	permalink: {},
	references: {type: "popup"},
	jump: {type: "popup"},
	syncing: {type: "popup"},
	fields: {type: "popup"}
};

// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	isGecko: config.userAgent.indexOf("gecko") != -1,
	ieVersion: /MSIE (\d.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	isOpera: config.userAgent.indexOf("opera") != -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
};

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
};
if(config.browser.isBadSafari) {
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
	};
}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.urlPattern = "[a-z]{3,8}:[^\\s:'\"][^\\s'\"]*(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
	config.textPrimitives.lowerLetter + "+" +
	config.textPrimitives.upperLetter +
	config.textPrimitives.anyLetter + "*)|(?:" +
	config.textPrimitives.upperLetter + "{2,}" +
	config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");

config.glyphs = {
	browsers: [
		function() {return config.browser.isIE;},
		function() {return true;}
	],
	currBrowser: null,
	codes: {
		downTriangle: ["\u25BC","\u25BE"],
		downArrow: ["\u2193","\u2193"],
		bentArrowLeft: ["\u2190","\u21A9"],
		bentArrowRight: ["\u2192","\u21AA"]
	}
};

//--
//-- Shadow tiddlers
//--

config.shadowTiddlers = {
	StyleSheet: "",
	MarkupPreHead: "<!--{{{-->\n<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml'/>\n<!--}}}-->",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: "",
	TabTimeline: '<<timeline>>',
	TabAll: '<<list all>>',
	TabTags: '<<allTags excludeLists>>',
	TabMoreMissing: '<<list missing>>',
	TabMoreOrphans: '<<list orphans>>',
	TabMoreShadowed: '<<list shadowed>>',
	AdvancedOptions: '<<options>>',
	PluginManager: '<<plugins>>',
	ImportTiddlers: '<<importTiddlers>>'
};

//--
//-- Translateable strings
//--

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
	txtUserName: "YourName"});

merge(config.tasks,{
	save: {text: "save", tooltip: "Save your changes to this TiddlyWiki", action: saveChanges},
	sync: {text: "sync", tooltip: "Synchronise changes with other TiddlyWiki files and servers", content: '<<sync>>'},
	importTask: {text: "import", tooltip: "Import tiddlers and plugins from other TiddlyWiki files and servers", content: '<<importTiddlers>>'},
	tweak: {text: "tweak", tooltip: "Tweak the appearance and behaviour of TiddlyWiki", content: '<<options>>'},
	plugins: {text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>'}
});

// Options that can be set in the options panel and/or cookies
merge(config.optionsDesc,{
	txtUserName: "Username for signing your edits",
	chkRegExpSearch: "Enable regular expressions for searches",
	chkCaseSensitiveSearch: "Case-sensitive searching",
	chkAnimate: "Enable animations",
	chkSaveBackups: "Keep backup file when saving changes",
	chkAutoSave: "Automatically save changes",
	chkGenerateAnRssFeed: "Generate an RSS feed when saving changes",
	chkSaveEmptyTemplate: "Generate an empty template when saving changes",
	chkOpenInNewWindow: "Open external links in a new window",
	chkToggleLinks: "Clicking on links to open tiddlers causes them to close",
	chkHttpReadOnly: "Hide editing features when viewed over HTTP",
	chkForceMinorUpdate: "Don't update modifier username and date when editing tiddlers",
	chkConfirmDelete: "Require confirmation before deleting tiddlers",
	chkInsertTabs: "Use the tab key to insert tab characters instead of moving between fields",
	txtBackupFolder: "Name of folder to use for backups",
	txtMaxEditRows: "Maximum number of rows in edit boxes",
	txtFileSystemCharSet: "Default character set for saving changes (Firefox/Mozilla only)"});

merge(config.messages,{
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#DownloadSoftware for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "Main TiddlyWiki file saved",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<\%0>>",
	macroErrorDetails: "Error while executing macro <<\%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed",
	loadingMissingTiddler: "Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'"});

merge(config.messages.messageClose,{
	text: "close",
	tooltip: "close this message area"});

config.messages.backstage = {
	open: {text: "backstage", tooltip: "Open the backstage area to perform authoring and editing tasks"},
	close: {text: "close", tooltip: "Close the backstage area"},
	prompt: "backstage: ",
	decal: {
		edit: {text: "edit", tooltip: "Edit the tiddler '%0'"}
	}
};

config.messages.listView = {
	tiddlerTooltip: "Click for the full text of this tiddler",
	previewUnavailable: "(preview not available)"
};

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
// suffixes for dates, eg "1st","2nd","3rd"..."30th","31st"
config.messages.dates.daySuffixes = ["st","nd","rd","th","th","th","th","th","th","th",
		"th","th","th","th","th","th","th","th","th","th",
		"st","nd","rd","th","th","th","th","th","th","th",
		"st"];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.messages.tiddlerPopup,{
	});

merge(config.views.wikified.tag,{
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	dateFormat: "DD MMM YYYY",
	createdPrompt: "created"});

merge(config.views.editor,{
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"});

merge(config.messages,{
	sizeTemplates:
		[
		{unit: 1024*1024*1024, template: "%0\u00a0GB"},
		{unit: 1024*1024, template: "%0\u00a0MB"},
		{unit: 1024, template: "%0\u00a0KB"},
		{unit: 1, template: "%0\u00a0B"}
		]});

merge(config.macros.search,{
	label: "search",
	prompt: "Search this TiddlyWiki",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
	dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";
config.macros.list.touched.prompt = "Tiddlers that have been modified locally";

merge(config.macros.closeAll,{
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"});

merge(config.macros.newTiddler,{
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"});

merge(config.macros.newJournal,{
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"});

merge(config.macros.options,{
	wizardTitle: "Tweak advanced options",
	step1Title: "These options are saved in cookies in your browser",
	step1Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",
	unknownDescription: "//(unknown)//",
	listViewTemplate: {
		columns: [
			{name: 'Option', field: 'option', title: "Option", type: 'String'},
			{name: 'Description', field: 'description', title: "Description", type: 'WikiText'},
			{name: 'Name', field: 'name', title: "Name", type: 'String'}
			],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'}
			]}
	});

merge(config.macros.plugins,{
	wizardTitle: "Manage plugins",
	step1Title: "Currently loaded plugins",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these plugins:\n\n%0",
	removeLabel: "remove systemConfig tag",
	removePrompt: "Remove systemConfig tag",
	deleteLabel: "delete",
	deletePrompt: "Delete these tiddlers forever",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
			{name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			]}
	});

merge(config.macros.toolbar,{
	moreLabel: "more",
	morePrompt: "Reveal further commands"
	});

merge(config.macros.refreshDisplay,{
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
	});

merge(config.macros.importTiddlers,{
	readOnlyWarning: "You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",
	wizardTitle: "Import tiddlers from another file or server",
	step1Title: "Step 1: Locate the server or TiddlyWiki file",
	step1Html: "Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",
	openLabel: "open",
	openPrompt: "Open the connection to this file or server",
	openError: "There were problems fetching the tiddlywiki file",
	statusOpenHost: "Opening the host",
	statusGetWorkspaceList: "Getting the list of available workspaces",
	step2Title: "Step 2: Choose the workspace",
	step2Html: "Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel this import",
	statusOpenWorkspace: "Opening the workspace",
	statusGetTiddlerList: "Getting the list of available tiddlers",
	step3Title: "Step 3: Choose the tiddlers to import",
	step3Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",
	importLabel: "import",
	importPrompt: "Import these tiddlers",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	step4Title: "Step 4: Importing %0 tiddler(s)",
	step4Html: "<input type='hidden' name='markReport'></input>", // DO NOT TRANSLATE
	doneLabel: "done",
	donePrompt: "Close this wizard",
	statusDoingImport: "Importing tiddlers",
	statusDoneImport: "All tiddlers imported",
	systemServerNamePattern: "%2 on %1",
	systemServerNamePatternNoWorkspace: "%1",
	confirmOverwriteSaveTiddler: "The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",
	serverSaveTemplate: "|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",
	serverSaveModifier: "(System)",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
			],
		rowClasses: [
			]}
	});

merge(config.macros.sync,{
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Server Type', field: 'serverType', title: "Server type", type: 'String'},
			{name: 'Server Host', field: 'serverHost', title: "Server host", type: 'String'},
			{name: 'Server Workspace', field: 'serverWorkspace', title: "Server workspace", type: 'String'},
			{name: 'Status', field: 'status', title: "Synchronisation status", type: 'String'},
			{name: 'Server URL', field: 'serverUrl', title: "Server URL", text: "View", type: 'Link'}
			],
		rowClasses: [
			],
		buttons: [
			{caption: "Sync these tiddlers", name: 'sync'}
			]},
	wizardTitle: "Synchronize with external servers and files",
	step1Title: "Choose the tiddlers you want to synchronize",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	syncLabel: "sync",
	syncPrompt: "Sync these tiddlers",
	hasChanged: "Changed while unplugged",
	hasNotChanged: "Unchanged while unplugged",
	syncStatusList: {
		none: {text: "...", color: "none"},
		changedServer: {text: "Changed on server", color: '#80ff80'},
		changedLocally: {text: "Changed while unplugged", color: '#80ff80'},
		changedBoth: {text: "Changed while unplugged and on server", color: '#ff8080'},
		notFound: {text: "Not found on server", color: '#ffff80'},
		putToServer: {text: "Saved update on server", color: '#ff80ff'},
		gotFromServer: {text: "Retrieved update from server", color: '#80ffff'}
		}
	});

merge(config.macros.annotations,{
	});

merge(config.commands.closeTiddler,{
	text: "close",
	tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
	text: "close others",
	tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
	text: "done",
	tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
	text: "permalink",
	tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"});

merge(config.commands.jump,{
	text: "jump",
	tooltip: "Jump to another open tiddler"});

merge(config.commands.syncing,{
	text: "syncing",
	tooltip: "Control synchronisation of this tiddler with a server or external file",
	currentlySyncing: "<div>Currently syncing via <span class='popupHighlight'>'%0'</span> to:</"+"div><div>host: <span class='popupHighlight'>%1</span></"+"div><div>workspace: <span class='popupHighlight'>%2</span></"+"div>", // Note escaping of closing <div> tag
	notCurrentlySyncing: "Not currently syncing",
	captionUnSync: "Stop synchronising this tiddler",
	chooseServer: "Synchronise this tiddler with another server:",
	currServerMarker: "\u25cf ",
	notCurrServerMarker: "  "});

merge(config.commands.fields,{
	text: "fields",
	tooltip: "Show the extended fields of this tiddler",
	emptyText: "There are no extended fields for this tiddler",
	listViewTemplate: {
		columns: [
			{name: 'Field', field: 'field', title: "Field", type: 'String'},
			{name: 'Value', field: 'value', title: "Value", type: 'String'}
			],
		rowClasses: [
			],
		buttons: [
			]}});

merge(config.shadowTiddlers,{
	DefaultTiddlers: "GettingStarted",
	MainMenu: "GettingStarted",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "http://www.tiddlywiki.com/",
	SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options H" "Change TiddlyWiki advanced options">>',
	SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
	TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'});

merge(config.annotations,{
	AdvancedOptions: "This shadow tiddler provides access to several advanced options",
	ColorPalette: "These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",
	DefaultTiddlers: "The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",
	EditTemplate: "The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",
	GettingStarted: "This shadow tiddler provides basic usage instructions",
	ImportTiddlers: "This shadow tiddler provides access to importing tiddlers",
	MainMenu: "This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",
	MarkupPreHead: "This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",
	MarkupPostHead: "This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",
	MarkupPreBody: "This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",
	MarkupPostBody: "This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately before the script block",
	OptionsPanel: "This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",
	PageTemplate: "The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",
	PluginManager: "This shadow tiddler provides access to the plugin manager",
	SideBarOptions: "This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",
	SideBarTabs: "This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",
	SiteSubtitle: "This shadow tiddler is used as the second part of the page title",
	SiteTitle: "This shadow tiddler is used as the first part of the page title",
	SiteUrl: "This shadow tiddler should be set to the full target URL for publication",
	StyleSheetColours: "This shadow tiddler contains CSS definitions related to the color of page elements",
	StyleSheet: "This tiddler can contain custom CSS definitions",
	StyleSheetLayout: "This shadow tiddler contains CSS definitions related to the layout of page elements",
	StyleSheetLocale: "This shadow tiddler contains CSS definitions related to the translation locale",
	StyleSheetPrint: "This shadow tiddler contains CSS definitions for printing",
	TabAll: "This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",
	TabMore: "This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",
	TabMoreMissing: "This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",
	TabMoreOrphans: "This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",
	TabMoreShadowed: "This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",
	TabTags: "This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",
	TabTimeline: "This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",
	ViewTemplate: "The HTML template in this shadow tiddler determines how tiddlers look"
	});

//--
//-- Main
//--

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
config.parsers = {}; // Hashmap of alternative parsers for the wikifier
var anim = new Animator(); // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether to use the JavaSaver applet
var useJavaSaver = config.browser.isSafari || config.browser.isOpera;

// Starting up
function main()
{
	var t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();
	startingUp = true;
	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki();
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	loadOptionsCookie();
	for(var s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	t1 = new Date();
	store.loadFromDiv("storeArea","store",true);
	t2 = new Date();
	loadShadowTiddlers();
	t3 = new Date();
	invokeParamifier(params,"onload");
	t4 = new Date();
	readOnly = (window.location.protocol == "file:") ? false : config.options.chkHttpReadOnly;
	var pluginProblem = loadPlugins();
	t5 = new Date();
	formatter = new Formatter(config.formatters);
	invokeParamifier(params,"onconfig");
	t6 = new Date();
	store.notifyAll();
	t7 = new Date();
	restart();
	t8 = new Date();
	if(pluginProblem) {
		story.displayTiddler(null,"PluginManager");
		displayMessage(config.messages.customConfigError);
	}
	for(var m in config.macros) {
		if(config.macros[m].init)
			config.macros[m].init();
	}
	if(!readOnly)
		backstage.init();
	t9 = new Date();
	if(config.options.chkDisplayStartupTime) {
		displayMessage("Load in " + (t2-t1) + " ms");
		displayMessage("Loadshadows in " + (t3-t2) + " ms");
		displayMessage("Loadplugins in " + (t5-t4) + " ms");
		displayMessage("Notify in " + (t7-t6) + " ms");
		displayMessage("Restart in " + (t8-t7) + " ms");
		displayMessage("Total startup in " + (t9-t0) + " ms");
	}
	startingUp = false;
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty()) {
		var defaultParams = store.getTiddlerText("DefaultTiddlers").parseParams("open",null,false);
		invokeParamifier(defaultParams,"onstart");
	}
	window.scrollTo(0,0);
}

function saveTest()
{
	var s = document.getElementById("saveTest");
	if(s.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	s.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
	var shadows = new TiddlyWiki();
	shadows.loadFromDiv("shadowArea","shadows",true);
	shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});
	delete shadows;
}

function loadPlugins()
{
	if(safeMode)
		return false;
	var tiddlers = store.getTaggedTiddlers("systemConfig");
	var toLoad = [];
	var nLoaded = 0;
	var map = {};
	var nPlugins = tiddlers.length;
	installedPlugins = [];
	for(var i=0; i<nPlugins; i++) {
		var p = getPluginInfo(tiddlers[i]);
		installedPlugins[i] = p;
		var n = p.Name;
		if(n)
			map[n] = p;
		n = p.Source;
		if(n)
			map[n] = p;
	}
	var visit = function(p) {
		if(!p || p.done)
			return;
		p.done = 1;
		var reqs = p.Requires;
		if(reqs) {
			reqs = reqs.readBracketedList();
			for(var i=0; i<reqs.length; i++)
				visit(map[reqs[i]]);
		}
		toLoad.push(p);
	};
	for(i=0; i<nPlugins; i++)
		visit(installedPlugins[i]);
	for(i=0; i<toLoad.length; i++) {
		p = toLoad[i];
		pluginInfo = p;
		tiddler = p.tiddler;
		if(isPluginExecutable(p)) {
			if(isPluginEnabled(p)) {
				p.executed = true;
				var startTime = new Date();
				try {
					if(tiddler.text)
						window.eval(tiddler.text);
					nLoaded++;
				} catch(ex) {
					p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
					p.error = true;
				}
				pluginInfo.startupTime = String((new Date()) - startTime) + "ms";
			} else {
				nPlugins--;
			}
		} else {
			p.warning = true;
		}
	}
	return nLoaded != nPlugins;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigForce"))
		return verifyTail(plugin,true,config.messages.pluginForced);
	if(plugin["CoreVersion"]) {
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0]) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1]) - version.minor;
		if(w == 0 && coreVersion[2])
		 	w = parseInt(coreVersion[2]) - version.revision;
		if(w > 0)
			return verifyTail(plugin,false,config.messages.pluginVersionError);
		}
	return true;
}

function isPluginEnabled(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable"))
		return verifyTail(plugin,false,config.messages.pluginDisabled);
	return true;
}

function verifyTail(plugin,result,message)
{
	plugin.log.push(message);
	return result;
}

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try {
		var m = config.macros[macro];
		if(m && m.handler)
			m.handler(place,macro,params.readMacroParams(),wikifier,params,tiddler);
		else
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
	} catch(ex) {
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
	}
}

//--
//-- Paramifiers
//--

function getParameters()
{
	var p = null;
	if(window.location.hash) {
		p = decodeURI(window.location.hash.substr(1));
		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
	}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	for(var t=1; t<params.length; t++) {
		var p = config.paramifiers[params[t].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[t].value);
	}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
	}
};

config.paramifiers.open = {
	onstart: function(v) {
		story.displayTiddler("bottom",v,null,false,null);
	}
};

config.paramifiers.story = {
	onstart: function(v) {
		var list = store.getTiddlerText(v,"").parseParams("open",null,false);
		invokeParamifier(list,"onstart");
	}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
	}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v,false,true);
	}
};

config.paramifiers.tag = {
	onstart: function(v) {
		var tagged = store.getTaggedTiddlers(v,"title");
		for(var t=0; t<tagged.length; t++)
			story.displayTiddler("bottom",tagged[t].title,null,false,null);
	}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		if(!readOnly) {
			story.displayTiddler(null,v,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(v,"text");
		}
	}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly) {
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
		}
	}
};

config.paramifiers.readOnly = {
	onconfig: function(v) {
		var p = v.toLowerCase();
		readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
	}
};

//--
//-- Formatter helpers
//--

function Formatter(formatters)
{
	this.formatters = [];
	var pattern = [];
	for(var n=0; n<formatters.length; n++) {
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
	}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	},

	inlineCssHelper: function(w)
	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var s,v;
			if(lookaheadMatch[1]) {
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
			} else {
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
			}
			if (s=="bgcolor")
				s = "backgroundColor";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		}
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		for(var t=0; t< styles.length; t++) {
			try {
				e.style[styles[t].style] = styles[t].value;
			} catch (ex) {
			}
		}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var text = lookaheadMatch[1];
			if(config.browser.isIE)
				text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {
			return false;
		}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
		if(urlRegExp.exec(link)) {
			return true;
		}
		if (link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1){
			return true;
		}
		return false;
	}

};

//--
//-- Standard formatters
//--

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},

	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table",null,"twtable");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == "k") {
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
			} else {
				if(nextRowType != currRowType) {
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
				}
				if(currRowType == "c") {
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
				} else {
					this.rowHandler(w,createTiddlyElement(rowContainer,"tr",null,(rowCount&1)?"oddRow":"evenRow"),prevColumns);
					rowCount++;
				}
			}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch) {
			if(cellMatch[1] == "~") {
				// Rowspan
				var last = prevColumns[col];
				if(last) {
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
				}
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[1] == ">") {
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[2]) {
				// End of row
				if(prevCell && colSpanCount > 1) {
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
				}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
			} else {
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while(chr == " ") {
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
				}
				var cell;
				if(chr == "!") {
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
				} else {
					cell = createTiddlyElement(e,"td");
				}
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1,element:cell};
				if(colSpanCount > 1) {
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
				}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if(spaceLeft)
					cell.align = "right";
				w.nextMatch--;
			}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
		}
	}
},

{
	name: "heading",
	match: "^!{1,6}",
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:[\\*#;:]+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType, baseType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			if(lookaheadMatch[1]) {
				listType = "ul";
				itemType = "li";
			} else if(lookaheadMatch[2]) {
				listType = "ol";
				itemType = "li";
			} else if(lookaheadMatch[3]) {
				listType = "dl";
				itemType = "dt";
			} else if(lookaheadMatch[4]) {
				listType = "dl";
				itemType = "dd";
			}
			if (!baseType)
			   baseType = listType;
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			var t;
			if(listLevel > currLevel) {
				for(t=currLevel; t<listLevel; t++) {
					var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;
					stack.push(createTiddlyElement(target,listType));
				}
			} else if (listType!=baseType && listLevel==1) {
				w.nextMatch -= lookaheadMatch[0].length;
				return;
			} else if(listLevel < currLevel) {
				for(t=currLevel; t>listLevel; t--)
					stack.pop();
			} else if(listLevel == currLevel && listType != currType) {
				stack.pop();
				stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));
			}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(stack[stack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t;
		do {
			if(newLevel > currLevel) {
				for(t=currLevel; t<newLevel; t++)
					stack.push(createTiddlyElement(stack[stack.length-1],this.element));
			} else if(newLevel < currLevel) {
				for(t=currLevel; t>newLevel; t--)
					stack.pop();
			}
			currLevel = newLevel;
			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
			createTiddlyElement(stack[stack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched) {
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
			}
		} while(matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^\\{\\{\\{\\n",
	lookaheadRegExp: /^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForCSS",
	match: "^/\\*\\{\\{\\{\\*/\\n",
	lookaheadRegExp: /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\/\*\}\}\}\*\/$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForPlugin",
	match: "^//\\{\\{\\{\\n",
	lookaheadRegExp: /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\/\/\}\}\}$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForTemplate",
	match: "^<!--\\{\\{\\{-->\\n",
	lookaheadRegExp: /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^<!--\}\}\}-->$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "wikifyCommentForPlugin",
	match: "^/\\*\\*\\*\\n",
	termRegExp: /(^\*\*\*\/\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(w.output,this.termRegExp);
	}
},

{
	name: "wikifyCommentForTemplate",
	match: "^<!---\\n",
	termRegExp: /(^--->\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(w.output,this.termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
		}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e;
			var text = lookaheadMatch[1];
			if(lookaheadMatch[3]) {
				// Pretty bracketted link
				var link = lookaheadMatch[3];
				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?
						createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
			} else {
				// Simple bracketted link
				e = createTiddlyLink(w.output,text,false,null,w.isStatic,w.tiddler);
			}
			createTiddlyText(e,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "unWikiLink",
	match: config.textPrimitives.unWikiLink+config.textPrimitives.wikiLink,
	handler: function(w)
	{
		w.outputText(w.output,w.matchStart+1,w.nextMatch);
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.wikiLink,
	handler: function(w)
	{
		if(w.matchStart > 0) {
			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
			preRegExp.lastIndex = w.matchStart-1;
			var preMatch = preRegExp.exec(w.source);
			if(preMatch.index == w.matchStart-1) {
				w.outputText(w.output,w.matchStart,w.nextMatch);
				return;
			}
		}
		if(w.autoLinkWikiWords == true || store.isShadowTiddler(w.matchText)) {
			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);
			w.outputText(link,w.matchStart,w.nextMatch);
		} else {
			w.outputText(w.output,w.matchStart,w.nextMatch);
		}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e = w.output;
			if(lookaheadMatch[5]) {
				var link = lookaheadMatch[5];
				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
				addClass(e,"imageLink");
			}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3])
				img.title = lookaheadMatch[3];
			img.src = lookaheadMatch[4];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "boldByChar",
	match: "''",
	termRegExp: /('')/mg,
	element: "strong",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "italicByChar",
	match: "//",
	termRegExp: /(\/\/)/mg,
	element: "em",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "underlineByChar",
	match: "__",
	termRegExp: /(__)/mg,
	element: "u",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "strikeByChar",
	match: "--(?!\\s|$)",
	termRegExp: /((?!\s)--|(?=\n\n))/mg,
	element: "strike",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "superscriptByChar",
	match: "\\^\\^",
	termRegExp: /(\^\^)/mg,
	element: "sup",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "subscriptByChar",
	match: "~~",
	termRegExp: /(~~)/mg,
	element: "sub",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "monospacedByChar",
	match: "\\{\\{\\{",
	lookaheadRegExp: /\{\{\{((?:.|\n)*?)\}\}\}/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "styleByChar",
	match: "@@",
	termRegExp: /(@@)/mg,
	handler: function(w)
	{
		var e = createTiddlyElement(w.output,"span");
		var styles = config.formatterHelpers.inlineCssHelper(w);
		if(styles.length == 0)
			e.className = "marked";
		else
			config.formatterHelpers.applyCssHelper(e,styles);
		w.subWikifyTerm(e,this.termRegExp);
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "rawText",
	match: "\\\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
	}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
	}
},

{
	name: "customClasses",
	match: "\\{\\{",
	termRegExp: /(\}\}\})/mg,
	lookaheadRegExp: /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch) {
			var e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			w.subWikifyTerm(e,this.termRegExp);
		}
	}
}

];

//--
//-- Wikifier
//--

function getParser(tiddler,format)
{
	if(tiddler) {
		if(!format)
			format = tiddler.fields["wikiformat"];
		var i;
		if(format) {
			for(i in config.parsers) {
				if(format == config.parsers[i].format)
					return config.parsers[i];
			}
		} else {
			for(i in config.parsers) {
				if(tiddler.isTagged(config.parsers[i].formatTag))
					return config.parsers[i];
			}
		}
	}
	return formatter;
}

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source && source != "") {
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		wikifier.subWikifyUnterm(output);
	}
}

function wikifyStatic(source,highlightRegExp,tiddler,format)
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	var html = "";
	if(source && source != "") {
		var wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);
		wikifier.isStatic = true;
		wikifier.subWikifyUnterm(e);
		html = e.innerHTML;
		removeNode(e);
	}
	return html;
}

function wikifyPlain(title,theStore,limit)
{
	if(!theStore)
		theStore = store;
	if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {
		return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);
	} else {
		return "";
	}
}

function wikifyPlainText(text,limit,tiddler)
{
	if(limit > 0)
		text = text.substr(0,limit);
	var wikifier = new Wikifier(text,formatter,null,tiddler);
	return wikifier.wikifyPlain();
}

function highlightify(source,output,highlightRegExp,tiddler)
{
	if(source && source != "") {
		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
		wikifier.outputText(output,0,source.length);
	}
}

function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp) {
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
	}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	this.subWikify(e);
	var text = getPlainText(e);
	removeNode(e);
	return text;
};

Wikifier.prototype.subWikify = function(output,terminator)
{
	if(terminator)
		this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
	else
		this.subWikifyUnterm(output);
};

Wikifier.prototype.subWikifyUnterm = function(output)
{
	// subWikify() can be indirectly recursive, so we need to save the old output pointer
	var oldOutput = this.output;
	this.output = output;
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while(formatterMatch) {
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
	// subWikify() can be indirectly recursive, so we need to save the old output pointer
	var oldOutput = this.output;
	this.output = output;
	// Get the first matches for the formatter and terminator RegExps
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch) {
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			this.output = oldOutput;
			return;
		}
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {
		if(this.highlightMatch.index > startPos) {
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
		}
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		var theHighlight = createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
	}
	if(startPos < endPos) {
		createTiddlyText(place,this.source.substring(startPos,endPos));
	}
};

//--
//-- Macro definitions
//--

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text;
	if(params[0])
		text = now.formatString(params[0].trim());
	else
		text = now.toLocaleString();
	createTiddlyElement(place,"span",null,null,text);
};

config.macros.version.handler = function(place)
{
	createTiddlyElement(place,"span",null,null,version.major + "." + version.minor + "." + version.revision + (version.beta ? " (beta " + version.beta + ")" : ""));
};

config.macros.list.handler = function(place,macroName,params)
{
	var type = params[0] ? params[0] : "all";
	var list = document.createElement("ul");
	place.appendChild(list);
	if(this[type].prompt)
		createTiddlyElement(list,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	for(var t = 0; t < results.length; t++) {
		var li = document.createElement("li");
		list.appendChild(li);
		createTiddlyLink(li,typeof results[t] == "string" ? results[t] : results[t].title,true);
	}
};

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
};

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
};

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
};

config.macros.list.touched.handler = function(params)
{
	return store.getTouched();
};

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags(params[0]);
	var ul = createTiddlyElement(place,"ul");
	if(tags.length == 0)
		createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
	for(var t=0; t<tags.length; t++) {
		var title = tags[t][0];
		var info = getTiddlyLinkInfo(title);
		var li =createTiddlyElement(ul,"li");
		var btn = createTiddlyButton(li,title + " (" + tags[t][1] + ")",this.tooltip.format([title]),onClickTag,info.classes);
		btn.setAttribute("tag",title);
		btn.setAttribute("refresh","link");
		btn.setAttribute("tiddlyLink",title);
	}
};

config.macros.timeline.handler = function(place,macroName,params)
{
	var field = params[0] ? params[0] : "modified";
	var tiddlers = store.reverseLookup("tags","excludeLists",false,field);
	var lastDay = "";
	var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;
	var dateFormat = params[2] ? params[2] : this.dateFormat;
	for(var t=tiddlers.length-1; t>=last; t--) {
		var tiddler = tiddlers[t];
		var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);
		if(theDay != lastDay) {
			var theDateList = document.createElement("ul");
			place.appendChild(theDateList);
			createTiddlyElement(theDateList,"li",null,"listTitle",tiddler[field].formatString(dateFormat));
			lastDay = theDay;
		}
		var theDateListItem = createTiddlyElement(theDateList,"li",null,"listLink");
		theDateListItem.appendChild(createTiddlyLink(place,tiddler.title,true));
	}
};

config.macros.search.handler = function(place,macroName,params)
{
	var searchTimeout = null;
	var btn = createTiddlyButton(place,this.label,this.prompt,this.onClick);
	var txt = createTiddlyElement(place,"input",null,"txtOptionInput");
	if(params[0])
		txt.value = params[0];
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",this.accessKey);
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
	if(config.browser.isSafari) {
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
	} else {
		txt.setAttribute("type","text");
	}
};

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0) {
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
	}
};

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
};

config.macros.search.onKeyPress = function(ev)
{
	var e = ev ? ev : window.event;
	switch(e.keyCode) {
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			config.macros.search.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
	}
	if(this.value.length > 2) {
		if(this.value != this.getAttribute("lastSearchText")) {
			if(config.macros.search.timeout)
				clearTimeout(config.macros.search.timeout);
			var txt = this;
			config.macros.search.timeout = setTimeout(function() {config.macros.search.doSearch(txt);},500);
		}
	} else {
		if(config.macros.search.timeout)
			clearTimeout(config.macros.search.timeout);
	}
};

config.macros.search.onFocus = function(e)
{
	this.select();
};

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("name",null,true,false,true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] ? names[1] : null;
	var args = params[0]["with"];
	var wrapper = createTiddlyElement(place,"span",null,className);
	if(!args) {
		wrapper.setAttribute("refresh","content");
		wrapper.setAttribute("tiddler",tiddlerName);
	}
	var text = store.getTiddlerText(tiddlerName);
	if(text) {
		var stack = config.macros.tiddler.tiddlerStack;
		if(stack.indexOf(tiddlerName) !== -1)
			return;
		stack.push(tiddlerName);
		try {
			var n = args ? Math.min(args.length,9) : 0;
			for(var i=0; i<n; i++) {
				var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
				text = text.replace(placeholderRE,args[i]);
			}
			config.macros.tiddler.renderText(wrapper,text,tiddlerName,params);
		} finally {
			stack.pop();
		}
	}
};

config.macros.tiddler.renderText = function(place,text,tiddlerName,params)
{
	wikify(text,place,null,store.getTiddler(tiddlerName));
};

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	createTagButton(place,params[0]);
};

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var theList = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params,"sep"," ");
	var lingo = config.views.wikified.tag;
	var prompt = tiddler.tags.length == 0 ? lingo.labelNoTags : lingo.labelTags;
	createTiddlyElement(theList,"li",null,"listTitle",prompt.format([tiddler.title]));
	for(var t=0; t<tiddler.tags.length; t++) {
		createTagButton(createTiddlyElement(theList,"li"),tiddler.tags[t],tiddler.title);
		if(t<tiddler.tags.length-1)
			createTiddlyText(theList,sep);
	}
};

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var theList = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params,"sep"," ");
	theList.setAttribute("title",this.tooltip.format([title]));
	var tagged = store.getTaggedTiddlers(title);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(theList,"li",null,"listTitle",prompt.format([title,tagged.length]));
	for(var t=0; t<tagged.length; t++) {
		createTiddlyLink(createTiddlyElement(theList,"li"),tagged[t].title,true);
		if(t<tagged.length-1)
			createTiddlyText(theList,sep);
	}
};

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
};

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
};

config.macros.saveChanges.handler = function(place)
{
	if(!readOnly)
		createTiddlyButton(place,this.label,this.prompt,this.onClick,null,null,this.accessKey);
};

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
};

config.macros.slider.onClickSlider = function(ev)
{
	var e = ev ? ev : window.event;
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate && anim && typeof Slider == "function")
		anim.startAnimating(new Slider(n,!isOpen,null,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOptionCookie(cookie);
	return false;
};

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var c = cookie ? cookie : "";
	var btn = createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(null,"div",null,"sliderPanel");
	panel.setAttribute("cookie",c);
	panel.style.display = config.options[c] ? "block" : "none";
	place.appendChild(panel);
	return panel;
};

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh","content");
	panel.setAttribute("tiddler",params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
};

config.macros.option.genericCreate = function(place,type,opt,className,desc)
{
	var typeInfo = config.macros.option.types[type];
	var c = document.createElement(typeInfo.elementType);
	if(typeInfo.typeValue)
		c.setAttribute("type",typeInfo.typeValue);
	c[typeInfo.eventName] = typeInfo.onChange;
	c.setAttribute("option",opt);
	if(className)
		c.className = className;
	else
		c.className = typeInfo.className;
	if(config.optionsDesc[opt])
		c.setAttribute("title",config.optionsDesc[opt]);
	place.appendChild(c);
	if(desc != "no")
		createTiddlyText(place,config.optionsDesc[opt] ? config.optionsDesc[opt] : opt);
	c[typeInfo.valueField] = config.options[opt];
	return c;
};

config.macros.option.genericOnChange = function(e)
{
	var opt = this.getAttribute("option");
	if(opt) {
		var optType = opt.substr(0,3);
		var handler = config.macros.option.types[optType];
		if (handler.elementType && handler.valueField)
			config.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType);
		}
	return true;
};

config.macros.option.types = {
	'txt': {
		elementType: "input",
		valueField: "value",
		eventName: "onkeyup",
		className: "txtOptionInput",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	},
	'chk': {
		elementType: "input",
		valueField: "checked",
		eventName: "onclick",
		className: "chkOptionInput",
		typeValue: "checkbox",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	}
};

config.macros.option.propagateOption = function(opt,valueField,value,elementType)
{
	config.options[opt] = value;
	saveOptionCookie(opt);
	var nodes = document.getElementsByTagName(elementType);
	for(var t=0; t<nodes.length; t++) {
		var optNode = nodes[t].getAttribute("option");
		if(opt == optNode)
			nodes[t][valueField] = value;
		}
};

config.macros.option.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var opt = (params[1] && params[1].name == "anon") ? params[1].value : getParam(params,"name",null);
	var className = (params[2] && params[2].name == "anon") ? params[2].value : getParam(params,"class",null);
	var desc = getParam(params,"desc","no");
	var type = opt.substr(0,3);
	var h = config.macros.option.types[type];
	if (h && h.create)
		h.create(place,type,opt,className,desc);
};

config.macros.options.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var showUnknown = getParam(params,"showUnknown","no");
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var chkUnknown = wizard.getElement("chkUnknown");
	chkUnknown.checked = showUnknown == "yes";
	chkUnknown.onchange = this.onChangeUnknown;
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	wizard.setValue("listWrapper",listWrapper);
	this.refreshOptions(listWrapper,showUnknown == "yes");
};

config.macros.options.refreshOptions = function(listWrapper,showUnknown)
{
	var opts = [];
	for(var n in config.options) {
		var opt = {};
		opt.option = "";
		opt.name = n;
		opt.lowlight = !config.optionsDesc[n];
		opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
		if(!opt.lowlight || showUnknown)
			opts.push(opt);
	}
	opts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});
	var listview = ListView.create(listWrapper,opts,this.listViewTemplate);
	for(n=0; n<opts.length; n++) {
		var type = opts[n].name.substr(0,3);
		var h = config.macros.option.types[type];
		if (h && h.create) {
			h.create(opts[n].colElements['option'],type,opts[n].name,null,"no");
		}
	}
};

config.macros.options.onChangeUnknown = function(e)
{
	var wizard = new Wizard(this);
	var listWrapper = wizard.getValue("listWrapper");
	removeChildren(listWrapper);
	config.macros.options.refreshOptions(listWrapper,this.checked);
	return false;
};

config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
	var tags = [];
	for(var t=1; t<params.length; t++) {
		if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
			tags.push(params[t].value);
	}
	label = getParam(params,"label",label);
	prompt = getParam(params,"prompt",prompt);
	accessKey = getParam(params,"accessKey",accessKey);
	newFocus = getParam(params,"focus",newFocus);
	var customFields = getParam(params,"fields","");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
	btn.setAttribute("newTitle",title);
	btn.setAttribute("isJournal",isJournal ? "true" : "false");
	if(tags.length > 0)
		btn.setAttribute("params",tags.join("|"));
	btn.setAttribute("newFocus",newFocus);
	btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
	if(customFields !== "")
		btn.setAttribute("customFields",customFields);
	var text = getParam(params,"text");
	if(text !== undefined)
		btn.setAttribute("newText",text);
	return btn;
};

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal") == "true") {
		var now = new Date();
		title = now.formatString(title.trim());
	}
	var params = this.getAttribute("params");
	var tags = params ? params.split("|") : [];
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	var customFields = this.getAttribute("customFields");
	story.displayTiddler(null,title,template,false,null,null);
	var tiddlerElem = document.getElementById(story.idPrefix + title);
	if(customFields)
		story.addCustomFields(tiddlerElem,customFields);
	var text = this.getAttribute("newText");
	if(typeof text == "string")
		story.getTiddlerField(title,"text").value = text.format([title]);
	for(var t=0;t<tags.length;t++)
		story.setTiddlerTag(title,tags[t],+1);
	story.focusTiddler(title,focus);
	return false;
};

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
		title = getParam(params,"title",title);
		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
	}
};

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : "";
		title = getParam(params,"title",title);
		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
	}
};

config.macros.sparkline.handler = function(place,macroName,params)
{
	var data = [];
	var min = 0;
	var max = 0;
	var v;
	for(var t=0; t<params.length; t++) {
		v = parseInt(params[t]);
		if(v < min)
			min = v;
		if(v > max)
			max = v;
		data.push(v);
	}
	if(data.length < 1)
		return;
	var box = createTiddlyElement(place,"span",null,"sparkline",String.fromCharCode(160));
	box.title = data.join(",");
	var w = box.offsetWidth;
	var h = box.offsetHeight;
	box.style.paddingRight = (data.length * 2 - w) + "px";
	box.style.position = "relative";
	for(var d=0; d<data.length; d++) {
		var tick = document.createElement("img");
		tick.border = 0;
		tick.className = "sparktick";
		tick.style.position = "absolute";
		tick.src = "data:image/gif,GIF89a%01%00%01%00%91%FF%00%FF%FF%FF%00%00%00%C0%C0%C0%00%00%00!%F9%04%01%00%00%02%00%2C%00%00%00%00%01%00%01%00%40%02%02T%01%00%3B";
		tick.style.left = d*2 + "px";
		tick.style.width = "2px";
		v = Math.floor(((data[d] - min)/(max-min)) * h);
		tick.style.top = (h-v) + "px";
		tick.style.height = v + "px";
		box.appendChild(tick);
	}
};

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(null,"div",null,cookie);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	for(var t=0; t<numTabs; t++) {
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
	}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset,config.options[cookie]);
};

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
};

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null;
	var nodes = tabset.childNodes;
	for(var t=0; t<nodes.length; t++) {
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab) {
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
		} else {
			nodes[t].className = "tab tabUnselected";
		}
	}
	if(theTab) {
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			removeNode(tabset.nextSibling);
		var tabContent = createTiddlyElement(null,"div",null,"tabContents");
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie) {
			config.options[cookie] = tab;
			saveOptionCookie(cookie);
		}
	}
};

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier)
{
	var terminator = ">>";
	var panel;
	if(wikifier)
		panel = createTiddlyElement(place,"div",null,"gradient");
	else
		panel = place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	var t;
	if(wikifier) {
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
	}
	var colours = [];
	for(t=1; t<params.length; t++) {
		var c = new RGB(params[t]);
		if(c)
			colours.push(c);
	}
	drawGradient(panel,params[0] != "vert",colours);
	if(wikifier)
		wikifier.subWikify(panel,terminator);
	if(document.all) {
		panel.style.height = "100%";
		panel.style.width = "100%";
	}
};

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0]) {
		var m = config;
		var p = params[0].split(".");
		for(var t=0; t<p.length; t++) {
			if(p[t] in m)
				m = m[p[t]];
			else
				break;
		}
		createTiddlyText(place,m.toString().format(params.splice(1)));
	}
};

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0]) {
		var value = store.getValue(tiddler,params[0]);
		if(value != undefined) {
			switch(params[1]) {
				case undefined:
					highlightify(value,place,highlightHack,tiddler);
					break;
				case "link":
					createTiddlyLink(place,value,true);
					break;
				case "wikified":
					wikify(value,place,highlightHack,tiddler);
					break;
				case "date":
					value = Date.convertFromYYYYMMDDHHMM(value);
					createTiddlyText(place,value.formatString(params[2] ? params[2] : config.views.wikified.dateFormat));
					break;
			}
		}
	}
};

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	var rows = params[1];
	if((tiddler instanceof Tiddler) && field) {
		story.setDirty(tiddler.title,true);
		var e,v;
		if(field != "text" && !rows) {
			e = createTiddlyElement(null,"input");
			if(tiddler.isReadOnly())
				e.setAttribute("readOnly","readOnly");
			e.setAttribute("edit",field);
			e.setAttribute("type","text");
			v = store.getValue(tiddler,field);
			if(!v)
				v = "";
			e.value = v;
			e.setAttribute("size","40");
			e.setAttribute("autocomplete","off");
			place.appendChild(e);
		} else {
			var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
			var wrapper2 = createTiddlyElement(wrapper1,"div");
			e = createTiddlyElement(wrapper2,"textarea");
			if(tiddler.isReadOnly())
				e.setAttribute("readOnly","readOnly");
			v = store.getValue(tiddler,field);
			if(!v)
				v = "";
			e.value = v;
			rows = rows ? rows : 10;
			var lines = v.match(/\n/mg);
			var maxLines = Math.max(parseInt(config.options.txtMaxEditRows),5);
			if(lines != null && lines.length > rows)
				rows = lines.length + 5;
			rows = Math.min(rows,maxLines);
			e.setAttribute("rows",rows);
			e.setAttribute("edit",field);
			place.appendChild(wrapper1);
		}
	}
};

config.macros.tagChooser.onClick = function(ev)
{
	var e = ev ? ev : window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags();
	if(tags.length == 0)
		createTiddlyText(createTiddlyElement(popup,"li"),lingo.popupNone);
	for(var t=0; t<tags.length; t++) {
		var theTag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		theTag.setAttribute("tag",tags[t][0]);
		theTag.setAttribute("tiddler",this.getAttribute("tiddler"));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
};

config.macros.tagChooser.onTagClick = function(ev)
{
	var e = ev ? ev : window.event;
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return false;
};

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler) {
		var title = tiddler.title;
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler",title);
	}
};

// Create a toolbar command button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,theClass)
{
	if(typeof commandName != "string") {
		var c = null;
		for(var t in config.commands) {
			if(config.commands[t] == commandName)
				c = t;
		}
		commandName = c;
	}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string")) {
		var command = config.commands[commandName];
		if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {
			var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);
			var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);
			var cmd;
			switch(command.type) {
				case "popup":
					cmd = this.onClickPopup;
					break;
				case "command":
				default:
					cmd = this.onClickCommand;
					break;
			}
			var btn = createTiddlyButton(null,text,tooltip,cmd);
			btn.setAttribute("commandName",commandName);
			btn.setAttribute("tiddler",tiddler.title);
			if(theClass)
				addClass(btn,theClass);
			place.appendChild(btn);
		}
	}
};

config.macros.toolbar.isCommandEnabled = function(command,tiddler)
{
	var title = tiddler.title;
	var ro = tiddler.isReadOnly();
	var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
	return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);
};

config.macros.toolbar.getCommandText = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyText ? command.readOnlyText : command.text;
};

config.macros.toolbar.getCommandTooltip = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyTooltip ? command.readOnlyTooltip : command.tooltip;
};

config.macros.toolbar.onClickCommand = function(ev)
{
	var e = ev ? ev : window.event;
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
};

config.macros.toolbar.onClickPopup = function(ev)
{
	var e = ev ? ev : window.event;
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	var popup = Popup.create(this);
	var command = config.commands[this.getAttribute("commandName")];
	var title = this.getAttribute("tiddler");
	var tiddler = store.fetchTiddler(title);
	popup.setAttribute("tiddler",title);
	command.handlePopup(popup,title);
	Popup.show();
	return false;
};

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,theClass,event)
{
	var children = place.getElementsByTagName("a");
	for(var t=0; t<children.length; t++) {
		var c = children[t];
		if(hasClass(c,theClass) && c.getAttribute && c.getAttribute("commandName")) {
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
		}
	}
};

config.macros.toolbar.onClickMore = function(ev)
{
	var e = this.nextSibling;
	e.style.display = "inline";
	removeNode(this);
	return false;
};

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	for(var t=0; t<params.length; t++) {
		var c = params[t];
		switch(c) {
			case '>':
				var btn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);
				addClass(btn,"moreCommand");
				var e = createTiddlyElement(place,"span",null,"moreCommand");
				e.style.display = "none";
				place = e;
				break;
			default:
				var theClass = "";
				switch(c.substr(0,1)) {
					case "+":
						theClass = "defaultCommand";
						c = c.substr(1);
						break;
					case "-":
						theClass = "cancelCommand";
						c = c.substr(1);
						break;
				}
				if(c in config.commands)
					this.createCommand(place,c,tiddler,theClass);
				break;
		}
	}
};

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
};

config.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var title = tiddler ? tiddler.title : null;
	var a = title ? config.annotations[title] : null;
	if(!tiddler || !title || !a)
		return;
	var text = a.format([title]);
	wikify(text,createTiddlyElement(place,"div",null,"annotation"),null,tiddler);
};

//--
//-- Menu and toolbar commands
//--

config.commands.closeTiddler.handler = function(event,src,title)
{
	story.closeTiddler(title,true);
	return false;
};

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
};

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	var tiddlerElem = document.getElementById(story.idPrefix + title);
	var fields = tiddlerElem.getAttribute("tiddlyFields");
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);
	story.focusTiddler(title,"text");
	return false;
};

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
		story.displayTiddler(null,newTitle);
	return false;
};

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly) {
		if(!confirm(this.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
};

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true;
	if (config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if (deleteIt) {
		store.removeTiddler(title);
		story.closeTiddler(title,true);
		autoSaveChanges();
	}
	return false;
};

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
};

config.commands.references.handlePopup = function(popup,title)
{
	var references = store.getReferringTiddlers(title);
	var c = false;
	for(var r=0; r<references.length; r++) {
		if(references[r].title != title && !references[r].isTagged("excludeLists")) {
			createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
			c = true;
		}
	}
	if(!c)
		createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),this.popupNone);
};

config.commands.jump.handlePopup = function(popup,title)
{
	story.forEachTiddler(function(title,element) {
		createTiddlyLink(createTiddlyElement(popup,"li"),title,true,null,false,null,true);
		});
};

config.commands.syncing.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var serverType = tiddler.getServerType();
	var serverHost = tiddler.fields['server.host'];
	var serverWorkspace = tiddler.fields['server.workspace'];
	if(!serverWorkspace)
		serverWorkspace = "";
	if(serverType) {
		var e = createTiddlyElement(popup,"li",null,"popupMessage");
		e.innerHTML = config.commands.syncing.currentlySyncing.format([serverType,serverHost,serverWorkspace]);
	} else {
		createTiddlyElement(popup,"li",null,"popupMessage",config.commands.syncing.notCurrentlySyncing);
	}
	if(serverType) {
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var btn = createTiddlyButton(createTiddlyElement(popup,"li"),this.captionUnSync,null,config.commands.syncing.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type","");
	}
	createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
	createTiddlyElement(popup,"li",null,"popupMessage",config.commands.syncing.chooseServer);
	var feeds = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<feeds.length; t++) {
		var f = feeds[t];
		var feedServerType = store.getTiddlerSlice(f.title,"Type");
		if(!feedServerType)
			feedServerType = "file";
		var feedServerHost = store.getTiddlerSlice(f.title,"URL");
		if(!feedServerHost)
			feedServerHost = "";
		var feedServerWorkspace = store.getTiddlerSlice(f.title,"Workspace");
		if(!feedServerWorkspace)
			feedServerWorkspace = "";
		var caption = f.title;
		if(serverType == feedServerType && serverHost == feedServerHost && serverWorkspace == feedServerWorkspace) {
			caption = config.commands.syncing.currServerMarker + caption;
		} else {
			caption = config.commands.syncing.notCurrServerMarker + caption;
		}
		btn = createTiddlyButton(createTiddlyElement(popup,"li"),caption,null,config.commands.syncing.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type",feedServerType);
		btn.setAttribute("server.host",feedServerHost);
		btn.setAttribute("server.workspace",feedServerWorkspace);
	}
};

config.commands.syncing.onChooseServer = function(e)
{
	var tiddler = this.getAttribute("tiddler");
	var serverType = this.getAttribute("server.type");
	if(serverType) {
		store.addTiddlerFields(tiddler,{
			'server.type': serverType,
			'server.host': this.getAttribute("server.host"),
			'server.workspace': this.getAttribute("server.workspace")
			});
	} else {
		store.setValue(tiddler,'server',null);
	}
	return false;
};

config.commands.fields.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var fields = {};
	store.forEachField(tiddler,function(tiddler,fieldName,value) {fields[fieldName] = value;},true);
	var items = [];
	for(var t in fields) {
		items.push({field: t,value: fields[t]});
	}
	items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});
	if(items.length > 0)
		ListView.create(popup,items,this.listViewTemplate);
	else
		createTiddlyElement(popup,"div",null,null,this.emptyText);
};

//--
//-- Tiddler() object
//--

function Tiddler(title)
{
	this.title = title;
	this.text = null;
	this.modifier = null;
	this.modified = new Date();
	this.created = new Date();
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	this.fields = {};
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated==false)
		this.changed();
	return this.links;
};

// Returns the fields that are inherited in string field:"value" field2:"value2" format
Tiddler.prototype.getInheritedFields = function()
{
	var f = {};
	for(i in this.fields) {
		if(i=="server.host" || i=="server.workspace" || i=="wikiformat"|| i=="server.type") {
			f[i] = this.fields[i];
		}
	}
	return String.encodeHashMap(f);
};

// Increment the changeCount of a tiddler
Tiddler.prototype.incChangeCount = function()
{
	var c = this.fields['changecount'];
	c = c ? parseInt(c) : 0;
	this.fields['changecount'] = String(c+1);
};

// Clear the changeCount of a tiddler
Tiddler.prototype.clearChangeCount = function()
{
	if(this.fields['changecount']) {
		delete this.fields['changecount'];
	}
};

// Returns true if the tiddler has been updated since the tiddler was created or downloaded
Tiddler.prototype.isTouched = function()
{
	var changeCount = this.fields['changecount'];
	if(changeCount === undefined)
		changeCount = 0;
	return changeCount > 0;
};

// Format the text for storage in an RSS item
Tiddler.prototype.saveToRss = function(url)
{
	var s = [];
	s.push("<item>");
	s.push("<title" + ">" + this.title.htmlEncode() + "</title" + ">");
	s.push("<description>" + wikifyStatic(this.text,null,this).htmlEncode() + "</description>");
	for(var t=0; t<this.tags.length; t++)
		s.push("<category>" + this.tags[t] + "</category>");
	s.push("<link>" + url + "#" + encodeURIComponent(String.encodeTiddlyLink(this.title)) + "</link>");
	s.push("<pubDate>" + this.modified.toGMTString() + "</pubDate>");
	s.push("</item>");
	return s.join("\n");
};

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields)
{
	this.assign(title,text,modifier,modified,tags,created,fields);
	this.changed();
	return this;
};

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(created != undefined)
		this.created = created;
	if(fields != undefined)
		this.fields = fields;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
};

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
};

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
};

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
};

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
};

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(this.text);
	while(formatMatch) {
		var lastIndex = tiddlerLinkRegExp.lastIndex;
		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) {
			// wikiWordLink
			if(formatMatch.index > 0) {
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
				preRegExp.lastIndex = formatMatch.index-1;
				var preMatch = preRegExp.exec(this.text);
				if(preMatch.index != formatMatch.index-1)
					this.links.pushUnique(formatMatch[1]);
			} else {
				this.links.pushUnique(formatMatch[1]);
			}
		}
		else if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink
			this.links.pushUnique(formatMatch[3-t]);
		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4-t]);
		tiddlerLinkRegExp.lastIndex = lastIndex;
		formatMatch = tiddlerLinkRegExp.exec(this.text);
	}
	this.linksUpdated = true;
};

Tiddler.prototype.getSubtitle = function()
{
	var theModifier = this.modifier;
	if(!theModifier)
		theModifier = config.messages.subtitleUnknown;
	var theModified = this.modified;
	if(theModified)
		theModified = theModified.toLocaleString();
	else
		theModified = config.messages.subtitleUnknown;
	return config.messages.tiddlerLinkTooltip.format([this.title,theModifier,theModified]);
};

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
};

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
};

Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
};

Tiddler.prototype.getServerType = function()
{
	var serverType = null;
	if(this.fields && this.fields['server.type'])
		serverType = this.fields['server.type'];
	if(!serverType)
		serverType = this.fields['wikiformat'];
	if(serverType && !config.adaptors[serverType])
		serverType = null;
	return serverType;
};

Tiddler.prototype.getAdaptor = function()
{
	var serverType = this.getServerType();
	if(serverType)
		return new config.adaptors[serverType];
	else
		return null;
};

//--
//-- TiddlyWiki() object contains Tiddler()s
//--

function TiddlyWiki()
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
	};
	this.fetchTiddler = function(title) {
		return tiddlers[title];
	};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
	};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
	};
	this.forEachTiddler = function(callback) {
		for(var t in tiddlers) {
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
		}
	};
}

TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
};

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
};

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
};

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
};

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
		}
	}
};

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if(n.name)
				n.notify(n.name);
		}
	}
};

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	for(var i=0; i<this.namedNotifications.length; i++) {
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	}
	this.namedNotifications.push({name: title, notify: fn});
	return this;
};

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return t != undefined;
};

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return typeof config.shadowTiddlers[title] == "string";
};

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
};

TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		return tiddler.text;
	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1) {
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
	}
	if(this.isShadowTiddler(title))
		return config.shadowTiddlers[title];
	if(defaultText != undefined)
		return defaultText;
	return null;
};

TiddlyWiki.prototype.slicesRE = /(?:[\'\/]*~?([\.\w]+)[\'\/]*\:[\'\/]*\s*(.*?)\s*$)|(?:\|[\'\/]*~?([\.\w]+)\:?[\'\/]*\|\s*(.*?)\s*\|)/gm;

// @internal
TiddlyWiki.prototype.calcAllSlices = function(title)
{
	var slices = {};
	var text = this.getTiddlerText(title,"");
	this.slicesRE.lastIndex = 0;
	do {
		var m = this.slicesRE.exec(text);
		if(m) {
			if(m[1])
				slices[m[1]] = m[2];
			else
				slices[m[3]] = m[4];
		}
	} while(m);
	return slices;
};

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
	var slices = this.slices[title];
	if(!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
};

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
	var r = {};
	for(var t=0; t<sliceNames.length; t++) {
		var slice = this.getTiddlerSlice(title,sliceNames[t]);
		if(slice)
			r[sliceNames[t]] = slice;
	}
	return r;
};

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,null);
	if(text == null)
		return defaultText;
	var textOut = [];
	var lastPos = 0;
	do {
		var match = bracketRegExp.exec(text);
		if(match) {
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1]) {
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],"[[" + match[1] + "]]",depth-1));
			}
			lastPos = match.index + match[0].length;
		} else {
			textOut.push(text.substr(lastPos));
		}
	} while(match);
	return textOut.join("");
};

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		var t = tiddler.tags.indexOf(tag);
		if(t != -1)
			tiddler.tags.splice(t,1);
		if(status)
			tiddler.tags.push(tag);
		tiddler.changed();
		this.incChangeCount(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.addTiddlerFields = function(title,fields)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		return;
	merge(tiddler.fields,fields);
	tiddler.changed();
	this.incChangeCount(title);
	this.notify(title,true);
	this.setDirty(true);
};

TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		created = created ? created : tiddler.created; // Preserve created date
		this.deleteTiddler(title);
	} else {
		created = created ? created : modified;
		tiddler = new Tiddler();
	}
	tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields);
	this.addTiddler(tiddler);
	if(clearChangeCount)
		tiddler.clearChangeCount();
	else
		tiddler.incChangeCount();
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.setDirty(true);
	return tiddler;
};

// Reset the sync status of a freshly synced tiddler
TiddlyWiki.prototype.resetTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		tiddler.clearChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.incChangeCount = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		tiddler.incChangeCount();
};

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler) {
		tiddler = new Tiddler();
		tiddler.title = title;
		this.addTiddler(tiddler);
		this.setDirty(true);
	}
	return tiddler;
};

// Load contents of a TiddlyWiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
	this.idPrefix = idPrefix;
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	if(!storeElem)
		return;
	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate) {
		for(var i = 0;i<tiddlers.length; i++)
			tiddlers[i].changed();
	}
};

// Load contents of a TiddlyWiki from a string
// Returns null if there's an error
TiddlyWiki.prototype.importTiddlyWiki = function(text)
{
	var posDiv = locateStoreArea(text);
	if(!posDiv)
		return null;
	var content = "<" + "html><" + "body>" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + "<" + "/body><" + "/html>";
	// Create the iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	document.body.appendChild(iframe);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6
	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();
	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	this.loadFromDiv(storeArea,"store");
	// Get rid of the iframe
	iframe.parentNode.removeChild(iframe);
	return this;
};

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title,tiddler) {
		tiddler.changed();
	});
};

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return store.getSaver().externalize(store);
};

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag)
{
	var candidates = this.reverseLookup("tags",excludeTag,false);
	var results = [];
	for(var t=0; t<candidates.length; t++) {
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
	}
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Returns a list of all tags in use
//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag
// Returns an array of arrays where [tag][0] is the name of the tag and [tag][1] is the number of occurances
TiddlyWiki.prototype.getTags = function(excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		for(var g=0; g<tiddler.tags.length; g++) {
			var tag = tiddler.tags[g];
			var n = true;
			for(var c=0; c<results.length; c++) {
				if(results[c][0] == tag) {
					n = false;
					results[c][1]++;
				}
			}
			if(n && excludeTag) {
				var t = store.fetchTiddler(tag);
				if(t && t.isTagged(excludeTag))
					n = false;
			}
			if(n)
				results.push([tag,1]);
		}
	});
	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
	return results;
};

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
};

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links",title,true,sortField);
};

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		for(var lookup=0; lookup<tiddler[lookupField].length; lookup++) {
			if(tiddler[lookupField][lookup] == lookupValue)
				f = lookupMatch;
		}
		if(f)
			results.push(tiddler);
	});
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
	});
	if(field)
		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
	return results;
};

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function(sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(tiddler.isTagged("excludeMissing") || tiddler.isTagged("systemConfig"))
			return;
		for(var n=0; n<tiddler.links.length;n++) {
			var link = tiddler.links[n];
			if(this.fetchTiddler(link) == null && !this.isShadowTiddler(link))
				results.pushUnique(link);
		}
	});
	results.sort();
	return results;
};

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
	});
	results.sort();
	return results;
};

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var results = [];
	for(var t in config.shadowTiddlers) {
		if(typeof config.shadowTiddlers[t] == "string")
			results.push(t);
	}
	results.sort();
	return results;
};

// Return an array of tiddlers that have been touched since they were downloaded or created
TiddlyWiki.prototype.getTouched = function()
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(tiddler.isTouched())
			results.push(tiddler);
		});
	results.sort();
	return results;
};

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler)
{
	var t = (typeof tiddler == 'string') ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
};

TiddlyWiki.prototype.getLoader = function()
{
	if(!this.loader)
		this.loader = new TW21Loader();
	return this.loader;
};

TiddlyWiki.prototype.getSaver = function()
{
	if(!this.saver)
		this.saver = new TW21Saver();
	return this.saver;
};

// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by '.'
TiddlyWiki.isValidFieldName = function(name)
{
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
};

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name)
{
	if(!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
};

function StringFieldAccess(n,readOnly)
{
	this.set = readOnly ?
			function(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :
			function(t,v) {if(v != t[n]) {t[n] = v; return true;}};
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n)
{
	this.set = function(t,v) {
		var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);
		if(d != t[n]) {
			t[n] = d; return true;
		}
	};
	this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};
}

function LinksFieldAccess(n)
{
	this.set = function(t,v) {
		var s = (typeof v == "string") ? v.readBracketedList() : v;
		if(s.toString() != t[n].toString()) {
			t[n] = s; return true;
		}
	};
	this.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	"title":    new StringFieldAccess("title",true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title",true),
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name)
{
	return TiddlyWiki.standardFieldAccess[name] != undefined;
};

// Sets the value of the given field of the tiddler to the value.
// Setting an ExtendedField's value to null or undefined removes the field.
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)
{
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return;
	fieldName = fieldName.toLowerCase();
	var isRemove = (value === undefined) || (value === null);
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		if(isRemove)
			// don't remove StandardFields
			return;
		var h = TiddlyWiki.standardFieldAccess[fieldName];
		if(!h.set(t,value))
			return;
	} else {
		var oldValue = t.fields[fieldName];
		if(isRemove) {
			if(oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				// delete all fields in a namespace
				var re = new RegExp('^'+fieldName+'\\.');
				var dirty = false;
				for(var n in t.fields) {
					if(n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if(!dirty)
					return;
			}
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience provide a nicer conversion Date->String
			value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);
			if(oldValue == value)
				return;
			t.fields[fieldName] = value;
		}
	}
	// When we are here the tiddler/store really was changed.
	this.notify(t.title,true);
	if(!fieldName.match(/^temp\./))
		this.setDirty(true);
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler,fieldName)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	fieldName = fieldName.toLowerCase();
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		return accessor.get(t);
	}
	return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler,fieldName,value).
TiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	var n,result;
	for(n in t.fields) {
		result = callback(t,n,t.fields[n]);
		if(result)
			return result;
		}
	if(onlyExtendedFields)
		return undefined;
	for(n in TiddlyWiki.standardFieldAccess) {
		if(n == "tiddler")
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			continue;
		result = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));
		if(result)
			return result;
	}
	return undefined;
};

//--
//-- Story functions
//--

function Story(container,idPrefix)
{
	this.container = container;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
}

Story.prototype.forEachTiddler = function(fn)
{
	var place = document.getElementById(this.container);
	if(!place)
		return;
	var e = place.firstChild;
	while(e) {
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		fn.call(this,title,e);
		e = n;
	}
};

Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)
{
	for(var t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);
};

Story.prototype.displayTiddler = function(srcElement,title,template,animate,unused,customFields,toggle)
{
	var place = document.getElementById(this.container);
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem) {
		if(toggle)
			this.closeTiddler(title,true);
		else
			this.refreshTiddler(title,template,false,customFields);
	} else {
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place,before,title,template,customFields);
	}
	if(srcElement && typeof srcElement !== "string") {
		if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == "function" && typeof Scroller == "function")
			anim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));
		else
			window.scrollTo(0,ensureVisible(tiddlerElem));
	}
};

Story.prototype.positionTiddler = function(srcElement)
{
	var place = document.getElementById(this.container);
	var before = null;
	if(typeof srcElement == "string") {
		switch(srcElement) {
			case "top":
				before = place.firstChild;
				break;
			case "bottom":
				before = null;
				break;
		}
	} else {
		var after = this.findContainingTiddler(srcElement);
		if(after == null) {
			before = place.firstChild;
		} else if(after.nextSibling) {
			before = after.nextSibling;
			if(before.nodeType != 1)
				before = null;
		}
	}
	return before;
};

Story.prototype.createTiddler = function(place,before,title,template,customFields)
{
	var tiddlerElem = createTiddlyElement(null,"div",this.idPrefix + title,"tiddler");
	tiddlerElem.setAttribute("refresh","tiddler");
	if(customFields)
		tiddlerElem.setAttribute("tiddlyFields",customFields);
	place.insertBefore(tiddlerElem,before);
	var defaultText = null;
	if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))
		defaultText = this.loadMissingTiddler(title,customFields,tiddlerElem);
	this.refreshTiddler(title,template,false,customFields,defaultText);
	return tiddlerElem;
};

Story.prototype.loadMissingTiddler = function(title,fields,tiddlerElem)
{
	var tiddler = new Tiddler(title);
	tiddler.fields = typeof fields == "string" ?  fields.decodeHashMap() : (fields ? fields : {});
	var serverType = tiddler.getServerType();
	var host = tiddler.fields['server.host'];
	var workspace = tiddler.fields['server.workspace'];
	if(!serverType | !host)
		return null;
	var sm = new SyncMachine(serverType,{
			start: function() {
				return this.openHost(host,"openWorkspace");
			},
			openWorkspace: function() {
				return this.openWorkspace(workspace,"getTiddler");
			},
			getTiddler: function() {
				return this.getTiddler(title,"gotTiddler");
			},
			gotTiddler: function(tiddler) {
				if(tiddler && tiddler.text) {
					var downloaded = new Date();
					if(!tiddler.created)
						tiddler.created = downloaded;
					if(!tiddler.modified)
						tiddler.modified = tiddler.created;
					store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags,tiddler.fields,true,tiddler.created);
					autoSaveChanges();
				}
				delete this;
				return true;
			},
			error: function(message) {
				displayMessage("Error loading missing tiddler from %0: %1".format([host,message]));
			}
		});
	sm.go();
	return config.messages.loadingMissingTiddler.format([title,serverType,host,workspace]);
};

Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
};

Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getRecursiveTiddlerText(template,null,10);
};

Story.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem) {
		if(tiddlerElem.getAttribute("dirty") == "true" && !force)
			return tiddlerElem;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = tiddlerElem.getAttribute("template");
		if((template != currTemplate) || force) {
			var tiddler = store.getTiddler(title);
			if(tiddler) {
				var f = tiddler.fields;
				if(customFields)
					f = merge(customFields.decodeHashMap(),f);
				customFields = String.encodeHashMap(f);
			} else {
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title)) {
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,[],version.date);
				} else {
					var text = template=="EditTemplate" ?
								config.views.editor.defaultText.format([title]) :
								config.views.wikified.defaultText.format([title]);
					text = defaultText ? defaultText : text;
					var fields = customFields ? customFields.decodeHashMap() : null;
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);
				}
			}
			tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
			tiddlerElem.setAttribute("tiddler",title);
			tiddlerElem.setAttribute("template",template);
			var me = this;
			tiddlerElem.onmouseover = this.onTiddlerMouseOver;
			tiddlerElem.onmouseout = this.onTiddlerMouseOut;
			tiddlerElem.ondblclick = this.onTiddlerDblClick;
			tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
			var html = this.getTemplateForTiddler(title,template,tiddler);
			tiddlerElem.innerHTML = html;
			applyHtmlMacros(tiddlerElem,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				addClass(tiddlerElem,"isTag");
			else
				removeClass(tiddlerElem,"isTag");
			if(!store.tiddlerExists(title)) {
				if(store.isShadowTiddler(title))
					addClass(tiddlerElem,"shadow");
				else
					addClass(tiddlerElem,"missing");
			} else {
				removeClass(tiddlerElem,"shadow");
				removeClass(tiddlerElem,"missing");
			}
			if(customFields)
				this.addCustomFields(tiddlerElem,customFields);
			forceReflow();
		}
	}
	return tiddlerElem;
};

Story.prototype.addCustomFields = function(place,customFields)
{
	var fields = customFields.decodeHashMap();
	var w = document.createElement("div");
	w.style.display = "none";
	place.appendChild(w);
	for(var t in fields) {
		var e = document.createElement("input");
		e.setAttribute("type","text");
		e.setAttribute("value",fields[t]);
		w.appendChild(e);
		e.setAttribute("edit",t);
	}
};

Story.prototype.refreshAllTiddlers = function()
{
	var place = document.getElementById(this.container);
	var e = place.firstChild;
	if(!e)
		return;
	this.refreshTiddler(e.getAttribute("tiddler"),e.getAttribute("template"),true);
	while((e = e.nextSibling) != null)
		this.refreshTiddler(e.getAttribute("tiddler"),e.getAttribute("template"),true);
};

Story.prototype.onTiddlerMouseOver = function(e)
{
	if(window.addClass instanceof Function)
		addClass(this,"selected");
};

Story.prototype.onTiddlerMouseOut = function(e)
{
	if(window.removeClass instanceof Function)
		removeClass(this,"selected");
};

Story.prototype.onTiddlerDblClick = function(ev)
{
	var e = ev ? ev : window.event;
	var theTarget = resolveTarget(e);
	if(theTarget && theTarget.nodeName.toLowerCase() != "input" && theTarget.nodeName.toLowerCase() != "textarea") {
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if(e.stopPropagation) e.stopPropagation();
		return true;
	} else {
		return false;
	}
};

Story.prototype.onTiddlerKeyPress = function(ev)
{
	var e = ev ? ev : window.event;
	clearMessage();
	var consume = false;
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode) {
		case 9: // Tab
			if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea") {
				replaceSelection(target,String.fromCharCode(9));
				consume = true;
			}
			if(config.isOpera) {
				target.onblur = function() {
					this.focus();
					this.onblur = null;
				};
			}
			break;
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
		case 77: // Ctrl-Enter is "M" on some platforms
			if(e.ctrlKey) {
				blurElement(this);
				config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
				consume = true;
			}
			break;
		case 27: // Escape
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
			consume = true;
			break;
	}
	e.cancelBubble = consume;
	if(consume) {
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
	}
	return !consume;
};

Story.prototype.getTiddlerField = function(title,field)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	var e = null;
	if(tiddlerElem != null) {
		var children = tiddlerElem.getElementsByTagName("*");
		for(var t=0; t<children.length; t++) {
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea") {
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
			}
		}
	}
	return e;
};

Story.prototype.focusTiddler = function(title,field)
{
	var e = this.getTiddlerField(title,field);
	if(e) {
		e.focus();
		e.select();
	}
};

Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null && tiddlerElem.focus && tiddlerElem.blur) {
		tiddlerElem.focus();
		tiddlerElem.blur();
	}
};

Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
	var c = story.getTiddlerField(title,field);

	var tags = c.value.readBracketedList();
	tags.setItem(tag,mode);
	c.value = String.encodeTiddlyLinkList(tags);
};

Story.prototype.setTiddlerTag = function(title,tag,mode)
{
	Story.prototype.setTiddlerField(title,tag,mode,"tags");
};

Story.prototype.closeTiddler = function(title,animate,unused)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null) {
		clearMessage();
		this.scrubTiddler(tiddlerElem);
		if(config.options.chkAnimate && animate && anim && typeof Slider == "function")
			anim.startAnimating(new Slider(tiddlerElem,false,null,"all"));
		else {
			removeNode(tiddlerElem);
			forceReflow();
		}
	}
};

Story.prototype.scrubTiddler = function(tiddlerElem)
{
	tiddlerElem.id = null;
};

Story.prototype.setDirty = function(title,dirty)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
};

Story.prototype.isDirty = function(title)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		return tiddlerElem.getAttribute("dirty") == "true";
	return null;
};

Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title,element) {
		if(this.isDirty(title))
			r = true;
	});
	return r;
};

Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
	});
	window.scrollTo(0,ensureVisible(this.container));
};

Story.prototype.isEmpty = function()
{
	var place = document.getElementById(this.container);
	return place && place.firstChild == null;
};

Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ?	 text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	var titles = [];
	for(var t=0;t<matches.length;t++)
		titles.push(matches[t].title);
	this.displayTiddlers(null,titles);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([titles.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
};

Story.prototype.findContainingTiddler = function(e)
{
	while(e && !hasClass(e,"tiddler"))
		e = e.parentNode;
	return e;
};

Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute) {
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");
		if(e.hasChildNodes()) {
			var c = e.childNodes;
			for(var t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields);
		}
	}
};

Story.prototype.hasChanges = function(title)
{
	var e = document.getElementById(this.idPrefix + title);
	if(e != null) {
		var fields = {};
		this.gatherSaveFields(e,fields);
		var tiddler = store.fetchTiddler(title);
		if(!tiddler)
			return false;
		for(var n in fields) {
			if(store.getValue(title,n) != fields[n])
				return true;
		}
	}
	return false;
};

Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null) {
		var fields = {};
		this.gatherSaveFields(tiddlerElem,fields);
		var newTitle = fields.title ? fields.title : title;
		if(store.tiddlerExists(newTitle) && newTitle != title) {
			if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				return null;
		}
		if(newTitle != title)
			this.closeTiddler(newTitle,false);
		tiddlerElem.id = this.idPrefix + newTitle;
		tiddlerElem.setAttribute("tiddler",newTitle);
		tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
		tiddlerElem.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		if(!store.tiddlerExists(newTitle))
			minorUpdate = false;
		var newDate = new Date();
		var extendedFields = store.tiddlerExists(newTitle) ? store.fetchTiddler(newTitle).fields : (newTitle!=title && store.tiddlerExists(title) ? store.fetchTiddler(title).fields : {});
		for(var n in fields) {
			if(!TiddlyWiki.isStandardField(n))
				extendedFields[n] = fields[n];
		}
		var tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields);
		autoSaveChanges(null,[tiddler]);
		return newTitle;
	}
	return null;
};

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
	});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
};

//--
//-- Backstage
//--

var backstage = {
	area: null,
	toolbar: null,
	button: null,
	showButton: null,
	hideButton: null,
	cloak: null,
	panel: null,
	panelBody: null,
	panelFooter: null,
	currTabName: null,
	currTabElem: null,
	content: null,

	init: function() {
		var cmb = config.messages.backstage;
		this.area = document.getElementById("backstageArea");
		this.toolbar = document.getElementById("backstageToolbar");
		this.button = document.getElementById("backstageButton");
		this.button.style.display = "block";
		var t = cmb.open.text + " " + glyph("bentArrowLeft");
		this.showButton = createTiddlyButton(this.button,t,cmb.open.tooltip,
						function (e) {backstage.show(); return false;},null,"backstageShow");
		t = glyph("bentArrowRight") + " " + cmb.close.text;
		this.hideButton = createTiddlyButton(this.button,t,cmb.close.tooltip,
						function (e) {backstage.hide(); return false;},null,"backstageHide");
		this.cloak = document.getElementById("backstageCloak");
		this.panel = document.getElementById("backstagePanel");
		this.panelFooter = createTiddlyElement(this.panel,"div",null,"backstagePanelFooter");
		this.panelBody = createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
		this.cloak.onmousedown = function(e) {
			backstage.switchTab(null);
		};
		createTiddlyText(this.toolbar,cmb.prompt);
		for(t=0; t<config.backstageTasks.length; t++) {
			var taskName = config.backstageTasks[t];
			var task = config.tasks[taskName];
			var handler = task.action ? this.onClickCommand : this.onClickTab;
			var text = task.text + (task.action ? "" : glyph("downTriangle"));
			var btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,"backstageTab");
			btn.setAttribute("task",taskName);
			addClass(btn,task.action ? "backstageAction" : "backstageTask");
			}
		this.content = document.getElementById("contentWrapper");
		if(config.options.chkBackstage)
			this.show();
		else
			this.hide();
	},

	isVisible: function () {
		return this.area ? this.area.style.display == "block" : false;
	},

	show: function() {
		this.area.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.toolbar.style.left = findWindowWidth() + "px";
			var p = [
				{style: "left", start: findWindowWidth(), end: 0, template: "%0px"}
			];
			anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));
		} else {
			backstage.area.style.left = "0px";
		}
		this.showButton.style.display = "none";
		this.hideButton.style.display = "block";
		config.options.chkBackstage = true;
		saveOptionCookie("chkBackstage");
		addClass(this.content,"backstageVisible");
	},

	hide: function() {
		if(this.currTabElem) {
			this.switchTab(null);
		} else {
			backstage.toolbar.style.left = "0px";
			if(anim && config.options.chkAnimate) {
				var p = [
					{style: "left", start: 0, end: findWindowWidth(), template: "%0px"}
				];
				var c = function(element,properties) {backstage.area.style.display = "none";};
				anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));
			} else {
				this.area.style.display = "none";
			}
			this.showButton.style.display = "block";
			this.hideButton.style.display = "none";
			config.options.chkBackstage = false;
			saveOptionCookie("chkBackstage");
			removeClass(this.content,"backstageVisible");
		}
	},

	onClickCommand: function(e) {
		var task = config.tasks[this.getAttribute("task")];
		displayMessage(task);
		if(task.action) {
			backstage.switchTab(null);
			task.action();
		}
		return false;
	},

	onClickTab: function(e) {
		backstage.switchTab(this.getAttribute("task"));
		return false;
	},

	// Switch to a given tab, or none if null is passed
	switchTab: function(tabName) {
		var tabElem = null;
		var e = this.toolbar.firstChild;
		while(e)
			{
			if(e.getAttribute && e.getAttribute("task") == tabName)
				tabElem = e;
			e = e.nextSibling;
			}
		if(tabName == backstage.currTabName)
			return;
		if(backstage.currTabElem) {
			removeClass(this.currTabElem,"backstageSelTab");
		}
		if(tabElem && tabName) {
			backstage.preparePanel();
			addClass(tabElem,"backstageSelTab");
			var task = config.tasks[tabName];
			wikify(task.content,backstage.panelBody,null,null);
			backstage.showPanel();
		} else if(backstage.currTabElem) {
			backstage.hidePanel();
		}
		backstage.currTabName = tabName;
		backstage.currTabElem = tabElem;
	},

	isPanelVisible: function() {
		return backstage.panel ? backstage.panel.style.display == "block" : false;
	},

	preparePanel: function() {
		backstage.cloak.style.height = findWindowHeight() + "px";
		backstage.cloak.style.display = "block";
		removeChildren(backstage.panelBody);
		return backstage.panelBody;
	},

	showPanel: function() {
		backstage.panel.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.panel.style.top = (-backstage.panel.offsetHeight) + "px";
			var p = [
				{style: "top", start: -backstage.panel.offsetHeight, end: 0, template: "%0px"}
			];
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));
		} else {
			backstage.panel.style.top = "0px";
		}
		return backstage.panelBody;
	},

	hidePanel: function() {
		backstage.currTabName = null;
		backstage.currTabElem = null;
		if(anim && config.options.chkAnimate) {
			var p = [
				{style: "top", start: 0, end: -(backstage.panel.offsetHeight), template: "%0px"},
				{style: "display", atEnd: "none"}
			];
			var c = function(element,properties) {backstage.cloak.style.display = "none";};
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));
		 } else {
			backstage.panel.style.display = "none";
			backstage.cloak.style.display = "none";
		}
	}
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var backstageTask = config.tasks[params[0]];
	if(backstageTask)
		createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;});
};

//--
//-- ImportTiddlers macro
//--

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(readOnly) {
		createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
		return;
	}
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	this.restart(w);
};

config.macros.importTiddlers.onCancel = function(e)
{
	var wizard = new Wizard(this);
	var place = wizard.clear();
	config.macros.importTiddlers.restart(wizard);
	return false;
};

config.macros.importTiddlers.restart = function(wizard)
{
	wizard.addStep(this.step1Title,this.step1Html);
	var s = wizard.getElement("selTypes");
	for(var t in config.adaptors) {
		var e = createTiddlyElement(s,"option",null,null,t);
		e.value = t;
	}
	s = wizard.getElement("selFeeds");
	var feeds = this.getFeeds();
	for(t in feeds) {
		e = createTiddlyElement(s,"option",null,null,t);
		e.value = t;
	}
	wizard.setValue("feeds",feeds);
	s.onchange = config.macros.importTiddlers.onFeedChange;
	var fileInput = wizard.getElement("txtBrowse");
	fileInput.onchange = config.macros.importTiddlers.onBrowseChange;
	fileInput.onkeyup = config.macros.importTiddlers.onBrowseChange;
	wizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: config.macros.importTiddlers.onOpen}]);
};

config.macros.importTiddlers.getFeeds = function()
{
	var feeds = {};
	var tagged = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<tagged.length; t++) {
		var title = tagged[t].title;
		var serverType = store.getTiddlerSlice(title,"Type");
		if(!serverType)
			serverType = "file";
		feeds[title] = {title: title,
						url: store.getTiddlerSlice(title,"URL"),
						workspace: store.getTiddlerSlice(title,"Workspace"),
						workspaceList: store.getTiddlerSlice(title,"WorkspaceList"),
						tiddlerFilter: store.getTiddlerSlice(title,"TiddlerFilter"),
						serverType: serverType,
						description: store.getTiddlerSlice(title,"Description")};
	}
	return feeds;
};

config.macros.importTiddlers.onFeedChange = function(e)
{
	var wizard = new Wizard(this);
	var selTypes = wizard.getElement("selTypes");
	var fileInput = wizard.getElement("txtPath");
	var feeds = wizard.getValue("feeds");
	var f = feeds[this.value];
	if(f) {
		selTypes.value = f.serverType;
		fileInput.value = f.url;
		this.selectedIndex = 0;
		wizard.setValue("feedName",f.serverType);
		wizard.setValue("feedHost",f.url);
		wizard.setValue("feedWorkspace",f.workspace);
		wizard.setValue("feedWorkspaceList",f.workspaceList);
		wizard.setValue("feedTiddlerFilter",f.tiddlerFilter);
	}
	return false;
};

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	fileInput.value = "file://" + this.value;
	var serverType = wizard.getElement("selTypes");
	serverType.value = "file";
	return false;
};

config.macros.importTiddlers.onOpen = function(e)
{
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	var url = fileInput.value;
	var serverType = wizard.getElement("selTypes").value;
	var adaptor = new config.adaptors[serverType];
	wizard.setValue("adaptor",adaptor);
	wizard.setValue("serverType",serverType);
	wizard.setValue("host",url);
	var context = {};
	var ret = adaptor.openHost(url,context,wizard,config.macros.importTiddlers.onOpenHost);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenHost);
	return false;
};

config.macros.importTiddlers.onOpenHost = function(context,wizard)
{
	var adaptor = wizard.getValue("adaptor");
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenHost: " + context.statusText);
	var ret = adaptor.getWorkspaceList(context,wizard,config.macros.importTiddlers.onGetWorkspaceList);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetWorkspaceList);
};

config.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)
{
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetWorkspaceList: " + context.statusText);
	wizard.addStep(config.macros.importTiddlers.step2Title,config.macros.importTiddlers.step2Html);
	var s = wizard.getElement("selWorkspace");
	s.onchange = config.macros.importTiddlers.onWorkspaceChange;
	for(var t=0; t<context.workspaces.length; t++) {
		var e = createTiddlyElement(s,"option",null,null,context.workspaces[t].title);
		e.value = context.workspaces[t].title;
	}
	var workspaceList = wizard.getValue("feedWorkspaceList");
	if(workspaceList) {
		var list = workspaceList.parseParams("workspace",null,false,true);
		for(var n=1; n<list.length; n++) {
			if(context.workspaces.findByField("title",list[n].value) == null) {
				e = createTiddlyElement(s,"option",null,null,list[n].value);
				e.value = list[n].value;
			}
		}
	}
	var workspace = wizard.getValue("feedWorkspace");
	if(workspace) {
		t = wizard.getElement("txtWorkspace");
		t.value = workspace;
	}
	wizard.setButtons([{caption: config.macros.importTiddlers.openLabel, tooltip: config.macros.importTiddlers.openPrompt, onClick: config.macros.importTiddlers.onChooseWorkspace}]);
};

config.macros.importTiddlers.onWorkspaceChange = function(e)
{
	var wizard = new Wizard(this);
	var t = wizard.getElement("txtWorkspace");
	t.value  = this.value;
	this.selectedIndex = 0;
	return false;
};

config.macros.importTiddlers.onChooseWorkspace = function(e)
{
	var wizard = new Wizard(this);
	var adaptor = wizard.getValue("adaptor");
	var workspace = wizard.getElement("txtWorkspace").value;
	wizard.setValue("workspace",workspace);
	var context = {};
	var ret = adaptor.openWorkspace(workspace,context,wizard,config.macros.importTiddlers.onOpenWorkspace);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenWorkspace);
	return false;
};

config.macros.importTiddlers.onOpenWorkspace = function(context,wizard)
{
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenWorkspace: " + context.statusText);
	var adaptor = wizard.getValue("adaptor");
	var ret = adaptor.getTiddlerList(context,wizard,config.macros.importTiddlers.onGetTiddlerList,wizard.getValue("feedTiddlerFilter"));
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetTiddlerList);
};

config.macros.importTiddlers.onGetTiddlerList = function(context,wizard)
{
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetTiddlerList: " + context.statusText);
	// Extract data for the listview
	var listedTiddlers = [];
	if(context.tiddlers) {
		for(var n=0; n<context.tiddlers.length; n++) {
			var tiddler = context.tiddlers[n];
			listedTiddlers.push({
				title: tiddler.title,
				modified: tiddler.modified,
				modifier: tiddler.modifier,
				text: tiddler.text ? wikifyPlainText(tiddler.text,100) : "",
				tags: tiddler.tags,
				size: tiddler.text ? tiddler.text.length : 0,
				tiddler: tiddler
			});
		}
	}
	listedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	// Display the listview
	wizard.addStep(config.macros.importTiddlers.step3Title,config.macros.importTiddlers.step3Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	var listView = ListView.create(listWrapper,listedTiddlers,config.macros.importTiddlers.listViewTemplate);
	wizard.setValue("listView",listView);
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler");
	txtSaveTiddler.value = config.macros.importTiddlers.generateSystemServerName(wizard);
	wizard.setButtons([
			{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel},
			{caption: config.macros.importTiddlers.importLabel, tooltip: config.macros.importTiddlers.importPrompt, onClick:  config.macros.importTiddlers.doImport}
		]);
};

config.macros.importTiddlers.generateSystemServerName = function(wizard)
{
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var pattern = config.macros.importTiddlers[workspace ? "systemServerNamePattern" : "systemServerNamePatternNoWorkspace"];
	return pattern.format([serverType,host,workspace]);
};

config.macros.importTiddlers.saveServerTiddler = function(wizard)
{
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler").value;
	if(store.tiddlerExists(txtSaveTiddler)) {
		if(!confirm(config.macros.importTiddlers.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))
			return;
		store.suspendNotifications();
		store.removeTiddler(txtSaveTiddler);
		store.resumeNotifications();
	}
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var text = config.macros.importTiddlers.serverSaveTemplate.format([serverType,host,workspace]);
	store.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,config.macros.importTiddlers.serverSaveModifier,new Date(),["systemServer"]);
};

config.macros.importTiddlers.doImport = function(e)
{
	var wizard = new Wizard(this);
	if(wizard.getElement("chkSave").checked)
		config.macros.importTiddlers.saveServerTiddler(wizard);
	var chkSync = wizard.getElement("chkSync").checked;
	wizard.setValue("sync",chkSync);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	var adaptor = wizard.getValue("adaptor");
	var overwrite = new Array();
	var t;
	for(t=0; t<rowNames.length; t++) {
		if(store.tiddlerExists(rowNames[t]))
			overwrite.push(rowNames[t]);
	}
	if(overwrite.length > 0) {
		if(!confirm(config.macros.importTiddlers.confirmOverwriteText.format([overwrite.join(", ")])))
			return false;
	}
	wizard.addStep(config.macros.importTiddlers.step4Title.format([rowNames.length]),config.macros.importTiddlers.step4Html);
	for(t=0; t<rowNames.length; t++) {
		var link = document.createElement("div");
		createTiddlyLink(link,rowNames[t],true);
		var place = wizard.getElement("markReport");
		place.parentNode.insertBefore(link,place);
	}
	wizard.setValue("remainingImports",rowNames.length);
	wizard.setButtons([
			{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}
		],config.macros.importTiddlers.statusDoingImport);
	for(t=0; t<rowNames.length; t++) {
		var context = {};
		context.allowSynchronous = true;
		var inbound = adaptor.getTiddler(rowNames[t],context,wizard,config.macros.importTiddlers.onGetTiddler);
	}
	return false;
};

config.macros.importTiddlers.onGetTiddler = function(context,wizard)
{
	if(!context.status)
		displayMessage("Error in importTiddlers.onGetTiddler: " + context.statusText);
	var tiddler = context.tiddler;
	store.suspendNotifications();
	store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
	if(!wizard.getValue("sync")) {
		store.setValue(tiddler.title,'server',null);
	}
	store.resumeNotifications();
	if(!context.isSynchronous)
		store.notify(tiddler.title,true);
	var remainingImports = wizard.getValue("remainingImports")-1;
	wizard.setValue("remainingImports",remainingImports);
	if(remainingImports == 0) {
		if(context.isSynchronous) {
			store.notifyAll();
			refreshDisplay();
		}
		wizard.setButtons([
				{caption: config.macros.importTiddlers.doneLabel, tooltip: config.macros.importTiddlers.donePrompt, onClick: config.macros.importTiddlers.onCancel}
			],config.macros.importTiddlers.statusDoneImport);
		autoSaveChanges();
	}
};

//--
//-- Sync macro
//--

// Synchronisation handlers
config.syncers = {};

// Sync state.
var currSync = null;

// sync macro
config.macros.sync.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!wikifier.isStatic)
		this.startSync(place);
};

config.macros.sync.startSync = function(place)
{
	if(currSync)
		config.macros.sync.cancelSync();
	currSync = {};
	currSync.syncList = this.getSyncableTiddlers();
	this.createSyncTasks();
	this.preProcessSyncableTiddlers();
	var wizard = new Wizard();
	currSync.wizard = wizard;
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	currSync.listView = ListView.create(listWrapper,currSync.syncList,this.listViewTemplate);
	this.processSyncableTiddlers();
	wizard.setButtons([
			{caption: this.syncLabel, tooltip: this.syncPrompt, onClick: this.doSync}
		]);
};

config.macros.sync.getSyncableTiddlers = function ()
{
	var list = [];
	store.forEachTiddler(function(title,tiddler) {
		var syncItem = {};
		syncItem.serverType = tiddler.getServerType();
		syncItem.serverHost = tiddler.fields['server.host'];
		syncItem.serverWorkspace = tiddler.fields['server.workspace'];
		syncItem.tiddler = tiddler;
		syncItem.title = tiddler.title;
		syncItem.isTouched = tiddler.isTouched();
		syncItem.selected = syncItem.isTouched;
		syncItem.syncStatus = config.macros.sync.syncStatusList[syncItem.isTouched ? "changedLocally" : "none"];
		syncItem.status = syncItem.syncStatus.text;
		if(syncItem.serverType && syncItem.serverHost)
			list.push(syncItem);
		});
	list.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	return list;
};

config.macros.sync.preProcessSyncableTiddlers = function()
{
	for(var t=0; t<currSync.syncList.length; t++) {
		si = currSync.syncList[t];
		var ti = si.syncTask.syncMachine.generateTiddlerInfo(si.tiddler);
		si.serverUrl = ti.uri;
	}
};

config.macros.sync.processSyncableTiddlers = function()
{
	for(var t=0; t<currSync.syncList.length; t++) {
		si = currSync.syncList[t];
		si.rowElement.style.backgroundColor = si.syncStatus.color;
	}
};

config.macros.sync.createSyncTasks = function()
{
	currSync.syncTasks = [];
	for(var t=0; t<currSync.syncList.length; t++) {
		var si = currSync.syncList[t];
		var r = null;
		for(var st=0; st<currSync.syncTasks.length; st++) {
			var cst = currSync.syncTasks[st];
			if(si.serverType == cst.serverType && si.serverHost == cst.serverHost && si.serverWorkspace == cst.serverWorkspace)
				r = cst;
		}
		if(r == null) {
			si.syncTask = this.createSyncTask(si);
			currSync.syncTasks.push(si.syncTask);
		} else {
			si.syncTask = r;
			r.syncItems.push(si);
		}
	}
};

config.macros.sync.createSyncTask = function(syncItem)
{
	var st = {};
	st.serverType = syncItem.serverType;
	st.serverHost = syncItem.serverHost;
	st.serverWorkspace = syncItem.serverWorkspace;
	st.syncItems = [syncItem];
	st.syncMachine = new SyncMachine(st.serverType,{
		start: function() {
			return this.openHost(st.serverHost,"openWorkspace");
		},
		openWorkspace: function() {
			return this.openWorkspace(st.serverWorkspace,"getTiddlerList");
		},
		getTiddlerList: function() {
			return this.getTiddlerList("gotTiddlerList");
		},
		gotTiddlerList: function(tiddlers) {
			for(var t=0; t<st.syncItems.length; t++) {
				var si = st.syncItems[t];
				var f = tiddlers.findByField("title",si.title);
				if(f !== null) {
					if(tiddlers[f].fields['server.page.revision'] > si.tiddler.fields['server.page.revision']) {
						si.syncStatus = config.macros.sync.syncStatusList[si.isTouched ? 'changedBoth' : 'changedServer'];
					}
				} else {
					si.syncStatus = config.macros.sync.syncStatusList.notFound;
				}
				config.macros.sync.updateSyncStatus(si);
			}
		},
		getTiddler: function(title) {
			return this.getTiddler(title,"onGetTiddler");
		},
		onGetTiddler: function(tiddler) {
			var syncItem = st.syncItems.findByField("title",tiddler.title);
			if(syncItem !== null) {
				syncItem = st.syncItems[syncItem];
				store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
				syncItem.syncStatus = config.macros.sync.syncStatusList.gotFromServer;
				config.macros.sync.updateSyncStatus(syncItem);
			}
		},
		putTiddler: function(tiddler) {
			return this.putTiddler(tiddler,"onPutTiddler");
		},
		onPutTiddler: function(tiddler) {
			var syncItem = st.syncItems.findByField("title",tiddler.title);
			if(syncItem !== null) {
				syncItem = st.syncItems[syncItem];
				store.resetTiddler(tiddler.title);
				syncItem.syncStatus = config.macros.sync.syncStatusList.putToServer;
				config.macros.sync.updateSyncStatus(syncItem);
			}
		}
	});
	st.syncMachine.go();
	return st;
};

config.macros.sync.updateSyncStatus = function(syncItem)
{
	var e = syncItem.colElements["status"];
	removeChildren(e);
	createTiddlyText(e,syncItem.syncStatus.text);
	syncItem.rowElement.style.backgroundColor = syncItem.syncStatus.color;
};

config.macros.sync.doSync = function(e)
{
	var rowNames = ListView.getSelectedRows(currSync.listView);
	for(var t=0; t<currSync.syncList.length; t++) {
		var si = currSync.syncList[t];
		if(rowNames.indexOf(si.title) != -1) {
			config.macros.sync.doSyncItem(si);
		}
	}
	return false;
};

config.macros.sync.doSyncItem = function(syncItem)
{
	var r = true;
	var sl = config.macros.sync.syncStatusList;
	switch(syncItem.syncStatus) {
		case sl.changedServer:
			r = syncItem.syncTask.syncMachine.go("getTiddler",syncItem.title);
			break;
		case sl.notFound:
		case sl.changedLocally:
		case sl.changedBoth:
			r = syncItem.syncTask.syncMachine.go("putTiddler",syncItem.tiddler);
			break;
		default:
			break;
	}
	if(r !== true)
		displayMessage("Error in doSyncItem: " + r);
};

config.macros.sync.cancelSync = function()
{
	currSync = null;
};

function SyncMachine(serverType,steps)
{
	this.serverType = serverType;
	this.adaptor = new config.adaptors[serverType];
	this.steps = steps;
}

SyncMachine.prototype.go = function(step,varargs)
{
	if(!step)
		step = "start";
	var h = this.steps[step];
	if(!h)
		return null;
	var a = [];
	for(var t=1; t<arguments.length; t++)
		a.push(arguments[t]);
	var r = h.apply(this,a);
	if(typeof r == "string")
		this.invokeError(r);
	return r;
};

SyncMachine.prototype.invokeError = function(message)
{
	if(this.steps.error)
		this.steps.error(message);
};

SyncMachine.prototype.openHost = function(host,nextStep)
{
	var me = this;
	return me.adaptor.openHost(host,null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep);
	});
};

SyncMachine.prototype.getWorkspaceList = function(nextStep)
{
	var me = this;
	return me.adaptor.getWorkspaceList(null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep,context.workspaces);
	});
};

SyncMachine.prototype.openWorkspace = function(workspace,nextStep)
{
	var me = this;
	return me.adaptor.openWorkspace(workspace,null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep);
	});
};

SyncMachine.prototype.getTiddlerList = function(nextStep)
{
	var me = this;
	return me.adaptor.getTiddlerList(null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep,context.tiddlers);
	});
};

SyncMachine.prototype.generateTiddlerInfo = function(tiddler)
{
	return this.adaptor.generateTiddlerInfo(tiddler);
};

SyncMachine.prototype.getTiddler = function(title,nextStep)
{
	var me = this;
	return me.adaptor.getTiddler(title,null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep,context.tiddler);
	});
};

SyncMachine.prototype.putTiddler = function(tiddler,nextStep)
{
	var me = this;
	return me.adaptor.putTiddler(tiddler,null,null,function(context) {
		if(typeof context.status == "string")
			me.invokeError(context.status);
		else
			me.go(nextStep,tiddler);
	});
};

//--
//-- Manager UI for groups of tiddlers
//--

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	listWrapper.setAttribute("refresh","macro");
	listWrapper.setAttribute("macroName","plugins");
	listWrapper.setAttribute("params",paramString);
	this.refresh(listWrapper,paramString);
};

config.macros.plugins.refresh = function(listWrapper,params)
{
	var wizard = new Wizard(listWrapper);
	var selectedRows = [];
	ListView.forEachSelector(listWrapper,function(e,rowName) {
			if(e.checked)
				selectedRows.push(e.getAttribute("rowName"));
		});
	removeChildren(listWrapper);
	params = params.parseParams("anon");
	var plugins = installedPlugins.slice(0);
	var t,tiddler,p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(t=0; t<configTiddlers.length; t++) {
		tiddler = configTiddlers[t];
		if(plugins.findByField("title",tiddler.title) == null) {
			p = getPluginInfo(tiddler);
			p.executed = false;
			p.log.splice(0,0,this.skippedText);
			plugins.push(p);
		}
	}
	for(t=0; t<plugins.length; t++) {
		p = plugins[t];
		p.size = p.tiddler.text ? p.tiddler.text.length : 0;
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
	}
	if(plugins.length == 0) {
		createTiddlyElement(listWrapper,"em",null,null,this.noPluginText);
		wizard.setButtons([]);
	} else {
		var listView = ListView.create(listWrapper,plugins,this.listViewTemplate,this.onSelectCommand);
		wizard.setValue("listView",listView);
		wizard.setButtons([
				{caption: config.macros.plugins.removeLabel, tooltip: config.macros.plugins.removePrompt, onClick:  config.macros.plugins.doRemoveTag},
				{caption: config.macros.plugins.deleteLabel, tooltip: config.macros.plugins.deletePrompt, onClick:  config.macros.plugins.doDelete}
			]);
	}
};

config.macros.plugins.doRemoveTag = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		for(var t=0; t<rowNames.length; t++)
			store.setTiddlerTag(rowNames[t],false,"systemConfig");
	}
};

config.macros.plugins.doDelete = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")]))) {
			for(t=0; t<rowNames.length; t++) {
				store.removeTiddler(rowNames[t]);
				story.closeTiddler(rowNames[t],true);
			}
		}
	}
};

//--
//-- Message area
//--

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		return null;
	if(!msgArea.hasChildNodes())
		createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
			config.messages.messageClose.text,
			config.messages.messageClose.tooltip,
			clearMessage);
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
	var e = getMessageDiv();
	if(!e) {
		alert(text);
		return;
	}
	if(linkText) {
		var link = createTiddlyElement(e,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
	} else {
		e.appendChild(document.createTextNode(text));
	}
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea) {
		removeChildren(msgArea);
		msgArea.style.display = "none";
	}
	return false;
}

//--
//-- Refresh mechanism
//--

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		return true;
		},

	tiddler: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && changeList.indexOf(title) != -1 && !story.isDirty(title))
			story.refreshTiddler(title,template,true);
		else
			refreshElements(e,changeList);
		return true;
		},

	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		if(force != null || changeList == null || changeList.indexOf(title) != -1) {
			removeChildren(e);
			wikify(store.getTiddlerText(title,title),e,null);
			return true;
		} else
			return false;
		},

	macro: function(e,changeList)
		{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e,params);
		return true;
		}
};

function refreshElements(root,changeList)
{
	var nodes = root.childNodes;
	for(var c=0; c<nodes.length; c++) {
		var e = nodes[c], type = null;
		if(e.getAttribute  && (e.tagName ? e.tagName != "IFRAME" : true))
			type = e.getAttribute("refresh");
		var refresher = config.refreshers[type];
		var refreshed = false;
		if(refresher != undefined)
			refreshed = refresher(e,changeList);
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e,changeList);
	}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e) {
		var nextChild = e.nextSibling;
		if(e.getAttribute) {
			var macro = e.getAttribute("macro");
			if(macro) {
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1) {
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
				}
				invokeMacro(e,macro,params,null,tiddler);
			}
		}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
	}
}

function refreshPageTemplate(title)
{
	var stash = createTiddlyElement(document.body,"div");
	stash.style.display = "none";
	var display = document.getElementById("tiddlerDisplay");
	var nodes,t;
	if(display) {
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
	}
	var wrapper = document.getElementById("contentWrapper");
	if(!title)
		title = "PageTemplate";
	var html = store.getRecursiveTiddlerText(title,null,10);
	wrapper.innerHTML = html;
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = document.getElementById("tiddlerDisplay");
	removeChildren(display);
	if(!display)
		display = createTiddlyElement(wrapper,"div","tiddlerDisplay");
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	removeNode(stash);
}

function refreshDisplay(hint)
{
	if(typeof hint == "string")
		hint = [hint];
	var e = document.getElementById("contentWrapper");
	refreshElements(e,hint);
	if(backstage.isPanelVisible()) {
		e = document.getElementById("backstage");
		refreshElements(e,hint);
	}
}

function refreshPageTitle()
{
	document.title = getPageTitle();
}

function getPageTitle()
{
	var st = wikifyPlain("SiteTitle");
	var ss = wikifyPlain("SiteSubtitle");
	return st + ((st == "" || ss == "") ? "" : " - ") + ss;
}

function refreshStyles(title,doc)
{
	if(!doc)
		doc = document;
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title,doc);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles("StyleSheet");
	refreshStyles("StyleSheetPrint");
}

//--
//-- Options cookie stuff
//--

config.optionHandlers = {
	'txt': {
		get: function(name) {return encodeCookie(config.options[name].toString());},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	},
	'chk': {
		get: function(name) {return config.options[name] ? "true" : "false";},
		set: function(name,value) {config.options[name] = value == "true";}
	}
};

function loadOptionsCookie()
{
	if(safeMode)
		return;
	var cookies = document.cookie.split(";");
	for(var c=0; c<cookies.length; c++) {
		var p = cookies[c].indexOf("=");
		if(p != -1) {
			var name = cookies[c].substr(0,p).trim();
			var value = cookies[c].substr(p+1).trim();
			var optType = name.substr(0,3);
			if(config.optionHandlers[optType] && config.optionHandlers[optType].set)
				config.optionHandlers[optType].set(name,value);
		}
	}
}

function saveOptionCookie(name)
{
	if(safeMode)
		return;
	var c = name + "=";
	var optType = name.substr(0,3);
	if(config.optionHandlers[optType] && config.optionHandlers[optType].get)
		c += config.optionHandlers[optType].get(name);
	c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
	document.cookie = c;
}

function encodeCookie(s)
{
	return escape(manualConvertUnicodeToUTF8(s));
}

function decodeCookie(s)
{
	s = unescape(s);
	var re = /&#[0-9]{1,5};/g;
	return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,"")));});
}

//--
//-- Saving
//--

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
	}
}

function updateLanguageAttribute(s)
{
	if(config.locale) {
		var mRE = /(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/;
		var m = mRE.exec(s);
		if(m) {
			var t = m[1];
			if(m[2])
				t += ' xml:lang="' + config.locale + '"';
			if(m[3])
				t += ' lang="' + config.locale + '"';
			t += ">";
			s = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);
		}
	}
	return s;
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
	return s.replaceChunk(
			"<!--%0-START-->".format([blockName]),
			"<!--%0-END-->".format([blockName]),
			"\n" + store.getRecursiveTiddlerText(tiddlerName,"") + "\n");
}

function updateOriginal(original,posDiv)
{
	if(!posDiv)
		posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return null;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + "\n" +
				convertUnicodeToUTF8(store.allTiddlersAsHtml()) + "\n" +
				original.substr(posDiv[1]);
	var newSiteTitle = convertUnicodeToUTF8(getPageTitle()).htmlEncode();
	revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
	revised = updateLanguageAttribute(revised);
	revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
	revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
	revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
	revised = updateMarkupBlock(revised,"POST-SCRIPT","MarkupPostBody");
	return revised;
}

function locateStoreArea(original)
{
	// Locate the storeArea div's
	var posOpeningDiv = original.indexOf(startSaveArea);
	var limitClosingDiv = original.indexOf("<"+"!--POST-STOREAREA--"+">");
	if(limitClosingDiv == -1)
		limitClosingDiv = original.indexOf("<"+"!--POST-BODY-START--"+">");
	var posClosingDiv = original.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? original.length : limitClosingDiv);
	return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;
}

function autoSaveChanges(onlyIfDirty,tiddlers)
{
	if(config.options.chkAutoSave)
		saveChanges(onlyIfDirty,tiddlers);
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty,tiddlers)
{
	if(onlyIfDirty && !store.isDirty())
		return;
	clearMessage();
	// Get the URL of the document
	var originalPath = document.location.toString();
	// Check we were loaded from a file URL
	if(originalPath.substr(0,5) != "file:") {
		alert(config.messages.notFileUrlError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
	}
	var localPath = getLocalPath(originalPath);
	// Load the original file
	var original = loadFile(localPath);
	if(original == null) {
		alert(config.messages.cantSaveError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
	}
	// Locate the storeArea div's
	var posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return;
	}
	saveBackup(localPath,original);
	saveRss(localPath);
	saveEmpty(localPath,original,posDiv);
	saveMain(localPath,original,posDiv);
}

function saveBackup(localPath,original)
{
	// Save the backup
	if(config.options.chkSaveBackups) {
		var backupPath = getBackupPath(localPath);
		var backup = config.browser.isIE ? ieCopyFile(backupPath,localPath) : saveFile(backupPath,original);
		if(backup)
			displayMessage(config.messages.backupSaved,"file://" + backupPath);
		else
			alert(config.messages.backupFailed);
	}
}

function saveRss(localPath)
{
	if(config.options.chkGenerateAnRssFeed) {
		var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
		var rssSave = saveFile(rssPath,convertUnicodeToUTF8(generateRss()));
		if(rssSave)
			displayMessage(config.messages.rssSaved,"file://" + rssPath);
		else
			alert(config.messages.rssFailed);
	}
}

function saveEmpty(localPath,original,posDiv)
{
	if(config.options.chkSaveEmptyTemplate) {
		var emptyPath,p;
		if((p = localPath.lastIndexOf("/")) != -1)
			emptyPath = localPath.substr(0,p) + "/empty.html";
		else if((p = localPath.lastIndexOf("\\")) != -1)
			emptyPath = localPath.substr(0,p) + "\\empty.html";
		else
			emptyPath = localPath + ".empty.html";
		var empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);
		var emptySave = saveFile(emptyPath,empty);
		if(emptySave)
			displayMessage(config.messages.emptySaved,"file://" + emptyPath);
		else
			alert(config.messages.emptyFailed);
	}
}

function saveMain(localPath,original,posDiv)
{
	var save;
	try {
		var revised = updateOriginal(original,posDiv);
		save = saveFile(localPath,revised);
	} catch (ex) {
		showException(ex);
	}
	if(save) {
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
	} else {
		alert(config.messages.mainFailed);
	}
}

function getLocalPath(origPath)
{
	var originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath)
{
	var backSlash = true;
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1) {
		dirPathPos = localPath.lastIndexOf("/");
		backSlash = false;
	}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + (backSlash ? "\\" : "/") + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + "." + (new Date()).convertToYYYYMMDDHHMMSSMMM() + ".html";
	return backupPath;
}

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlain("SiteTitle").htmlEncode() + "</title" + ">");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlain("SiteSubtitle").htmlEncode() + "</description>");
	s.push("<language>en-us</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + version.major + "." + version.minor + "." + version.revision + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for (var t=tiddlers.length-1; t>=n; t--)
		s.push(tiddlers[t].saveToRss(u));
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

//--
//-- Filesystem code
//--

function convertUTF8ToUnicode(u)
{
	if(window.netscape == undefined)
		return manualConvertUTF8ToUnicode(u);
	else
		return mozConvertUTF8ToUnicode(u);
}

function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length) {
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80) {
			dst++;
		} else if(b1 < 0xE0) {
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		} else {
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		}
	}
	return uni;
}

function mozConvertUTF8ToUnicode(u)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUTF8ToUnicode(u);
	} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return (fin.length > 0) ? s+fin : s;
}

function convertUnicodeToUTF8(s)
{
	if(window.netscape == undefined)
		return manualConvertUnicodeToUTF8(s);
	else
		return mozConvertUnicodeToUTF8(s);
}

function manualConvertUnicodeToUTF8(s)
{
	var re = /[^\u0000-\u007F]/g ;
	return s.replace(re,function($0) {return "&#" + $0.charCodeAt(0).toString() + ";";});
}

function mozConvertUnicodeToUTF8(s)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUnicodeToUTF8(s);
	} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	if(fin.length > 0)
		return u + fin;
	else
		return u;
}

function convertUriToUTF8(uri,charSet)
{
	if(window.netscape == undefined || charSet == undefined || charSet == "")
		return uri;
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService);
	} catch(ex) {
		return uri;
	}
	return converter.convertURISpecToUTF8(uri,charSet);
}

function saveFile(fileUrl,content)
{
	var r = null;
	if(!r)
		r = mozillaSaveFile(fileUrl,content);
	if(!r)
		r = ieSaveFile(fileUrl,content);
	if(!r)
		r = javaSaveFile(fileUrl,content);
	return r;
}

function loadFile(fileUrl)
{
	var r = null;
	if((r == null) || (r == false))
		r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = javaLoadFile(fileUrl);
	return r;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath,content)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return true;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
	} catch(ex) {
		return null;
	}
	return content;
}

function ieCopyFile(dest,source)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		fso.GetFile(source).Copy(dest);
	} catch(ex) {
		return false;
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath,content)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				file.create(0,0664);
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file,0x20|0x02,00004,null);
			out.write(content,content.length);
			out.flush();
			out.close();
			return true;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				return null;
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file,0x01,00004,null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			return sInputStream.read(sInputStream.available());
		} catch(ex) {
			return false;
		}
	}
	return null;
}

function javaUrlToFilename(url)
{
	var f = "//localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	if(i > 0)
		return url.substring(i-1);
	return url;
}

function javaSaveFile(filePath,content)
{
	try {
		if(document.applets["TiddlySaver"])
			return document.applets["TiddlySaver"].saveFile(javaUrlToFilename(filePath),"UTF-8",content);
	} catch(ex) {
	}
	try {
		var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
		s.print(content);
		s.close();
	} catch(ex) {
		return null;
	}
	return true;
}

function javaLoadFile(filePath)
{
	try {
		if(document.applets["TiddlySaver"])
			return String(document.applets["TiddlySaver"].loadFile(javaUrlToFilename(filePath),"UTF-8"));
	} catch(ex) {
	}
	var content = [];
	try {
		var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
		var line;
		while((line = r.readLine()) != null)
			content.push(new String(line));
		r.close();
	} catch(ex) {
		return null;
	}
	return content.join("\n");
}

//--
//-- Server adaptor for talking to static files
//--

function FileAdaptor()
{
	this.host = null;
	this.store = null;
	return this;
}

FileAdaptor.NotLoadedError = "TiddlyWiki file has not been loaded";
FileAdaptor.serverType = 'file';

// Open the specified host/server
FileAdaptor.prototype.openHost = function(host,context,userParams,callback)
{
	this.host = host;
	if(!context)
		context = {};
	context.adaptor = this;
	context.callback = callback;
	context.userParams = userParams;
	var ret = loadRemoteFile(host,FileAdaptor.openHostCallback,context);
	return typeof(ret) == "string" ? ret : true;
};

FileAdaptor.openHostCallback = function(status,context,responseText,url,xhr)
{
	var adaptor = context.adaptor;
	context.status = status;
	if(!status) {
		context.statusText = "Error reading file: " + xhr.statusText;
	} else {
		// Load the content into a TiddlyWiki() object
		adaptor.store = new TiddlyWiki();
		if(!adaptor.store.importTiddlyWiki(responseText))
			context.statusText = config.messages.invalidFileError.format([url]);
	}
	context.callback(context,context.userParams);
};

// Gets the list of workspaces on a given server
FileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)
{
	if(!context)
		context = {};
	context.workspaces = [{title:"(default)"}];
	context.status = true;
	window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

// Open the specified workspace
FileAdaptor.prototype.openWorkspace = function(workspace,context,userParams,callback)
{
	if(!context)
		context = {};
	context.status = true;
	window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

// Gets the list of tiddlers within a given workspace
FileAdaptor.prototype.getTiddlerList = function(context,userParams,callback)
{
	if(!this.store)
		return FileAdaptor.NotLoadedError;
	if(!context)
		context = {};
	context.tiddlers = [];
	this.store.forEachTiddler(function(title,tiddler)
		{
		var t = new Tiddler(title);
		t.text = tiddler.text;
		t.modified = tiddler.modified;
		t.modifier = tiddler.modifier;
		t.fields['server.page.revision'] = tiddler.modified.convertToYYYYMMDDHHMM();
		t.tags = tiddler.tags;
		context.tiddlers.push(t);
		});
	context.status = true;
	window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)
{
	var info = {};
	info.uri = tiddler.fields['server.host'] + "#" + tiddler.title;
	return info;
};

// Retrieves a tiddler from a given workspace on a given server
FileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)
{
	if(!this.store)
		return FileAdaptor.NotLoadedError;
	if(!context)
		context = {};
	context.tiddler = this.store.fetchTiddler(title);
	if(context.tiddler) {
		context.tiddler.fields['server.type'] = FileAdaptor.serverType;
		context.tiddler.fields['server.host'] = this.host;
		context.tiddler.fields['server.page.revision'] = context.tiddler.modified.convertToYYYYMMDDHHMM();
	}
	context.status = true;
	if(context.allowSynchronous) {
		context.isSynchronous = true;
		callback(context,userParams);
	} else {
		window.setTimeout(function() {callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.close = function()
{
	delete this.store;
	this.store = null;
};

config.adaptors[FileAdaptor.serverType] = FileAdaptor;

//--
//-- Remote HTTP requests
//--

function loadRemoteFile(url,callback,params)
{
	return doHttp("GET",url,null,null,null,null,callback,params,null);
}

// HTTP status codes
var httpStatus = {
	OK: 200,
	ContentCreated: 201,
	NoContent: 204,
	Unauthorized: 401,
	Forbidden: 403,
	NotFound: 404,
	MethodNotAllowed: 405
};

function doHttp(type,url,data,contentType,username,password,callback,params,headers)
{
	// Get an xhr object
	var x = getXMLHttpRequest();
	if(!x)
		return "Can't create XMLHttpRequest object";
	// Install callback
	x.onreadystatechange = function() {
		if (x.readyState == 4 && callback && (x.status !== undefined)) {
			if([0, httpStatus.OK, httpStatus.ContentCreated, httpStatus.NoContent].contains(x.status))
				callback(true,params,x.responseText,url,x);
			else
				callback(false,params,null,url,x);
			x.onreadystatechange = function(){};
			x = null;
		}
	};
	// Send request
	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	try {
		url = url + (url.indexOf("?") < 0 ? "?" : "&") + "nocache=" + Math.random();
		x.open(type,url,true,username,password);
		if (data)
			x.setRequestHeader("Content-Type", contentType ? contentType : "application/x-www-form-urlencoded");
		if (x.overrideMimeType)
			x.setRequestHeader("Connection", "close");
		if(headers) {
			for(n in headers)
				x.setRequestHeader(n,headers[n]);
		}
		x.setRequestHeader("X-Requested-With", "TiddlyWiki " + version.major + "." + version.minor + "." + version.revision + (version.beta ? " (beta " + version.beta + ")" : ""));
		x.send(data);
	} catch (ex) {
		return exceptionText(ex);
	}
	return x;
}

function getXMLHttpRequest()
{
	try {
		var x = new XMLHttpRequest(); // Modern
	} catch(ex) {
		try {
			x = new ActiveXObject("Msxml2.XMLHTTP"); // IE 6
		} catch (ex2) {
			return null;
		}
	}
	return x;
}

//--
//-- TiddlyWiki-specific utility functions
//--

function createTiddlyButton(theParent,theText,theTooltip,theAction,theClass,theId,theAccessKey)
{
	var theButton = document.createElement("a");
	if(theAction) {
		theButton.onclick = theAction;
		theButton.setAttribute("href","javascript:;");
	}
	if(theTooltip)
		theButton.setAttribute("title",theTooltip);
	if(theText)
		theButton.appendChild(document.createTextNode(theText));
	if(theClass)
		theButton.className = theClass;
	else
		theButton.className = "button";
	if(theId)
		theButton.id = theId;
	if(theParent)
		theParent.appendChild(theButton);
	if(theAccessKey)
		theButton.setAttribute("accessKey",theAccessKey);
	return theButton;
}

function createTiddlyLink(place,title,includeText,theClass,isStatic,linkedFromTiddler,noToggle)
{
	var text = includeText ? title : null;
	var i = getTiddlyLinkInfo(title,theClass);
	var btn = isStatic ? createExternalLink(place,store.getTiddlerText("SiteUrl",null) + "#" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	if(noToggle)
		btn.setAttribute("noToggle","true");
	if(linkedFromTiddler) {
		var fields = linkedFromTiddler.getInheritedFields();
		if(fields)
			btn.setAttribute("tiddlyFields",fields);
	}
	return btn;
}

function refreshTiddlyLink(e,title)
{
	var i = getTiddlyLinkInfo(title,e.className);
	e.className = i.classes;
	e.title = i.subTitle;
}

function getTiddlyLinkInfo(title,currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler) {
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
	} else {
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title)) {
			subTitle = config.messages.shadowedTiddlerToolTip.format([title]);
			classes.pushUnique("shadow");
		} else {
			subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
			classes.remove("shadow");
		}
	}
	if(config.annotations[title])
		subTitle = config.annotations[title];
	return {classes: classes.join(" "),subTitle: subTitle};
}

function createExternalLink(place,url)
{
	var theLink = document.createElement("a");
	theLink.className = "externalLink";
	theLink.href = url;
	theLink.title = config.messages.externalLinkTooltip.format([url]);
	if(config.options.chkOpenInNewWindow)
		theLink.target = "_blank";
	place.appendChild(theLink);
	return theLink;
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(e)
{
	if(!e) e = window.event;
	var theTarget = resolveTarget(e);
	var theLink = theTarget;
	var title = null;
	var fields = null;
	var noToggle = null;
	do {
		title = theLink.getAttribute("tiddlyLink");
		fields = theLink.getAttribute("tiddlyFields");
		noToggle = theLink.getAttribute("noToggle");
		theLink = theLink.parentNode;
	} while(title == null && theLink != null);
	if(!store.isShadowTiddler(title)) {
		var f = fields ? fields.decodeHashMap() : {};
		fields = String.encodeHashMap(merge(f,config.defaultCustomFields,true));
	}
	if(title) {
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		if(noToggle)
			toggling = false;
		story.displayTiddler(theTarget,title,null,true,null,fields,toggling);
	}
	clearMessage();
	return false;
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler)
{
	var theTag = createTiddlyButton(place,tag,config.views.wikified.tag.tooltip.format([tag]),onClickTag);
	theTag.setAttribute("tag",tag);
	if(excludeTiddler)
		theTag.setAttribute("tiddler",excludeTiddler);
	return theTag;
}

// Event handler for clicking on a tiddler tag
function onClickTag(ev)
{
	var e = ev ? ev : window.event;
	var popup = Popup.create(this);
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag) {
		var tagged = store.getTaggedTiddlers(tag);
		var titles = [];
		var li,r;
		for(r=0;r<tagged.length;r++) {
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		}
		var lingo = config.views.wikified.tag;
		if(titles.length > 0) {
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
			for(r=0; r<titles.length; r++) {
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
			}
		} else {
			createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),lingo.popupNone.format([tag]));
		}
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(ev)
{
	var e = ev ? ev : window.event;
	var tag = this.getAttribute("tag");
	var tagged = store.getTaggedTiddlers(tag);
	var titles = [];
	for(var t=0; t<tagged.length; t++)
		titles.push(tagged[t].title);
	story.displayTiddlers(this,titles);
	return false;
}

function onClickError(ev)
{
	var e = ev ? ev : window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	for(var t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyDropDown(place,onchange,options,defaultValue)
{
	var sel = createTiddlyElement(place,"select");
	sel.onchange = onchange;
	for(var t=0; t<options.length; t++) {
		var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
		e.value = options[t].name;
		if(options[t].name == defaultValue)
			e.selected = true;
	}
	return sel;
}

function createTiddlyPopup(place,caption,tooltip,tiddler)
{
	if(tiddler.text) {
		createTiddlyLink(place,caption,true);
		var btn = createTiddlyButton(place,glyph("downArrow"),tooltip,onClickTiddlyPopup,"tiddlerPopupButton");
		btn.tiddler = tiddler;
	} else {
		createTiddlyText(place,caption);
	}
}

function onClickTiddlyPopup(ev)
{
	var e = ev ? ev : window.event;
	var tiddler = this.tiddler;
	if(tiddler.text) {
		var popup = Popup.create(this,"div","popupTiddler");
		wikify(tiddler.text,popup,null,tiddler);
		Popup.show();
	}
	if(e) e.cancelBubble = true;
	if(e && e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if(text) btn.setAttribute("errorText",text);
}

function merge(dst,src,preserveExisting)
{
	for(p in src) {
		if(!preserveExisting || dst[p] === undefined)
			dst[p] = src[p];
	}
	return dst;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e,message)
{
	var s = e.description ? e.description : e.toString();
	return message ? "%0:\n%1".format([message,s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e,message)
{
	alert(exceptionText(e,message));
}

function alertAndThrow(m)
{
	alert(m);
	throw(m);
}

function glyph(name)
{
	var g = config.glyphs;
	var b = g.currBrowser;
	if(b == null) {
		b = 0;
		while(!g.browsers[b]() && b < g.browsers.length-1)
			b++;
		g.currBrowser = b;
	}
	if(!g.codes[name])
		return "";
	return g.codes[name][b];
}
//-
//- Animation engine
//-

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID = 0; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() // Variable number of arguments
{
	for(var t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0) {
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},10);
	}
	this.running += arguments.length;
};

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length) {
		var animation = me.animations[a];
		if(animation.tick()) {
			a++;
		} else {
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
		}
	}
};

// Map a 0..1 value to 0..1, but slow down at the start and end
Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
};

//--
//-- Morpher animation
//--

// Animate a set of properties of an element
function Morpher(element,duration,properties,callback)
{
	this.element = element;
	this.duration = duration;
	this.properties = properties;
	this.startTime = new Date();
	this.endTime = Number(this.startTime) + duration;
	this.callback = callback;
	this.tick();
	return this;
}

Morpher.prototype.assignStyle = function(element,style,value)
{
	switch(style) {
		case "-tw-vertScroll":
			window.scrollTo(findScrollX(),value);
			break;
		case "-tw-horizScroll":
			window.scrollTo(value,findScrollY());
			break;
		default:
			element.style[style] = value;
			break;
	}
};

Morpher.prototype.stop = function()
{
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.atEnd !== undefined) {
			this.assignStyle(this.element,p.style,p.atEnd);
		}
	}
	if(this.callback)
		this.callback(this.element,this.properties);
};

Morpher.prototype.tick = function()
{
	var currTime = Number(new Date());
	progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.start !== undefined && p.end !== undefined) {
			var template = p.template ? p.template : "%0";
			switch(p.format) {
				case undefined:
				case "style":
					var v = p.start + (p.end-p.start) * progress;
					this.assignStyle(this.element,p.style,template.format([v]));
					break;
				case "color":
					break;
			}
		}
	}
	if(currTime >= this.endTime) {
		this.stop();
		return false;
	}
	return true;
};

//--
//-- Zoomer animation
//--

function Zoomer(text,startElement,targetElement,unused)
{
	var e = createTiddlyElement(document.body,"div",null,"zoomer");
	createTiddlyElement(e,"div",null,null,text);
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	var p = [
		{style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},
		{style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},
		{style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},
		{style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},
		{style: 'fontSize', start: 8, end: 24, template: '%0pt'}
	];
	var c = function(element,properties) {removeNode(element);};
	return new Morpher(e,config.animDuration,p,c);
}

//--
//-- Scroller animation
//--

function Scroller(targetElement,unused)
{
	var p = [
		{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}
	];
	return new Morpher(targetElement,config.animDuration,p);
}

//--
//-- Slider animation
//--

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,unused,deleteMode)
{
	element.style.overflow = 'hidden';
	if(opening)
		element.style.height = '0px'; // Resolves a Firefox flashing bug
	element.style.display = 'block';
	var left = findPosX(element);
	var width = element.scrollWidth;
	var height = element.scrollHeight;
	var winWidth = findWindowWidth();
	var p = [];
	var c = null;
	if(opening) {
		p.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});
		p.push({style: 'opacity', start: 0, end: 1, template: '%0'});
		p.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});
	} else {
		p.push({style: 'height', start: height, end: 0, template: '%0px'});
		p.push({style: 'display', atEnd: 'none'});
		p.push({style: 'opacity', start: 1, end: 0, template: '%0'});
		p.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});
		switch(deleteMode) {
			case "all":
				c = function(element,properties) {removeNode(element);};
				break;
			case "children":
				c = function(element,properties) {removeChildren(element);};
				break;
		}
	}
	return new Morpher(element,config.animDuration,p,c);
}

//--
//-- Popup menu
//--

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root,elem,theClass)
{
	Popup.remove();
	var popup = createTiddlyElement(document.body,elem ? elem : "ol","popup",theClass ? theClass : "popup");
	Popup.stack.push({root: root, popup: popup});
	return popup;
};

Popup.onDocumentClick = function(ev)
{
	var e = ev ? ev : window.event;
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
};

Popup.show = function(unused1,unused2)
{
	var curr = Popup.stack[Popup.stack.length-1];
	this.place(curr.root,curr.popup);
	addClass(curr.root,"highlight");
	if(config.options.chkAnimate && anim && typeof Scroller == "function")
		anim.startAnimating(new Scroller(curr.popup));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
};

Popup.place = function(root,popup,offset)
{
	if(!offset) var offset = {x:0, y:0};
	var rootLeft = findPosX(root);
	var rootTop = findPosY(root);
	var rootHeight = root.offsetHeight;
	var popupLeft = rootLeft + offset.x;
	var popupTop = rootTop + rootHeight + offset.y;
	var winWidth = findWindowWidth();
	if(popup.offsetWidth > winWidth*0.75)
		popup.style.width = winWidth*0.75 + "px";
	var popupWidth = popup.offsetWidth;
	if(popupLeft + popupWidth > winWidth)
		popupLeft = winWidth - popupWidth;
	popup.style.left = popupLeft + "px";
	popup.style.top = popupTop + "px";
	popup.style.display = "block";
};

Popup.remove = function()
{
	if(Popup.stack.length > 0) {
		Popup.removeFrom(0);
	}
};

Popup.removeFrom = function(from)
{
	for(var t=Popup.stack.length-1; t>=from; t--) {
		var p = Popup.stack[t];
		removeClass(p.root,"highlight");
		removeNode(p.popup);
	}
	Popup.stack = Popup.stack.slice(0,from);
};

//--
//-- Wizard support
//--

function Wizard(elem)
{
	if(elem) {
		this.formElem = findRelated(elem,"wizard","className");
		this.bodyElem = findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling");
		this.footElem = findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling");
	} else {
		this.formElem = null;
		this.bodyElem = null;
		this.footElem = null;
	}
}

Wizard.prototype.setValue = function(name,value)
{
	if(this.formElem)
		this.formElem[name] = value;
};

Wizard.prototype.getValue = function(name)
{
	return this.formElem ? this.formElem[name] : null;
};

Wizard.prototype.createWizard = function(place,title)
{
	this.formElem = createTiddlyElement(place,"form",null,"wizard");
	createTiddlyElement(this.formElem,"h1",null,null,title);
	this.bodyElem = createTiddlyElement(this.formElem,"div",null,"wizardBody");
	this.footElem = createTiddlyElement(this.formElem,"div",null,"wizardFooter");
};

Wizard.prototype.clear = function()
{
	removeChildren(this.bodyElem);
};

Wizard.prototype.setButtons = function(buttonInfo,status)
{
	removeChildren(this.footElem);
	for(var t=0; t<buttonInfo.length; t++) {
		createTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);
		insertSpacer(this.footElem);
		}
	if(typeof status == "string") {
		createTiddlyElement(this.footElem,"span",null,"status",status);
	}
};

Wizard.prototype.addStep = function(stepTitle,html)
{
	removeChildren(this.bodyElem);
	var w = createTiddlyElement(this.bodyElem,"div");
	createTiddlyElement(w,"h2",null,null,stepTitle);
	var step = createTiddlyElement(w,"div",null,"wizardStep");
	step.innerHTML = html;
	applyHtmlMacros(step,tiddler);
};

Wizard.prototype.getElement = function(name)
{
	return this.formElem.elements[name];
};

//--
//-- ListView gadget
//--

var ListView = {};

// Create a listview
ListView.create = function(place,listObject,listTemplate,callback,className)
{
	var table = createTiddlyElement(place,"table",null,className ? className : "listView twtable");
	var thead = createTiddlyElement(table,"thead");
	var r = createTiddlyElement(thead,"tr");
	for(var t=0; t<listTemplate.columns.length; t++) {
		var columnTemplate = listTemplate.columns[t];
		var c = createTiddlyElement(r,"th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader)
			colType.createHeader(c,columnTemplate,t);
	}
	var tbody = createTiddlyElement(table,"tbody");
	for(var rc=0; rc<listObject.length; rc++) {
		rowObject = listObject[rc];
		r = createTiddlyElement(tbody,"tr");
		for(c=0; c<listTemplate.rowClasses.length; c++) {
			if(rowObject[listTemplate.rowClasses[c].field])
				addClass(r,listTemplate.rowClasses[c].className);
		}
		rowObject.rowElement = r;
		rowObject.colElements = {};
		for(var cc=0; cc<listTemplate.columns.length; cc++) {
			c = createTiddlyElement(r,"td");
			columnTemplate = listTemplate.columns[cc];
			var field = columnTemplate.field;
			colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem)
				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
			rowObject.colElements[field] = c;
		}
	}
	if(callback && listTemplate.actions)
		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
	if(callback && listTemplate.buttons) {
		for(t=0; t<listTemplate.buttons.length; t++) {
			var a = listTemplate.buttons[t];
			if(a && a.name != "")
				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
		}
	}
	return table;
};

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
	return function(e) {
		var view = findRelated(this,"TABLE",null,"previousSibling");
		var tiddlers = [];
		ListView.forEachSelector(view,function(e,rowName) {
					if(e.checked)
						tiddlers.push(rowName);
					});
		if(tiddlers.length == 0 && !allowEmptySelection) {
			alert(config.messages.nothingSelected);
		} else {
			if(this.nodeName.toLowerCase() == "select") {
				callback(view,this.value,tiddlers);
				this.selectedIndex = 0;
			} else {
				callback(view,name,tiddlers);
			}
		}
	};
};

// Invoke a callback for each selector checkbox in the listview
ListView.forEachSelector = function(view,callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var hadOne = false;
	for(var t=0; t<checkboxes.length; t++) {
		var cb = checkboxes[t];
		if(cb.getAttribute("type") == "checkbox") {
			var rn = cb.getAttribute("rowName");
			if(rn) {
				callback(cb,rn);
				hadOne = true;
			}
		}
	}
	return hadOne;
};

ListView.getSelectedRows = function(view)
{
	var rowNames = [];
	ListView.forEachSelector(view,function(e,rowName) {
				if(e.checked)
					rowNames.push(rowName);
				});
	return rowNames;
};

ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyText(place,columnTemplate.title);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v);
		}
};

ListView.columnTypes.WikiText = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				wikify(v,place,null,null);
		}
};

ListView.columnTypes.Tiddler = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined && v.title)
				createTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);
		}
};

ListView.columnTypes.Size = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var t = 0;
				while(t<config.messages.sizeTemplates.length-1 && v<config.messages.sizeTemplates[t].unit)
					t++;
				createTiddlyText(place,config.messages.sizeTemplates[t].template.format([Math.round(v/config.messages.sizeTemplates[t].unit)]));
			}
		}
};

ListView.columnTypes.Link = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			var c = columnTemplate.text;
			if(v != undefined)
				createTiddlyText(createExternalLink(place,v),c ? c : v);
		}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
		}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				for(var t=0; t<v.length; t++) {
					createTiddlyText(place,v[t]);
					createTiddlyElement(place,"br");
				}
			}
		}
};

ListView.columnTypes.Selector = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyCheckbox(place,null,false,this.onHeaderChange);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],null);
			e.setAttribute("rowName",listObject[columnTemplate.rowName]);
		},
	onHeaderChange: function(e)
		{
			var state = this.checked;
			var view = findRelated(this,"TABLE");
			if(!view)
				return;
			ListView.forEachSelector(view,function(e,rowName) {
								e.checked = state;
							});
		}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var tags = listObject[field];
			createTiddlyText(place,String.encodeTiddlyLinkList(tags));
		}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			if(listObject[field] == true)
				createTiddlyText(place,columnTemplate.trueText);
			if(listObject[field] == false)
				createTiddlyText(place,columnTemplate.falseText);
		}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
			e.setAttribute("tiddler",listObject.title);
			e.setAttribute("tag",columnTemplate.tag);
		},
	onChange : function(e)
		{
			var tag = this.getAttribute("tag");
			var tiddler = this.getAttribute("tiddler");
			store.setTiddlerTag(tiddler,this.checked,tag);
		}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
				createTiddlyText(link,listObject[field]);
			}
		}
};

//--
//-- Augmented methods for the JavaScript Number(), Array(), String() and Date() objects
//--

// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return c;
};

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
	if(!from)
		from = 0;
	for(var i=from; i<this.length; i++) {
		if(this[i] === item)
			return i;
	}
	return -1;
};}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
	for(var t=0; t<this.length; t++) {
		if(this[t][field] == value)
			return t;
	}
	return null;
};

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
	var p = this.indexOf(value);
	if(mode == 0)
		mode = (p == -1) ? +1 : -1;
	if(mode == +1) {
		if(p == -1)
			this.push(value);
	} else if(mode == -1) {
		if(p != -1)
			this.splice(p,1);
	}
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	for(var i=0; i<items.length; i++) {
		if (this.indexOf(items[i]) != -1)
			return true;
	}
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	for (var i = 0; i<items.length; i++) {
		if (this.indexOf(items[i]) == -1)
			return false;
	}
	return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique === false) {
		this.push(item);
	} else {
		if(this.indexOf(item) == -1)
			this.push(item);
	}
};

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1)
		this.splice(p,1);
};

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	return n < this.length ? this.slice(this.length-n) : this;
};

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
};

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var s = this.split("-");
	if(s.length > 1) {
		for(var t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	}
	return s.join("");
};

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(substrings)
{
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var r = [];
	do {
		var match = subRegExp.exec(this);
		if(match && match[1]) {
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1])]);
			currPos = subRegExp.lastIndex;
		}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
};

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	var s = "\\^$*+?()=!|,{}[].";
	var c = this;
	for(var t=0; t<s.length; t++)
		c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
	return c;
};

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
};

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
};

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;");
};

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return this.replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\"").replace(/&amp;/mg,"&");
};

// Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org
String.prototype.toJSONString = function()
{
	var m = {
		'\b': '\\b',
		'\f': '\\f',
		'\n': '\\n',
		'\r': '\\r',
		'\t': '\\t',
		'"' : '\\"',
		'\\': '\\\\'
		};
	var replaceFn = function(a,b) {
		var c = m[b];
		if(c)
			return c;
		c = b.charCodeAt();
		return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
		};
	if(/["\\\x00-\x1f]/.test(this))
		return '"' + this.replace(/([\x00-\x1f\\"])/g,replaceFn) + '"';
	return '"' + this + '"';
};

// Parse a space-separated string of name:value parameters
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
	var parseToken = function(match,p) {
		var n;
		if(match[p]) // Double quoted
			n = match[p];
		else if(match[p+1]) // Single quoted
			n = match[p+1];
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try {
				n = match[p+3];
				if(allowEval)
					n = window.eval(n);
			} catch(ex) {
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(ex);
			}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		else if(match[p+5]) // empty quote
			n = "";
		return n;
	};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames ? new RegExp(token,"mg") : new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
	var params = [];
	do {
		var match = re.exec(this);
		if(match) {
			var n = parseToken(match,1);
			if(noNames) {
				r.push({name:"",value:n});
			} else {
				var v = parseToken(match,8);
				if(v == null && defaultName) {
					v = n;
					n = defaultName;
				} else if(v == null && defaultValue) {
					v = defaultValue;
				}
				r.push({name:n,value:v});
				if(cascadeDefaults) {
					defaultName = n;
					defaultValue = v;
				}
			}
		}
	} while(match);
	// Summarise parameters into first element
	for(var t=1; t<r.length; t++) {
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
	}
	return r;
};

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function()
{
	var p = this.parseParams("list",null,true,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
};

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.pushUnique(p[t].value,unique);
	return n;
};

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end)
{
	var s = this.indexOf(start);
	if(s != -1) {
		s += start.length;
		var e = this.indexOf(end,s);
		if(e != -1)
			return [s,e];
	}
};

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var r = this.getChunkRange(start,end);
	return r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;
};

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
	var r = this.getChunkRange(start,end);
	if(r)
		return this.substring(r[0],r[1]);
};


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	return title.indexOf(" ") == -1 ? title : "[[" + title + "]]";
};

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(list) {
		var results = [];
		for(var t=0; t<list.length; t++)
			results.push(String.encodeTiddlyLink(list[t]));
		return results.join(" ");
	} else {
		return "";
	}
};

// Convert a string as a sequence of name:"value" pairs into a hashmap
String.prototype.decodeHashMap = function()
{
	var fields = this.parseParams("anon","",false);
	var r = {};
	for(var t=1; t<fields.length; t++)
		r[fields[t].name] = fields[t].value;
	return r;
};

// Static method to encode a hashmap into a name:"value"... string
String.encodeHashMap = function(hashmap)
{
	var r = [];
	for(var t in hashmap)
		r.push(t + ':"' + hashmap[t] + '"');
	return r.join(" ");
};

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return s;
};

String.prototype.startsWith = function(prefix)
{
	return !prefix || this.substring(0,prefix.length) == prefix;
};

// Returns the first value of the given named parameter.
function getParam(params,name,defaultValue)
{
	if(!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params,name,defaultValue)
{
	return !!getParam(params,name,defaultValue);
}

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
	t = t.replace(/hh12/g,this.getHours12());
	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	t = t.replace(/hh/g,this.getHours());
	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	t = t.replace(/mm/g,this.getMinutes());
	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	t = t.replace(/ss/g,this.getSeconds());
	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
	t = t.replace(/wYYYY/g,this.getYearForWeekNo());
	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
	t = t.replace(/YYYY/g,this.getFullYear());
	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	t = t.replace(/MM/g,this.getMonth()+1);
	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
	t = t.replace(/WW/g,this.getWeek());
	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
	t = t.replace(/DD/g,this.getDate());
	return t;
};

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if (d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);
	return Math.floor(n/7)+1;
};

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if (d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
	return dt.getFullYear();
};

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h-12 : ( h > 0 ? h : 12 );
};

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
};

Date.prototype.daySuffix = function()
{
	return config.messages.dates.daySuffixes[this.getDate()-1];
};

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return String.zeroPad(this.getFullYear(),4) + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);
};

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return String.zeroPad(this.getUTCFullYear(),4) + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);
};

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return String.zeroPad(this.getUTCFullYear(),4) + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),4);
};

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	return new Date(Date.UTC(parseInt(d.substr(0,4),10),
			parseInt(d.substr(4,2),10)-1,
			parseInt(d.substr(6,2),10),
			parseInt(d.substr(8,2),10),
			parseInt(d.substr(10,2),10),0,0));
};

//--
//-- Crypto functions and associated conversion routines
//--

// Crypto "namespace"
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	var be = Array();
	var len = Math.floor(str.length/4);
	var i, j;
	for(i=0, j=0; i<len; i++, j+=4) {
		be[i] = ((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
	}
	while (j<str.length) {
		be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
		j++;
	}
	return be;
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	var str = "";
	for(var i=0;i<be.length*32;i+=8)
		str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
	return str;
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	var hex = "0123456789ABCDEF";
	var str = "";
	for(var i=0;i<be.length*4;i++)
		str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
	return str;
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return Crypto.be32sToHex(Crypto.sha1Str(str));
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return Crypto.sha1(Crypto.strToBe32s(str),str.length);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	// Add 32-bit integers, wrapping at 32 bits
	add32 = function(a,b)
	{
		var lsw = (a&0xFFFF)+(b&0xFFFF);
		var msw = (a>>16)+(b>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	};
	// Add five 32-bit integers, wrapping at 32 bits
	add32x5 = function(a,b,c,d,e)
	{
		var lsw = (a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
		var msw = (a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	};
	// Bitwise rotate left a 32-bit integer by 1 bit
	rol32 = function(n)
	{
		return (n>>>31)|(n<<1);
	};

	var len = blen*8;
	// Append padding so length in bits is 448 mod 512
	x[len>>5] |= 0x80 << (24-len%32);
	// Append length
	x[((len+64>>9)<<4)+15] = len;
	var w = Array(80);

	var k1 = 0x5A827999;
	var k2 = 0x6ED9EBA1;
	var k3 = 0x8F1BBCDC;
	var k4 = 0xCA62C1D6;

	var h0 = 0x67452301;
	var h1 = 0xEFCDAB89;
	var h2 = 0x98BADCFE;
	var h3 = 0x10325476;
	var h4 = 0xC3D2E1F0;

	for(var i=0;i<x.length;i+=16) {
		var j,t;
		var a = h0;
		var b = h1;
		var c = h2;
		var d = h3;
		var e = h4;
		for(j = 0;j<16;j++) {
			w[j] = x[i+j];
			t = add32x5(e,(a>>>27)|(a<<5),d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
		}
		for(j=16;j<20;j++) {
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
		}
		for(j=20;j<40;j++) {
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),b^c^d,w[j],k2);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
		}
		for(j=40;j<60;j++) {
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),(b&c)|(d&(b|c)),w[j],k3);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
		}
		for(j=60;j<80;j++) {
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),b^c^d,w[j],k4);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
		}

		h0 = add32(h0,a);
		h1 = add32(h1,b);
		h2 = add32(h2,c);
		h3 = add32(h3,d);
		h4 = add32(h4,e);
	}
	return Array(h0,h1,h2,h3,h4);
};

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string") {
		if(r.substr(0,1) == "#") {
			if(r.length == 7) {
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
			} else {
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
			}
		} else {
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
			var c = r.match(rgbPattern);
			if(c) {
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
			}
		}
	} else {
		this.r = r;
		this.g = g;
		this.b = b;
	}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	return "#" + ("0" + Math.floor(this.r.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.g.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.b.clamp(0,1) * 255).toString(16)).right(2);
};

//--
//-- DOM utilities - many derived from www.quirksmode.org
//--

function drawGradient(place,horiz,colours)
{
	for(var t=0; t<= 100; t+=2) {
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var f = t/100;
		var p = f*(colours.length-1);
		bar.style.backgroundColor = colours[Math.floor(p)].mix(colours[Math.ceil(p)],p-Math.floor(p)).toString();
	}
}

function createTiddlyText(theParent,theText)
{
	return theParent.appendChild(document.createTextNode(theText));
}

function createTiddlyCheckbox(theParent,caption,checked,onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type","checkbox");
	cb.onclick = onChange;
	theParent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption,theParent);
	return cb;
}

function createTiddlyElement(theParent,theElement,theID,theClass,theText)
{
	var e = document.createElement(theElement);
	if(theClass != null)
		e.className = theClass;
	if(theID != null)
		e.setAttribute("id",theID);
	if(theText != null)
		e.appendChild(document.createTextNode(theText));
	if(theParent != null)
		theParent.appendChild(e);
	return e;
}

function addEvent(obj,type,fn)
{
	if(obj.attachEvent) {
		obj['e'+type+fn] = fn;
		obj[type+fn] = function(){obj['e'+type+fn](window.event);};
		obj.attachEvent('on'+type,obj[type+fn]);
	} else {
		obj.addEventListener(type,fn,false);
	}
}

function removeEvent(obj,type,fn)
{
	if(obj.detachEvent) {
		obj.detachEvent('on'+type,obj[type+fn]);
		obj[type+fn] = null;
	} else {
		obj.removeEventListener(type,fn,false);
	}
}

function addClass(e,theClass)
{
	var currClass = e.className.split(" ");
	if(currClass.indexOf(theClass) == -1)
		e.className += " " + theClass;
}

function removeClass(e,theClass)
{
	var currClass = e.className.split(" ");
	var i = currClass.indexOf(theClass);
	while(i != -1) {
		currClass.splice(i,1);
		i = currClass.indexOf(theClass);
	}
	e.className = currClass.join(" ");
}

function hasClass(e,theClass)
{
	if(e.className) {
		if(e.className.split(" ").indexOf(theClass) != -1)
			return true;
	}
	return false;
}

// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
	name = name ? name : "tagName";
	relative = relative ? relative : "parentNode";
	if(name == "className") {
		while(e && !hasClass(e,value)) {
			e = e[relative];
		}
	} else {
		while(e && e[name] != value) {
			e = e[relative];
		}
	}
	return e;
}

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if(e.target)
		obj = e.target;
	else if(e.srcElement)
		obj = e.srcElement;
	if(obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return obj;
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	var text = "";
	if(e.innerText)
		text = e.innerText;
	else if(e.textContent)
		text = e.textContent;
	return text;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop) {
		return posTop;
	} else if(posBot > winBot) {
		if(e.offsetHeight < winHeight)
			return posTop - (winHeight - e.offsetHeight);
		else
			return posTop;
	} else {
		return winTop;
	}
}

// Get the current width of the display window
function findWindowWidth()
{
	return window.innerWidth ? window.innerWidth : document.documentElement.clientWidth;
}

// Get the current height of the display window
function findWindowHeight()
{
	return window.innerHeight ? window.innerHeight : document.documentElement.clientHeight;
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return window.scrollX ? window.scrollX : document.documentElement.scrollLeft;
}

// Get the current vertical page scroll position
function findScrollY()
{
	return window.scrollY ? window.scrollY : document.documentElement.scrollTop;
}

function findPosX(obj)
{
	var curleft = 0;
	while(obj.offsetParent) {
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
	}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while(obj.offsetParent) {
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
	}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e != null && e.focus && e.blur) {
		e.focus();
		e.blur();
	}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Remove all children of a node
function removeChildren(e)
{
	while(e && e.hasChildNodes())
		removeNode(e.firstChild);
}

// Remove a node and all it's children
function removeNode(e)
{
	scrubNode(e);
	e.parentNode.removeChild(e);
}

// Remove any event handlers or non-primitve custom attributes
function scrubNode(e)
{
	if(!config.browser.isIE)
		return;
	var att = e.attributes;
	if(att) {
		for(var t=0; t<att.length; t++) {
			var n = att[t].name;
			if(n !== 'style' && (typeof e[n] === 'function' || (typeof e[n] === 'object' && e[n] != null))) {
				try {
					e[n] = null;
				} catch(ex) {
				}
			}
		}
	}
	var c = e.firstChild;
	while(c) {
		scrubNode(c);
		c = c.nextSibling;
	}
}

// Add a stylesheet, replacing any previous custom stylesheet
function setStylesheet(s,id,doc)
{
	if(!id)
		id = "customStyleSheet";
	if(!doc)
		doc = document;
	var n = doc.getElementById(id);
	if(doc.createStyleSheet) {
		// Test for IE's non-standard createStyleSheet method
		if(n)
			n.parentNode.removeChild(n);
		// This failed without the &nbsp;
		doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style id='" + id + "'>" + s + "</style>");
	} else {
		if(n) {
			n.replaceChild(doc.createTextNode(s),n.firstChild);
		} else {
			n = doc.createElement("style");
			n.type = "text/css";
			n.id = id;
			n.appendChild(doc.createTextNode(s));
			doc.getElementsByTagName("head")[0].appendChild(n);
		}
	}
}

// Force the browser to do a document reflow when needed to workaround browser bugs
function forceReflow()
{
	if(config.browser.isGecko) {
		setStylesheet("body {top:-1em;margin-top:1em;}");
		setStylesheet("");
	}
}

// Replace the current selection of a textarea or text input and scroll it into view
function replaceSelection(e,text)
{
	if(e.setSelectionRange) {
		var oldpos = e.selectionStart;
		var isRange = e.selectionEnd > e.selectionStart;
		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);
		e.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);
		var linecount = e.value.split('\n').length;
		var thisline = e.value.substr(0,e.selectionStart).split('\n').length-1;
		e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);
	} else if(document.selection) {
		var range = document.selection.createRange();
		if(range.parentElement() == e) {
			var isCollapsed = range.text == "";
			range.text = text;
			if(!isCollapsed) {
				range.moveStart('character', -text.length);
				range.select();
			}
		}
	}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var t = "";
	while(e && e.nodeName == "#text") {
		t += e.nodeValue;
		e = e.nextSibling;
	}
	return t;
}

//--
//-- LoaderBase and SaverBase
//--

function LoaderBase() {}

LoaderBase.prototype.loadTiddler = function(store,node,tiddlers)
{
	var title = this.getTitle(store,node);
	if(title) {
		var tiddler = store.createTiddler(title);
		this.internalizeTiddler(store,tiddler,title,node);
		tiddlers.push(tiddler);
	}
};

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
	var tiddlers = [];
	for(var t = 0; t < nodes.length; t++) {
		try {
			this.loadTiddler(store,nodes[t],tiddlers);
		} catch(ex) {
			showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));
		}
	}
	return tiddlers;
};

function SaverBase() {}

SaverBase.prototype.externalize = function(store)
{
	var results = [];
	var tiddlers = store.getTiddlers("title");
	for(var t = 0; t < tiddlers.length; t++)
		results.push(this.externalizeTiddler(store,tiddlers[t]));
	return results.join("\n");
};

//--
//-- TW21Loader (inherits from LoaderBase)
//--

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store,node)
{
	var title = null;
	if(node.getAttribute) {
		title = node.getAttribute("title");
		if(!title)
			title = node.getAttribute("tiddler");
	}
	if(!title && node.id) {
		var lenPrefix = store.idPrefix.length;
		if (node.id.substr(0,lenPrefix) == store.idPrefix)
			title = node.id.substr(lenPrefix);
	}
	return title;
};

TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)
{
	var e = node.firstChild;
	var text = null;
	if(node.getAttribute("tiddler")) {
		text = getNodeText(e).unescapeLineBreaks();
	} else {
		while(e.nodeName!="PRE" && e.nodeName!="pre") {
			e = e.nextSibling;
		}
		text = e.innerHTML.replace(/\r/mg,"").htmlDecode();
	}
	var modifier = node.getAttribute("modifier");
	var c = node.getAttribute("created");
	var m = node.getAttribute("modified");
	var created = c ? Date.convertFromYYYYMMDDHHMM(c) : version.date;
	var modified = m ? Date.convertFromYYYYMMDDHHMM(m) : created;
	var tags = node.getAttribute("tags");
	var fields = {};
	var attrs = node.attributes;
	for(var i = attrs.length-1; i >= 0; i--) {
		var name = attrs[i].name;
		if (attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title,text,modifier,modified,tags,created,fields);
	return tiddler;
};

//--
//-- TW21Saver (inherits from SaverBase)
//--

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store,tiddler)
{
	try {
		var extendedAttributes = "";
		var usePre = config.options.chkUsePreForStorage;
		store.forEachField(tiddler,
			function(tiddler,fieldName,value) {
				// don't store stuff from the temp namespace
				if(typeof value != "string")
					value = "";
				if (!fieldName.match(/^temp\./))
					extendedAttributes += ' %0="%1"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);
			},true);
		var created = tiddler.created.convertToYYYYMMDDHHMM();
		var modified = tiddler.modified.convertToYYYYMMDDHHMM();
		var vdate = version.date.convertToYYYYMMDDHHMM();
		var attributes = tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "";
		attributes += (usePre && modified == created) ? "" : ' modified="' + modified +'"';
		attributes += (usePre && created == vdate) ? "" :' created="' + created + '"';
		var tags = tiddler.getTags();
		if(!usePre || tags)
			attributes += ' tags="' + tags.htmlEncode() + '"';
		return ('<div %0="%1"%2%3>%4</'+'div>').format([
				usePre ? "title" : "tiddler",
				tiddler.title.htmlEncode(),
				attributes,
				extendedAttributes,
				usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.text.escapeLineBreaks().htmlEncode()
			]);
	} catch (ex) {
		throw exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));
	}
};

//--
//-- Deprecated code
//--

// @Deprecated: Use createElementAndWikify and this.termRegExp instead
config.formatterHelpers.charFormatHelper = function(w)
{
	w.subWikify(createTiddlyElement(w.output,this.element),this.terminator);
};

// @Deprecated: Use enclosedTextHelper and this.lookaheadRegExp instead
config.formatterHelpers.monospacedByLineHelper = function(w)
{
	var lookaheadRegExp = new RegExp(this.lookahead,"mg");
	lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = lookaheadRegExp.exec(w.source);
	if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
		var text = lookaheadMatch[1];
		if(config.browser.isIE)
			text = text.replace(/\n/g,"\r");
		createTiddlyElement(w.output,"pre",null,null,text);
		w.nextMatch = lookaheadRegExp.lastIndex;
	}
};

// @Deprecated: Use <br> or <br /> instead of <<br>>
config.macros.br.handler = function(place)
{
	createTiddlyElement(place,"br");
};

// Find an entry in an array. Returns the array index or null
// @Deprecated: Use indexOf instead
Array.prototype.find = function(item)
{
	var i = this.indexOf(item);
	return i == -1 ? null : i;
};

// Load a tiddler from an HTML DIV. The caller should make sure to later call Tiddler.changed()
// @Deprecated: Use store.getLoader().internalizeTiddler instead
Tiddler.prototype.loadFromDiv = function(divRef,title)
{
	return store.getLoader().internalizeTiddler(store,this,title,divRef);
};

// Format the text for storage in an HTML DIV
// @Deprecated Use store.getSaver().externalizeTiddler instead.
Tiddler.prototype.saveToDiv = function()
{
	return store.getSaver().externalizeTiddler(store,this);
};

// @Deprecated: Use store.allTiddlersAsHtml() instead
function allTiddlersAsHtml()
{
	return store.allTiddlersAsHtml();
}

// @Deprecated: Use refreshPageTemplate instead
function applyPageTemplate(title)
{
	refreshPageTemplate(title);
}

// @Deprecated: Use story.displayTiddlers instead
function displayTiddlers(srcElement,titles,template,unused1,unused2,animate,unused3)
{
	story.displayTiddlers(srcElement,titles,template,animate);
}

// @Deprecated: Use story.displayTiddler instead
function displayTiddler(srcElement,title,template,unused1,unused2,animate,unused3)
{
	story.displayTiddler(srcElement,title,template,animate);
}

// @Deprecated: Use functions on right hand side directly instead
var createTiddlerPopup = Popup.create;
var scrollToTiddlerPopup = Popup.show;
var hideTiddlerPopup = Popup.remove;

// @Deprecated: Use right hand side directly instead
var regexpBackSlashEn = new RegExp("\\\\n","mg");
var regexpBackSlash = new RegExp("\\\\","mg");
var regexpBackSlashEss = new RegExp("\\\\s","mg");
var regexpNewLine = new RegExp("\n","mg");
var regexpCarriageReturn = new RegExp("\r","mg");
//--
//-- End of scripts
//--
//]]>
</script>
<script type="text/javascript">
//<![CDATA[
if(useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<!--POST-SCRIPT-START-->

<!--POST-SCRIPT-END-->
</body>
</html>